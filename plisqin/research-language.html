<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/plisqin/research-language.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:29:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>7&nbsp;Plisqin as a Research Language</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Plisqin</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Read_Me_First.html" class="tocviewlink" data-pltdoc="x">Read Me First</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="using-define-schema.html" class="tocviewlink" data-pltdoc="x">Using define-<wbr></wbr>schema</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Aggregates.html" class="tocviewlink" data-pltdoc="x">Aggregates</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Nullability.html" class="tocviewlink" data-pltdoc="x">Nullability</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Refactoring_Recipes.html" class="tocviewlink" data-pltdoc="x">Refactoring Recipes</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Reference.html" class="tocviewlink" data-pltdoc="x">Reference</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Plisqin as a Research Language</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>7&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Plisqin as a Research Language</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">7.1&nbsp;</td><td><a href="#%28part._.My_.Ideal_.Query_.Language%29" class="tocviewlink" data-pltdoc="x">My Ideal Query Language</a></td></tr><tr><td align="right">7.2&nbsp;</td><td><a href="#%28part._.Plisqin_.Desugared%29" class="tocviewlink" data-pltdoc="x">Plisqin Desugared</a></td></tr><tr><td align="right">7.3&nbsp;</td><td><a href="#%28part._.Open_.Questions_and_.Shortcomings%29" class="tocviewlink" data-pltdoc="x">Open Questions and Shortcomings</a></td></tr><tr><td align="right">7.4&nbsp;</td><td><a href="#%28part._.Other_.Random_.Thoughts%29" class="tocviewlink" data-pltdoc="x">Other Random Thoughts</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">7.1<tt>&nbsp;</tt></span><a href="#%28part._.My_.Ideal_.Query_.Language%29" class="tocsubseclink" data-pltdoc="x">My Ideal Query Language</a></td></tr><tr><td><span class="tocsublinknumber">7.1.1<tt>&nbsp;</tt></span><a href="#%28part._.Rule_of_.Power%29" class="tocsubseclink" data-pltdoc="x">Rule of Power</a></td></tr><tr><td><span class="tocsublinknumber">7.1.2<tt>&nbsp;</tt></span><a href="#%28part._.Rule_of_.Uniformity%29" class="tocsubseclink" data-pltdoc="x">Rule of Uniformity</a></td></tr><tr><td><span class="tocsublinknumber">7.1.3<tt>&nbsp;</tt></span><a href="#%28part._.Rule_of_.Polymorphism%29" class="tocsubseclink" data-pltdoc="x">Rule of Polymorphism</a></td></tr><tr><td><span class="tocsublinknumber">7.2<tt>&nbsp;</tt></span><a href="#%28part._.Plisqin_.Desugared%29" class="tocsubseclink" data-pltdoc="x">Plisqin Desugared</a></td></tr><tr><td><span class="tocsublinknumber">7.3<tt>&nbsp;</tt></span><a href="#%28part._.Open_.Questions_and_.Shortcomings%29" class="tocsubseclink" data-pltdoc="x">Open Questions and Shortcomings</a></td></tr><tr><td><span class="tocsublinknumber">7.3.1<tt>&nbsp;</tt></span><a href="#%28part._.The_.Limit_.Offset_.Problem%29" class="tocsubseclink" data-pltdoc="x">The Limit/<span class="mywbr"> &nbsp;</span>Offset Problem</a></td></tr><tr><td><span class="tocsublinknumber">7.3.2<tt>&nbsp;</tt></span><a href="#%28part._.Nominal_vs_.Structural_.Typing%29" class="tocsubseclink" data-pltdoc="x">Nominal vs Structural Typing</a></td></tr><tr><td><span class="tocsublinknumber">7.3.2.1<tt>&nbsp;</tt></span><a href="#%28part._.Basic_.Structural_.Typing_is_not_.Good_.Enough%29" class="tocsubseclink" data-pltdoc="x">Basic Structural Typing is not Good Enough</a></td></tr><tr><td><span class="tocsublinknumber">7.3.2.2<tt>&nbsp;</tt></span><a href="#%28part._.A_.Hybrid_.Approach_%29" class="tocsubseclink" data-pltdoc="x">A Hybrid Approach?</a></td></tr><tr><td><span class="tocsublinknumber">7.3.3<tt>&nbsp;</tt></span><a href="#%28part._.Lateral_.Joins%29" class="tocsubseclink" data-pltdoc="x">Lateral Joins</a></td></tr><tr><td><span class="tocsublinknumber">7.3.4<tt>&nbsp;</tt></span><a href="#%28part._.Nullability_and_exists%29" class="tocsubseclink" data-pltdoc="x">Nullability and <span class="RktSym"><span class="RktValLink">exists</span></span></a></td></tr><tr><td><span class="tocsublinknumber">7.4<tt>&nbsp;</tt></span><a href="#%28part._.Other_.Random_.Thoughts%29" class="tocsubseclink" data-pltdoc="x">Other Random Thoughts</a></td></tr><tr><td><span class="tocsublinknumber">7.4.1<tt>&nbsp;</tt></span><a href="#%28part._.Cardinality%29" class="tocsubseclink" data-pltdoc="x">Cardinality</a></td></tr><tr><td><span class="tocsublinknumber">7.4.2<tt>&nbsp;</tt></span><a href="#%28part._.Separating_.Specification_from_.Implementation%29" class="tocsubseclink" data-pltdoc="x">Separating Specification from Implementation</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.6</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="plisqin-examples_adventure-works.html" title="backward to &quot;6.5 plisqin-examples/adventure-works&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Plisqin&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h3 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;research-language&quot;">7<tt>&nbsp;</tt><a name="(part._research-language)"></a>Plisqin as a Research Language</h3><h4 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;My_Ideal_Query_Language&quot;">7.1<tt>&nbsp;</tt><a name="(part._.My_.Ideal_.Query_.Language)"></a>My Ideal Query Language</h4><p>To me, the perfect query language for relational databases must satisfy
at least the following rules.</p><p>(There are other qualities that my perfect query language must have,
but I cannot distill them into simple rules.
The generalized <span class="RktSym">sales-report</span> created in the
<a href="using-define-schema.html" data-pltdoc="x">Using define-schema</a> walkthrough is a good example.)</p><h5 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;Rule_of_Power&quot;">7.1.1<tt>&nbsp;</tt><a name="(part._.Rule_of_.Power)"></a>Rule of Power</h5><p><span class="emph">If the database knows a fact about some table <span class="RktSym">T</span>, then it
must be possible to encode that fact into a function that takes a single
argument representing a row in the table <span class="RktSym">T</span>.</span></p><p><div class="SIntrapara">For example, assume that "total sales since 2004" is a fact that our database
knows about the <span class="RktSym">Product</span> table.
Plisqin allows you to encode that fact into a procedure as follows:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=attaching-contracts-to-values.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fregion..rkt%2529._define%252Fcontract%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define/contract</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">total-sales-since-2004</span><span class="hspace">&nbsp;</span><span class="RktSym">product</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Product</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Ftypes..rkt%29._.Number~3f%29%29" class="RktValLink" data-pltdoc="x">Number?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._error%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"to be implemented"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>Note that the choice of implementation is not important here.
What is important is the contract (or "type signature", if you prefer).</p><p>Also, it would be silly not to make "2004" an argument in real code.
The "single argument" mandate is a litmus test for language designers, not a
recommendation for end users of the language.</p><h5 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;Rule_of_Uniformity&quot;">7.1.2<tt>&nbsp;</tt><a name="(part._.Rule_of_.Uniformity)"></a>Rule of Uniformity</h5><p><span class="emph">There must be a uniform call-site syntax for every kind of fact,
regardless of how that fact is implemented.</span></p><p><div class="SIntrapara">This rule is intended to insulate calling code from changes in implementation.
For example, let&rsquo;s imagine that "total sales" is a fact about the Product table.
In Plisqin, the call-site syntax is always <span class="RktPn">(</span><span class="RktSym">total-sales</span><span class="stt"> </span><span class="RktSym">product</span><span class="RktPn">)</span>.
The implementation might be any of the following
</div><div class="SIntrapara"><ul><li><p>A simple access of the Product.TotalSales column</p></li><li><p>An access of the ProductStats.TotalSales column,
assuming that Product:ProductStats is a 1:1 relationship</p></li><li><p>A subquery of the SalesOrderDetail table,
assuming that Product:SalesOrderDetail is a 1:many relationship</p></li><li><p>A <a href="Aggregates.html#%28tech._grouped._join._aggregation%29" class="techoutside" data-pltdoc="x"><span class="techinside">grouped join aggregation</span></a> of the SalesOrderDetail table,
assuming that Product:SalesOrderDetail is a 1:many relationship</p></li><li><p>A stored procedure call</p></li></ul></div></p><p>... or anything else. The implementation does not matter.
What matters is being able to change the implementation without breaking the
call sites.</p><p>This rule does not prohibit other non-uniform syntaxes from being supported.
For example, your uniform syntax might be <span class="RktSym">product..total_sales</span>
but you could also support <span class="RktSym">product.total_sales</span>
which would raise an error if <span class="RktSym">total_sales</span> is not a direct column
access of the table identified by <span class="RktSym">product</span>.</p><h5 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;Rule_of_Polymorphism&quot;">7.1.3<tt>&nbsp;</tt><a name="(part._.Rule_of_.Polymorphism)"></a>Rule of Polymorphism</h5><p><span class="emph">If the database knows the same fact about multiple tables
<span class="RktSym">T1</span><span class="stt"> </span><span class="RktSym">..</span><span class="stt"> </span><span class="RktSym">TN</span>, then it must be possible to encode that fact into a
function that accepts a single argument representing a row in any of the
tables <span class="RktSym">T1</span><span class="stt"> </span><span class="RktSym">..</span><span class="stt"> </span><span class="RktSym">TN</span>.</span></p><p>For example, assume that CategoryName is a fact about the Category table,
and CategoryName is also a fact about the Subcategory table.
This rule states that it must be possible to create a <span class="RktSym">CategoryName</span>
function that will work whether it is passed a Category or a Subcategory.</p><p><div class="SIntrapara">This rule is the main motivation behind <span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._define-schema%29%29" class="RktStxLink" data-pltdoc="x">define-schema</a></span>.
But users of Plisqin could also write polymorphic functions by hand, as follows:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=attaching-contracts-to-values.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fregion..rkt%2529._define%252Fcontract%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define/contract</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">CategoryName</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Category</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Subcategory</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Ftypes..rkt%29._.Scalar~3f%29%29" class="RktValLink" data-pltdoc="x">Scalar?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Category</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._scalar%29%29" class="RktValLink" data-pltdoc="x">%%scalar</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktVal">".CategoryName"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Subcategory</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">this will recurse with an (instanceof Category)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">CategoryName</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._join%29%29" class="RktStxLink" data-pltdoc="x">join</a></span><span class="hspace">&nbsp;</span><span class="RktSym">cat</span><span class="hspace">&nbsp;</span><span class="RktSym">Category</span><span class="hspace">&nbsp;</span><span class="RktPn">#:to</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._join-on%29%29" class="RktValLink" data-pltdoc="x">join-on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict%2Foperators..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">.=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">CategoryID</span><span class="hspace">&nbsp;</span><span class="RktSym">cat</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">CategoryID</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h4 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;Plisqin_Desugared&quot;">7.2<tt>&nbsp;</tt><a name="(part._.Plisqin_.Desugared)"></a>Plisqin Desugared</h4><p><div class="SIntrapara">The following example shows how the <a href="using-define-schema.html#%28part._.Teaser%29" data-pltdoc="x">Teaser</a> from the define-schema
walkthrough can be recreated using the smallest possible subset of Plisqin.
Here we will use the <a href="Read_Me_First.html#%28tech._unsafe%29" class="techoutside" data-pltdoc="x"><span class="techinside">unsafe</span></a> variant because it will be cumbersome to
avoid typecheck and nullcheck errors without using <span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._define-schema%29%29" class="RktStxLink" data-pltdoc="x">define-schema</a></span>.
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._only-in%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">only-in</a></span><span class="hspace">&nbsp;</span><span class="RktSym">plisqin</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._to-sql%29%29" class="RktValLink" data-pltdoc="x">to-sql</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._from%29%29" class="RktStxLink" data-pltdoc="x">from</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._join%29%29" class="RktStxLink" data-pltdoc="x">join</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._limit%29%29" class="RktValLink" data-pltdoc="x">limit</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._scalar%29%29" class="RktValLink" data-pltdoc="x">%%scalar</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._aggregate%29%29" class="RktValLink" data-pltdoc="x">%%aggregate</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._select%29%29" class="RktValLink" data-pltdoc="x">%%select</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._join-on%29%29" class="RktValLink" data-pltdoc="x">%%join-on</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._group-by%29%29" class="RktValLink" data-pltdoc="x">%%group-by</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._order-by%29%29" class="RktValLink" data-pltdoc="x">%%order-by</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._prefix-in%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">prefix-in</a></span><span class="hspace">&nbsp;</span><span class="RktSym">aw:</span><span class="hspace">&nbsp;</span><span class="RktSym">plisqin-examples/adventure-works</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">undefined</span><span class="hspace">&nbsp;</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">arg</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._error%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"~a is not defined for:"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">name</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">arg</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductName</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">Product</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._scalar%29%29" class="RktValLink" data-pltdoc="x">%%scalar</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktVal">".Name"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">undefined</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">ProductName</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductID</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">Product</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._scalar%29%29" class="RktValLink" data-pltdoc="x">%%scalar</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktVal">".ProductID"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">SalesOrderDetail</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._scalar%29%29" class="RktValLink" data-pltdoc="x">%%scalar</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktVal">".ProductID"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">undefined</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">ProductID</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">CategoryName</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">ProductCategory</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._scalar%29%29" class="RktValLink" data-pltdoc="x">%%scalar</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktVal">".Name"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">CategoryName</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductCategory</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductCategory</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">ProductSubcategory</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._join%29%29" class="RktStxLink" data-pltdoc="x">join</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">ProductCategory</span><span class="hspace">&nbsp;</span><span class="RktPn">#:to</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._join-on%29%29" class="RktValLink" data-pltdoc="x">%%join-on</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pc</span><span class="RktVal">".ProductCategoryID = "</span><span class="RktSym">x</span><span class="RktVal">".ProductCategoryID"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductCategory</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductSubcategory</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductSubcategory</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">Product</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._join%29%29" class="RktStxLink" data-pltdoc="x">join</a></span><span class="hspace">&nbsp;</span><span class="RktSym">subcat</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">ProductSubcategory</span><span class="hspace">&nbsp;</span><span class="RktPn">#:to</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._join-on%29%29" class="RktValLink" data-pltdoc="x">%%join-on</a></span><span class="hspace">&nbsp;</span><span class="RktSym">subcat</span><span class="RktVal">".ProductSubcategoryID = "</span><span class="RktSym">x</span><span class="RktVal">".ProductSubcategoryID"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">undefined</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">ProductSubcategory</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">DetailsG</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">Product</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._join%29%29" class="RktStxLink" data-pltdoc="x">join</a></span><span class="hspace">&nbsp;</span><span class="RktSym">dtls</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">SalesOrderDetail</span><span class="hspace">&nbsp;</span><span class="RktPn">#:to</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._group-by%29%29" class="RktValLink" data-pltdoc="x">%%group-by</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductID</span><span class="hspace">&nbsp;</span><span class="RktSym">dtls</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._join-on%29%29" class="RktValLink" data-pltdoc="x">%%join-on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductID</span><span class="hspace">&nbsp;</span><span class="RktSym">dtls</span><span class="RktPn">)</span><span class="RktVal">" = "</span><span class="RktPn">(</span><span class="RktSym">ProductID</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">undefined</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">DetailsG</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">TotalSales</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">Product</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%252A%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">let*</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">dtls</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">DetailsG</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">line-total</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._scalar%29%29" class="RktValLink" data-pltdoc="x">%%scalar</a></span><span class="hspace">&nbsp;</span><span class="RktSym">dtls</span><span class="RktVal">".LineTotal"</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._aggregate%29%29" class="RktValLink" data-pltdoc="x">%%aggregate</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"sum("</span><span class="RktSym">line-total</span><span class="RktVal">")"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">undefined</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">TotalSales</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">the-query</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._from%29%29" class="RktStxLink" data-pltdoc="x">from</a></span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">Product</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._select%29%29" class="RktValLink" data-pltdoc="x">%%select</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductName</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="RktPn">)</span><span class="RktVal">" as ProductName"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._select%29%29" class="RktValLink" data-pltdoc="x">%%select</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">CategoryName</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="RktPn">)</span><span class="RktVal">" as CategoryName"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._select%29%29" class="RktValLink" data-pltdoc="x">%%select</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">TotalSales</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="RktPn">)</span><span class="RktVal">" as TotalSales"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._order-by%29%29" class="RktValLink" data-pltdoc="x">%%order-by</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">desc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">TotalSales</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-examples_adventure-works.html#%28def._%28%28lib._plisqin-examples%2Fadventure-works..rkt%29._show-table%29%29" class="RktValLink" data-pltdoc="x">aw:show-table</a></span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._from%29%29" class="RktStxLink" data-pltdoc="x">from</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">the-query</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._limit%29%29" class="RktValLink" data-pltdoc="x">limit</a></span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">ProductName</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">	CategoryName	TotalSales</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span></p></td></tr><tr><td><p><span class="RktOut">---</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">	--- </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">	--- </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span></p></td></tr><tr><td><p><span class="RktOut">Mountain-200 Black, 38 	Bikes </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">	4400592.800400055 </span></p></td></tr><tr><td><p><span class="RktOut">Mountain-200 Black, 42 	Bikes </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">	4009494.761841063 </span></p></td></tr><tr><td><p><span class="RktOut">Mountain-200 Silver, 38	Bikes </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">	3693678.0252720583</span></p></td></tr></table></td></tr></table></blockquote></div></p><h4 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;Open_Questions_and_Shortcomings&quot;">7.3<tt>&nbsp;</tt><a name="(part._.Open_.Questions_and_.Shortcomings)"></a>Open Questions and Shortcomings</h4><p>Plisqin is closer to my ideal query language than anything else I&rsquo;ve tried.
But there are still some rough edges that could be improved.</p><h5 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;The_Limit_Offset_Problem&quot;">7.3.1<tt>&nbsp;</tt><a name="(part._.The_.Limit_.Offset_.Problem)"></a>The Limit/Offset Problem</h5><p>See <a href="https://github.com/default-kramer/plisqin/issues/12">this issue</a>.</p><p>This problem highlights the fact that a scalar is more than just a data type
(such as <span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Ftypes..rkt%29._.Number~3f%29%29" class="RktValLink" data-pltdoc="x">Number?</a></span>) and a nullability (such as <span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._no%29%29" class="RktValLink" data-pltdoc="x">no</a></span>).
There is at least one more aspect, which I called "static" in the Github issue,
which is relevant here.
But can we always know whether an expression is "static", or does it depend
on where it is being used...?</p><p>An easy way around this is to add <a href="Read_Me_First.html#%28tech._unsafe%29" class="techoutside" data-pltdoc="x"><span class="techinside">unsafe</span></a> versions of <span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._limit%29%29" class="RktValLink" data-pltdoc="x">limit</a></span>
and <span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._offset%29%29" class="RktValLink" data-pltdoc="x">offset</a></span>, but that is not interesting from a research perspective.</p><h5 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;Nominal_vs_Structural_Typing&quot;">7.3.2<tt>&nbsp;</tt><a name="(part._.Nominal_vs_.Structural_.Typing)"></a>Nominal vs Structural Typing</h5><p><div class="SIntrapara">Plisqin currently satisfies the Rule of Polymorphism using nominal typing.
Specifically, it uses <span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span> to dispatch:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">CategoryName</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ProductCategory</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._scalar%29%29" class="RktValLink" data-pltdoc="x">%%scalar</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktVal">".Name"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ProductSubcategory</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">presumably (ProductCategory x) is returning a join here</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">CategoryName</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductCategory</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara">As long as you have an instance of <span class="RktSym">ProductCategory</span> or
<span class="RktSym">ProductSubcategory</span>, the previous function works fine.
But the following example will not work:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._from%29%29" class="RktStxLink" data-pltdoc="x">from</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._subquery%29%29" class="RktValLink" data-pltdoc="x">subquery</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._from%29%29" class="RktStxLink" data-pltdoc="x">from</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pc</span><span class="hspace">&nbsp;</span><span class="RktSym">ProductCategory</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._select%29%29" class="RktValLink" data-pltdoc="x">%%select</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"42 as Blah"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._select%29%29" class="RktValLink" data-pltdoc="x">select</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">CategoryName</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara">Should <span class="RktSym">x</span> be considered an <span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="stt"> </span><span class="RktSym">ProductCategory</span><span class="RktPn">)</span>?
Absolutely not!
It has none of the columns that we expect an instance of ProductCategory to have.
That was a silly example, so consider another one:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._from%29%29" class="RktStxLink" data-pltdoc="x">from</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._subquery%29%29" class="RktValLink" data-pltdoc="x">subquery</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._from%29%29" class="RktStxLink" data-pltdoc="x">from</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pc</span><span class="hspace">&nbsp;</span><span class="RktSym">ProductCategory</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._select%29%29" class="RktValLink" data-pltdoc="x">select</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Name</span><span class="hspace">&nbsp;</span><span class="RktSym">pc</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._select%29%29" class="RktValLink" data-pltdoc="x">select</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">CategoryName</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>This time, the previous example would actually work if we consider <span class="RktSym">x</span>
to be an <span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="stt"> </span><span class="RktSym">ProductCategory</span><span class="RktPn">)</span>.
This highlights the problem.
A subquery might have some but not all of the columns that a normal instance
of the same table would have.</p><p>This turns out not to be a big problem because the query composition techniques
that Plisqin encourages make subqueries less common.
Still, my ideal query language probably needs an answer to this problem.</p><h5 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;Basic_Structural_Typing_is_not_Good_Enough&quot;">7.3.2.1<tt>&nbsp;</tt><a name="(part._.Basic_.Structural_.Typing_is_not_.Good_.Enough)"></a>Basic Structural Typing is not Good Enough</h5><p><div class="SIntrapara">In theory, a structural type system could notice that the subquery and the
ProductCategory table are structurally identical.
That is, they have the same column names and types.
But a purely structural approach makes dispatch awkward.
How would we redefine <span class="RktSym">CategoryName</span> using structural typing?
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">CategoryName</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">looks-like-a-category?</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._scalar%29%29" class="RktValLink" data-pltdoc="x">%%scalar</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktVal">".Name"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">CategoryName</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductCategory</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>I omitted the definition of <span class="RktSym">looks-like-a-category?</span> because I don&rsquo;t
think there is a good answer.
We could check that it has a numeric ProductCategoryID column and a string
Name column, but that is probably not accurate.
After all, the ProductSubcategory table might also have those two columns, but
its Name is not the same as a ProductCategory&rsquo;s Name.
(This problem could be avoided by renaming the columns to CategoryName and
SubcategoryName, but this places constraints on the design of the database
schema, which Plisqin does not want to do.)</p><h5 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;A_Hybrid_Approach_&quot;">7.3.2.2<tt>&nbsp;</tt><a name="(part._.A_.Hybrid_.Approach_)"></a>A Hybrid Approach?</h5><p><div class="SIntrapara">One possibility is to allow something like the following
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._subquery%29%29" class="RktValLink" data-pltdoc="x">%%subquery</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:instanceof</span><span class="hspace">&nbsp;</span><span class="RktSym">ProductCategory</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"select *, 'hello world' as Greeting from ProductCategory"</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>This would mean that when that subquery is used as a queryable, the instance
would be an <span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="stt"> </span><span class="RktSym">ProductCategory</span><span class="RktPn">)</span>.
And based on what we know about SQL, this would work just fine (assuming that
ProductCategory table does not already have a Greeting column).</p><p><div class="SIntrapara">Now consider the following:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._subquery%29%29" class="RktValLink" data-pltdoc="x">subquery</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:instanceof</span><span class="hspace">&nbsp;</span><span class="RktSym">ProductCategory</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._from%29%29" class="RktStxLink" data-pltdoc="x">from</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pc</span><span class="hspace">&nbsp;</span><span class="RktSym">ProductCategory</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._select%29%29" class="RktValLink" data-pltdoc="x">select</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductCategoryID</span><span class="hspace">&nbsp;</span><span class="RktSym">pc</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._select%29%29" class="RktValLink" data-pltdoc="x">select</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Name</span><span class="hspace">&nbsp;</span><span class="RktSym">pc</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>The previous subquery can pass for an <span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="stt"> </span><span class="RktSym">ProductCategory</span><span class="RktPn">)</span> as
long as we only ever attempt to access its ProductCategoryID and Name columns.
If we attempt to access any other column, it will be an error.
This might be reasonable behavior and possible to make well-defined.</p><p>Basically, we use <span class="RktPn">#:instanceof</span> to guide the dispatcher, but we
accept that we might still encounter a structural type error later if we
dispatch into some code that needs a column that is missing from the instance.</p><h5 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;Lateral_Joins&quot;">7.3.3<tt>&nbsp;</tt><a name="(part._.Lateral_.Joins)"></a>Lateral Joins</h5><p>Currently Plisqin has no support for lateral joins
(aka "cross apply" / "outer apply" in SQL Server).
Adding support won&rsquo;t be hard, but there is a decision that needs to be made.</p><p><div class="SIntrapara">The following join should be a lateral join.
This is because the <span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._where%29%29" class="RktValLink" data-pltdoc="x">%%where</a></span> clause contains a "foreign instance"
(namely <span class="RktSym">x</span>) that comes from an outer scope.
</div><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>There is nothing special about <span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._where%29%29" class="RktValLink" data-pltdoc="x">%%where</a></span> here.
It is more accurate to say that <span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._join-on%29%29" class="RktValLink" data-pltdoc="x">join-on</a></span> is special in that it
does not exhibit this behavior.</p></blockquote></blockquote></blockquote></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">lateral-example</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._from%29%29" class="RktStxLink" data-pltdoc="x">from</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">X</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._join%29%29" class="RktStxLink" data-pltdoc="x">join</a></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">Y</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._join-type%29%29" class="RktValLink" data-pltdoc="x">join-type</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">left</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe..rkt%29._where%29%29" class="RktValLink" data-pltdoc="x">%%where</a></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktVal">".foo = "</span><span class="RktSym">x</span><span class="RktVal">".foo"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">This SQL is invalid because Plisqin has no support for lateral joins:</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._to-sql%29%29" class="RktValLink" data-pltdoc="x">to-sql</a></span><span class="hspace">&nbsp;</span><span class="RktSym">lateral-example</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">select x.*</span></p></td></tr><tr><td><p><span class="RktOut">from X x</span></p></td></tr><tr><td><p><span class="RktOut">left join (</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">select y.*</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">from Y y</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">where y.foo = x.foo</span></p></td></tr><tr><td><p><span class="RktOut">) y</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">on 1=1</span></p></td></tr></table></td></tr></table></blockquote></div></p><p><div class="SIntrapara">Plisqin could easily detect the "foreign instance" in the previous example,
and automatically generate a lateral join.
Should it?
I think...
</div><div class="SIntrapara"><ul><li><p>If the user explicitly says "lateral join", then generate a lateral join.</p></li><li><p>If the user explicitly says "non-lateral join", then generate a normal
join. Raise an error if a foreign instance is detected.</p></li><li><p>If the user does not say anything, generate a lateral join when
necessary and a normal join otherwise.</p></li></ul></div></p><p>A user who doesn&rsquo;t like that decision should be able to easily redefine
<span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._join%29%29" class="RktStxLink" data-pltdoc="x">join</a></span> to be non-lateral by default.</p><h5 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;Nullability_and_exists&quot;">7.3.4<tt>&nbsp;</tt><a name="(part._.Nullability_and_exists)"></a>Nullability and <span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._exists%29%29" class="RktValLink" data-pltdoc="x">exists</a></span></h5><p>From this section: <a href="using-define-schema.html#%28part._.Task_3__.Products_with_.Non-.Zero_.Sales%29" data-pltdoc="x">Task 3: Products with Non-Zero Sales</a></p><p><div class="SIntrapara">We define the equivalent of this procedure
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=attaching-contracts-to-values.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fregion..rkt%2529._define%252Fcontract%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define/contract</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">HasSales?</span><span class="hspace">&nbsp;</span><span class="RktSym">prd</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._instanceof%29%29" class="RktValLink" data-pltdoc="x">instanceof</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Product</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Ftypes..rkt%29._.Boolish~3f%29%29" class="RktValLink" data-pltdoc="x">Boolish?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._exists%29%29" class="RktValLink" data-pltdoc="x">exists</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib.html#%28form._%28%28lib._plisqin-lib%2Fmain..rkt%29._from%29%29" class="RktStxLink" data-pltdoc="x">from</a></span><span class="hspace">&nbsp;</span><span class="RktSym">dtl</span><span class="hspace">&nbsp;</span><span class="RktSym">SalesOrderDetail</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._where%29%29" class="RktValLink" data-pltdoc="x">where</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict%2Foperators..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">.=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductID</span><span class="hspace">&nbsp;</span><span class="RktSym">dtl</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ProductID</span><span class="hspace">&nbsp;</span><span class="RktSym">prd</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>But the problem is, what if the given <span class="RktSym">prd</span> is a left join?
We will fail with a nullability error.
So we could add a fallback, but even that doesn&rsquo;t feel right.
This feels like one of the rare times when we want to preserve the unknown
boolean value.</p><p><div class="SIntrapara">I think we want the call-site pattern to be as follows:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._where%29%29" class="RktValLink" data-pltdoc="x">where</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._coalesce%29%29" class="RktValLink" data-pltdoc="x">coalesce</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">HasSales?</span><span class="hspace">&nbsp;</span><span class="RktSym">product</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28form._%28%28lib._plisqin-lib%2Fstrict..rkt%29._val%29%29" class="RktStxLink" data-pltdoc="x">val</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>The caller could also choose not to coalesce at all if it knows that that
the instance it passes in is not a left join.</p><p>But how to implement this?
There are a couple of problems.
First, if we switch to <span class="RktSym"><a href="plisqin-lib_unsafe.html#%28def._%28%28lib._plisqin-lib%2Funsafe%2Foperators..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">%%=</a></span> the nullability of the where clause will be
<span class="RktSym"><a href="plisqin-lib.html#%28def._%28%28lib._plisqin-lib%2Fmain..rkt%29._yes%29%29" class="RktValLink" data-pltdoc="x">yes</a></span>, but the queries do not have a notion of nullability.
If they did, what does it mean for a query to be nullable?
Does it only affect <span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._exists%29%29" class="RktValLink" data-pltdoc="x">exists</a></span>?
Is a query nullable when any of its clauses are nullable?</p><p><div class="SIntrapara">Second, even if we have a well-defined way to make the <span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._exists%29%29" class="RktValLink" data-pltdoc="x">exists</a></span><span class="stt"> </span><span class="RktSym">....</span><span class="RktPn">)</span>
token nullable, that doesn&rsquo;t seem to help because in SQL "exists" never returns
the unknown boolean value.
This would make SQL generation very difficult or maybe impossible.
Reconsider the following call site:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._where%29%29" class="RktValLink" data-pltdoc="x">where</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28def._%28%28lib._plisqin-lib%2Fstrict..rkt%29._coalesce%29%29" class="RktValLink" data-pltdoc="x">coalesce</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">HasSales?</span><span class="hspace">&nbsp;</span><span class="RktSym">product</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="plisqin-lib_strict.html#%28form._%28%28lib._plisqin-lib%2Fstrict..rkt%29._val%29%29" class="RktStxLink" data-pltdoc="x">val</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>What SQL should be generated?
Do you have an answer that generalizes?
If so, please let me know, because I&rsquo;m stumped.</p><h4 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;Other_Random_Thoughts&quot;">7.4<tt>&nbsp;</tt><a name="(part._.Other_.Random_.Thoughts)"></a>Other Random Thoughts</h4><h5 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;Cardinality&quot;">7.4.1<tt>&nbsp;</tt><a name="(part._.Cardinality)"></a>Cardinality</h5><p>For example, I would like to be able to assert "this query should return at
most one row per ProductCategory" and have Plisqin error if it can prove that I
wrong or warn if it cannot prove that I am correct.</p><p>A very unsophisticated solution works similar to nullability, where we need the
user to give us hints like <span class="RktPn">#:has-one</span> so we know that a join is singular.
I wonder if such an unsophisticated soluation would be useful at all, or if it
just means that the user makes the same mistake in a different place.</p><p>A sophisticated solution requires deep knowledge of the database schema.
Which columns are unique keys of each table?
Which comparison expressions are guaranteed to match exactly one row?
This gets super tricky when you think about collation.</p><h5 x-source-module="(lib &quot;plisqin-doc/scribblings/plisqin.scrbl&quot;)" x-source-pkg="plisqin" x-part-tag="&quot;Separating_Specification_from_Implementation&quot;">7.4.2<tt>&nbsp;</tt><a name="(part._.Separating_.Specification_from_.Implementation)"></a>Separating Specification from Implementation</h5><p>Barring tremendous leaps in query optimizers (which are already amazing IMO),
I think many projects would benefit from having two database languages.
A "specification language", something like Plisqin, would be used by application
developers to define what result set they need from the DB.
The "implementation language" would be used by DBAs to tell the database how a
certain query from the specification language should be implemented.
Things like query hints obviously belong in the implementation language,
but so do decisions like choosing between a negative join or "not exists".</p><p>SQL (and therefore Plisqin) combine specification and implementation.
In other words, from a certain level SQL is not actually declarative.
I don&rsquo;t think this is a huge flaw of SQL.
Forcing users to write a specification and an implementation for every
single query would not be a good language design.
A good language would be able to support both workflows.</p><p><a href="http://cosette.cs.washington.edu/">Cosette</a> looks promising.
For example, an application developer uses Plisqin as the specification language.
Plisqin generates SQL which might be very inefficient.
A DBA hand-crafts SQL that is acceptably efficient.
Cosette ensures that the hand-written SQL is equivalent to Plisqin&rsquo;s SQL.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="plisqin-examples_adventure-works.html" title="backward to &quot;6.5 plisqin-examples/adventure-works&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Plisqin&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/plisqin/research-language.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:29:46 GMT -->
</html>