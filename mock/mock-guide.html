<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/mock/mock-guide.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:25:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>1&nbsp;The Mock Guide</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Mocks</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">The Mock Guide</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="mock-reference.html" class="tocviewlink" data-pltdoc="x">The Mock Reference</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>1&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">The Mock Guide</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">1.1&nbsp;</td><td><a href="#%28part._.Introduction_to_.Mocks%29" class="tocviewlink" data-pltdoc="x">Introduction to Mocks</a></td></tr><tr><td align="right">1.2&nbsp;</td><td><a href="#%28part._.Using_.Mocks_in_.Place_of_.Dependencies%29" class="tocviewlink" data-pltdoc="x">Using Mocks in Place of Dependencies</a></td></tr><tr><td align="right">1.3&nbsp;</td><td><a href="#%28part._.Dynamically_.Changing_.Mock_.Behavior%29" class="tocviewlink" data-pltdoc="x">Dynamically Changing Mock Behavior</a></td></tr><tr><td align="right">1.4&nbsp;</td><td><a href="#%28part._.Automatic_.Mocking_with_.Syntax%29" class="tocviewlink" data-pltdoc="x">Automatic Mocking with Syntax</a></td></tr><tr><td align="right">1.5&nbsp;</td><td><a href="#%28part._.Stubbing_.Undefined_.Dependencies%29" class="tocviewlink" data-pltdoc="x">Stubbing Undefined Dependencies</a></td></tr><tr><td align="right">1.6&nbsp;</td><td><a href="#%28part._.Mocking_and_.Opaque_.Values%29" class="tocviewlink" data-pltdoc="x">Mocking and Opaque Values</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._.Introduction_to_.Mocks%29" class="tocsubseclink" data-pltdoc="x">Introduction to Mocks</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._.Using_.Mocks_in_.Place_of_.Dependencies%29" class="tocsubseclink" data-pltdoc="x">Using Mocks in Place of Dependencies</a></td></tr><tr><td><span class="tocsublinknumber">1.3<tt>&nbsp;</tt></span><a href="#%28part._.Dynamically_.Changing_.Mock_.Behavior%29" class="tocsubseclink" data-pltdoc="x">Dynamically Changing Mock Behavior</a></td></tr><tr><td><span class="tocsublinknumber">1.4<tt>&nbsp;</tt></span><a href="#%28part._.Automatic_.Mocking_with_.Syntax%29" class="tocsubseclink" data-pltdoc="x">Automatic Mocking with Syntax</a></td></tr><tr><td><span class="tocsublinknumber">1.5<tt>&nbsp;</tt></span><a href="#%28part._.Stubbing_.Undefined_.Dependencies%29" class="tocsubseclink" data-pltdoc="x">Stubbing Undefined Dependencies</a></td></tr><tr><td><span class="tocsublinknumber">1.6<tt>&nbsp;</tt></span><a href="#%28part._.Mocking_and_.Opaque_.Values%29" class="tocsubseclink" data-pltdoc="x">Mocking and Opaque Values</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.6</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="index.html" title="backward to &quot;Mocks&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Mocks&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="mock-reference.html" title="forward to &quot;2 The Mock Reference&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;mock/main.scrbl&quot;)" x-source-pkg="mock" x-part-tag="&quot;mock-guide&quot;">1<tt>&nbsp;</tt><a name="(part._mock-guide)"></a>The Mock Guide</h3><p>This guide is intended for programmers who are familiar with Racket but new to working
with <a href="index.html#%28tech._mock%29" class="techoutside" data-pltdoc="x"><span class="techinside">mocks</span></a>. It contains a description of the high level concepts associated
with the <a href="index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">mock</span></a> library, as well as examples and use cases. For a complete
description of the <a href="index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">mock</span></a> API, see <a href="mock-reference.html" data-pltdoc="x">The Mock Reference</a>.</p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Introduction_to_.Mocks%29" class="toclink" data-pltdoc="x">1.1<span class="hspace">&nbsp;</span>Introduction to Mocks</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Using_.Mocks_in_.Place_of_.Dependencies%29" class="toclink" data-pltdoc="x">1.2<span class="hspace">&nbsp;</span>Using Mocks in Place of Dependencies</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Dynamically_.Changing_.Mock_.Behavior%29" class="toclink" data-pltdoc="x">1.3<span class="hspace">&nbsp;</span>Dynamically Changing Mock Behavior</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Automatic_.Mocking_with_.Syntax%29" class="toclink" data-pltdoc="x">1.4<span class="hspace">&nbsp;</span>Automatic Mocking with Syntax</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Stubbing_.Undefined_.Dependencies%29" class="toclink" data-pltdoc="x">1.5<span class="hspace">&nbsp;</span>Stubbing Undefined Dependencies</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Mocking_and_.Opaque_.Values%29" class="toclink" data-pltdoc="x">1.6<span class="hspace">&nbsp;</span>Mocking and Opaque Values</a></p></td></tr></table><h4 x-source-module="(lib &quot;mock/main.scrbl&quot;)" x-source-pkg="mock" x-part-tag="&quot;Introduction_to_Mocks&quot;">1.1<tt>&nbsp;</tt><a name="(part._.Introduction_to_.Mocks)"></a>Introduction to Mocks</h4><p>The <a href="index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">mock</span></a> library defines <a href="index.html#%28tech._mock%29" class="techoutside" data-pltdoc="x"><span class="techinside">mocks</span></a>, procedures that record how
they&rsquo;re used and can have their response to calls dynamically altered. Mocks are most
useful when testing imperative code or code with side effects, serving as "fake"
implementations in tests for verifying real implementations are used correctly. For
example, consider the following procedure:</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">call/secret</span><span class="hspace">&nbsp;</span><span class="RktSym">proc</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">proc</span><span class="hspace">&nbsp;</span><span class="RktVal">"secret"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">call/secret</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._print%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">print</a></span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">"secret"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">call/secret</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=values.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._values%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">values</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>How can a test verify that the secret value is passed correctly? It would be one thing
if <span class="RktSym">call/secret</span> returned the result of the call, then we could simply pass in
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=values.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._values%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">values</a></span> and verify that the whole thing returns <span class="RktVal">"secret"</span>. But because
the result of the call is discarded, we somehow need to use a procedure that records a
history of all calls made with it so we can check that history afterwards. This is
precisely what mocks are for.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">secret-mock</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock%29%29" class="RktValLink" data-pltdoc="x">mock</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:behavior</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">call/secret</span><span class="hspace">&nbsp;</span><span class="RktSym">secret-mock</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-calls%29%29" class="RktValLink" data-pltdoc="x">mock-calls</a></span><span class="hspace">&nbsp;</span><span class="RktSym">secret-mock</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(list (mock-call #f (arguments "secret") '(#&lt;void&gt;)))</span></p></td></tr></table></blockquote></div></p><p>Mocks are constructed by the <span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock%29%29" class="RktValLink" data-pltdoc="x">mock</a></span> function. They&rsquo;re procedures that behave
exactly like whatever their current <a href="mock-reference.html#%28tech._behavior%29" class="techoutside" data-pltdoc="x"><span class="techinside">behavior</span></a> is, but they also keep a
record of all calls made with them. In the previous example, we construct the mock
<span class="RktSym">secret-mock</span> that behaves like the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void</a></span> procedure. If the behavior is
unspecified the mock will throw an error whenver its called, so we choose <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void</a></span>
as its behavior since <span class="RktSym">call/secret</span> doesn&rsquo;t need a return value from the procedure
it&rsquo;s given. After evaluating <span class="RktPn">(</span><span class="RktSym">call/secret</span><span class="stt"> </span><span class="RktSym">secret-mock</span><span class="RktPn">)</span>, the <span class="RktSym">secret-mock</span>
has a procedure call in its saved history that is accessible via <span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-calls%29%29" class="RktValLink" data-pltdoc="x">mock-calls</a></span>. Now
we can query this history in tests. We can also clear a mock&rsquo;s history of calls using
<span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-reset%21%29%29" class="RktValLink" data-pltdoc="x">mock-reset!</a></span>, allowing us to clean up after a test.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-num-calls%29%29" class="RktValLink" data-pltdoc="x">mock-num-calls</a></span><span class="hspace">&nbsp;</span><span class="RktSym">secret-mock</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">1</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-reset%21%29%29" class="RktValLink" data-pltdoc="x">mock-reset!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">secret-mock</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-num-calls%29%29" class="RktValLink" data-pltdoc="x">mock-num-calls</a></span><span class="hspace">&nbsp;</span><span class="RktSym">secret-mock</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">0</span></p></td></tr></table></blockquote></div></p><h4 x-source-module="(lib &quot;mock/main.scrbl&quot;)" x-source-pkg="mock" x-part-tag="&quot;Using_Mocks_in_Place_of_Dependencies&quot;">1.2<tt>&nbsp;</tt><a name="(part._.Using_.Mocks_in_.Place_of_.Dependencies)"></a>Using Mocks in Place of Dependencies</h4><p>In the previous section we used mocks to test a higher order function <span class="RktSym">call/secret</span>.
Mocks also help when dealing with code that performs operations with side effects. In
tests, we simply replace the operation procedure with a mock. To do this, we can take a
procedure that calls side effectful dependencies and convert it to a higher order procedure
like <span class="RktSym">call/secret</span>, which accepts the side effectful dependencies as inputs. Consider
a procedure that looks up a favorite color from a file, then prints a message based on that
color.</p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">print-favorite-color-message</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">color</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Filesystem.html%23%2528def._%2528%2528lib._racket%252Ffile..rkt%2529._file-%7E3estring%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">file-&gt;string</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"color-preference.txt"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">message</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=case.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._case%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">case</a></span><span class="hspace">&nbsp;</span><span class="RktSym">color</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"blue"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is blue. Like the ocean!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"red"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is red. Fiery, fiery red!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"green"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is green. I love forests!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"I haven't got much to say about your favorite color."</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktSym">message</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>Testing this procedure is definitely tricky. There&rsquo;s input from the
<span class="RktVal">"color-preferences.txt"</span> file to worry about along with output via
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span>. To properly test this procedure, let&rsquo;s alter it slightly.
We&rsquo;ll pass in the side effectful dependency procedures as arguments.</p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">print-favorite-color-message</span><span class="hspace">&nbsp;</span><span class="RktPn">#:read-with</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Filesystem.html%23%2528def._%2528%2528lib._racket%252Ffile..rkt%2529._file-%7E3estring%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">file-&gt;string</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Filesystem.html%23%2528def._%2528%2528lib._racket%252Ffile..rkt%2529._file-%7E3estring%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">file-&gt;string</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:print-with</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">color</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Filesystem.html%23%2528def._%2528%2528lib._racket%252Ffile..rkt%2529._file-%7E3estring%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">file-&gt;string</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"color-preference.txt"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">message</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=case.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._case%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">case</a></span><span class="hspace">&nbsp;</span><span class="RktSym">color</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"blue"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is blue. Like the ocean!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"red"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is red. Fiery, fiery red!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"green"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is green. I love forests!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"I haven't got much to say about your favorite color."</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktSym">message</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>Much better. By passing in the procedures we use for reading and writing as
arguments, we allow tests to specify that input and output should be performed
with mocks. Using the real functions by default also means we don&rsquo;t affect any
existing code using <span class="RktSym">print-favorite-color-message</span>. Now let&rsquo;s try using
mocks.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">file-mock</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock%29%29" class="RktValLink" data-pltdoc="x">mock</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:behavior</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">displayln-mock</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock%29%29" class="RktValLink" data-pltdoc="x">mock</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:behavior</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">print-favorite-color-message</span><span class="hspace">&nbsp;</span><span class="RktPn">#:read-with</span><span class="hspace">&nbsp;</span><span class="RktSym">file-mock</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:print-with</span><span class="hspace">&nbsp;</span><span class="RktSym">displayln-mock</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-calls%29%29" class="RktValLink" data-pltdoc="x">mock-calls</a></span><span class="hspace">&nbsp;</span><span class="RktSym">file-mock</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(list (mock-call #f (arguments "color-preference.txt") '("green")))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-calls%29%29" class="RktValLink" data-pltdoc="x">mock-calls</a></span><span class="hspace">&nbsp;</span><span class="RktSym">displayln-mock</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(list</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(mock-call</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">#f</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(arguments "Your favorite color is green. I love forests!")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">'(#&lt;void&gt;)))</span></p></td></tr></table></td></tr></table></blockquote></div></p><p>By using <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span> we&rsquo;re able to easily setup tests that exercise a
particular codepath. We can test side effectful code! There&rsquo;s still more to
discuss, the following sections discuss adjusting mock behavior and automatically
mocking out dependencies.</p><h4 x-source-module="(lib &quot;mock/main.scrbl&quot;)" x-source-pkg="mock" x-part-tag="&quot;Dynamically_Changing_Mock_Behavior&quot;">1.3<tt>&nbsp;</tt><a name="(part._.Dynamically_.Changing_.Mock_.Behavior)"></a>Dynamically Changing Mock Behavior</h4><p>Mocks have a <span style="font-style: italic">behavior</span>, which defines what they return when called. This
behavior is not fixed; mocks can have their behavior changed dynamically using
<span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mock-behavior%29%29" class="RktStxLink" data-pltdoc="x">with-mock-behavior</a></span>. This allows the same mock to respond differently to
different calls while retaining a history of all calls. Recall the favorite color
procedure we defined in the previous section:</p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">print-favorite-color-message</span><span class="hspace">&nbsp;</span><span class="RktPn">#:read-with</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Filesystem.html%23%2528def._%2528%2528lib._racket%252Ffile..rkt%2529._file-%7E3estring%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">file-&gt;string</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Filesystem.html%23%2528def._%2528%2528lib._racket%252Ffile..rkt%2529._file-%7E3estring%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">file-&gt;string</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:print-with</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">color</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Filesystem.html%23%2528def._%2528%2528lib._racket%252Ffile..rkt%2529._file-%7E3estring%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">file-&gt;string</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"color-preference.txt"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">message</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=case.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._case%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">case</a></span><span class="hspace">&nbsp;</span><span class="RktSym">color</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"blue"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is blue. Like the ocean!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"red"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is red. Fiery, fiery red!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"green"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is green. I love forests!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"I haven't got much to say about your favorite color."</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktSym">message</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>If we want to test more than one branch of this code, we need our <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Filesystem.html%23%2528def._%2528%2528lib._racket%252Ffile..rkt%2529._file-%7E3estring%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">file-&gt;string</a></span>
mock to return different results. We could use different mocks, but then each mock has
a separate call history. In this particular case that&rsquo;s not a problem, but for the sake
of a good example we&rsquo;ll assume we want a combined history. We can use
<span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mock-behavior%29%29" class="RktStxLink" data-pltdoc="x">with-mock-behavior</a></span> to dynmaically control the behavior of a mock.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">file-mock</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock%29%29" class="RktValLink" data-pltdoc="x">mock</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:behavior</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">displayln-mock</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock%29%29" class="RktValLink" data-pltdoc="x">mock</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:behavior</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">print-favorite-color-message</span><span class="hspace">&nbsp;</span><span class="RktPn">#:read-with</span><span class="hspace">&nbsp;</span><span class="RktSym">file-mock</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:print-with</span><span class="hspace">&nbsp;</span><span class="RktSym">displayln-mock</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mock-behavior%29%29" class="RktStxLink" data-pltdoc="x">with-mock-behavior</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">file-mock</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"blue"</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">print-favorite-color-message</span><span class="hspace">&nbsp;</span><span class="RktPn">#:read-with</span><span class="hspace">&nbsp;</span><span class="RktSym">file-mock</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:print-with</span><span class="hspace">&nbsp;</span><span class="RktSym">displayln-mock</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-calls%29%29" class="RktValLink" data-pltdoc="x">mock-calls</a></span><span class="hspace">&nbsp;</span><span class="RktSym">displayln-mock</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(list</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(mock-call</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">#f</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(arguments "Your favorite color is green. I love forests!")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">'(#&lt;void&gt;))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(mock-call</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">#f</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(arguments "Your favorite color is blue. Like the ocean!")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">'(#&lt;void&gt;)))</span></p></td></tr></table></td></tr></table></blockquote></div></p><p>A mocks behavior is a <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=parameterize.html%23%2528tech._parameter%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">parameter</span></a> under the hood, so <span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mock-behavior%29%29" class="RktStxLink" data-pltdoc="x">with-mock-behavior</a></span>
acts similarly to <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=parameters.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._parameterize%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">parameterize</a></span>. While here we could have made a second mock,
in the next section we&rsquo;ll introduce automatic mocking which defines one mock per
dependency for us.</p><h4 x-source-module="(lib &quot;mock/main.scrbl&quot;)" x-source-pkg="mock" x-part-tag="&quot;Automatic_Mocking_with_Syntax&quot;">1.4<tt>&nbsp;</tt><a name="(part._.Automatic_.Mocking_with_.Syntax)"></a>Automatic Mocking with Syntax</h4><p>In the previous sections we transformed procedures we wanted to test into higher order
functions that accepted their dependencies as input. This let us construct a mock for
each dependency and pass it in to inspect how the procedure called its dependencies.
This was a fairly mechanical translation. In this section we introduce <span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define%2Fmock%29%29" class="RktStxLink" data-pltdoc="x">define/mock</a></span>,
a syntactic form that automates mocking out dependencies in this fashion. Recall again our
favorite color procedure.</p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">print-favorite-color-message</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">color</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Filesystem.html%23%2528def._%2528%2528lib._racket%252Ffile..rkt%2529._file-%7E3estring%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">file-&gt;string</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"color-preference.txt"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">message</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=case.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._case%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">case</a></span><span class="hspace">&nbsp;</span><span class="RktSym">color</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"blue"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is blue. Like the ocean!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"red"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is red. Fiery, fiery red!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"green"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is green. I love forests!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"I haven't got much to say about your favorite color."</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktSym">message</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>We previously mocked out the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Filesystem.html%23%2528def._%2528%2528lib._racket%252Ffile..rkt%2529._file-%7E3estring%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">file-&gt;string</a></span> and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span> procedures.
This was done in three steps:</p><ul><li><p>Add a parameter for each dependency procedure that defaults to the real one.</p></li><li><p>Define a mock for each dependency procedure with appropriate behavior</p></li><li><p>Call <span class="RktSym">print-favorite-color-message</span> with the mocks as its dependencies,
adjusting mock behavior and resetting mocks as necessary.</p></li></ul><p>The <span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define%2Fmock%29%29" class="RktStxLink" data-pltdoc="x">define/mock</a></span> form automates the first two steps of this process.</p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define%2Fmock%29%29" class="RktStxLink" data-pltdoc="x">define/mock</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">print-favorite-color-message</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mock</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Filesystem.html%23%2528def._%2528%2528lib._racket%252Ffile..rkt%2529._file-%7E3estring%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">file-&gt;string</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:as</span><span class="hspace">&nbsp;</span><span class="RktSym">file-mock</span><span class="hspace">&nbsp;</span><span class="RktPn">#:with-behavior</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"blue"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mock</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:as</span><span class="hspace">&nbsp;</span><span class="RktSym">display-mock</span><span class="hspace">&nbsp;</span><span class="RktPn">#:with-behavior</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">color</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Filesystem.html%23%2528def._%2528%2528lib._racket%252Ffile..rkt%2529._file-%7E3estring%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">file-&gt;string</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"color-preference.txt"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">message</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=case.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._case%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">case</a></span><span class="hspace">&nbsp;</span><span class="RktSym">color</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"blue"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is blue. Like the ocean!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"red"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is red. Fiery, fiery red!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">"green"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Your favorite color is green. I love forests!"</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"I haven't got much to say about your favorite color."</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktSym">message</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>The details of how this works are covered in <a href="mock-reference.html" data-pltdoc="x">The Mock Reference</a>, but the gist is
that each <span class="RktPn">#:mock</span> clause mocks out a single dependency procedure and defines a
mock with the name given in the <span class="RktPn">#:as</span> clause. The <span class="RktPn">#:with-behavior</span> clause
defines the default behavior for each mock. However, the mocks are not immediately
available to client code - their definitions must be brought into scope using a
<span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mocks%29%29" class="RktStxLink" data-pltdoc="x">with-mocks</a></span> form.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktSym">file-mock</span></td></tr><tr><td><p><span class="RktErr">file-mock: undefined;</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr">cannot reference an identifier before its definition</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">in module: 'program</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">print-favorite-color-message</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">open-input-file: cannot open input file</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">path: /home/root/user/.local/share/racket/8.6/pkgs/mock/co</span></p></td></tr><tr><td><p><span class="RktErr">lor-preference.txt</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">system error: No such file or directory; errno=2</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mocks%29%29" class="RktStxLink" data-pltdoc="x">with-mocks</a></span><span class="hspace">&nbsp;</span><span class="RktSym">print-favorite-color-message</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">print-favorite-color-message</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._println%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">println</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-calls%29%29" class="RktValLink" data-pltdoc="x">mock-calls</a></span><span class="hspace">&nbsp;</span><span class="RktSym">display-mock</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">(list (mock-call 'display-mock (arguments "Your favorite color is blue. Like the ocean!") '(#&lt;void&gt;)))</span></p></td></tr></table></blockquote></div></p><p>The <span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mocks%29%29" class="RktStxLink" data-pltdoc="x">with-mocks</a></span> form also takes care of calling <span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-reset%21%29%29" class="RktValLink" data-pltdoc="x">mock-reset!</a></span> on every
mock associated with <span class="RktSym">print-favorite-color-message</span>.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mocks%29%29" class="RktStxLink" data-pltdoc="x">with-mocks</a></span><span class="hspace">&nbsp;</span><span class="RktSym">print-favorite-color-message</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">print-favorite-color-message</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._println%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">println</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-num-calls%29%29" class="RktValLink" data-pltdoc="x">mock-num-calls</a></span><span class="hspace">&nbsp;</span><span class="RktSym">display-mock</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">1</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mocks%29%29" class="RktStxLink" data-pltdoc="x">with-mocks</a></span><span class="hspace">&nbsp;</span><span class="RktSym">print-favorite-color-message</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._println%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">println</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-num-calls%29%29" class="RktValLink" data-pltdoc="x">mock-num-calls</a></span><span class="hspace">&nbsp;</span><span class="RktSym">display-mock</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">0</span></p></td></tr></table></blockquote></div></p><p>This makes setting up mocked dependencies much simpler. The <span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define%2Fmock%29%29" class="RktStxLink" data-pltdoc="x">define/mock</a></span> form
has a few other options to control its behavior, see <a href="mock-reference.html" data-pltdoc="x">The Mock Reference</a> for details.</p><h4 x-source-module="(lib &quot;mock/main.scrbl&quot;)" x-source-pkg="mock" x-part-tag="&quot;Stubbing_Undefined_Dependencies&quot;">1.5<tt>&nbsp;</tt><a name="(part._.Stubbing_.Undefined_.Dependencies)"></a>Stubbing Undefined Dependencies</h4><p>When testing with mocks, we&rsquo;re able to test how a procedure calls its dependencies
without actually using real dependencies. In theory then, there&rsquo;s no reason those
dependencies need to be implemented before we write our test. Consider a procedure in a
web application that checks whether the current user is authenticated. What are its
dependencies? Clearly there must be some sort of <span class="RktSym">user</span> datatype and a
<span class="RktSym">user-admin?</span> predicate. There must also be a way to determine the user associated
with the current request, call that <span class="RktSym">current-user</span>. And if the user isn&rsquo;t an admin,
there must be some sort of <span class="RktSym">raise-non-admin-access-error</span> procedure to throw an
exception indicating the lack of access. We can try and define a
<span class="RktSym">check-current-user-admin</span> procedure in terms of these pieces before defining the
pieces, but our code won&rsquo;t compile.</p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-current-user-admin</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">user</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">current-user</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=when_unless.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._unless%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unless</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">user-admin?</span><span class="hspace">&nbsp;</span><span class="RktSym">user</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">raise-non-admin-access-error</span><span class="hspace">&nbsp;</span><span class="RktSym">user</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>If we&rsquo;re testing <span class="RktSym">check-current-user-admin</span> with mocks, since all those dependencies
will be mocked out anyway we could just define fake implementations for them.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">current-user</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">user-admin?</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">raise-non-admin-access-error</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define%2Fmock%29%29" class="RktStxLink" data-pltdoc="x">define/mock</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-current-user-admin</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mock</span><span class="hspace">&nbsp;</span><span class="RktSym">current-user</span><span class="hspace">&nbsp;</span><span class="RktPn">#:with-behavior</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"user"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mock</span><span class="hspace">&nbsp;</span><span class="RktSym">user-admin?</span><span class="hspace">&nbsp;</span><span class="RktPn">#:with-behavior</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mock</span><span class="hspace">&nbsp;</span><span class="RktSym">raise-non-admin-access-error</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">user</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">current-user</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=when_unless.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._unless%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unless</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">user-admin?</span><span class="hspace">&nbsp;</span><span class="RktSym">user</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">raise-non-admin-access-error</span><span class="hspace">&nbsp;</span><span class="RktSym">user</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>Now we can test <span class="RktSym">check-current-user-admin</span> without properly defining real dependencies.</p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mocks%29%29" class="RktStxLink" data-pltdoc="x">with-mocks</a></span><span class="hspace">&nbsp;</span><span class="RktSym">check-current-user-admin</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-current-user-admin</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-calls%29%29" class="RktValLink" data-pltdoc="x">mock-calls</a></span><span class="hspace">&nbsp;</span><span class="RktSym">raise-non-admin-access-error</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mock-behavior%29%29" class="RktStxLink" data-pltdoc="x">with-mock-behavior</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">user-admin?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">raise-non-admin-access-error</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-current-user-admin</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._println%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">println</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-calls%29%29" class="RktValLink" data-pltdoc="x">mock-calls</a></span><span class="hspace">&nbsp;</span><span class="RktSym">raise-non-admin-access-error</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">(list (mock-call 'raise-non-admin-access-error (arguments "user") '(#&lt;void&gt;)))</span></p></td></tr></table></blockquote></div></p><p>Nice as this approach could be, it&rsquo;s still rather tedious to define each of those fake
dependencies. And if they&rsquo;re <span class="emph">actually</span> called, the error message is a terrible one
about the evils of treating <span class="RktVal">#f</span> as a procedure. The <a href="index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">mock</span></a> library
provides a <span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._stub%29%29" class="RktStxLink" data-pltdoc="x">stub</a></span> form for automatically defining these sorts of fake implementations.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._stub%29%29" class="RktStxLink" data-pltdoc="x">stub</a></span><span class="hspace">&nbsp;</span><span class="RktSym">current-user</span><span class="hspace">&nbsp;</span><span class="RktSym">user-admin?</span><span class="hspace">&nbsp;</span><span class="RktSym">raise-non-admin-access-error</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define%2Fmock%29%29" class="RktStxLink" data-pltdoc="x">define/mock</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-current-user-admin</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mock</span><span class="hspace">&nbsp;</span><span class="RktSym">current-user</span><span class="hspace">&nbsp;</span><span class="RktPn">#:with-behavior</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"user"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mock</span><span class="hspace">&nbsp;</span><span class="RktSym">user-admin?</span><span class="hspace">&nbsp;</span><span class="RktPn">#:with-behavior</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mock</span><span class="hspace">&nbsp;</span><span class="RktSym">raise-non-admin-access-error</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">user</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">current-user</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=when_unless.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._unless%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unless</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">user-admin?</span><span class="hspace">&nbsp;</span><span class="RktSym">user</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">raise-non-admin-access-error</span><span class="hspace">&nbsp;</span><span class="RktSym">user</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>We can now better control the order in which we implement procedures, writing tests as we
go and even writing code in a test-first fashion.</p><h4 x-source-module="(lib &quot;mock/main.scrbl&quot;)" x-source-pkg="mock" x-part-tag="&quot;Mocking_and_Opaque_Values&quot;">1.6<tt>&nbsp;</tt><a name="(part._.Mocking_and_.Opaque_.Values)"></a>Mocking and Opaque Values</h4><p>Libraries often define "special" values that can&rsquo;t be inspected and are only obtainable
through the library, such as database connections or other "opaque" values. When mocking
dependency functions from that library, we often end up in a situation where a mocked
dependency produces one of these values and another mock consumes it. In this case, it
doesn&rsquo;t matter at all what the producer returns.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._stub%29%29" class="RktStxLink" data-pltdoc="x">stub</a></span><span class="hspace">&nbsp;</span><span class="RktSym">db-connect!</span><span class="hspace">&nbsp;</span><span class="RktSym">db-list-ids</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define%2Fmock%29%29" class="RktStxLink" data-pltdoc="x">define/mock</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-db-user-ids</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mock</span><span class="hspace">&nbsp;</span><span class="RktSym">db-connect!</span><span class="hspace">&nbsp;</span><span class="RktPn">#:with-behavior</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"some random value"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mock</span><span class="hspace">&nbsp;</span><span class="RktSym">db-list-ids</span><span class="hspace">&nbsp;</span><span class="RktPn">#:with-behavior</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-list-ids</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-connect!</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">users</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mocks%29%29" class="RktStxLink" data-pltdoc="x">with-mocks</a></span><span class="hspace">&nbsp;</span><span class="RktSym">list-db-user-ids</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._println%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">println</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-db-user-ids</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._println%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">println</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-calls%29%29" class="RktValLink" data-pltdoc="x">mock-calls</a></span><span class="hspace">&nbsp;</span><span class="RktSym">db-list-ids</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">'(1 2 3)</span></p></td></tr><tr><td><p><span class="RktOut">(list (mock-call 'db-list-ids (arguments "some random value" 'users) '((1 2 3))))</span></p></td></tr></table></td></tr></table></blockquote></div></p><p>We could have returned any value at all from the <span class="RktSym">db-connect!</span> procedure, for unit
testing purposes all we care about is that whatever <span class="RktSym">db-connect!</span> returns is passed
in properly to <span class="RktSym">db-list-ids</span>. However, this could lead to problems if we accidentally
passed the "connection" value somewhere else. If given to a procedure that prints out a string,
instead of throwing an error we&rsquo;ll get "some random value" printed out unexpectedly. What we&rsquo;d
really like is to create some value that can <span class="emph">only</span> be used as a mock connection. The
<span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define-opaque%29%29" class="RktStxLink" data-pltdoc="x">define-opaque</a></span> form lets us define opaque values, which are completely black-boxed
values with no meaning that any procedure could extract from them.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._stub%29%29" class="RktStxLink" data-pltdoc="x">stub</a></span><span class="hspace">&nbsp;</span><span class="RktSym">db-connect!</span><span class="hspace">&nbsp;</span><span class="RktSym">db-list-ids</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define-opaque%29%29" class="RktStxLink" data-pltdoc="x">define-opaque</a></span><span class="hspace">&nbsp;</span><span class="RktSym">test-connection</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define%2Fmock%29%29" class="RktStxLink" data-pltdoc="x">define/mock</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-db-user-ids</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mock</span><span class="hspace">&nbsp;</span><span class="RktSym">db-connect!</span><span class="hspace">&nbsp;</span><span class="RktPn">#:with-behavior</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktSym">test-connection</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mock</span><span class="hspace">&nbsp;</span><span class="RktSym">db-list-ids</span><span class="hspace">&nbsp;</span><span class="RktPn">#:with-behavior</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-list-ids</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-connect!</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">users</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mocks%29%29" class="RktStxLink" data-pltdoc="x">with-mocks</a></span><span class="hspace">&nbsp;</span><span class="RktSym">list-db-user-ids</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._println%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">println</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-db-user-ids</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._println%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">println</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-calls%29%29" class="RktValLink" data-pltdoc="x">mock-calls</a></span><span class="hspace">&nbsp;</span><span class="RktSym">db-list-ids</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">'(1 2 3)</span></p></td></tr><tr><td><p><span class="RktOut">(list (mock-call 'db-list-ids (arguments #&lt;test-connection&gt; 'users) '((1 2 3))))</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">test-connection</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">add1: contract violation</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">expected: number?</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">given: #&lt;test-connection&gt;</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">test-connection?</span><span class="hspace">&nbsp;</span><span class="RktSym">test-connection</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr></table></blockquote></div></p><p>In this example, we&rsquo;ve defined an opaque <span class="RktSym">test-connection</span> value that our tests can
look for. It&rsquo;s impossible to misuse this value, and it helpfully identifies itself in error
messages when passed around unexpectedly. The <span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define-opaque%29%29" class="RktStxLink" data-pltdoc="x">define-opaque</a></span> form defines both an
opaque value and a predicate that can be used to recognize that value. In tests, we can
look for the opaque value in mock call history with the predicate or <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._equal%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">equal?</a></span>.</p><p>In addition to <span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define-opaque%29%29" class="RktStxLink" data-pltdoc="x">define-opaque</a></span>, the <span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define%2Fmock%29%29" class="RktStxLink" data-pltdoc="x">define/mock</a></span> form provides a handy syntax
for defining an opaque value that only that definition&rsquo;s mocks and <span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mocks%29%29" class="RktStxLink" data-pltdoc="x">with-mocks</a></span>
enclosed code can reference. Simply add the identifier in an <span class="RktPn">#:opaque</span> clause.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._stub%29%29" class="RktStxLink" data-pltdoc="x">stub</a></span><span class="hspace">&nbsp;</span><span class="RktSym">db-connect!</span><span class="hspace">&nbsp;</span><span class="RktSym">db-list-ids</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define%2Fmock%29%29" class="RktStxLink" data-pltdoc="x">define/mock</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-db-user-ids</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:opaque</span><span class="hspace">&nbsp;</span><span class="RktSym">test-connection</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mock</span><span class="hspace">&nbsp;</span><span class="RktSym">db-connect!</span><span class="hspace">&nbsp;</span><span class="RktPn">#:with-behavior</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktSym">test-connection</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mock</span><span class="hspace">&nbsp;</span><span class="RktSym">db-list-ids</span><span class="hspace">&nbsp;</span><span class="RktPn">#:with-behavior</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Ffunction..rkt%2529._const%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-list-ids</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-connect!</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">users</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._with-mocks%29%29" class="RktStxLink" data-pltdoc="x">with-mocks</a></span><span class="hspace">&nbsp;</span><span class="RktSym">list-db-user-ids</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._println%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">println</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-db-user-ids</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._println%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">println</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="mock-reference.html#%28def._%28%28lib._mock%2Fmain..rkt%29._mock-calls%29%29" class="RktValLink" data-pltdoc="x">mock-calls</a></span><span class="hspace">&nbsp;</span><span class="RktSym">db-list-ids</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">'(1 2 3)</span></p></td></tr><tr><td><p><span class="RktOut">(list (mock-call 'db-list-ids (arguments #&lt;test-connection&gt; 'users) '((1 2 3))))</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">test-connection</span></td></tr><tr><td><p><span class="RktErr">test-connection: undefined;</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr">cannot reference an identifier before its definition</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">in module: 'program</span></p></td></tr></table></blockquote></div></p><p>The <span class="RktPn">#:opaque</span> clause can define multiple opaque values at once by surrounding them
in parentheses. See <span class="RktSym"><a href="mock-reference.html#%28form._%28%28lib._mock%2Fmain..rkt%29._define%2Fmock%29%29" class="RktStxLink" data-pltdoc="x">define/mock</a></span>&rsquo;s documentation in <a href="mock-reference.html" data-pltdoc="x">The Mock Reference</a> for
details.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="index.html" title="backward to &quot;Mocks&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Mocks&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="mock-reference.html" title="forward to &quot;2 The Mock Reference&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/mock/mock-guide.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:25:42 GMT -->
</html>