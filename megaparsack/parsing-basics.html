<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/megaparsack/parsing-basics.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:21:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>1&nbsp;Parsing Basics</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Megaparsack:<span class="mywbr"> &nbsp;</span> Practical Parser Combinators</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Parsing Basics</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="choice.html" class="tocviewlink" data-pltdoc="x">Parsers with Choice</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="producing-syntax.html" class="tocviewlink" data-pltdoc="x">Producing Syntax</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="state.html" class="tocviewlink" data-pltdoc="x">Parsers with State</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="reference.html" class="tocviewlink" data-pltdoc="x">API Reference</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="differences-from-parsack.html" class="tocviewlink" data-pltdoc="x">Appendix:<span class="mywbr"> &nbsp;</span> Parsack vs Megaparsack</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>1&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Parsing Basics</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">1.1&nbsp;</td><td><a href="#%28part._getting-started%29" class="tocviewlink" data-pltdoc="x">Getting started with parsers</a></td></tr><tr><td align="right">1.2&nbsp;</td><td><a href="#%28part._parsing-textual-data%29" class="tocviewlink" data-pltdoc="x">Parsing textual data</a></td></tr><tr><td align="right">1.3&nbsp;</td><td><a href="#%28part._sequencing-parsers%29" class="tocviewlink" data-pltdoc="x">Sequencing parsers</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._getting-started%29" class="tocsubseclink" data-pltdoc="x">Getting started with parsers</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._parsing-textual-data%29" class="tocsubseclink" data-pltdoc="x">Parsing textual data</a></td></tr><tr><td><span class="tocsublinknumber">1.3<tt>&nbsp;</tt></span><a href="#%28part._sequencing-parsers%29" class="tocsubseclink" data-pltdoc="x">Sequencing parsers</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.6</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="index.html" title="backward to &quot;Megaparsack: Practical Parser Combinators&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Megaparsack: Practical Parser Combinators&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="choice.html" title="forward to &quot;2 Parsers with Choice&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;scribblings/megaparsack.scrbl&quot;)" x-source-pkg="megaparsack-doc" x-part-tag="&quot;parsing-basics&quot;">1<tt>&nbsp;</tt><a name="(part._parsing-basics)"></a>Parsing Basics</h3><p>Megaparsack is a library for manipulating <a name="(tech._parser)"></a><span style="font-style: italic">parsers</span>, which are, very simply, functions that
operate on streams of tokens. This is very broad: the tokens in question can simply be characters in a
string, they can be tokens produced as the result of a lexer, they can be syntax objects, or they can
even be completely arbitrary data.</p><p>What&#8217;s special about parsers is that they can be <span class="emph">sequenced</span>&#8212;that is, multiple parsers can be
chained together to make a larger parser. For example, to make a parser that parses the string
<span class="RktVal">"ab"</span>, you might compose two parsers that parse the characters <span class="RktVal">#\a</span> and <span class="RktVal">#\b</span>
individually.</p><h4 x-source-module="(lib &quot;scribblings/megaparsack.scrbl&quot;)" x-source-pkg="megaparsack-doc" x-part-tag="&quot;getting-started&quot;">1.1<tt>&nbsp;</tt><a name="(part._getting-started)"></a>Getting started with parsers</h4><p>To get started, require the <a href="index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">megaparsack</span></a> and <a href="reference.html#%28mod-path._megaparsack%2Ftext%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">megaparsack/text</span></a>
libraries.</p><blockquote class="SCodeFlow"><p><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><a href="index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">megaparsack</span></a><span class="hspace">&nbsp;</span><a href="reference.html#%28mod-path._megaparsack%2Ftext%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">megaparsack/text</span></a><span class="RktPn">)</span></p></blockquote><p>This will import the basic parser functions, as well as some built-in parsers for parsing textual
data. Now, you can use the <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span> function along with basic parsers to parse values
from strings. Let&#8217;s start by parsing an integer:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._integer%2Fp%29%29" class="RktValLink" data-pltdoc="x">integer/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"42"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(success 42)</span></p></td></tr></table></blockquote><p>Since the parser was successful, it returns a <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=either.html%23%2528def._%2528%2528lib._data%252Feither..rkt%2529._success%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">success</a></span> value. The <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span>
function returns an <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=either.html%23%2528tech._either%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">either</span></a> value that represents success and failure. For example, take a
look at what would happen when a parse fails:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._integer%2Fp%29%29" class="RktValLink" data-pltdoc="x">integer/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"not an integer"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(failure (message (srcloc 'string 1 0 1 1) #\n '("integer")))</span></p></td></tr></table></blockquote><p>When a parse fails, it returns a <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=either.html%23%2528def._%2528%2528lib._data%252Feither..rkt%2529._failure%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">failure</a></span> value that encodes some information about what
caused the parser to error. You can convert that information to a human-readable error message using
the <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._parse-error-~3estring%29%29" class="RktValLink" data-pltdoc="x">parse-error-&gt;string</a></span> function:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=either.html%23%2528def._%2528%2528lib._data%252Feither..rkt%2529._map-failure%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">map-failure</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._parse-error-~3estring%29%29" class="RktValLink" data-pltdoc="x">parse-error-&gt;string</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._integer%2Fp%29%29" class="RktValLink" data-pltdoc="x">integer/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"not an integer"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(failure "string:1:0: parse error\n</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">unexpected: n\n</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">expected: integer")</span></p></td></tr></table></blockquote><p>You can also assert that a parse will succeed and just get the result out by using the
<span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._parse-result%21%29%29" class="RktValLink" data-pltdoc="x">parse-result!</a></span> function, which will throw an <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._exn~3afail~3aread~3amegaparsack%29%29" class="RktValLink" data-pltdoc="x">exn:fail:read:megaparsack</a></span> exception
when the parser fails.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._parse-result%21%29%29" class="RktValLink" data-pltdoc="x">parse-result!</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._integer%2Fp%29%29" class="RktValLink" data-pltdoc="x">integer/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"42"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">42</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._parse-result%21%29%29" class="RktValLink" data-pltdoc="x">parse-result!</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._integer%2Fp%29%29" class="RktValLink" data-pltdoc="x">integer/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"not an integer"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">string:1:0: parse error</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">unexpected: n</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">expected: integer</span></p></td></tr></table></blockquote><p>You may notice that the error message includes some useful information. Specifically, megaparsack will
attempt to provide the following information to the user whenever a parse fails:</p><ul><li><p>the source location of the error that caused the parse to fail</p></li><li><p>the token that was &#8220;unexpected&#8221;, which caused the parse to fail</p></li><li><p>a set of values that were &#8220;expected&#8221;, which would have been accepted as valid values for the
parse</p></li></ul><p>In the above case, the parser reports that it expected an integer, but it encountered the character
<span class="stt">n</span>, which obviously isn&#8217;t a valid piece of an integer.</p><h4 x-source-module="(lib &quot;scribblings/megaparsack.scrbl&quot;)" x-source-pkg="megaparsack-doc" x-part-tag="&quot;parsing-textual-data&quot;">1.2<tt>&nbsp;</tt><a name="(part._parsing-textual-data)"></a>Parsing textual data</h4><p>The <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._integer%2Fp%29%29" class="RktValLink" data-pltdoc="x">integer/p</a></span> parser, as would be expected, parses a single integer. However, this isn&#8217;t very
useful on its own&#8212;most of the time, you will want to parse something much more complicated than that.
However, it is a useful building block for creating larger parsers. Let&#8217;s look at some other &#8220;building
block&#8221; parsers that work with strings.</p><p>The <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._letter%2Fp%29%29" class="RktValLink" data-pltdoc="x">letter/p</a></span>, <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._digit%2Fp%29%29" class="RktValLink" data-pltdoc="x">digit/p</a></span>, and <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._space%2Fp%29%29" class="RktValLink" data-pltdoc="x">space/p</a></span> parsers parse a single letter, digit, or
whitespace character, respectively:</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Note that these parsers succeed even when only part of the input is consumed. This is important when
combining parsers together, but if you want to ensure a parser parses the entire input, you can use
<span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._eof%2Fp%29%29" class="RktValLink" data-pltdoc="x">eof/p</a></span>.</p></blockquote></blockquote></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._letter%2Fp%29%29" class="RktValLink" data-pltdoc="x">letter/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"hello"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(success #\h)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._digit%2Fp%29%29" class="RktValLink" data-pltdoc="x">digit/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"123"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(success #\1)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._space%2Fp%29%29" class="RktValLink" data-pltdoc="x">space/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">" "</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(success #\space)</span></p></td></tr></table></blockquote><p>The <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._char%2Fp%29%29" class="RktValLink" data-pltdoc="x">char/p</a></span> function creates a parser that parses a single character:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._char%2Fp%29%29" class="RktValLink" data-pltdoc="x">char/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"abc"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(success #\a)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._parse-result%21%29%29" class="RktValLink" data-pltdoc="x">parse-result!</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._char%2Fp%29%29" class="RktValLink" data-pltdoc="x">char/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"xyz"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">string:1:0: parse error</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">unexpected: x</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">expected: 'a'</span></p></td></tr></table></blockquote><p>It may not make very much sense why the <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._char%2Fp%29%29" class="RktValLink" data-pltdoc="x">char/p</a></span> parser is useful&#8212;after all, it just seems to
return itself. Indeed, in these contrived examples, it&#8217;s not very useful at all! However, it becomes
<span class="emph">extremely</span> important when combining multiple parsers together.</p><h4 x-source-module="(lib &quot;scribblings/megaparsack.scrbl&quot;)" x-source-pkg="megaparsack-doc" x-part-tag="&quot;sequencing-parsers&quot;">1.3<tt>&nbsp;</tt><a name="(part._sequencing-parsers)"></a>Sequencing parsers</h4><p>All <a href="#%28tech._parser%29" class="techoutside" data-pltdoc="x"><span class="techinside">parsers</span></a> are <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528tech._monad%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">monads</span></a>, so it&#8217;s possible to use <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528def._%2528%2528lib._data%252Fmonad..rkt%2529._chain%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">chain</a></span> and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528form._%2528%2528lib._data%252Fmonad..rkt%2529._do%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">do</a></span> from
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528mod-path._data%252Fmonad%2529&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">data/monad</span></a> to combine multiple parsers together to create a bigger parser. For
example, let&#8217;s create a parser that parses the letters <span class="stt">a</span> and <span class="stt">b</span> in sequence:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528mod-path._data%252Fmonad%2529&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">data/monad</span></a><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ab/p</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528form._%2528%2528lib._data%252Fmonad..rkt%2529._do%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">do</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._char%2Fp%29%29" class="RktValLink" data-pltdoc="x">char/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._char%2Fp%29%29" class="RktValLink" data-pltdoc="x">char/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Now we can use our new parser just like any other:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ab/p</span><span class="hspace">&nbsp;</span><span class="RktVal">"ab"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(success #\b)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._parse-result%21%29%29" class="RktValLink" data-pltdoc="x">parse-result!</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ab/p</span><span class="hspace">&nbsp;</span><span class="RktVal">"ac"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">string:1:1: parse error</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">unexpected: c</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">expected: 'b'</span></p></td></tr></table></blockquote><p>The parser succeeds when we supply it with the string <span class="RktVal">"ab"</span>, but it fails when it doesn&#8217;t
match, and we automatically get a pretty good error message.</p><p>One thing to note is that the result of the parser is not particularly meaningful&#8212;it&#8217;s just
<span class="RktVal">#\b</span>. That&#8217;s because the last parser in the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528form._%2528%2528lib._data%252Fmonad..rkt%2529._do%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">do</a></span> block was <span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._char%2Fp%29%29" class="RktValLink" data-pltdoc="x">char/p</a></span><span class="stt"> </span><span class="RktVal">#\b</span><span class="RktPn">)</span>, so
the result of <span class="RktSym">ab/p</span> is just the result of its final parser. If we wanted to, we could change
the result to be whatever we wanted (but only on a successful parse) by returning our own value at the
end of the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528form._%2528%2528lib._data%252Fmonad..rkt%2529._do%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">do</a></span> block:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ab*/p</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528form._%2528%2528lib._data%252Fmonad..rkt%2529._do%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">do</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._char%2Fp%29%29" class="RktValLink" data-pltdoc="x">char/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._char%2Fp%29%29" class="RktValLink" data-pltdoc="x">char/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528def._%2528%2528lib._data%252Fapplicative..rkt%2529._pure%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">pure</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"success!"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>We need the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528def._%2528%2528lib._data%252Fapplicative..rkt%2529._pure%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">pure</a></span> wrapper in order to properly &#8220;lift&#8221; our arbitrary value into the context of
a parser. Now we can run our new parser and get back our custom value when it succeeds:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ab*/p</span><span class="hspace">&nbsp;</span><span class="RktVal">"ab"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(success "success!")</span></p></td></tr></table></blockquote><p>This parser is a little silly, but we can use these concepts to implement parsers that might actually
be useful. For example, you might need to parser two integers, separated by a comma, then add them
together. Using the monadic parser interface, this is extremely simple:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">add-two-ints/p</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528form._%2528%2528lib._data%252Fmonad..rkt%2529._do%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">do</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528form._%2528%2528lib._data%252Fmonad..rkt%2529._%7E3c-%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._integer%2Fp%29%29" class="RktValLink" data-pltdoc="x">integer/p</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._char%2Fp%29%29" class="RktValLink" data-pltdoc="x">char/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#\,</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528form._%2528%2528lib._data%252Fmonad..rkt%2529._%7E3c-%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._integer%2Fp%29%29" class="RktValLink" data-pltdoc="x">integer/p</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528def._%2528%2528lib._data%252Fapplicative..rkt%2529._pure%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">pure</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>This definition is a little bit more complicated because we are using the results of the two integer
parsers in our sequence, so we use the <span class="RktPn">[</span><span class="RktVar">a</span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528form._%2528%2528lib._data%252Fmonad..rkt%2529._%7E3c-%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&lt;-</a></span><span class="stt"> </span><span class="RktVar">b</span><span class="RktPn">]</span> syntax to &#8220;pull out&#8221; the result of each
parser and bind it to a variable. Then we can add the two results together at the end. Actually using
this parser works just as intended:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym">add-two-ints/p</span><span class="hspace">&nbsp;</span><span class="RktVal">"7,12"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(success 19)</span></p></td></tr></table></blockquote><p>Using this technique, it&#8217;s possible to build up fairly complex parsers from small, self-contained
units.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="index.html" title="backward to &quot;Megaparsack: Practical Parser Combinators&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Megaparsack: Practical Parser Combinators&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="choice.html" title="forward to &quot;2 Parsers with Choice&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/megaparsack/parsing-basics.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:21:40 GMT -->
</html>