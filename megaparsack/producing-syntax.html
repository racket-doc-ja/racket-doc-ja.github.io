<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/megaparsack/producing-syntax.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:21:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>3&nbsp;Producing Syntax</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Megaparsack:<span class="mywbr"> &nbsp;</span> Practical Parser Combinators</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="parsing-basics.html" class="tocviewlink" data-pltdoc="x">Parsing Basics</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="choice.html" class="tocviewlink" data-pltdoc="x">Parsers with Choice</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Producing Syntax</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="state.html" class="tocviewlink" data-pltdoc="x">Parsers with State</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="reference.html" class="tocviewlink" data-pltdoc="x">API Reference</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="differences-from-parsack.html" class="tocviewlink" data-pltdoc="x">Appendix:<span class="mywbr"> &nbsp;</span> Parsack vs Megaparsack</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>3&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Producing Syntax</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">3.1&nbsp;</td><td><a href="#%28part._.Annotating_parsers_to_produce_syntax%29" class="tocviewlink" data-pltdoc="x">Annotating parsers to produce syntax</a></td></tr><tr><td align="right">3.2&nbsp;</td><td><a href="#%28part._.Parsing_tokens_from_parser-tools_lex%29" class="tocviewlink" data-pltdoc="x">Parsing tokens from <span class="RktModLink"><span class="RktSym">parser-<wbr></wbr>tools/<span class="mywbr"> &nbsp;</span>lex</span></span></a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#%28part._.Annotating_parsers_to_produce_syntax%29" class="tocsubseclink" data-pltdoc="x">Annotating parsers to produce syntax</a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#%28part._.Parsing_tokens_from_parser-tools_lex%29" class="tocsubseclink" data-pltdoc="x">Parsing tokens from <span class="RktModLink"><span class="RktSym">parser-<wbr></wbr>tools/<span class="mywbr"> &nbsp;</span>lex</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.6</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Parsing_sequences.html" title="backward to &quot;2.2 Parsing sequences&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Megaparsack: Practical Parser Combinators&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="state.html" title="forward to &quot;4 Parsers with State&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;scribblings/megaparsack.scrbl&quot;)" x-source-pkg="megaparsack-doc" x-part-tag="&quot;producing-syntax&quot;">3<tt>&nbsp;</tt><a name="(part._producing-syntax)"></a>Producing Syntax</h3><p>One of the properties of megaparsack is that it always tracks source locations, which is how it is
able to include source location information in error messages. This can be leveraged for an entirely
separate purpose, which is creating parsers that produce <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=syntax-model.html%23%2528tech._syntax._object%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">syntax objects</span></a> as output. This
functionality is extremely useful when creating custom <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a> languages.</p><h4 x-source-module="(lib &quot;scribblings/megaparsack.scrbl&quot;)" x-source-pkg="megaparsack-doc" x-part-tag="&quot;Annotating_parsers_to_produce_syntax&quot;">3.1<tt>&nbsp;</tt><a name="(part._.Annotating_parsers_to_produce_syntax)"></a>Annotating parsers to produce syntax</h4><p>Megaparsack does not opt to produce syntax objects as the result of every parse because it would make
composing parsers extremely tedious. For example, if <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._integer%2Fp%29%29" class="RktValLink" data-pltdoc="x">integer/p</a></span> produced syntax objects
containing integers instead of integers themselves, they would need to be unwrapped before they could
be added together or otherwise used as numbers. Instead, megaparsack requires that you opt-in to
syntax object production by using the <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span> combinator.</p><p>The <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span> combinator is &#8220;magic&#8221;&#8212;it takes <span class="emph">any</span> parser and turns it into a parser that
produces a value containing accurate source location information. This is because <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span>
takes advantage of the internal parser state to track information that is otherwise not accessible
to parsers. Fortunately, this makes the interface extremely simple to use&#8212;just wrap an ordinary parser
with <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span> and use it as usual:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._integer%2Fp%29%29" class="RktValLink" data-pltdoc="x">integer/p</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"42"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(success #&lt;syntax:string:1:0 42&gt;)</span></p></td></tr></table></blockquote><p>The produced syntax objects automatically keep track of all the relevant syntax properties, including
line, column, position, and span:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._parse-result%21%29%29" class="RktValLink" data-pltdoc="x">parse-result!</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._integer%2Fp%29%29" class="RktValLink" data-pltdoc="x">integer/p</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"42"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-line%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax-line</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">1</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-column%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax-column</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">0</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-span%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax-span</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">2</span></p></td></tr></table></blockquote><p>This syntax tracking is not specific to the built-in parsers, and you do not need to do anything
special to use it with your custom parsers. For example, consider a relatively complex parser that
parses a list of comma-delimited numbers surrounded by brackets:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">integer-list/p</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528form._%2528%2528lib._data%252Fmonad..rkt%2529._do%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">do</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._char%2Fp%29%29" class="RktValLink" data-pltdoc="x">char/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#\[</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">ints</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528form._%2528%2528lib._data%252Fmonad..rkt%2529._%7E3c-%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._many%2Fp%29%29" class="RktValLink" data-pltdoc="x">many/p</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._integer%2Fp%29%29" class="RktValLink" data-pltdoc="x">integer/p</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">#:sep</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._char%2Fp%29%29" class="RktValLink" data-pltdoc="x">char/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#\,</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._char%2Fp%29%29" class="RktValLink" data-pltdoc="x">char/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#\]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528def._%2528%2528lib._data%252Fapplicative..rkt%2529._pure%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">pure</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ints</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>We&#8217;ve annotated the <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._integer%2Fp%29%29" class="RktValLink" data-pltdoc="x">integer/p</a></span> parser with <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span> once again so we can get location
tracking for each individual list element, but we&#8217;ll also annotate the whole thing with
<span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span> so we can track information about the entire list as well:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">integer-list-stx</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._parse-result%21%29%29" class="RktValLink" data-pltdoc="x">parse-result!</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._parse-string%29%29" class="RktValLink" data-pltdoc="x">parse-string</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span><span class="hspace">&nbsp;</span><span class="RktSym">integer-list/p</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"[1,2,3,5,8,13]"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">integer-list-stx</span></td></tr><tr><td><p><span class="RktRes">#&lt;syntax:string:1:0 (1 2 3 5 8 13)&gt;</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-span%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax-span</a></span><span class="hspace">&nbsp;</span><span class="RktSym">integer-list-stx</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">14</span></p></td></tr></table></blockquote><p>As expected, the top-level syntax object spans the entire input, including the brackets. We can also
get information about the individual elements, since they are syntax objects as well:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3elist%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">integer-list-stx</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">'(#&lt;syntax:string:1:1 1&gt;</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">#&lt;syntax:string:1:3 2&gt;</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">#&lt;syntax:string:1:5 3&gt;</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">#&lt;syntax:string:1:7 5&gt;</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">#&lt;syntax:string:1:9 8&gt;</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">#&lt;syntax:string:1:11 13&gt;)</span></p></td></tr></table></td></tr></table></blockquote><p>This makes writing a reader for a <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a> relatively straightforward because source location
information is already encoded into a set of syntax objects which can be used as the source of a
Racket module.</p><h4 x-source-module="(lib &quot;scribblings/megaparsack.scrbl&quot;)" x-source-pkg="megaparsack-doc" x-part-tag="&quot;Parsing_tokens_from_parser-tools_lex&quot;">3.2<tt>&nbsp;</tt><a name="(part._.Parsing_tokens_from_parser-tools_lex)"></a>Parsing tokens from <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">parser-tools/lex</span></a></h4><p>While <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span> can be used with any megaparsack parser, it is sometimes useful to be able to
perform a lexing phase before parsing to handle things like ignoring whitespace and tokenization in a
separate pass. Currently, megaparsack does not include tools of its own specifically for lexing
(though it would be perfectly possible to use the output of a separate simple parser as the input to
another parser), but it does provide a function to interoperate with <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">parser-tools/lex</span></a>,
another Racket library that provides utilities designed specifically for lexing.</p><p>When using <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">parser-tools/lex</span></a>, make sure to use the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex..rkt%2529._lexer-src-pos%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lexer-src-pos</a></span> form, which
enables the lexer&#8217;s own source location tracking. This configures the lexer to produce
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528def._%2528%2528lib._parser-tools%252Flex..rkt%2529._position-token%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">position-token</a></span> values as output, which can be fed to <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fparser-tools%2Flex..rkt%29._parse-tokens%29%29" class="RktValLink" data-pltdoc="x">parse-tokens</a></span> from
<a href="reference.html#%28mod-path._megaparsack%2Fparser-tools%2Flex%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">megaparsack/parser-tools/lex</span></a> to parse with any megaparsack parser.</p><p>Parsers that operate on strings, like <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._char%2Fp%29%29" class="RktValLink" data-pltdoc="x">char/p</a></span> and <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Ftext..rkt%29._integer%2Fp%29%29" class="RktValLink" data-pltdoc="x">integer/p</a></span>, will not work with
tokens from <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">parser-tools/lex</span></a> because tokens can contain arbitrary data. Instead,
use the <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fparser-tools%2Flex..rkt%29._token%2Fp%29%29" class="RktValLink" data-pltdoc="x">token/p</a></span> function to create parsers that handle particular tokens.</p><p>Here is a very simple lexer that produces lexemes for identifiers, numbers, parentheses, and commas:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex..rkt%2529._define-tokens%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-tokens</a></span><span class="hspace">&nbsp;</span><span class="RktSym">simple</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">IDENTIFIER</span><span class="hspace">&nbsp;</span><span class="RktSym">NUMBER</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex..rkt%2529._define-empty-tokens%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-empty-tokens</a></span><span class="hspace">&nbsp;</span><span class="RktSym">simple*</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">OPEN-PAREN</span><span class="hspace">&nbsp;</span><span class="RktSym">CLOSE-PAREN</span><span class="hspace">&nbsp;</span><span class="RktSym">COMMA</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">simple-lexer</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex..rkt%2529._lexer-src-pos%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lexer-src-pos</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">#\(</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">token-OPEN-PAREN</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">#\)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">token-CLOSE-PAREN</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">#\,</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">token-COMMA</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex-sre..rkt%2529._%252B%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">:+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex-sre..rkt%2529._or%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">:or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex-sre..rkt%2529._%252F%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">:/</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\z</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex-sre..rkt%2529._%252F%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">:/</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#\A</span><span class="hspace">&nbsp;</span><span class="RktVal">#\Z</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">token-IDENTIFIER</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=symbols.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-%7E3esymbol%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">string-&gt;symbol</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex..rkt%2529._lexeme%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lexeme</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex-sre..rkt%2529._%252B%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">:+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex-sre..rkt%2529._%252F%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">:/</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#\0</span><span class="hspace">&nbsp;</span><span class="RktVal">#\9</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">token-NUMBER</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-%7E3enumber%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">string-&gt;number</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex..rkt%2529._lexeme%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lexeme</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex-sre..rkt%2529._or%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">:or</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex..rkt%2529._whitespace%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">whitespace</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex..rkt%2529._blank%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">blank</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._parser-tools%252Flex..rkt%2529._iso-control%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">iso-control</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void</a></span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eof%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eof</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eof%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eof</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>We can write a simple helper function to lex a string into a list of tokens, making sure to call
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=linecol.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._port-count-lines%2521%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">port-count-lines!</a></span> to enable source location tracking:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lex-simple</span><span class="hspace">&nbsp;</span><span class="RktSym">str</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">in</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stringport.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._open-input-string%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">open-input-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym">str</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=linecol.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._port-count-lines%2521%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">port-count-lines!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">in</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-lexer</span><span class="hspace">&nbsp;</span><span class="RktSym">in</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528def._%2528%2528lib._parser-tools%252Flex..rkt%2529._position-token-token%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">position-token-token</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-lexer</span><span class="hspace">&nbsp;</span><span class="RktSym">in</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eof-object%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eof-object?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528def._%2528%2528lib._parser-tools%252Flex..rkt%2529._position-token-token%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">position-token-token</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cons%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-lexer</span><span class="hspace">&nbsp;</span><span class="RktSym">in</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">lex-simple</span><span class="hspace">&nbsp;</span><span class="RktVal">"f(1, g(3, 4))"</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(list</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(position-token (token 'IDENTIFIER 'f) (position 1 1 0) (position 2 1 1))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(position-token 'OPEN-PAREN (position 2 1 1) (position 3 1 2))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(position-token (token 'NUMBER 1) (position 3 1 2) (position 4 1 3))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(position-token 'COMMA (position 4 1 3) (position 5 1 4))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(position-token (token 'IDENTIFIER 'g) (position 6 1 5) (position 7 1 6))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(position-token 'OPEN-PAREN (position 7 1 6) (position 8 1 7))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(position-token (token 'NUMBER 3) (position 8 1 7) (position 9 1 8))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(position-token 'COMMA (position 9 1 8) (position 10 1 9))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(position-token (token 'NUMBER 4) (position 11 1 10) (position 12 1 11))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(position-token 'CLOSE-PAREN (position 12 1 11) (position 13 1 12))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(position-token 'CLOSE-PAREN (position 13 1 12) (position 14 1 13)))</span></p></td></tr></table></td></tr></table></blockquote><p>Next, we can write a trivial parser to actually parse these tokens. Since we&#8217;ve written a lexer, most
of the heavy lifting is already done, and we can just focus on assigning semantics:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">some wrappers around tokens that use <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span></span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">number/p</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fparser-tools%2Flex..rkt%29._token%2Fp%29%29" class="RktValLink" data-pltdoc="x">token/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">NUMBER</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">identifier/p</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fparser-tools%2Flex..rkt%29._token%2Fp%29%29" class="RktValLink" data-pltdoc="x">token/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">IDENTIFIER</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">a simple function invokation</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">funcall/p</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528form._%2528%2528lib._data%252Fmonad..rkt%2529._do%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">do</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">func</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528form._%2528%2528lib._data%252Fmonad..rkt%2529._%7E3c-%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">identifier/p</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fparser-tools%2Flex..rkt%29._token%2Fp%29%29" class="RktValLink" data-pltdoc="x">token/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">OPEN-PAREN</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">args</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528form._%2528%2528lib._data%252Fmonad..rkt%2529._%7E3c-%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._many%2Fp%29%29" class="RktValLink" data-pltdoc="x">many/p</a></span><span class="hspace">&nbsp;</span><span class="RktSym">expression/p</span><span class="hspace">&nbsp;</span><span class="RktPn">#:sep</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fparser-tools%2Flex..rkt%29._token%2Fp%29%29" class="RktValLink" data-pltdoc="x">token/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">COMMA</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fparser-tools%2Flex..rkt%29._token%2Fp%29%29" class="RktValLink" data-pltdoc="x">token/p</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">CLOSE-PAREN</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=functional&amp;rel=interfaces.html%23%2528def._%2528%2528lib._data%252Fapplicative..rkt%2529._pure%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">pure</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%252A%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">func</span><span class="hspace">&nbsp;</span><span class="RktSym">args</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">an expression can be a number or a function invokation</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">expression/p</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._or%2Fp%29%29" class="RktValLink" data-pltdoc="x">or/p</a></span><span class="hspace">&nbsp;</span><span class="RktSym">number/p</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">funcall/p</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Now, with our simple parser in place, we can actually parse arbitrary C-style function calls into
S-expressions:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">expr-stx</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._parse-result%21%29%29" class="RktValLink" data-pltdoc="x">parse-result!</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fparser-tools%2Flex..rkt%29._parse-tokens%29%29" class="RktValLink" data-pltdoc="x">parse-tokens</a></span><span class="hspace">&nbsp;</span><span class="RktSym">expression/p</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lex-simple</span><span class="hspace">&nbsp;</span><span class="RktVal">"f(1, g(3, 4))"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">expr-stx</span></td></tr><tr><td><p><span class="RktRes">#&lt;syntax:tokens:1:0 (f 1 (g 3 4))&gt;</span></p></td></tr></table></blockquote><p>As expected, the source locations for each datum will automatically be assigned to the resulting
syntax object due to the use of <span class="RktSym"><a href="reference.html#%28def._%28%28lib._megaparsack%2Fmain..rkt%29._syntax%2Fp%29%29" class="RktValLink" data-pltdoc="x">syntax/p</a></span> on the base datums and around <span class="RktSym">funcall/p</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3elist%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">expr-stx</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(#&lt;syntax:tokens:1:0 f&gt; #&lt;syntax:tokens:1:2 1&gt; #&lt;syntax:tokens:1:5 (g 3 4)&gt;)</span></p></td></tr></table></blockquote><p>In just a couple dozens lines of code, we&#8217;ve managed to implement a fairly robust parser that produces
syntax objects ready to be handed off to Racket as the result of parsing a module body, which can be
compiled into working Racket code.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Parsing_sequences.html" title="backward to &quot;2.2 Parsing sequences&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Megaparsack: Practical Parser Combinators&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="state.html" title="forward to &quot;4 Parsers with State&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/megaparsack/producing-syntax.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:21:40 GMT -->
</html>