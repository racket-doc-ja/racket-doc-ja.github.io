<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/phc-toolkit/template-lib.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:29:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>36&nbsp;Versatile parser and template library</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">phc-<wbr></wbr>toolkit</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Aliases_for_other_racket_identifiers.html" class="tocviewlink" data-pltdoc="x">Aliases for other racket identifiers</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="backtrace.html" class="tocviewlink" data-pltdoc="x">backtrace</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Compatibility_wrappers.html" class="tocviewlink" data-pltdoc="x">Compatibility wrappers</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="cond-let.html" class="tocviewlink" data-pltdoc="x">cond-<wbr></wbr>let</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="contract.html" class="tocviewlink" data-pltdoc="x">contract</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="eval-get-values.html" class="tocviewlink" data-pltdoc="x">eval-<wbr></wbr>get-<wbr></wbr>values</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Fixnum_operations__fxxor___.html" class="tocviewlink" data-pltdoc="x">Fixnum operations (fxxor &#8230;)</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="generate-indices.html" class="tocviewlink" data-pltdoc="x">generate-<wbr></wbr>indices</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="Generating_identifiers.html" class="tocviewlink" data-pltdoc="x">Generating identifiers</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="in.html" class="tocviewlink" data-pltdoc="x">in</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="list-lang.html" class="tocviewlink" data-pltdoc="x">list-<wbr></wbr>lang</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="list.html" class="tocviewlink" data-pltdoc="x">list</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="logn-id.html" class="tocviewlink" data-pltdoc="x">logn-<wbr></wbr>id</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="Miscellaneous_utilities.html" class="tocviewlink" data-pltdoc="x">Miscellaneous utilities</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="multiassoc-syntax.html" class="tocviewlink" data-pltdoc="x">multiassoc-<wbr></wbr>syntax</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="not-implemented-yet.html" class="tocviewlink" data-pltdoc="x">not-<wbr></wbr>implemented-<wbr></wbr>yet</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="let-in_binding_and_destructuring_form.html" class="tocviewlink" data-pltdoc="x"><span class="RktSym">let-<wbr></wbr>in</span> binding and destructuring form</a></td></tr><tr><td align="right">18&nbsp;</td><td><a href="repeat-stx.html" class="tocviewlink" data-pltdoc="x">repeat-<wbr></wbr>stx</a></td></tr><tr><td align="right">19&nbsp;</td><td><a href="require-provide.html" class="tocviewlink" data-pltdoc="x">require-<wbr></wbr>provide</a></td></tr><tr><td align="right">20&nbsp;</td><td><a href="sequence.html" class="tocviewlink" data-pltdoc="x">sequence</a></td></tr><tr><td align="right">21&nbsp;</td><td><a href="set.html" class="tocviewlink" data-pltdoc="x">set</a></td></tr><tr><td align="right">22&nbsp;</td><td><a href="Syntax_object_manipulation_utilities.html" class="tocviewlink" data-pltdoc="x">Syntax object manipulation utilities</a></td></tr><tr><td align="right">23&nbsp;</td><td><a href="syntax-parse_helpers.html" class="tocviewlink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">syntax-<wbr></wbr>parse</span></span> helpers</a></td></tr><tr><td align="right">24&nbsp;</td><td><a href="test-framework.html" class="tocviewlink" data-pltdoc="x">test-<wbr></wbr>framework</a></td></tr><tr><td align="right">25&nbsp;</td><td><a href="threading.html" class="tocviewlink" data-pltdoc="x">threading</a></td></tr><tr><td align="right">26&nbsp;</td><td><a href="tmpl.html" class="tocviewlink" data-pltdoc="x">tmpl</a></td></tr><tr><td align="right">27&nbsp;</td><td><a href="Utilities_and_patches_for_typed_rackunit.html" class="tocviewlink" data-pltdoc="x">Utilities and patches for <span class="RktModLink"><span class="RktSym">typed/<span class="mywbr"> &nbsp;</span>rackunit</span></span></a></td></tr><tr><td align="right">28&nbsp;</td><td><a href="Extensions_for_typed_rackunit.html" class="tocviewlink" data-pltdoc="x">Extensions for <span class="RktModLink"><span class="RktSym">typed/<span class="mywbr"> &nbsp;</span>rackunit</span></span></a></td></tr><tr><td align="right">29&nbsp;</td><td><a href="typed-untyped.html" class="tocviewlink" data-pltdoc="x">typed-<wbr></wbr>untyped</a></td></tr><tr><td align="right">30&nbsp;</td><td><a href="type-inference-helpers.html" class="tocviewlink" data-pltdoc="x">type-<wbr></wbr>inference-<wbr></wbr>helpers</a></td></tr><tr><td align="right">31&nbsp;</td><td><a href="values.html" class="tocviewlink" data-pltdoc="x">values</a></td></tr><tr><td align="right">32&nbsp;</td><td><a href="Untyped_versions_of_the_modules.html" class="tocviewlink" data-pltdoc="x">Untyped versions of the modules</a></td></tr><tr><td align="right">33&nbsp;</td><td><a href="for__list_.html" class="tocviewlink" data-pltdoc="x">for*/<span class="mywbr"> &nbsp;</span>list*</a></td></tr><tr><td align="right">34&nbsp;</td><td><a href="meta_operations_on_structs.html" class="tocviewlink" data-pltdoc="x">meta operations on structs</a></td></tr><tr><td align="right">35&nbsp;</td><td><a href="phc-toolkit-format-id-record.html" class="tocviewlink" data-pltdoc="x">Formatting identifiers so that
Dr<span class="mywbr"> &nbsp;</span>Racket still shows arrows</a></td></tr><tr><td align="right">36&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Versatile parser and template library</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>36&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Versatile parser and template library</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">36.1&nbsp;</td><td><a href="#%28part._.Ideas_for_implementation%29" class="tocviewlink" data-pltdoc="x">Ideas for implementation</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><a href="#%28form._%28%28lib._phc-toolkit%2Fmain..rkt%29._parse%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">parse</span></a></td></tr><tr><td><a href="#%28form._%28%28lib._phc-toolkit%2Fmain..rkt%29._tmpl%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">tmpl</span></a></td></tr><tr><td><span class="tocsublinknumber">36.1<tt>&nbsp;</tt></span><a href="#%28part._.Ideas_for_implementation%29" class="tocsubseclink" data-pltdoc="x">Ideas for implementation</a></td></tr><tr><td><span class="tocsublinknumber">36.1.1<tt>&nbsp;</tt></span><a href="#%28part._.Extensibility__expanders_%29" class="tocsubseclink" data-pltdoc="x">Extensibility (expanders)</a></td></tr><tr><td><span class="tocsublinknumber">36.1.2<tt>&nbsp;</tt></span><a href="#%28part._.Customization%29" class="tocsubseclink" data-pltdoc="x">Customization</a></td></tr><tr><td><span class="tocsublinknumber">36.1.3<tt>&nbsp;</tt></span><a href="#%28part._.Unsorted_ideas%29" class="tocsubseclink" data-pltdoc="x">Unsorted ideas</a></td></tr><tr><td><span class="tocsublinknumber">36.1.3.1<tt>&nbsp;</tt></span><a href="#%28part._.Global_pattern_constraints%29" class="tocsubseclink" data-pltdoc="x">Global pattern constraints</a></td></tr><tr><td><span class="tocsublinknumber">36.1.3.2<tt>&nbsp;</tt></span><a href="#%28part._.Generalization_of_pattern_template_kinds%29" class="tocsubseclink" data-pltdoc="x">Generalization of pattern/<span class="mywbr"> &nbsp;</span>template kinds</a></td></tr><tr><td><span class="tocsublinknumber">36.1.3.3<tt>&nbsp;</tt></span><a href="#%28part._.Lenses%29" class="tocsubseclink" data-pltdoc="x">Lenses</a></td></tr><tr><td><span class="tocsublinknumber">36.1.3.4<tt>&nbsp;</tt></span><a href="#%28part._.Backtracking%29" class="tocsubseclink" data-pltdoc="x">Backtracking</a></td></tr><tr><td><span class="tocsublinknumber">36.1.3.5<tt>&nbsp;</tt></span><a href="#%28part._.Partial_application%29" class="tocsubseclink" data-pltdoc="x">Partial application</a></td></tr><tr><td><span class="tocsublinknumber">36.1.3.6<tt>&nbsp;</tt></span><a href="#%28part._.Partial_compilation%29" class="tocsubseclink" data-pltdoc="x">Partial compilation</a></td></tr><tr><td><span class="tocsublinknumber">36.1.3.7<tt>&nbsp;</tt></span><a href="#%28part._.Quick.Check_test_generation%29" class="tocsubseclink" data-pltdoc="x">Quick<span class="mywbr"> &nbsp;</span>Check test generation</a></td></tr><tr><td><span class="tocsublinknumber">36.1.3.8<tt>&nbsp;</tt></span><a href="#%28part._.Error_messages%29" class="tocsubseclink" data-pltdoc="x">Error messages</a></td></tr><tr><td><span class="tocsublinknumber">36.1.4<tt>&nbsp;</tt></span><a href="#%28part._.Things_to_look_at%29" class="tocsubseclink" data-pltdoc="x">Things to look at</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.6</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="phc-toolkit-format-id-record.html" title="backward to &quot;35 Formatting identifiers so that
DrRacket still shows arrows&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;phc-toolkit&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h3 x-source-module="(lib &quot;phc-toolkit/scribblings/phc-toolkit.scrbl&quot;)" x-source-pkg="phc-toolkit" x-part-tag="&quot;template-lib&quot;">36<tt>&nbsp;</tt><a name="(part._template-lib)"></a>Versatile parser and template library</h3><p>Keywords: grammar, parser, template.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._phc-toolkit/main..rkt)._parse))"></a><span title="Provided from: phc-toolkit | Package: phc-toolkit"><span class="RktSym"><span class="RktSymDef RktSym">parse</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktVar">pattern</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Analogous to <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span>, except it isn&rsquo;t
specialized for syntax, but rather works for arbitrary
s-expressions, including syntax ones (denoted by
<span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktVar">&#8230;</span><span class="RktPn">)</span> in the pattern).</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._phc-toolkit/main..rkt)._tmpl))"></a><span title="Provided from: phc-toolkit | Package: phc-toolkit"><span class="RktSym"><span class="RktSymDef RktSym">tmpl</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">template</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">variable</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">[</span><span class="RktVar">variable</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._%7E3a%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktVar">type</span><span class="RktPn">]</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">template</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">template</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">template</span><span class="hspace">&nbsp;</span><span class="RktSym">::</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">template**</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">template**-dotted</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">template**</span><span class="RktVal">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">vector</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">template**-dotted</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">hash</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">template**-dotted</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">hasheq</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">template**-dotted</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">hasheqv</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">template**-dotted</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVal">#hash</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktVal">template</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">template</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVal">#hasheq</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktVal">template</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">template</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVal">#hasheqv</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktVal">template</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">template</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">struct-id</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktVar">struct-id</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVal">#s</span><span class="RktVal">(</span><span class="RktVal">prefab-id</span><span class="hspace">&nbsp;</span><span class="RktVal">template</span><span class="hspace">&nbsp;</span><span class="RktVal">&#8230;</span><span class="RktVal">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVal">#s</span><span class="RktVal">(</span><span class="RktVal">template</span><span class="hspace">&nbsp;</span><span class="RktVal">template</span><span class="hspace">&nbsp;</span><span class="RktVal">&#8230;</span><span class="RktVal">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVal">#&amp;</span><span class="RktVal">template</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">~identifier</span><span class="hspace">&nbsp;</span><span class="RktVar">args</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">~</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktVar">args</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">unquote</span><span class="RktVar">expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">unquote-splicing</span><span class="RktPn">(</span><span class="RktVar">list</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">unquote-splicing</span><span class="RktPn">(</span><span class="RktVar">list*</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">template-expander-id</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">template-expander-id</span><span class="hspace">&nbsp;</span><span class="RktVar">args</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">??</span><span class="hspace">&nbsp;</span><span class="RktVar">alt-template</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">?@</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">template**-dotted</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">??@</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">template**-dotted</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">?if</span><span class="hspace">&nbsp;</span><span class="RktVar">condition</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">@if</span><span class="hspace">&nbsp;</span><span class="RktVar">condition</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">if@</span><span class="hspace">&nbsp;</span><span class="RktVar">condition</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">@cond</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktVar">condition</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">@cond</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktVar">condition</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">cond@</span><span class="hspace">&nbsp;</span><span class="RktVar">condition</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktVar">~let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVar">meta-var+args</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">. </span><span class="RktVar">template**-dotted</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">~sort</span><span class="hspace">&nbsp;</span><span class="RktVar">key</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="hspace">&nbsp;</span><span class="RktVar">ooo</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">~loc</span><span class="hspace">&nbsp;</span><span class="RktVar">stxloc</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">template</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">~each</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">ddd</span><span class="hspace">&nbsp;</span><span class="RktVar">escaped</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVal">#t</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVal">#f</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">string</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">bytes</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">number</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">char</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">keyword</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">regexp</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">pregexp</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">meta-var+args</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">meta-var</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">meta-var</span><span class="hspace">&nbsp;</span><span class="RktVar">meta-arg</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">tail-template</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">template</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">variable</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">identifier</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">template**-dotted</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">template*</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">template</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">template**</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">template**</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">template*</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">template*</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span><span class="hspace">&nbsp;</span><span class="RktSym">::</span><span class="hspace">&nbsp;</span><span class="RktVar">template</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">template*</span><span class="hspace">&nbsp;</span><span class="RktVar">&#8230;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">~rest</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">template</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">template*</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">template</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">template</span><span class="hspace">&nbsp;</span><span class="RktVar">ooo</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">special-cased-template</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">special-cased-template</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">template</span><span class="hspace">&nbsp;</span><span class="RktVar">vardd</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">template</span><span class="hspace">&nbsp;</span><span class="RktVar">ddvar</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">vardd</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">var..</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">var...</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">ddvar</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">..var</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">...var</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">ooo</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">___</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">..k</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">__k</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">..</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">__</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">ddd</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">TODO: implement the versatile template library.
<span class="RktMeta"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span></div></p><p>TODO: support for typed/racket.</p><p>TODO: optimization feature: would it be useful if the
expanded code could be optimized? For example, when looking
at the output of syntax-parse, the code is far from being
concise.</p><p>The patterns for <span class="RktSym">parse</span> should all have a way to
create a symmetric counterpart for <span class="RktSym">tmpl</span>, which
produces the original value. This symmetry is important
because it allows lens-like macros, which operate on only a
part of the data structure, leaving everything else
intact.</p><p><span class="RktVar">??</span> works like <span class="RktVar">??</span> from
<span class="RktSym">syntax/parse/experimental/template</span>, except it
allows any number of alternatives (including 0, to avoid
special-casing in macros). It is more or less equivalent to
<span class="RktPn">(</span><span class="RktVar">??</span><span class="stt"> </span><span class="RktSym">a</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVar">??</span><span class="stt"> </span><span class="RktSym">b</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVar">??</span><span class="stt"> </span><span class="RktSym">c</span><span class="stt"> </span><span class="RktVar">&#8230;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span>, following syntax/parse&rsquo;s
semantics.</p><p><span class="RktVar">?@</span> has the same meaning as in syntax/parse.</p><p><span class="RktPn">(</span><span class="RktVar">??@</span><span class="stt"> </span><span class="RktSym">t*</span><span class="stt"> </span><span class="RktVar">&#8230;</span><span class="RktPn">)</span> is a shortcut for
<span class="RktPn">(</span><span class="RktVar">??</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVar">?@</span><span class="stt"> </span><span class="RktSym">t*</span><span class="stt"> </span><span class="RktVar">&#8230;</span><span class="RktPn">)</span><span class="RktPn">)</span></p><p>For better compatibility with at-exp, <span class="RktVar">@if</span> can be
written <span class="RktVar">if@</span>, and the same goes for
<span class="RktVar">@cond</span> etc.</p><p>TODO: what&rsquo;s the difference between <span class="RktVar">~</span>,
<span class="RktSym">template-expander</span> and <span class="RktVar">unquote</span>?
<span class="RktSym">template-expander</span> runs at compile-time and should
treat its arguments as syntax.</p><p>Concerning unquoting, unlike <span class="RktSym">racket</span>&rsquo;s default
behaviour in <span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="stt"> </span><span class="RktRdr">#,</span><span class="RktPn">(</span><span class="RktSym">y</span><span class="stt"> </span><span class="RktVar">&#8230;</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">&#8230;</span><span class="RktPn">)</span>, unquoting should
not break the nesting of ellipses. How should we express
voluntary variation of the level of nesting? <span class="RktVar">~let</span>
already allows expanding part of the template at some level
and inserting it verbatim somewhere below, but it&rsquo;s not a
silver bullet. One case which comes to mind is when some of
the nested data should be mixed with less-nested data, for
example going from
<span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVal">10</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">]</span><span class="stt"> </span><span class="RktPn">[</span><span class="RktVal">100</span><span class="stt"> </span><span class="RktVal">4</span><span class="stt"> </span><span class="RktVal">5</span><span class="RktPn">]</span><span class="stt"> </span><span class="RktPn">[</span><span class="RktVal">1000</span><span class="stt"> </span><span class="RktVal">6</span><span class="RktPn">]</span><span class="RktPn">)</span> to
<span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVal">10</span><span class="stt"> </span><span class="RktVal">20</span><span class="stt"> </span><span class="RktVal">30</span><span class="RktPn">]</span><span class="stt"> </span><span class="RktPn">[</span><span class="RktVal">400</span><span class="stt"> </span><span class="RktVal">500</span><span class="RktPn">]</span><span class="stt"> </span><span class="RktPn">[</span><span class="RktVal">6000</span><span class="RktPn">]</span><span class="RktPn">)</span> should be relatively
easy to express. Maybe <span class="RktVar">~let</span> with parameters can be
a suitable generalized solution:
<span class="RktPn">(</span><span class="RktPn">{</span><span class="RktVar">~let</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">addx</span><span class="stt"> </span><span class="RktSym">v</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktRdr">#,</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktSym">x</span><span class="stt"> </span><span class="RktSym">v</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">addx</span><span class="stt"> </span><span class="RktSym">y</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVar">&#8230;</span><span class="RktPn">]</span><span class="RktPn">}</span><span class="stt"> </span><span class="RktVar">&#8230;</span><span class="RktPn">)</span></p><p>The special-cased template syntax should allow special
treatment of the <span class="RktSym">i</span>-th iteration in a doubly-nested
loop: matching <span class="RktSym">x</span> on <span class="RktPn">(</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="stt"> </span><span class="RktVal">4</span><span class="stt"> </span><span class="RktVal">5</span><span class="RktPn">)</span>, and
using the template <span class="RktPn">(</span><span class="RktVal">0</span><span class="stt"> </span><span class="RktSym">x..</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVar">unquote</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252A%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">*</a></span><span class="stt"> </span><span class="RktSym">x</span><span class="stt"> </span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">..x</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVar">&#8230;</span> will
produce <span class="RktPn">(</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">4</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">9</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">16</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">24</span><span class="RktPn">)</span>. The pattern before
<span class="RktSym">x..</span> and the pattern after <span class="RktSym">..x</span> can expand
to multiple items which will be spliced in by wrapping it
with <span class="RktVar">?@</span>.</p><h4 x-source-module="(lib &quot;phc-toolkit/scribblings/phc-toolkit.scrbl&quot;)" x-source-pkg="phc-toolkit" x-part-tag="&quot;Ideas_for_implementation&quot;">36.1<tt>&nbsp;</tt><a name="(part._.Ideas_for_implementation)"></a>Ideas for implementation</h4><h5 x-source-module="(lib &quot;phc-toolkit/scribblings/phc-toolkit.scrbl&quot;)" x-source-pkg="phc-toolkit" x-part-tag="&quot;Extensibility__expanders_&quot;">36.1.1<tt>&nbsp;</tt><a name="(part._.Extensibility__expanders_)"></a>Extensibility (expanders)</h5><p>Allow normal, inline-prefix, inline-postfix and inline-infix
expanders, which can bind using regular expressions. This
allows implementing exotic syntax like <span class="RktSym">var..</span>
(postfix, operates on the pattern preceeding it),
<span class="RktSym">..var</span> (postfix, operates on the pattern after it),
<span class="RktPn">(</span><span class="RktSym">&#8230;</span><span class="stt"> </span><span class="RktSym">escaped-pattern</span><span class="RktPn">)</span> (normal, operates on the
containing s-exp)</p><h5 x-source-module="(lib &quot;phc-toolkit/scribblings/phc-toolkit.scrbl&quot;)" x-source-pkg="phc-toolkit" x-part-tag="&quot;Customization&quot;">36.1.2<tt>&nbsp;</tt><a name="(part._.Customization)"></a>Customization</h5><p>For things that are likely to be customized by the user in
the whole file scope, define a grammar/custom module, used
as follows:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">grammar/custom</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">grammar/custom</span><span class="hspace">&nbsp;</span><span class="RktSym">option</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8230;</span><span class="RktPn">)</span></td></tr></table></blockquote><p>The <span class="RktSym">grammar/custom</span> macro expands to
<span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><span class="RktSym">grammar/core</span><span class="RktPn">)</span> followed by a bunch of
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span> which wrap the core macros, providing
them the custom options:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">grammar/core</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._define-syntax-rule%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">parse</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym">rest</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">parse/core</span><span class="hspace">&nbsp;</span><span class="RktPn">#:global-options</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">option</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8230;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym">rest</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._define-syntax-rule%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">tmpl</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym">rest</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">parse/core</span><span class="hspace">&nbsp;</span><span class="RktPn">#:global-options</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">option</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8230;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym">rest</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>This can also be used to rename the <span class="RktSym">parse</span> and
<span class="RktSym">tmpl</span> macros, if desired (for example,
<span class="RktSym">tmpl</span> could be renamed to <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fqqstx..rkt%2529._quasisyntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasisyntax</a></span>, or
something similar).</p><p>Otherwise, <span class="RktSym">grammar/custom</span> could just <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=set_.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._set%2521%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">set!</a></span>
some for-syntax variable which stores the options. A second
boolean for-syntax variable could be used to check if
<span class="RktSym">grammar/custom</span> was called twice, and throw an error
in that case.</p><p>Or maybe we should just use units? Can they be customized in
a similar way?</p><p>The idea is to avoid having to wrap the whole file in a
<span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=parameters.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._parameterize%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">parameterize</a></span><span class="stt"> </span><span class="RktSym">&#8230;</span><span class="RktPn">)</span>, and be able to easily
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._provide%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">provide</a></span> a customized variation of this library:</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._provide%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">provide</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">customized-out</span><span class="hspace">&nbsp;</span><span class="RktSym">grammar/custom</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote><h5 x-source-module="(lib &quot;phc-toolkit/scribblings/phc-toolkit.scrbl&quot;)" x-source-pkg="phc-toolkit" x-part-tag="&quot;Unsorted_ideas&quot;">36.1.3<tt>&nbsp;</tt><a name="(part._.Unsorted_ideas)"></a>Unsorted ideas</h5><h5 x-source-module="(lib &quot;phc-toolkit/scribblings/phc-toolkit.scrbl&quot;)" x-source-pkg="phc-toolkit" x-part-tag="&quot;Global_pattern_constraints&quot;">36.1.3.1<tt>&nbsp;</tt><a name="(part._.Global_pattern_constraints)"></a>Global pattern constraints</h5><p>For patterns, have global constraints: <span class="RktPn">(</span><span class="RktSym">~global-or</span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Library_Syntax_Classes_and_Literal_Sets.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._id%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">id</a></span><span class="RktPn">)</span> binds
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Library_Syntax_Classes_and_Literal_Sets.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._id%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">id</a></span> to true if the enclosing pattern was matched at least once, and
false otherwise. Multiple occurrences of the same <span class="RktPn">(</span><span class="RktSym">~global-or</span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Library_Syntax_Classes_and_Literal_Sets.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._id%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">id</a></span><span class="RktPn">)</span> make
the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Library_Syntax_Classes_and_Literal_Sets.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._id%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">id</a></span> true if any of the containing clauses was matched at least
once.</p><p>Inside a <span class="RktPn">{</span><span class="RktSym">~no-order</span><span class="RktPn">}</span>, it should be possible to impose some partial
order constraints, so that we can say:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span><span class="RktSym">~no-order</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eoptional%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~optional</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pat-a</span><span class="RktPn">}</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eoptional%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~optional</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pat-b</span><span class="RktPn">}</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktSym">pat-c</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eoptional%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~optional</a></span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~constrain</span><span class="hspace">&nbsp;</span><span class="RktSym">pat-d</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~after</span><span class="hspace">&nbsp;</span><span class="RktSym">pat-a</span><span class="RktPn">}</span><span class="RktPn">}</span><span class="RktPn">}</span><span class="RktPn">}</span></td></tr></table></blockquote><p>The above code means that <span class="RktSym">pat-a</span>, <span class="RktSym">pat-b</span> and <span class="RktSym">pat-d</span> are
optional (but not <span class="RktSym">pat-c</span>), the four patterns can appear in any order,
but if <span class="RktSym">pat-a</span> and <span class="RktSym">pat-d</span> are both present, then <span class="RktSym">pat-d</span>
must appear after <span class="RktSym">pat-a</span>.</p><p>Scopes: the global constraints apply within a scope. By default, there is an
implicit top-level scope, and some forms might implicitly introduce a catch-all
scope unless otherwise specified, like the implicit <span class="RktSym">~demimit-cut</span> for
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-specifying.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._define-syntax-class%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax-class</a></span> from <span class="RktSym">syntax/parse</span>. There could be two
kinds of scopes: unhygienic catch-all scopes which scope all "global"
constraints within, and naming scopes, which explicitly say which identifiers
they scope.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span><span class="RktSym">~scope</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">a</span><span class="RktPn">}</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~vector</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~scope</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">b</span><span class="RktPn">}</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~no-order</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eonce%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~once</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">}</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eoptional%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~optional</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">}</span><span class="RktPn">}</span><span class="RktPn">}</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~scope</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">b</span><span class="RktPn">}</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~no-order</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eonce%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~once</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">}</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eoptional%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~optional</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">}</span><span class="RktPn">}</span><span class="RktPn">}</span><span class="RktPn">}</span><span class="RktPn">}</span></td></tr></table></blockquote><p>The code above matches against a vector of two <span class="RktSym">~no-order</span> lists. The
<span class="RktSym">a</span> pattern must appear exactly once, either in the first list or in the
second, but not in both. On the other hand, the <span class="RktSym">b</span> pattern may appear
zero or one time in the first list, zero or one time in the second list, and may
appear in both since its constraint is scoped for each list. Although it is less
clear, the following code is semantically identical:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span><span class="RktSym">~scope</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">}</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~vector</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~no-order</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eonce%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~once</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">}</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eoptional%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~optional</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">}</span><span class="RktPn">}</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~scope</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">b</span><span class="RktPn">}</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~no-order</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eonce%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~once</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">}</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eoptional%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~optional</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">}</span><span class="RktPn">}</span><span class="RktPn">}</span><span class="RktPn">}</span><span class="RktPn">}</span></td></tr></table></blockquote><p>Since the <span class="RktSym">b</span> in the <span class="RktVal">"~no-order"</span> is bound to the enclosing
<span class="RktPn">{</span><span class="RktSym">~scope</span><span class="stt"> </span><span class="RktPn">{</span><span class="RktSym">b</span><span class="RktPn">}</span><span class="stt"> </span><span class="RktSym">&#8230;</span><span class="RktPn">}</span>, it does not interact in any way with the outer scope.
The <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eoptional%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~optional</a></span> constraint on the <span class="RktSym">b</span> in the first
<span class="RktSym">~no-order</span> therefore does not interact withe the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eoptional%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~optional</a></span>
constraint in the second <span class="RktSym">~no-order</span>.</p><h5 x-source-module="(lib &quot;phc-toolkit/scribblings/phc-toolkit.scrbl&quot;)" x-source-pkg="phc-toolkit" x-part-tag="&quot;Generalization_of_pattern_template_kinds&quot;">36.1.3.2<tt>&nbsp;</tt><a name="(part._.Generalization_of_pattern_template_kinds)"></a>Generalization of pattern/template kinds</h5><p>Nearly all patterns and templates should work equally well for regular lists and
syntax objects. It should be possible and easy enough to create new "kinds" of
data, which modify how patterns and templates work all the way through the
pattern or template tree, until it switches to a new kind. As an example, the
following pattern starts as a normal s-expr pattern, and switches to syntax in
two nodes:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span><span class="RktSym">~s-expr</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">buckle</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eoptional%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~optional</a></span><span class="hspace">&nbsp;</span><span class="RktSym">my</span><span class="RktPn">}</span><span class="hspace">&nbsp;</span><span class="RktSym">shoe</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~syntax</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">knock</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eoptional%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~optional</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="hspace">&nbsp;</span><span class="RktSym">the</span><span class="RktPn">}</span><span class="hspace">&nbsp;</span><span class="RktSym">door</span><span class="RktPn">)</span><span class="RktPn">}</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pick</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~optional-wrap</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">up</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">sticks</span><span class="RktPn">)</span><span class="RktPn">}</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~syntax</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lay</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym">~optional-wrap</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">them</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">straight</span><span class="RktPn">)</span><span class="RktPn">}</span><span class="RktPn">)</span><span class="RktPn">}</span><span class="RktPn">}</span></td></tr></table></blockquote><p>That pattern should match the following value:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">buckle</span><span class="hspace">&nbsp;</span><span class="RktVal">shoe</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">knock</span><span class="hspace">&nbsp;</span><span class="RktSym">door</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">pick</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">up</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">sticks</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">lay</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">them</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">straight</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktVal">)</span></td></tr></table></blockquote><p>The <span class="RktSym">~syntax</span> indicates that the whole subtree should start matching (or
producing) syntax objects, instead of regular s-expressions. It is worht noting
that syntax objects have extra information (source location, syntax properties)
that regular s-expressions lack. One way of implementing this would be to make
the pattern directives operate on "enhanced" s-expressions. Enhanced
s-expressions are s-expressions with arbitrary kind-specific data attached to
them. The <span class="RktSym">~s-expr</span> simply translates s-expressions into enhanced
s-expressions with an empty data attached, while <span class="RktSym">~syntax</span> is a sort of
pre-processor which turns syntax objects into enhanced s-expressions with source
location and syntax properties attached. These "kind" pre-processors run before
the normal pattern directives are applied. Some kind-specific pattern directives
can access those properties (if they are used in within the scope of the
appropriate <span class="RktSym">~kind</span>), so that a <span class="RktPn">(</span><span class="RktSym">~loc</span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._srcloc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">srcloc</a></span><span class="stt"> </span><span class="RktPn">. </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-specifying.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._pattern%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">pattern</a></span><span class="RktPn">)</span> matches
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-specifying.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._pattern%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">pattern</a></span> and saves its source location into the variable
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._srcloc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">srcloc</a></span>.</p><p>Kinds should also be able to alter how the pattern variables are bound:
<span class="RktSym">~s-expr</span> simply binds (in patterns) and uses (in templates) normal
Racket variables. On the other hand, <span class="RktSym">~syntax</span> binds and uses syntax
pattern variables, so that the bound variables are used as <span class="RktRdr">#'</span><span class="RktSym">var</span>
instead of <span class="RktSym">var</span>.</p><p>Different pattern and template forms can specify a default kind (possibly by
simply wrapping their pattern or tempalte with the appropriate <span class="RktSym">~kind</span>).
For example, a <span class="RktSym">define/match</span> form would use <span class="RktSym">~s-expr</span> by default,
whereas a <span class="RktSym">define-syntax/match</span> would use <span class="RktSym">~syntax</span>. The same
would apply for re-implementations of Racket&rsquo;s <span class="RktSym">match</span> and
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span>.</p><p>Do the "kinds" form some sort of monad? TODO: Think about this, and try to see
if there are some monads which can be translated to pattern/template kinds
usefully.</p><h5 x-source-module="(lib &quot;phc-toolkit/scribblings/phc-toolkit.scrbl&quot;)" x-source-pkg="phc-toolkit" x-part-tag="&quot;Lenses&quot;">36.1.3.3<tt>&nbsp;</tt><a name="(part._.Lenses)"></a>Lenses</h5><p>It should be possible to describe lenses using the patterns: you can work on
the focused part of the match, possibly access (read-only) other parts, and
return a new value. What should happen when the focused part is under an
ellipsis and has more than one match ? Implicitly execute the code n times, like
a sort of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._for%252Flist%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">for/list</a></span>?</p><h5 x-source-module="(lib &quot;phc-toolkit/scribblings/phc-toolkit.scrbl&quot;)" x-source-pkg="phc-toolkit" x-part-tag="&quot;Backtracking&quot;">36.1.3.4<tt>&nbsp;</tt><a name="(part._.Backtracking)"></a>Backtracking</h5><p><div class="SIntrapara">Since the parser may need to backtrack, we need to expose the backtracking
mechanism to the user in some way, so that the user can:
</div><div class="SIntrapara"><ul><li><p>Cut the current branch</p></li><li><p>Perform some side-effects and undo them when backtracking (dangerous)</p></li><li><p>Record a side-effectful lambda which is executed when the match succeeds
or when the current branch is <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7ecommit%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~commit</a></span>ted.</p></li><li><p>Querry information about the previously failed branches</p></li><li><p>Maybe affect the order in which non-deterministic branches are taken.
This feature would mainly be used by optimizers.</p><p>As a toy "just because we can" example, the backtracking mechanism should be
configurable enough that some CSP algorithm like AC2003 can be expressed by
the user, turning the pattern library into a CSP solver (where the CSP problem
is expressed as a pattern over an empty object). Another toy "just because we
can" example would be a datalog implementation built upon this library, where
the deduction rules are expressed as patterns.</p><p>The goal is that the parser&rsquo;s backtracking mechanism should be modular enough
to allow us to implement a dead-simple unoptimized backtracker, and allow
optimizers to be written as plug-ins. For example, an optimiazer could
statically detect branches that can be cut due to a prior failure (e.g. if the
two-element-list pattern <span class="RktPn">(</span><span class="RktSym">foo:id</span><span class="stt"> </span><span class="RktSym">bar:number</span><span class="RktPn">)</span> failed because the first
element was not an <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fstx..rkt%2529._identifier%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">identifier?</a></span>, there&rsquo;s no point in trying
<span class="RktPn">(</span><span class="RktSym">baz:id</span><span class="stt"> </span><span class="RktSym">quux:string</span><span class="stt"> </span><span class="RktSym">fuzz:number</span><span class="RktPn">)</span> on the same term.</p><p>Extensive configurability of the backtracking mechanism and optimization
features may interact badly with partial application and partial compilation,
see below. Think it through before giving too much or too little expressivity
to the user.</p></li></ul></div></p><h5 x-source-module="(lib &quot;phc-toolkit/scribblings/phc-toolkit.scrbl&quot;)" x-source-pkg="phc-toolkit" x-part-tag="&quot;Partial_application&quot;">36.1.3.5<tt>&nbsp;</tt><a name="(part._.Partial_application)"></a>Partial application</h5><p>It should be possible to give a partial input with holes to a pattern or
template form, and, for optimization purposes, request that the pattern or
template processes the input as much as it can (for the parser, it would
potentially open a bounded number of backtracking branches, ready to switch to
the next one if one fails), leaving an efficient "continuation".</p><h5 x-source-module="(lib &quot;phc-toolkit/scribblings/phc-toolkit.scrbl&quot;)" x-source-pkg="phc-toolkit" x-part-tag="&quot;Partial_compilation&quot;">36.1.3.6<tt>&nbsp;</tt><a name="(part._.Partial_compilation)"></a>Partial compilation</h5><p>One of the drawbacks of <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">syntax/parse</span></a> is that compiling a
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span> form takes some non-negligible time. This means that if a
macro generates another macro, and the generated macro code uses syntax-parse,
each call to the "generator" macro will be expensive. A complex macro generating
syntax which contains hundreds of uses of syntax-case will be reasonnably fast.
The same code using syntax-parse will be much slower. Since the generated uses
of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span> will all have the same "shape" with a few identifiers
etc. changing, it would be nice to be able to partially pre-expand a use of
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span>, leaving only the "holes" to be expanded. With a bottom-up
expansion mechanism there&rsquo;s not much to do, so we have to try hard to make the
pattern / template expander top-down as much as possible, and/or use a lazy
language (for which most things can be evaluated, leaving a continuation for the
few things that actually depend on the holes).</p><p>Although partial compilation sounds like a very interesting academic project,
it might be too difficult to get something useful out of it in practice. An
alternative, which would procude the sought performance benefits for macros
generating code which uses the pattern/template library, would be to make as
many of the concepts first-class, so that they can easily be supplied as a
parameter. Note that firs-class in this case does not necessarily mean "run-time
first-class", but possibly "compile-time first-class": we only need to be able
to pre-declare parametric templates, then use them in the code generated by a
macro. As long as the parametric templates support a form of "separate
compilation" and optimization, filling in the parameters can be handled by a
fast macro.</p><p>Some of the optimization plug-ins may however rely on a closed-world assumption
(i.e. they want to have the whole, final pattern or template, in order to
optimize it). If such an optimization plug-in is used, we may have to fall back
to the idea of using partial compilation, or simply accept that macros which
generate such code will take a while to expand.</p><h5 x-source-module="(lib &quot;phc-toolkit/scribblings/phc-toolkit.scrbl&quot;)" x-source-pkg="phc-toolkit" x-part-tag="&quot;QuickCheck_test_generation&quot;">36.1.3.7<tt>&nbsp;</tt><a name="(part._.Quick.Check_test_generation)"></a>QuickCheck test generation</h5><p>It should be possible to generate random data that matches (and does not match,
too, that&rsquo;s a distinct problem) a pattern (unless there&rsquo;s a user-provided
predicate that is opaque to the library, in which case we can just ignore it and
generate instances at random, hoping that some will match and some won&rsquo;t).</p><p>Combined with the fact that pattern directives should be reversible into
template directives, and vica versa, it means that each directive should also
express its set of accepted values in terms of its contents. Of course, we don&rsquo;t
expect to be able to uniformly sample random instances, nor do we expect to be
able to support in a useful way complex patterns with lots of opaque predicates.</p><h5 x-source-module="(lib &quot;phc-toolkit/scribblings/phc-toolkit.scrbl&quot;)" x-source-pkg="phc-toolkit" x-part-tag="&quot;Error_messages&quot;">36.1.3.8<tt>&nbsp;</tt><a name="(part._.Error_messages)"></a>Error messages</h5><p><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">syntax/parse</span></a> generates good error messages, but it does not
work as well when the patterns become complex. Think this through, so that the
annotation burden is minimal, and so that users don&rsquo;t have to think too hard
about where to put a <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7edescribe%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~describe</a></span> (I frequently had the problem with
<span class="RktSym">syntax/parse</span> where I wrote a <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7edescribe%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~describe</a></span>, but it wasn&rsquo;t taken
into account.</p><h5 x-source-module="(lib &quot;phc-toolkit/scribblings/phc-toolkit.scrbl&quot;)" x-source-pkg="phc-toolkit" x-part-tag="&quot;Things_to_look_at&quot;">36.1.4<tt>&nbsp;</tt><a name="(part._.Things_to_look_at)"></a>Things to look at</h5><ul><li><p><span class="RktSym">math/arry</span>, for <span class="RktSym">::</span> and array
broadcasting.</p></li><li><p>Quasipatterns in <span class="RktSym">match</span>.</p></li><li><p>The <span class="RktSym">lens</span> library</p></li><li><p><a href="https://github.com/racket/racket/issues/1304"><span class="url">https://github.com/racket/racket/issues/1304</span></a>
non-linear matching (with repeated binding variables, for
example, that should be eq? or equal?)</p></li></ul><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="phc-toolkit-format-id-record.html" title="backward to &quot;35 Formatting identifiers so that
DrRacket still shows arrows&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;phc-toolkit&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/phc-toolkit/template-lib.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:29:41 GMT -->
</html>