<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/net2/Transport_Connectors.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:27:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>3&nbsp;Transport Connectors</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Net2:<span class="mywbr"> &nbsp;</span> Evolved Networking Libraries</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Networking_Data_Structures.html" class="tocviewlink" data-pltdoc="x">Networking Data Structures</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Transports.html" class="tocviewlink" data-pltdoc="x">Transports</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Transport Connectors</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Transport_Listeners.html" class="tocviewlink" data-pltdoc="x">Transport Listeners</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Operating_System_Networking.html" class="tocviewlink" data-pltdoc="x">Operating System Networking</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>3&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Transport Connectors</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">3.1&nbsp;</td><td><a href="#%28part._.Connector_.Concepts%29" class="tocviewlink" data-pltdoc="x">Connector Concepts</a></td></tr><tr><td align="right">3.2&nbsp;</td><td><a href="#%28part._.Connector_.Primitives%29" class="tocviewlink" data-pltdoc="x">Connector Primitives</a></td></tr><tr><td align="right">3.3&nbsp;</td><td><a href="#%28part._.Composing_and_.Extending_.Connectors%29" class="tocviewlink" data-pltdoc="x">Composing and Extending Connectors</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#%28part._.Connector_.Concepts%29" class="tocsubseclink" data-pltdoc="x">Connector Concepts</a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#%28part._.Connector_.Primitives%29" class="tocsubseclink" data-pltdoc="x">Connector Primitives</a></td></tr><tr><td><a href="#%28def._%28%28lib._net2%2Fconnector..rkt%29._connector~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">connector?</span></a></td></tr><tr><td><a href="#%28def._%28%28lib._net2%2Fconnector..rkt%29._connector%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">connector</span></a></td></tr><tr><td><a href="#%28def._%28%28lib._net2%2Fconnector..rkt%29._transport-pool%2Fc%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">transport-<wbr></wbr>pool/<span class="mywbr"> &nbsp;</span>c</span></a></td></tr><tr><td><a href="#%28def._%28%28lib._net2%2Fconnector..rkt%29._connect%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">connect!</span></a></td></tr><tr><td><a href="#%28def._%28%28lib._net2%2Fconnector..rkt%29._connection%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">connection</span></a></td></tr><tr><td><span class="tocsublinknumber">3.3<tt>&nbsp;</tt></span><a href="#%28part._.Composing_and_.Extending_.Connectors%29" class="tocsubseclink" data-pltdoc="x">Composing and Extending Connectors</a></td></tr><tr><td><a href="#%28def._%28%28lib._net2%2Fconnector..rkt%29._connector-tunnel%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">connector-<wbr></wbr>tunnel</span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.6</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Transports.html" title="backward to &quot;2 Transports&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Net2: Evolved Networking Libraries&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Transport_Listeners.html" title="forward to &quot;4 Transport Listeners&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;net2/scribblings/main.scrbl&quot;)" x-source-pkg="net2" x-part-tag="&quot;Transport_Connectors&quot;">3<tt>&nbsp;</tt><a name="(part._.Transport_.Connectors)"></a><a name="(mod-path._net2/connector)"></a>Transport Connectors</h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#" class="RktModLink" data-pltdoc="x"><span class="RktSym">net2/connector</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/net2" title="Install this package using `raco pkg install net2`"><span class="stt">net2</span></a></span></td></tr></table></p><p>A <a name="(tech._connector)"></a><span style="font-style: italic">connector</span> is a means of opening new
<a href="Transports.html#%28tech._transport%29" class="techoutside" data-pltdoc="x"><span class="techinside">transports</span></a> to arbitrary <a href="Networking_Data_Structures.html#%28tech._uri._authority%29" class="techoutside" data-pltdoc="x"><span class="techinside">authorities</span></a>.
Connectors play the role of a "client" authority in the sense that they send
connection requests to "server" authorities, but once an authority accepts that
request and opens a new transport either party may send or receive bytes to the
other at any time. To instead accept connection requests from others, see
<font class="badlink"><span class="techoutside"><span class="techinside">listeners</span></span></font>.</p><p>The <a href="#" class="RktModLink" data-pltdoc="x"><span class="RktSym">net2/connector</span></a> module defines a means of constructing new
connectors as well as generic ways of extending connectors. For connectors that
use the operating system&rsquo;s networking including TCP connectors, see the
<a href="Operating_System_Networking.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">net2/system</span></a> module.</p><h4 x-source-module="(lib &quot;net2/scribblings/main.scrbl&quot;)" x-source-pkg="net2" x-part-tag="&quot;Connector_Concepts&quot;">3.1<tt>&nbsp;</tt><a name="(part._.Connector_.Concepts)"></a>Connector Concepts</h4><p>Connectors are typically responsible for all connections of a specific kind in a
program, regardless of which <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=concurrency.html%23%2528tech._thread%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">thread</span></a> attempts to connect to which
authority. This allows connectors to reuse connections across threads without
fear that a <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval-model.html%23%2528tech._custodian%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">custodian</span></a> shutdown in one thread will close a
transport used by another thread. Connector transport reuse and management is
primarily defined in terms of <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=disposable&amp;rel=Basic_Disposable_API_and_Concepts.html%23%2528tech._disposable%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">disposables</span></a> from the
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=disposable&amp;rel=index.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">disposable</span></a> library.</p><p>Note that many kinds of <a href="Transports.html#%28tech._transport%29" class="techoutside" data-pltdoc="x"><span class="techinside">transports</span></a> (including TCP connections)
are expensive to create, maintain, and terminate. It is crucial to minimize the
number of open connections between two parties, but sometimes higher-level
protocols need to control when connections are closed or whether a fresh,
previously unused connection is required. For this purpose, <a href="#%28tech._connector%29" class="techoutside" data-pltdoc="x"><span class="techinside">connectors</span></a> are defined in terms of <a name="(tech._transport._pool)"></a><span style="font-style: italic">transport pools</span>. A transport pool is a combination of a <font class="badlink"><span class="techoutside"><span class="techinside">disposable pool</span></span></font> and a <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=disposable&amp;rel=Transient_Values.html%23%2528tech._transient%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">transient</span></a> that allows reusing
transports, and is defined by the <span class="RktSym">transport-pool/c</span> contract.</p><h4 x-source-module="(lib &quot;net2/scribblings/main.scrbl&quot;)" x-source-pkg="net2" x-part-tag="&quot;Connector_Primitives&quot;">3.2<tt>&nbsp;</tt><a name="(part._.Connector_.Primitives)"></a>Connector Primitives</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._net2/connector..rkt)._connector~3f))"></a><span title="Provided from: net2/connector, net2 | Package: net2"><span class="RktSym"><span class="RktSymDef RktSym">connector?</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">v</span> is a <a href="#%28tech._connector%29" class="techoutside" data-pltdoc="x"><span class="techinside">connector</span></a>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._net2/connector..rkt)._connector))"></a><span title="Provided from: net2/connector, net2 | Package: net2"><span class="RktSym"><span class="RktSymDef RktSym">connector</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">connect-proc</span><span class="hspace">&nbsp;</span><span class="RktPn">#:custodian</span><span class="hspace">&nbsp;</span><span class="RktVar">cust</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">connector?</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">connect-proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">authority?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=disposable&amp;rel=Basic_Disposable_API_and_Concepts.html%23%2528def._%2528%2528lib._disposable%252Fmain..rkt%2529._disposable%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">disposable/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym">transport?</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cust</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=custodians.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-custodian%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">make-custodian</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="#%28tech._connector%29" class="techoutside" data-pltdoc="x"><span class="techinside">connector</span></a> that can be used with <span class="RktSym">connect</span> to
open new <a href="Transports.html#%28tech._transport%29" class="techoutside" data-pltdoc="x"><span class="techinside">transports</span></a> to a given <a href="Networking_Data_Structures.html#%28tech._uri._authority%29" class="techoutside" data-pltdoc="x"><span class="techinside">authority</span></a>.
Calls to <span class="RktVar">connect-proc</span>, allocation of the <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=disposable&amp;rel=Basic_Disposable_API_and_Concepts.html%23%2528tech._disposable%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">disposable</span></a>
it returns, and deallocation of allocated transports are all made with
<span class="RktVar">cust</span> installed as the <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval-model.html%23%2528tech._current._custodian%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">current custodian</span></a> to ensure
that all <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=i_o.html%23%2528tech._port%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">ports</span></a> are managed solely by the returned connector. If
<span class="RktVar">cust</span> is not provided it defaults to a new custodian that is a child of
the custodian that was current when <span class="RktSym">connector</span> was called.</div></p><p>The <span class="RktVar">connect-proc</span> procedure is expected to choose a source authority
for outgoing transports, as well as resolve the destination authority from a
resolvable name authority (such as a DNS address) to a more direct network
address authority (such as an IP address). As a result, transports created by
<span class="RktVar">connect-proc</span> may have a different destination authority than the
destination authority oringally provided to <span class="RktVar">connect-proc</span>.</p><p>Cleanly closing transports may involve negotiating shutdown actions with the
destination authority. The <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=disposable&amp;rel=Basic_Disposable_API_and_Concepts.html%23%2528tech._disposable%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">disposable</span></a> returned by
<span class="RktVar">connect-proc</span> is expected to responsibly implement this sort of
graceful close logic, with forceful termination of the transport left to
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval-model.html%23%2528tech._custodian%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">custodian</span></a> shutdowns and finalizers. See <a href="Transports.html#%28part._transport-cleanup%29" data-pltdoc="x">Transport Cleanup and Disposables</a> for a more in-depth discussion.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._net2/connector..rkt)._transport-pool/c))"></a><span title="Provided from: net2/connector, net2 | Package: net2"><span class="RktSym"><span class="RktSymDef RktSym">transport-pool/c</span></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=contract-utilities.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fguts..rkt%2529._contract%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">contract?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=disposable&amp;rel=Basic_Disposable_API_and_Concepts.html%23%2528def._%2528%2528lib._disposable%252Fmain..rkt%2529._disposable%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">disposable/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=disposable&amp;rel=Basic_Disposable_API_and_Concepts.html%23%2528def._%2528%2528lib._disposable%252Fmain..rkt%2529._disposable%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">disposable/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=disposable&amp;rel=Transient_Values.html%23%2528def._%2528%2528lib._disposable%252Fmain..rkt%2529._transient%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">transient/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym">transport?</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">A contract that recognizes <a href="#%28tech._transport._pool%29" class="techoutside" data-pltdoc="x"><span class="techinside">transport pools</span></a> as used by
<a href="#%28tech._connector%29" class="techoutside" data-pltdoc="x"><span class="techinside">connectors</span></a>. A transport pool is a collection of opened
<a href="Transports.html#%28tech._transport%29" class="techoutside" data-pltdoc="x"><span class="techinside">transports</span></a> to a particular <a href="Networking_Data_Structures.html#%28tech._uri._authority%29" class="techoutside" data-pltdoc="x"><span class="techinside">authority</span></a>, where
clients may use the <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=disposable&amp;rel=Transient_Values.html%23%2528tech._transient%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">transient value</span></a> protocol to do any of the
following:</div></p><ul><li><p>Get any open transport &#8212;<wbr></wbr> creating a new one if one doesn&rsquo;t exist &#8212;<wbr></wbr> and
return it to the pool after use.</p></li><li><p>Open a <span class="emph">fresh</span> transport that&rsquo;s never been used and return it to the
pool after use.</p></li><li><p>Explicitly close a transport ensuring that it won&rsquo;t be used again.</p></li></ul><p>Most clients will simply request any available transport and return it after
use, but some protocols require clients explicitly close connections after
specific interactions. The use of transient values offers clients a mechanism
for opting-in to this complexity, even when other clients of the same pool
choose the simpler interface.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._net2/connector..rkt)._connect!))"></a><span title="Provided from: net2/connector, net2 | Package: net2"><span class="RktSym"><span class="RktSymDef RktSym">connect!</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">conn</span><span class="hspace">&nbsp;</span><span class="RktVar">dest</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">transport?</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">conn</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">connector?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">dest</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">authority?</span></td></tr></table></blockquote></div><div class="SIntrapara">Connects to <span class="RktVar">dest</span> using <span class="RktVar">conn</span> and returns a <a href="Transports.html#%28tech._transport%29" class="techoutside" data-pltdoc="x"><span class="techinside">transport</span></a> that can be used to communicate with <span class="RktVar">dest</span>, albeit possibly
with a different address for the destination <a href="Networking_Data_Structures.html#%28tech._uri._authority%29" class="techoutside" data-pltdoc="x"><span class="techinside">authority</span></a> due to
name resolution. If <span class="RktVar">conn</span> opens <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=i_o.html%23%2528tech._port%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">ports</span></a> or other resources
managed by <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval-model.html%23%2528tech._custodian%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">custodians</span></a>, those resources are owned by the
custodian used to construct <span class="RktVar">conn</span> instead of the <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval-model.html%23%2528tech._current._custodian%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">current custodian</span></a>. See <span class="RktSym">connector</span> for more details.</div></p><p>The returned transport is created for use only in the current thread and
automatically destroyed when the current thread dies, but the meaning of
"destroyed" is dependent on the specific <a href="#%28tech._connector%29" class="techoutside" data-pltdoc="x"><span class="techinside">connector</span></a> used. In
particular, some connectors may reuse transports in the future. For precise
control over construction and destruction of transports, see the
<span class="RktSym">connection</span> procedure.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._net2/connector..rkt)._connection))"></a><span title="Provided from: net2/connector, net2 | Package: net2"><span class="RktSym"><span class="RktSymDef RktSym">connection</span></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">conn</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">dest</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:fresh-only?</span><span class="hspace">&nbsp;</span><span class="RktVar">fresh-only?</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=disposable&amp;rel=Basic_Disposable_API_and_Concepts.html%23%2528def._%2528%2528lib._disposable%252Fmain..rkt%2529._disposable%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">disposable/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">transport?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void?</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">conn</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">connector?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">dest</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">authority?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">fresh-only?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">Currently undocumented.</div></p><h4 x-source-module="(lib &quot;net2/scribblings/main.scrbl&quot;)" x-source-pkg="net2" x-part-tag="&quot;Composing_and_Extending_Connectors&quot;">3.3<tt>&nbsp;</tt><a name="(part._.Composing_and_.Extending_.Connectors)"></a>Composing and Extending Connectors</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._net2/connector..rkt)._connector-tunnel))"></a><span title="Provided from: net2/connector, net2 | Package: net2"><span class="RktSym"><span class="RktSymDef RktSym">connector-tunnel</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">conn</span><span class="hspace">&nbsp;</span><span class="RktVar">tunneler</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">connector?</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">conn</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">connector?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">tunneler</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">transport?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=disposable&amp;rel=Basic_Disposable_API_and_Concepts.html%23%2528def._%2528%2528lib._disposable%252Fmain..rkt%2529._disposable%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">disposable/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym">transport?</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="#%28tech._connector%29" class="techoutside" data-pltdoc="x"><span class="techinside">connector</span></a> that is like <span class="RktVar">conn</span>, except that
after constructing a <a href="Transports.html#%28tech._transport%29" class="techoutside" data-pltdoc="x"><span class="techinside">transport</span></a> with <span class="RktVar">conn</span> (such as in
a call to <span class="RktSym">connect!</span>) the <span class="RktVar">tunneler</span> procedure is used to layer a
new protocol on top of the transport. This is most commonly used to convert an
insecure TCP connection to a secure TLS connection with <span class="RktSym">tls-transport</span>,
but other use cases exist.</div></p><p>The <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=disposable&amp;rel=Basic_Disposable_API_and_Concepts.html%23%2528tech._disposable%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">disposable</span></a> returned by <span class="RktVar">tunneler</span> is responsible
only for setting up and tearing down the new protocol <span class="emph">on top of</span> an
already existing transport &#8212;<wbr></wbr> it is not responsible for creating or destroying
the underlying transport being tunneled over. As a consequence, this allows
opening and closing a tunnel multiple times on the same transport if
<span class="RktVar">conn</span> reuses transports. To control whether or not a tunnel should use
a fresh transport, see the <span class="RktSym">connection</span> procedure.</p><p>Tunnel disposables are not expected to created new <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=i_o.html%23%2528tech._port%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">ports</span></a> or other
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval-model.html%23%2528tech._custodian%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">custodian</span></a> managed resources due to their reuse of an existing
transport, but in the event one does they will be created under supervision of
a <span class="emph">new</span> custodian that is subordinate to the custodian of <span class="RktVar">conn</span>,
not the <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval-model.html%23%2528tech._current._custodian%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">current custodian</span></a>.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Transports.html" title="backward to &quot;2 Transports&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Net2: Evolved Networking Libraries&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Transport_Listeners.html" title="forward to &quot;4 Transport Listeners&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/net2/Transport_Connectors.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:27:54 GMT -->
</html>