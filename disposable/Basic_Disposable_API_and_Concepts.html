<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/disposable/Basic_Disposable_API_and_Concepts.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:25:36 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>1&nbsp;Basic Disposable API and Concepts</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Disposable Values</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Basic Disposable API and Concepts</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Reusing_Disposables_with_Pools.html" class="tocviewlink" data-pltdoc="x">Reusing Disposables with Pools</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Transient_Values.html" class="tocviewlink" data-pltdoc="x">Transient Values</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Batteries-Included_Disposables.html" class="tocviewlink" data-pltdoc="x">Batteries-<wbr></wbr>Included Disposables</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>1&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Basic Disposable API and Concepts</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">1.1&nbsp;</td><td><a href="#%28part._.Data_.Definition%29" class="tocviewlink" data-pltdoc="x">Data Definition</a></td></tr><tr><td align="right">1.2&nbsp;</td><td><a href="#%28part._.Consuming_.Disposable_.Values%29" class="tocviewlink" data-pltdoc="x">Consuming Disposable Values</a></td></tr><tr><td align="right">1.3&nbsp;</td><td><a href="#%28part._.Unsafe_.Allocation_of_.Disposables%29" class="tocviewlink" data-pltdoc="x">Unsafe Allocation of Disposables</a></td></tr><tr><td align="right">1.4&nbsp;</td><td><a href="#%28part._.Monadic_.Composition_of_.Disposables%29" class="tocviewlink" data-pltdoc="x">Monadic Composition of Disposables</a></td></tr><tr><td align="right">1.5&nbsp;</td><td><a href="#%28part._.Asynchronous_.Cleanup%29" class="tocviewlink" data-pltdoc="x">Asynchronous Cleanup</a></td></tr><tr><td align="right">1.6&nbsp;</td><td><a href="#%28part._.Disposables_with_.Associated_.Custodians%29" class="tocviewlink" data-pltdoc="x">Disposables with Associated Custodians</a></td></tr><tr><td align="right">1.7&nbsp;</td><td><a href="#%28part._.Memoization_and_.Disposables%29" class="tocviewlink" data-pltdoc="x">Memoization and Disposables</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._.Data_.Definition%29" class="tocsubseclink" data-pltdoc="x">Data Definition</a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">disposable</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._make-disposable%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">make-<wbr></wbr>disposable</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">disposable?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fc%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">disposable/<span class="mywbr"> &nbsp;</span>c</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._.Consuming_.Disposable_.Values%29" class="tocsubseclink" data-pltdoc="x">Consuming Disposable Values</a></td></tr><tr><td><a href="#%28form._%28%28lib._disposable%2Fmain..rkt%29._with-disposable%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">with-<wbr></wbr>disposable</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._call%2Fdisposable%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">call/<span class="mywbr"> &nbsp;</span>disposable</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._acquire%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">acquire</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._acquire-global%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">acquire-<wbr></wbr>global</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._acquire-virtual%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">acquire-<wbr></wbr>virtual</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.3<tt>&nbsp;</tt></span><a href="#%28part._.Unsafe_.Allocation_of_.Disposables%29" class="tocsubseclink" data-pltdoc="x">Unsafe Allocation of Disposables</a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Funsafe..rkt%29._acquire%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">acquire!</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.4<tt>&nbsp;</tt></span><a href="#%28part._.Monadic_.Composition_of_.Disposables%29" class="tocsubseclink" data-pltdoc="x">Monadic Composition of Disposables</a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-pure%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">disposable-<wbr></wbr>pure</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-apply%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">disposable-<wbr></wbr>apply</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-chain%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">disposable-<wbr></wbr>chain</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.5<tt>&nbsp;</tt></span><a href="#%28part._.Asynchronous_.Cleanup%29" class="tocsubseclink" data-pltdoc="x">Asynchronous Cleanup</a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fasync-dealloc%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">disposable/<span class="mywbr"> &nbsp;</span>async-<wbr></wbr>dealloc</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.6<tt>&nbsp;</tt></span><a href="#%28part._.Disposables_with_.Associated_.Custodians%29" class="tocsubseclink" data-pltdoc="x">Disposables with Associated Custodians</a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fcustodian%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">disposable/<span class="mywbr"> &nbsp;</span>custodian</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.7<tt>&nbsp;</tt></span><a href="#%28part._.Memoization_and_.Disposables%29" class="tocsubseclink" data-pltdoc="x">Memoization and Disposables</a></td></tr><tr><td><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fmemoize%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">disposable/<span class="mywbr"> &nbsp;</span>memoize</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.6</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="index.html" title="backward to &quot;Disposable Values&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Disposable Values&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Reusing_Disposables_with_Pools.html" title="forward to &quot;2 Reusing Disposables with Pools&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;disposable/scribblings/main.scrbl&quot;)" x-source-pkg="disposable" x-part-tag="&quot;Basic_Disposable_API_and_Concepts&quot;">1<tt>&nbsp;</tt><a name="(part._.Basic_.Disposable_.A.P.I_and_.Concepts)"></a>Basic Disposable API and Concepts</h3><p>A <a name="(tech._disposable)"></a><span style="font-style: italic">disposable</span> is a producer of values that
allocates <a href="#%28tech._external._resource%29" class="techoutside" data-pltdoc="x"><span class="techinside">external resources</span></a> when producing a value and provides
a way to deallocate those resources when a produced value is no longer needed.
A value produced by a disposable is called a <a name="(tech._disposable._value)"></a><span style="font-style: italic">disposable value</span>.</p><p>Disposables are closely related to <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval-model.html%23%2528tech._custodian%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">custodians</span></a>, but differ in
what sort of resources they manage and how those resources are reclaimed.
Broadly speaking, resources requiring management can be divided into two
categories:</p><ul><li><p><a name="(tech._system._resource)"></a><span style="font-style: italic">System resources</span> &#8212;<wbr></wbr> resources acquired
from a program&rsquo;s execution environment such as memory, file descriptors,
operating system threads, handles to other local processes, etc.</p></li><li><p><a name="(tech._external._resource)"></a><span style="font-style: italic">External resources</span> &#8212;<wbr></wbr> resources managed
by arbitrary external systems that a program communicates with, such as test
data in a database, network connections with graceful termination protocols,
machines used to execute distributed data processing, temporary access
credentials acquired from a remote key management service, etc.</p></li></ul><p>These two kinds of resources have very different implications for programs that
use them. Due to the distributed nature of external resources and the inherent
unreliability of network communication, <span style="font-weight: bold">it is impossible to guarantee that
a given external resource is released</span>. However, system resources are very
rarely impossible to release. <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval-model.html%23%2528tech._custodian%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">Custodians</span></a> are designed to
mangage <a href="#%28tech._system._resource%29" class="techoutside" data-pltdoc="x"><span class="techinside">system resources</span></a> and assume reliable reclamation is
possible, placing several restrictions on how programs can use custodians as a
result:</p><ul><li><p>It must be possible to <span class="emph">forcibly</span> reclaim system resources during
program termination as occurs when <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=custodians.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._custodian-shutdown-all%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">custodian-shutdown-all</a></span> is called.
This prevents reclaiming resources by communicating over a network because
it&rsquo;s  impossible to guarantee successful distributed communication.</p></li><li><p>Placing a user-defined resource under the management of a custodian
requires using the <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=foreign&amp;rel=Custodian_Shutdown_Registration.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">ffi/unsafe/custodian</span></a> module. This is an
unsafe API because custodian shutdown actions are executed in
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=foreign&amp;rel=Atomic_Execution.html%23%2528tech._atomic._mode%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">atomic mode</span></a>, resulting in possible deadlocks if shutdown
actions perform asynchronous IO.</p></li><li><p>Custodian shutdown callbacks normally should not strongly reference the
values they&rsquo;re meant to clean up, as these shutdown callbacks frequently
double as <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=willexecutor.html%23%2528tech._finalizer%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">finalizers</span></a> that run when the garbage collector
determines the value to finalize is no longer reachable. This defeats certain
composition patterns for shutdown callbacks, particularly composition that
uses closures to reference both composed callbacks and managed values.</p></li></ul><p>These restrictions make managing <a href="#%28tech._external._resource%29" class="techoutside" data-pltdoc="x"><span class="techinside">external resources</span></a> with
custodians inappropriate. Instead, an external resource should be produced by a
<a href="#%28tech._disposable%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable</span></a> resulting in a <a href="#%28tech._disposable._value%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable value</span></a>
that can be safely managed in a distributed system.</p><p>All of the bindings documented in this section are provided by <a href="index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">disposable</span></a> with the exception of <span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Funsafe..rkt%29._acquire%21%29%29" class="RktValLink" data-pltdoc="x">acquire!</a></span>, which is provided by
<a href="#%28mod-path._disposable%2Funsafe%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">disposable/unsafe</span></a>.</p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Data_.Definition%29" class="toclink" data-pltdoc="x">1.1<span class="hspace">&nbsp;</span>Data Definition</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Consuming_.Disposable_.Values%29" class="toclink" data-pltdoc="x">1.2<span class="hspace">&nbsp;</span>Consuming Disposable Values</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Unsafe_.Allocation_of_.Disposables%29" class="toclink" data-pltdoc="x">1.3<span class="hspace">&nbsp;</span>Unsafe Allocation of Disposables</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Monadic_.Composition_of_.Disposables%29" class="toclink" data-pltdoc="x">1.4<span class="hspace">&nbsp;</span>Monadic Composition of Disposables</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Asynchronous_.Cleanup%29" class="toclink" data-pltdoc="x">1.5<span class="hspace">&nbsp;</span>Asynchronous Cleanup</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Disposables_with_.Associated_.Custodians%29" class="toclink" data-pltdoc="x">1.6<span class="hspace">&nbsp;</span>Disposables with Associated Custodians</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Memoization_and_.Disposables%29" class="toclink" data-pltdoc="x">1.7<span class="hspace">&nbsp;</span>Memoization and Disposables</a></p></td></tr></table><h4 x-source-module="(lib &quot;disposable/scribblings/main.scrbl&quot;)" x-source-pkg="disposable" x-part-tag="&quot;Data_Definition&quot;">1.1<tt>&nbsp;</tt><a name="(part._.Data_.Definition)"></a>Data Definition</h4><p>Concretely, a <a href="#%28tech._disposable%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable</span></a> is implemented as a thunk that when
called allocates a new <a href="#%28tech._disposable._value%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable value</span></a> and returns that value
alongside another thunk that deallocates the <a href="#%28tech._external._resource%29" class="techoutside" data-pltdoc="x"><span class="techinside">external resources</span></a>
associated with that particular disposable value.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._disposable/main..rkt)._disposable))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%29%29" class="RktValDef RktValLink" data-pltdoc="x">disposable</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">alloc</span><span class="hspace">&nbsp;</span><span class="RktVar">dealloc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">alloc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">dealloc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void?</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="#%28tech._disposable%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable</span></a> that allocates a <a href="#%28tech._disposable._value%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable value</span></a> by calling <span class="RktVar">alloc</span> and deallocates <a href="#%28tech._external._resource%29" class="techoutside" data-pltdoc="x"><span class="techinside">external resources</span></a> associated with that value by calling <span class="RktVar">dealloc</span> on
the allocated value. Both procedures are called with <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=breakhandler.html%23%2528tech._break%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">breaks</span></a>
disabled. For a more flexible but less convenient interface, see <span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._make-disposable%29%29" class="RktValLink" data-pltdoc="x">make-disposable</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._disposable/main..rkt)._make-disposable))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._make-disposable%29%29" class="RktValDef RktValLink" data-pltdoc="x">make-disposable</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">proc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=values.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._values%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">values</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void?</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="#%28tech._disposable%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable</span></a> that is implemented with <span class="RktVar">proc</span>.
The given <span class="RktVar">proc</span> should return two values: a newly allocated value for
use by consumers of the disposable, and a thunk that can be used to deallocate
any <a href="#%28tech._external._resource%29" class="techoutside" data-pltdoc="x"><span class="techinside">external resources</span></a> created during allocation of the value.
Both <span class="RktVar">proc</span> and the disposal thunk it returns are called with breaks
disabled. For the common case where deallocation can be implemented with a
function that takes the allocated value as input, prefer the <span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%29%29" class="RktValLink" data-pltdoc="x">disposable</a></span> procedure.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._disposable/main..rkt)._disposable~3f))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">disposable?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">v</span> is a <a href="#%28tech._disposable%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable</span></a>, returns
<span class="RktVal">#f</span> otherwise.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._disposable/main..rkt)._disposable/c))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fc%29%29" class="RktValDef RktValLink" data-pltdoc="x">disposable/c</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=contract-utilities.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fguts..rkt%2529._contract%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">contract?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">c</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=contract-utilities.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fguts..rkt%2529._contract%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">contract?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a contract for a <a href="#%28tech._disposable%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable</span></a> that allocates values
matching <span class="RktVar">c</span>.</div></p><h4 x-source-module="(lib &quot;disposable/scribblings/main.scrbl&quot;)" x-source-pkg="disposable" x-part-tag="&quot;Consuming_Disposable_Values&quot;">1.2<tt>&nbsp;</tt><a name="(part._.Consuming_.Disposable_.Values)"></a>Consuming Disposable Values</h4><p><a href="#%28tech._disposable._value%29" class="techoutside" data-pltdoc="x"><span class="techinside">Disposable values</span></a> can be acquired in a variety of ways,
ranging from unsafe low level access with <span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Funsafe..rkt%29._acquire%21%29%29" class="RktValLink" data-pltdoc="x">acquire!</a></span> to automated
per-thread allocation with <span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._acquire-virtual%29%29" class="RktValLink" data-pltdoc="x">acquire-virtual</a></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._disposable/main..rkt)._with-disposable))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28form._%28%28lib._disposable%2Fmain..rkt%29._with-disposable%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">with-disposable</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVar">id</span><span class="hspace">&nbsp;</span><span class="RktVar">disp-expr</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktMeta">...+</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">disp-expr</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Allocates a <a href="#%28tech._disposable._value%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable value</span></a> with each <span class="RktVar">disp-expr</span> and
binds each value to its corresponding <span class="RktVar">id</span> within the scope of the
<span class="RktVar">body</span> expressions. The values are deallocated upon exiting the <span class="RktVar">body</span> expressions, even if exiting occurs with an <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=exns.html%23%2528tech._exception%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">exception</span></a> or a
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=conts.html%23%2528tech._continuation%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">continuation jump</span></a>. Additionally, the <span class="RktVar">body</span> expressions are
called with a <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval-model.html%23%2528tech._continuation._barrier%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">continuation barrier</span></a> to prevent jumping back
into the expressions after deallocation. Deallocation of the <span class="RktVar">id</span> values
occurs concurrently; deallocation of one value does not block on deallocation
of any other values.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._disposable%2Fmain..rkt%29._with-disposable%29%29" class="RktStxLink" data-pltdoc="x">with-disposable</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._-%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">Allocated 74</span></p></td></tr><tr><td><p><span class="RktOut">Allocated 83</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 74</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 83</span></p></td></tr></table></td></tr><tr><td><p><span class="RktRes">9</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._disposable%2Fmain..rkt%29._with-disposable%29%29" class="RktStxLink" data-pltdoc="x">with-disposable</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._error%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"uh oh!"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">Allocated 30</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 30</span></p></td></tr></table></td></tr><tr><td><p><span class="RktErr">uh oh!</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._disposable/main..rkt)._call/disposable))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._call%2Fdisposable%29%29" class="RktValDef RktValLink" data-pltdoc="x">call/disposable</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span><span class="RktVar">proc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">any</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">any</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Allocates a <a href="#%28tech._disposable._value%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable value</span></a> with <span class="RktVar">disp</span>, calls
<span class="RktVar">proc</span> with the value as an argument, deallocates the value, then
returns the result of calling <span class="RktVar">proc</span>. This is essentially a non-macro
form of <span class="RktSym"><a href="#%28form._%28%28lib._disposable%2Fmain..rkt%29._with-disposable%29%29" class="RktStxLink" data-pltdoc="x">with-disposable</a></span>. Like <span class="RktSym"><a href="#%28form._%28%28lib._disposable%2Fmain..rkt%29._with-disposable%29%29" class="RktStxLink" data-pltdoc="x">with-disposable</a></span>, the value is
deallocated if control leaves <span class="RktVar">proc</span> due to an <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=exns.html%23%2528tech._exception%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">exception</span></a> or a
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=conts.html%23%2528tech._continuation%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">continuation jump</span></a>, and a <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval-model.html%23%2528tech._continuation._barrier%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">continuation barrier</span></a>
prevents jumping back into <span class="RktVar">proc</span>. To use with multiple disposables that
are deallocated concurrently, use <span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-apply%29%29" class="RktValLink" data-pltdoc="x">disposable-apply</a></span> with <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span>
to transform multiple disposables into a single disposable that allocates a
list of values.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._call%2Fdisposable%29%29" class="RktValLink" data-pltdoc="x">call/disposable</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._%7Ece%7Ebb%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252A%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">Allocated 36</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 36</span></p></td></tr></table></td></tr><tr><td><p><span class="RktRes">1296</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._call%2Fdisposable%29%29" class="RktValLink" data-pltdoc="x">call/disposable</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._%7Ece%7Ebb%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._error%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"uh oh!"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">Allocated 0</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 0</span></p></td></tr></table></td></tr><tr><td><p><span class="RktErr">uh oh!</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._disposable/main..rkt)._acquire))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._acquire%29%29" class="RktValDef RktValLink" data-pltdoc="x">acquire</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span><span class="RktOpt">[</span><span class="RktPn">#:dispose-evt</span><span class="hspace">&nbsp;</span><span class="RktVar">evt</span><span class="RktOpt">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">evt</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._evt%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">evt?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._thread-dead-evt%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">thread-dead-evt</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-thread%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">current-thread</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Allocates and returns a value with <span class="RktVar">disp</span> and launches a background
thread that deallocates the value when <span class="RktVar">evt</span> is <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._ready._for._synchronization%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">ready
for synchronization</span></a>. Using the default for <span class="RktVar">evt</span> causes the value to
be deallocated when the calling thread dies. This is for when a disposable
value is inherently tied to the lifteime of the thread using it, such as a
connection used while handling a web server request in a servlet model where a
new thread is spawned for each request. Other uses include <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._alarm-evt%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">alarm-evt</a></span>
to return a value that is deallocated after a timeout, or using a
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=subprocess.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._subprocess%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">subprocess?</a></span> value to deallocate after a subprocess terminates.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sync%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sync</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._thread%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">thread</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._%7Ece%7Ebb%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._acquire%29%29" class="RktValLink" data-pltdoc="x">acquire</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._printf%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Acquired ~v\n"</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">Allocated 24</span></p></td></tr><tr><td><p><span class="RktOut">Acquired 24</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 24</span></p></td></tr></table></td></tr><tr><td><p><span class="RktRes">#&lt;thread&gt;</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._disposable/main..rkt)._acquire-global))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._acquire-global%29%29" class="RktValDef RktValLink" data-pltdoc="x">acquire-global</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span><span class="RktOpt">[</span><span class="RktPn">#:plumber</span><span class="hspace">&nbsp;</span><span class="RktVar">plumber</span><span class="RktOpt">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">plumber</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=plumbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._plumber%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">plumber?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=plumbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-plumber%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">current-plumber</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Allocates and returns a value with <span class="RktVar">disp</span> and attaches a
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=plumbers.html%23%2528tech._flush._callback%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">flush callback</span></a> to <span class="RktVar">plumber</span> that deallocates the value.
This is intended for when a disposable value is used throughout the lifetime of
a program, such as a global database connection pool. Globally allocated values
can be safely provided by modules for use in other modules just like normal
values, allowing the modular definition of global program resources. Note that
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=plumbers.html%23%2528tech._plumber%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">plumbers</span></a> expect that after all flush callbacks return the
program may exit and kill any remaining threads, so a disposable that is
acquired globally should not deallocate values in any asynchronous manner (such
as in a background thread). In particular, do not use <span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._acquire-global%29%29" class="RktValLink" data-pltdoc="x">acquire-global</a></span>
with <span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fasync-dealloc%29%29" class="RktValLink" data-pltdoc="x">disposable/async-dealloc</a></span>.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">plumb</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=plumbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-plumber%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">make-plumber</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._acquire-global%29%29" class="RktValLink" data-pltdoc="x">acquire-global</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:plumber</span><span class="hspace">&nbsp;</span><span class="RktSym">plumb</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">Allocated 84</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">85</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=plumbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._plumber-flush-all%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">plumber-flush-all</a></span><span class="hspace">&nbsp;</span><span class="RktSym">plumb</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">Deallocated 84</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._disposable/main..rkt)._acquire-virtual))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._acquire-virtual%29%29" class="RktValDef RktValLink" data-pltdoc="x">acquire-virtual</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">disp</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a thunk that returns a
<a name="(tech._virtual._instance)"></a><span style="font-style: italic">virtual instance</span> of <span class="RktVar">disp</span>, meaning an
instance is allocated per-thread the first time a thread calls the thunk and
returned in subsequent calls by the same thread. The returned thunk maintains a
weak mapping of threads to allocated instances of <span class="RktVar">disp</span>, with instances
deallocated whenever their associated threads die (in the same manner as
<span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._acquire%29%29" class="RktValLink" data-pltdoc="x">acquire</a></span>). This may be expensive in high-concurrency scenarios with
short lived threads. To use with high concurrency, consider combining with
<span class="RktSym"><a href="Reusing_Disposables_with_Pools.html#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-pool%29%29" class="RktValLink" data-pltdoc="x">disposable-pool</a></span> to reuse instances between threads. In particular, see
<a href="Reusing_Disposables_with_Pools.html#%28part._gpvl%29" data-pltdoc="x">Global Pools with Virtual Leases</a> for a common and convenient access pattern.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">virtual-example</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._acquire-virtual%29%29" class="RktValLink" data-pltdoc="x">acquire-virtual</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">spawn</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._thread%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">thread</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._%7Ece%7Ebb%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._printf%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Acquired ~v\n"</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">virtual-example</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sync%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sync</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">spawn</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">spawn</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">spawn</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">Allocated 43</span></p></td></tr><tr><td><p><span class="RktOut">Acquired 43</span></p></td></tr><tr><td><p><span class="RktOut">Allocated 26</span></p></td></tr><tr><td><p><span class="RktOut">Acquired 26</span></p></td></tr><tr><td><p><span class="RktOut">Allocated 36</span></p></td></tr><tr><td><p><span class="RktOut">Acquired 36</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 36</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 26</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 43</span></p></td></tr></table></td></tr><tr><td><p><span class="RktRes">#&lt;thread&gt;</span></p></td></tr></table></blockquote></div></p><h4 x-source-module="(lib &quot;disposable/scribblings/main.scrbl&quot;)" x-source-pkg="disposable" x-part-tag="&quot;Unsafe_Allocation_of_Disposables&quot;">1.3<tt>&nbsp;</tt><a name="(part._.Unsafe_.Allocation_of_.Disposables)"></a><a name="(mod-path._disposable/unsafe)"></a>Unsafe Allocation of Disposables</h4><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._disposable%2Funsafe%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">disposable/unsafe</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/disposable" title="Install this package using `raco pkg install disposable`"><span class="stt">disposable</span></a></span></td></tr></table></p><p>The <a href="#%28mod-path._disposable%2Funsafe%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">disposable/unsafe</span></a> module provides a single export,
<span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Funsafe..rkt%29._acquire%21%29%29" class="RktValLink" data-pltdoc="x">acquire!</a></span>, which provides an unsafe building block upon which safe
allocation abstractions can be built.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._disposable/unsafe..rkt)._acquire!))"></a><span title="Provided from: disposable/unsafe | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Funsafe..rkt%29._acquire%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">acquire!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">disp</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><table cellspacing="0" cellpadding="0"><tr><td><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void?</a></span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a newly-allocated value with <span class="RktVar">disp</span> as well as a thunk that
deallocates the value when called. This is <span class="emph">unsafe</span>, as the caller is
responsible for ensuring that the deallocation thunk is called. Both the
<span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Funsafe..rkt%29._acquire%21%29%29" class="RktValLink" data-pltdoc="x">acquire!</a></span> procedure and the disposal thunk it returns should be called
with breaks disabled.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._define-values%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-values</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">dispose!</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Funsafe..rkt%29._acquire%21%29%29" class="RktValLink" data-pltdoc="x">acquire!</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">Allocated 15</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._printf%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Acquired ~v unsafely\n"</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">Acquired 15 unsafely</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">dispose!</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">Deallocated 15</span></p></td></tr></table></blockquote></div></p><h4 x-source-module="(lib &quot;disposable/scribblings/main.scrbl&quot;)" x-source-pkg="disposable" x-part-tag="&quot;Monadic_Composition_of_Disposables&quot;">1.4<tt>&nbsp;</tt><a name="(part._.Monadic_.Composition_of_.Disposables)"></a>Monadic Composition of Disposables</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._disposable/main..rkt)._disposable-pure))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-pure%29%29" class="RktValDef RktValLink" data-pltdoc="x">disposable-pure</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a pure <a href="#%28tech._disposable%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable</span></a>. The disposable always returns
<span class="RktVar">v</span> when asked to allocate a value and takes no action upon
deallocation. Useful with <span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-apply%29%29" class="RktValLink" data-pltdoc="x">disposable-apply</a></span> for combining a mix of
disposable and plain values.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._disposable%2Fmain..rkt%29._with-disposable%29%29" class="RktStxLink" data-pltdoc="x">with-disposable</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-pure%29%29" class="RktValLink" data-pltdoc="x">disposable-pure</a></span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">42</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._disposable/main..rkt)._disposable-apply))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-apply%29%29" class="RktValDef RktValLink" data-pltdoc="x">disposable-apply</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">f</span><span class="hspace">&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">f</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._procedure%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">procedure?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="#%28tech._disposable%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable</span></a> value that allocates a value from each
<span class="RktVar">disp</span>, calls <span class="RktVar">f</span> with the allocated values, then returns the
result of calling <span class="RktVar">f</span> as the allocated value. Deallocation of the value
is performed by deallocating each of the source values produced. Deallocation
occurs concurrently.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">posn</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">disposable-posn</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-apply%29%29" class="RktValLink" data-pltdoc="x">disposable-apply</a></span><span class="hspace">&nbsp;</span><span class="RktSym">posn</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._disposable%2Fmain..rkt%29._with-disposable%29%29" class="RktStxLink" data-pltdoc="x">with-disposable</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">p</span><span class="hspace">&nbsp;</span><span class="RktSym">disposable-posn</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._printf%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Acquired ~v\n"</span><span class="hspace">&nbsp;</span><span class="RktSym">p</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">Allocated 85</span></p></td></tr><tr><td><p><span class="RktOut">Allocated 73</span></p></td></tr><tr><td><p><span class="RktOut">Acquired (posn 73 85)</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 85</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 73</span></p></td></tr></table></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._disposable/main..rkt)._disposable-chain))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-chain%29%29" class="RktValDef RktValLink" data-pltdoc="x">disposable-chain</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span><span class="RktVar">f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">f</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="#%28tech._disposable%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable</span></a> that allocates a value from
<span class="RktVar">disp</span>, calls <span class="RktVar">f</span> with the allocated value producing a new
disposable, then returns a newly allocated value with the disposable returned
by <span class="RktVar">f</span>. Deallocation of the value is performed by first deallocating
using the disposable returned by <span class="RktVar">f</span>, then deallocating the source value
produced by <span class="RktVar">disp</span> after finishing deallocating with the disposable
produced by <span class="RktVar">f</span>.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add-example</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-apply%29%29" class="RktValLink" data-pltdoc="x">disposable-apply</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._%7Ece%7Ebb%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sum-disp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-chain%29%29" class="RktValLink" data-pltdoc="x">disposable-chain</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="hspace">&nbsp;</span><span class="RktSym">add-example</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._disposable%2Fmain..rkt%29._with-disposable%29%29" class="RktStxLink" data-pltdoc="x">with-disposable</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktSym">sum-disp</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._printf%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Acquired ~v\n"</span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">Allocated 3</span></p></td></tr><tr><td><p><span class="RktOut">Allocated 89</span></p></td></tr><tr><td><p><span class="RktOut">Acquired 92</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 89</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 3</span></p></td></tr></table></td></tr></table></blockquote></div></p><h4 x-source-module="(lib &quot;disposable/scribblings/main.scrbl&quot;)" x-source-pkg="disposable" x-part-tag="&quot;Asynchronous_Cleanup&quot;">1.5<tt>&nbsp;</tt><a name="(part._.Asynchronous_.Cleanup)"></a>Asynchronous Cleanup</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._disposable/main..rkt)._disposable/async-dealloc))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fasync-dealloc%29%29" class="RktValDef RktValLink" data-pltdoc="x">disposable/async-dealloc</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">disp</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a disposable that is like <span class="RktVar">disp</span>, but deallocation happens
asynchronously in a background thread spawned when deallocation would normally
occur. This is intended for disposables where immediately releasing the
resource is not required. Note that this is not recommended for use with
<span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._acquire-global%29%29" class="RktValLink" data-pltdoc="x">acquire-global</a></span>, as it&rsquo;s important that the <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=plumbers.html%23%2528tech._plumber%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">plumber</span></a> used
by <span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._acquire-global%29%29" class="RktValLink" data-pltdoc="x">acquire-global</a></span> does not finish flushing until all resources have
been deallocated.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._disposable%2Fmain..rkt%29._with-disposable%29%29" class="RktStxLink" data-pltdoc="x">with-disposable</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fasync-dealloc%29%29" class="RktValLink" data-pltdoc="x">disposable/async-dealloc</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._printf%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Acquired ~v\n"</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">Allocated 53</span></p></td></tr><tr><td><p><span class="RktOut">Acquired 53</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 53</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sleep%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sleep</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0.1</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h4 x-source-module="(lib &quot;disposable/scribblings/main.scrbl&quot;)" x-source-pkg="disposable" x-part-tag="&quot;Disposables_with_Associated_Custodians&quot;">1.6<tt>&nbsp;</tt><a name="(part._.Disposables_with_.Associated_.Custodians)"></a>Disposables with Associated Custodians</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._disposable/main..rkt)._disposable/custodian))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fcustodian%29%29" class="RktValDef RktValLink" data-pltdoc="x">disposable/custodian</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span><span class="RktVar">cust</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">disp</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cust</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=custodians.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._custodian%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">custodian?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="#%28tech._disposable%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable</span></a> that is like <span class="RktVar">disp</span>, but
allocation and deallocation occur with <span class="RktVar">cust</span> as the <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval-model.html%23%2528tech._current._custodian%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">current custodian</span></a>. Normally, disposables only manage <a href="#%28tech._external._resource%29" class="techoutside" data-pltdoc="x"><span class="techinside">external
resources</span></a> whereas <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval-model.html%23%2528tech._custodian%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">custodians</span></a> only manage <a href="#%28tech._system._resource%29" class="techoutside" data-pltdoc="x"><span class="techinside">system resources</span></a> &#8212;<wbr></wbr> use of <span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fcustodian%29%29" class="RktValLink" data-pltdoc="x">disposable/custodian</a></span> is reserved for
when allocation and deallocation creates <span class="emph">both</span> system resources and
external resources. This frequently occurs when allocation of a disposable
involves creating <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=i_o.html%23%2528tech._port%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">ports</span></a> to communicate with other parties, which
must be closed by a custodian. In these circumstances <span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fcustodian%29%29" class="RktValLink" data-pltdoc="x">disposable/custodian</a></span> can be used to control which custodian manages all system
resources created by a particular disposable.</div></p><p class="SHistory">Added in version 0.4 of package <span class="stt">disposable</span>.</p><h4 x-source-module="(lib &quot;disposable/scribblings/main.scrbl&quot;)" x-source-pkg="disposable" x-part-tag="&quot;Memoization_and_Disposables&quot;">1.7<tt>&nbsp;</tt><a name="(part._.Memoization_and_.Disposables)"></a>Memoization and Disposables</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._disposable/main..rkt)._disposable/memoize))"></a><span title="Provided from: disposable | Package: disposable"><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fmemoize%29%29" class="RktValDef RktValLink" data-pltdoc="x">disposable/memoize</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">f</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span><span class="RktOpt">[</span></td><td valign="top"><span class="RktPn">#:make-dict</span><span class="hspace">&nbsp;</span><span class="RktVar">make-dict</span><span class="RktOpt">]</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fc%29%29" class="RktValLink" data-pltdoc="x">disposable/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._procedure%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">procedure?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">f</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._unconstrained-domain-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unconstrained-domain-&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable~3f%29%29" class="RktValLink" data-pltdoc="x">disposable?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">make-dict</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._and%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">and/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=dicts.html%23%2528def._%2528%2528lib._racket%252Fdict..rkt%2529._dict%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">dict?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=dicts.html%23%2528def._%2528%2528lib._racket%252Fdict..rkt%2529._dict-mutable%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">dict-mutable?</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-hash%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">make-hash</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="#%28tech._disposable%29" class="techoutside" data-pltdoc="x"><span class="techinside">disposable</span></a> that produces a <span class="emph">memoized</span> version
of <span class="RktVar">f</span>. Whereas <span class="RktVar">f</span> would normally return a disposable for any
given call, the same call to the memoized <span class="RktVar">f</span> instead allocates and
returns a value using the disposable that <span class="RktVar">f</span> returns. Furthermore,
repeated calls to the memoized <span class="RktVar">f</span> with the same arguments reuse the
disposable allocated for the first call. All disposables allocated by the
memoized <span class="RktVar">f</span> are deallocated when the disposable returned by <span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fmemoize%29%29" class="RktValLink" data-pltdoc="x">disposable/memoize</a></span> deallocates the memoized <span class="RktVar">f</span>.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">color+ex-disp</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-apply%29%29" class="RktValLink" data-pltdoc="x">disposable-apply</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable-pure%29%29" class="RktValLink" data-pltdoc="x">disposable-pure</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Batteries-Included_Disposables.html#%28def._%28%28lib._disposable%2Fexample..rkt%29._example-disposable%29%29" class="RktValLink" data-pltdoc="x">example-disposable</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._disposable%2Fmain..rkt%29._with-disposable%29%29" class="RktStxLink" data-pltdoc="x">with-disposable</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">color+ex</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._disposable%2Fmain..rkt%29._disposable%2Fmemoize%29%29" class="RktValLink" data-pltdoc="x">disposable/memoize</a></span><span class="hspace">&nbsp;</span><span class="RktSym">color+ex-disp</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">color+ex</span><span class="hspace">&nbsp;</span><span class="RktVal">"red"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">color+ex</span><span class="hspace">&nbsp;</span><span class="RktVal">"blue"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">color+ex</span><span class="hspace">&nbsp;</span><span class="RktVal">"red"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">Allocated 16</span></p></td></tr><tr><td><p><span class="RktOut">(red 16)</span></p></td></tr><tr><td><p><span class="RktOut">Allocated 48</span></p></td></tr><tr><td><p><span class="RktOut">(blue 48)</span></p></td></tr><tr><td><p><span class="RktOut">(red 16)</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 48</span></p></td></tr><tr><td><p><span class="RktOut">Deallocated 16</span></p></td></tr></table></td></tr></table></blockquote></div></p><p>Reuse of values by the memoized <span class="RktVar">f</span> is achieved by mapping arguments
(both positional and keyword) to allocated values in a mutable dictionary.
Allocation of the memoized <span class="RktVar">f</span> creates that mutable dictionary using
<span class="RktVar">make-dict</span>, which by default produces a mutable hash table that holds
keys and values strongly.</p><p class="SHistory">Added in version 0.5 of package <span class="stt">disposable</span>.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="index.html" title="backward to &quot;Disposable Values&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Disposable Values&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Reusing_Disposables_with_Pools.html" title="forward to &quot;2 Reusing Disposables with Pools&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/disposable/Basic_Disposable_API_and_Concepts.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:25:36 GMT -->
</html>