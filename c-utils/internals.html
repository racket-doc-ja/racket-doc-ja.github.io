<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/c-utils/internals.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:26:21 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>7&nbsp;Internals</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">C Metaprogramming Utilities</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" data-pltdoc="x">C Metaprogramming Utilities</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="syntax.html" class="tocviewlink" data-pltdoc="x">The C Language</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="parsing.html" class="tocviewlink" data-pltdoc="x">Parsing and Reading C</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="pc.html" class="tocviewlink" data-pltdoc="x">Parenthetical C</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="header.html" class="tocviewlink" data-pltdoc="x">Header Compilation</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="eval.html" class="tocviewlink" data-pltdoc="x">Evaluation</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Internals</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>7&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Internals</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">7.1&nbsp;</td><td><a href="#%28part._internals_parser%29" class="tocviewlink" data-pltdoc="x">Parser</a></td></tr><tr><td align="right">7.2&nbsp;</td><td><a href="#%28part._internals_header%29" class="tocviewlink" data-pltdoc="x">Header Compilation</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">7.1<tt>&nbsp;</tt></span><a href="#%28part._internals_parser%29" class="tocsubseclink" data-pltdoc="x">Parser</a></td></tr><tr><td><span class="tocsublinknumber">7.1.1<tt>&nbsp;</tt></span><a href="#%28part._grammar_definitions%29" class="tocsubseclink" data-pltdoc="x">Grammar Definitions</a></td></tr><tr><td><span class="tocsublinknumber">7.1.2<tt>&nbsp;</tt></span><a href="#%28part._grammar_invariants%29" class="tocsubseclink" data-pltdoc="x">Grammar Invariants</a></td></tr><tr><td><span class="tocsublinknumber">7.1.3<tt>&nbsp;</tt></span><a href="#%28part._syntactic_context%29" class="tocsubseclink" data-pltdoc="x">Syntactic Contexts</a></td></tr><tr><td><a href="#%28def._%28%28lib._c%2Fprivate%2Fsyntactic-context..rkt%29._lexer-state%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">lexer-<wbr></wbr>state</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._c%2Fprivate%2Fsyntactic-context..rkt%29._parser-state%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">parser-<wbr></wbr>state</span></span></a></td></tr><tr><td><span class="tocsublinknumber">7.1.4<tt>&nbsp;</tt></span><a href="#%28part._parser_invariants%29" class="tocsubseclink" data-pltdoc="x">Lexer and Parser Invariants</a></td></tr><tr><td><span class="tocsublinknumber">7.1.5<tt>&nbsp;</tt></span><a href="#%28part._typedef_names_as_ids%29" class="tocsubseclink" data-pltdoc="x">Type Names as Identifiers</a></td></tr><tr><td><span class="tocsublinknumber">7.2<tt>&nbsp;</tt></span><a href="#%28part._internals_header%29" class="tocsubseclink" data-pltdoc="x">Header Compilation</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="eval.html" title="backward to &quot;6 Evaluation&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;C Metaprogramming Utilities&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="doc-index.html" title="forward to &quot;Index&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;c/scribblings/c-utils.scrbl&quot;)" x-source-pkg="c-utils" x-part-tag="&quot;internals&quot;">7<tt>&nbsp;</tt><a name="(part._internals)"></a>Internals</h3><p>This section provides some information about the implementation of this package. It is not
required at all to understand how to use any of the C Metaprogramming Utilities.
<span style="font-weight: bold">None of the modules documented in this section should be used externally, and are subject to incompatible changes at any time.</span></p><h4 x-source-module="(lib &quot;c/scribblings/c-utils.scrbl&quot;)" x-source-pkg="c-utils" x-part-tag="&quot;internals_parser&quot;">7.1<tt>&nbsp;</tt><a name="(part._internals_parser)"></a>Parser</h4><p>C is not an easy language to parse. The grammar is essentially
<a href="https://en.wikipedia.org/wiki/LALR_parser">LALR(1)</a>, except for one
nasty wrinkle: there are two lexical classes that are considered distinct in the grammar
but whose lexical definitions are identical: <span style="font-style: italic">identifier</span> and <span style="font-style: italic">typedef_name</span>.</p><p>The language distinguish these two classes by their bindings, so parsers must maintain an
environment and make the environment available to the lexer. However, because the grammar
is LALR(1), the lexer may sometimes look ahead of the current production(s) being parsed.
Consequently, the lexer must also make sure that it does not look ahead to an apparent
identifier before committing all necessary updates to the environment.</p><p><div class="SIntrapara">For example, in a program such as:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">typedef int T;</span></p></td></tr><tr><td><p><span class="stt">T a;</span></p></td></tr></table></div><div class="SIntrapara">the second occurrence of <span class="stt">T</span> might be tokenized during lookahead before the parser
has had a chance to update the the environment from the first declaration. As a result,
the lexer must be careful whenever it reaches the end of a potential declaration to
commit any outstanding updates to the environment.</div></p><p>The following articles were useful in developing the parser:</p><ul><li><p><a href="http://www.open-std.org/JTC1/SC22/WG14/www/docs/n1256.pdf">ISO/IEC 9899:TC3</a>&#8212;<wbr></wbr>the C99 standard.</p></li><li><p><a href="http://www.informit.com/guides/content.aspx?g=cplusplus&amp;seqNum=215">A Tour of C99</a>&#8212;<wbr></wbr>a 2004 article
on some of the new, exotic features of C99.</p></li><li><p><a href="http://www.ddj.com/linux-open-source/196603535">Practical Parsing for ANSI C</a>&#8212;<wbr></wbr>an article in
<a href="http://www.ddj.com/">Dr. Dobb&rsquo;s Journal</a> with a few helpful tips on parsing C. It has some errors,
however, and shouldn&rsquo;t be considered authoritative.</p></li><li><p><a href="https://groups.google.com/group/comp.compilers/msg/c0797b5b668605b4">Parsing C, the last word</a> from
<a href="https://groups.google.com/group/comp.compilers"><span class="stt">comp.compilers</span></a>&#8212;<wbr></wbr>a message from
Jim Roskind back in 1992 with some tips on tracking <span class="stt">typedef</span> bindings.</p></li><li><p><a href="https://groups.google.com/group/comp.compilers/msg/9d8a968f346d24c0">Parsing C typedefs</a> from
<a href="https://groups.google.com/group/comp.compilers"><span class="stt">comp.compilers</span></a>&#8212;<wbr></wbr>a message from
Dale R. Worley back in 1992 with excellent advice on how to allow <span class="stt">typedef</span> names in certain
identifier contexts without generating LALR conflicts.</p></li></ul><h5 x-source-module="(lib &quot;c/scribblings/c-utils.scrbl&quot;)" x-source-pkg="c-utils" x-part-tag="&quot;grammar_definitions&quot;">7.1.1<tt>&nbsp;</tt><a name="(part._grammar_definitions)"></a>Grammar Definitions</h5><p>A <a name="(tech._declarator._terminator)"></a><span style="font-style: italic">declarator terminator</span> is a token of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528def._%2528%2528lib._parser-tools%252Flex..rkt%2529._token-name%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">token-name</a></span> <span class="RktVal">'</span><span class="RktVal">COMMA</span>, <span class="RktVal">'</span><span class="RktVal">=</span>, or <span class="RktVal">'</span><span class="RktVal">SEMI_COLON</span>.</p><p>A <a name="(tech._declarator._id)"></a><span style="font-style: italic">declarator id</span> is the value of the <span class="ssansserif">DeclaratorId</span> attribute of a &#8249;<span style="font-style: italic">Declarator</span>&#8250; node,
using the following attribution rules for the language grammar:</p><p><table cellspacing="0" cellpadding="0"><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p>&#8249;<span style="font-style: italic">Declarator</span>&#8250;<span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic">X</span></span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p>[&#8249;<span style="font-style: italic">Pointer</span>&#8250;]<span class="hspace">&nbsp;</span>&#8249;<span style="font-style: italic">DirectDeclarator</span>&#8250;<span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic">X</span></span><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span><span class="RktSym">$0</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span><span class="stt"><span class="hspace">&nbsp;</span></span>&larr;<span class="stt"><span class="hspace">&nbsp;</span></span><span class="RktSym">$1</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p>&#8249;<span style="font-style: italic">DirectDeclarator</span>&#8250;<span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic">X</span></span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span style="font-style: italic">X</span><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span><span class="RktSym">$0</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span><span class="stt"><span class="hspace">&nbsp;</span></span>&larr;<span class="stt"><span class="hspace">&nbsp;</span></span><span class="RktSym">$1</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktVal">"("</span><span class="hspace">&nbsp;</span>&#8249;<span style="font-style: italic">Declarator</span>&#8250;<span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic">X</span></span><span class="hspace">&nbsp;</span><span class="RktVal">")"</span><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span><span class="RktSym">$0</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span><span class="stt"><span class="hspace">&nbsp;</span></span>&larr;<span class="stt"><span class="hspace">&nbsp;</span></span><span class="RktSym">$1</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p>&#8249;<span style="font-style: italic">DirectDeclarator</span>&#8250;<span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic">X</span></span><span class="hspace">&nbsp;</span><span class="RktVal">"["</span><span class="hspace">&nbsp;</span>&#8249;<span style="font-style: italic">TypeQualifier</span>&#8250;*<span class="hspace">&nbsp;</span>[&#8249;<span style="font-style: italic">AssignmentExpression</span>&#8250;]<span class="hspace">&nbsp;</span><span class="RktVal">"]"</span><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span><span class="RktSym">$0</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span><span class="stt"><span class="hspace">&nbsp;</span></span>&larr;<span class="stt"><span class="hspace">&nbsp;</span></span><span class="RktSym">$1</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p>&#8249;<span style="font-style: italic">DirectDeclarator</span>&#8250;<span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic">X</span></span><span class="hspace">&nbsp;</span><span class="RktVal">"["</span><span class="hspace">&nbsp;</span><span class="RktVal">"static"</span><span class="hspace">&nbsp;</span>&#8249;<span style="font-style: italic">TypeQualifier</span>&#8250;*<span class="hspace">&nbsp;</span>&#8249;<span style="font-style: italic">AssignmentExpression</span>&#8250;<span class="hspace">&nbsp;</span><span class="RktVal">"]"</span><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span><span class="RktSym">$0</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span><span class="stt"><span class="hspace">&nbsp;</span></span>&larr;<span class="stt"><span class="hspace">&nbsp;</span></span><span class="RktSym">$1</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p>&#8249;<span style="font-style: italic">DirectDeclarator</span>&#8250;<span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic">X</span></span><span class="hspace">&nbsp;</span><span class="RktVal">"["</span><span class="hspace">&nbsp;</span>TypeQualifier<span style="vertical-align: super; font-size: 80%">+</span><span class="hspace">&nbsp;</span><span class="RktVal">"static"</span><span class="hspace">&nbsp;</span>&#8249;<span style="font-style: italic">AssignmentExpression</span>&#8250;<span class="hspace">&nbsp;</span><span class="RktVal">"]"</span><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span><span class="RktSym">$0</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span><span class="stt"><span class="hspace">&nbsp;</span></span>&larr;<span class="stt"><span class="hspace">&nbsp;</span></span><span class="RktSym">$1</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p>&#8249;<span style="font-style: italic">DirectDeclarator</span>&#8250;<span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic">X</span></span><span class="hspace">&nbsp;</span><span class="RktVal">"["</span><span class="hspace">&nbsp;</span>&#8249;<span style="font-style: italic">TypeQualifier</span>&#8250;*<span class="hspace">&nbsp;</span><span class="RktVal">"*"</span><span class="hspace">&nbsp;</span><span class="RktVal">"]"</span><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span><span class="RktSym">$0</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span><span class="stt"><span class="hspace">&nbsp;</span></span>&larr;<span class="stt"><span class="hspace">&nbsp;</span></span><span class="RktSym">$1</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p>&#8249;<span style="font-style: italic">DirectDeclarator</span>&#8250;<span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic">X</span></span><span class="hspace">&nbsp;</span><span class="RktVal">"("</span><span class="hspace">&nbsp;</span>&#8249;<span style="font-style: italic">ParameterTypeList</span>&#8250;<span class="hspace">&nbsp;</span><span class="RktVal">")"</span><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span><span class="RktSym">$0</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span><span class="stt"><span class="hspace">&nbsp;</span></span>&larr;<span class="stt"><span class="hspace">&nbsp;</span></span><span class="RktSym">$1</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p>&#8249;<span style="font-style: italic">DirectDeclarator</span>&#8250;<span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic">X</span></span><span class="hspace">&nbsp;</span><span class="RktVal">"("</span><span class="hspace">&nbsp;</span>[&#8249;<span style="font-style: italic">List</span>&#8250;<span style="vertical-align: sub; font-size: 80%">&#8249;<span style="font-style: italic">Identifier</span>&#8250;</span>]<span class="hspace">&nbsp;</span><span class="RktVal">")"</span><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span><span class="RktSym">$0</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span><span class="stt"><span class="hspace">&nbsp;</span></span>&larr;<span class="stt"><span class="hspace">&nbsp;</span></span><span class="RktSym">$1</span><span class="RktKw">.</span><span class="ssansserif">DeclaratorId</span></p></td></tr></table></p><h5 x-source-module="(lib &quot;c/scribblings/c-utils.scrbl&quot;)" x-source-pkg="c-utils" x-part-tag="&quot;grammar_invariants&quot;">7.1.2<tt>&nbsp;</tt><a name="(part._grammar_invariants)"></a>Grammar Invariants</h5><p>Following are some invariants&#8212;<wbr></wbr>essentially, informal lemmas&#8212;<wbr></wbr>about the implemented grammar:</p><ul><li><p>Every &#8249;<span style="font-style: italic">Declarator</span>&#8250; has a <a href="#%28tech._declarator._id%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator id</span></a>.</p></li><li><p>In a &#8249;<span style="font-style: italic">Declaration</span>&#8250; or &#8249;<span style="font-style: italic">StructDeclaration</span>&#8250; production, a &#8249;<span style="font-style: italic">TypedefName</span>&#8250; can be used as a <a href="#%28tech._declarator._id%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator id</span></a> iff no &#8249;<span style="font-style: italic">TypeSpecifier</span>&#8250; precedes it in the declaration.</p></li><li><p>In a valid program, the token immediately following a &#8249;<span style="font-style: italic">Declarator</span>&#8250; is always a <a href="#%28tech._declarator._terminator%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator terminator</span></a>.</p></li></ul><h5 x-source-module="(lib &quot;c/scribblings/c-utils.scrbl&quot;)" x-source-pkg="c-utils" x-part-tag="&quot;syntactic_context&quot;">7.1.3<tt>&nbsp;</tt><a name="(part._syntactic_context)"></a><a name="(mod-path._c/private/syntactic-context)"></a>Syntactic Contexts</h5><p>The internal module <a href="#%28mod-path._c%2Fprivate%2Fsyntactic-context%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">c/private/syntactic-context</span></a>
defines structures that are used internally
to maintain information about parsing and lexing state. It could be accessed via</p><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._c%2Fprivate%2Fsyntactic-context%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">c/private/syntactic-context</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/c-utils" title="Install this package using `raco pkg install c-utils`"><span class="stt">c-utils</span></a></span></td></tr></table></p><p>but generally shouldn&rsquo;t be used.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>struct</p></div></div><table cellspacing="0" cellpadding="0" class="RForeground"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="nobreak"><a name="(def._((lib._c/private/syntactic-context..rkt)._lexer-state-previous-token))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._lexer-state-parenthesis-depth))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._lexer-state-brace-depth))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._lexer-state-declarators))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._lexer-state-offset))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._lexer-state-source))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._lexer-state-read~3f))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._make-lexer-state))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._lexer-state~3f))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._struct~3alexer-state))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._lexer-state))"></a><span title="Provided from: c/private/syntactic-context | Package: c-utils"><span class="RktSym"><a href="#%28def._%28%28lib._c%2Fprivate%2Fsyntactic-context..rkt%29._lexer-state%29%29" class="RktValDef RktValLink" data-pltdoc="x">lexer-state</a></span></span></span></td><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span></td><td><span class="nobreak"><span class="RktSym">read?</span></span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">source</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">offset</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">declarators</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">brace-depth</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">parenthesis-depth</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">previous-token</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:extra-constructor-name</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._c%2Fprivate%2Fsyntactic-context..rkt%29._make-lexer-state%29%29" class="RktValLink" data-pltdoc="x">make-lexer-state</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">read?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">source</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">any</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">offset</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528def._%2528%2528lib._parser-tools%252Flex..rkt%2529._position%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">position?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">declarators</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._listof%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fbox..rkt%2529._box%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">box/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=symbols.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._symbol%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">brace-depth</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">parenthesis-depth</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">previous-token</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528def._%2528%2528lib._parser-tools%252Flex..rkt%2529._token%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">token?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">State pertaining to the lexer.</div></p><p>The <span class="RktSym">read?</span> field is used by the lexer for implementing a C reader.
When <span class="RktSym">read?</span> is <span class="RktVal">#t</span>, the lexer reports an <span class="RktSym">EOF</span> token when it reaches
a terminating delimiter.</p><p>The <span class="RktSym">source</span> field is used to identify the input source, such as with a path. The
<span class="RktSym">offset</span> is used as a base offset for generating source location information. When
<span class="RktSym">offset</span> is <span class="RktVal">#f</span> the base location <span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=parser-tools&amp;rel=Lexers.html%23%2528def._%2528%2528lib._parser-tools%252Flex..rkt%2529._make-position%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">make-position</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span> is used.</p><p>The <span class="RktSym">declarators</span> stack contains the cache for the current <a href="#%28tech._declarator._id%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator id</span></a> if the current
context is a <a href="#%28tech._declaration._context%29" class="techoutside" data-pltdoc="x"><span class="techinside">declaration context</span></a>. Both the lexer state and parser state maintain views of
the declarators stack, which can be compared to determine whether the lexer is currently looking
ahead. The <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._car%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">car</a></span> of the stack is the <a name="(tech._current._declarator._cache)"></a><span style="font-style: italic">current declarator cache</span>.</p><p>The <span class="RktSym">brace-depth</span> tracks the nesting depth of curly-brace delimiters, and the <span class="RktSym">parenthesis-depth</span>
tracks the nesting depth of parenthesis delimiters.</p><p>The <span class="RktSym">previous-token</span> stores the previously lexed token or <span class="RktVal">#f</span> if no tokens have been read yet.</p><p><div class="SIntrapara">A <a name="(tech._major._context)"></a><span style="font-style: italic">major context</span> is one of
</div><div class="SIntrapara"><ul><li><p><span class="RktVal">'</span><span class="RktVal">block</span>&#8212;<wbr></wbr>a block context, such as the top-level of a program or compound statement.</p></li><li><p><span class="RktVal">'</span><span class="RktVal">formals</span>&#8212;<wbr></wbr>the formal arguments to a function definition or function signature.</p></li><li><p><span class="RktVal">'</span><span class="RktVal">preamble</span>&#8212;<wbr></wbr>the preamble to a function definition body, i.e., the declarations preceding the function body in a K &amp; R-style function definition.</p></li><li><p><span class="RktVal">'</span><span class="RktVal">struct</span>&#8212;<wbr></wbr>the body of a <span class="stt">struct</span> type.</p></li><li><p><span class="RktVal">'</span><span class="RktVal">union</span>&#8212;<wbr></wbr>the body of a <span class="stt">union</span> type.</p></li><li><p><span class="RktVal">'</span><span class="RktVal">enum</span>&#8212;<wbr></wbr>the body of an <span class="stt">enum</span> type.</p></li><li><p><span class="RktVal">'</span><span class="RktVal">statement</span>&#8212;<wbr></wbr>a non-declaration context such as a statement or expression.</p></li></ul></div></p><p><div class="SIntrapara">A <a name="(tech._minor._context)"></a><span style="font-style: italic">minor context</span> is one of
</div><div class="SIntrapara"><ul><li><p><span class="RktVal">'</span><span class="RktVal">typedef</span>&#8212;<wbr></wbr>a <span class="stt">typedef</span> declaration in a <span class="RktVal">'</span><span class="RktVal">block</span> major context.</p></li><li><p><span class="RktVal">'</span><span class="RktVal">for</span>&#8212;<wbr></wbr>a <span class="stt">for</span> statement in a <span class="RktVal">'</span><span class="RktVal">statement</span> major context.</p></li><li><p><span class="RktVal">#f</span>&#8212;<wbr></wbr>anything else.</p></li></ul></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>struct</p></div></div><table cellspacing="0" cellpadding="0" class="RForeground"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span></td><td><span class="hspace">&nbsp;</span></td><td><a name="(def._((lib._c/private/syntactic-context..rkt)._parser-state-minor-context))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._parser-state-major-context))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._parser-state-declarators))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._parser-state-env))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._make-parser-state))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._parser-state~3f))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._struct~3aparser-state))"></a><a name="(def._((lib._c/private/syntactic-context..rkt)._parser-state))"></a><span title="Provided from: c/private/syntactic-context | Package: c-utils"><span class="RktSym"><a href="#%28def._%28%28lib._c%2Fprivate%2Fsyntactic-context..rkt%29._parser-state%29%29" class="RktValDef RktValLink" data-pltdoc="x">parser-state</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">env</span><span class="stt"> </span><span class="RktSym">declarators</span><span class="stt"> </span><span class="RktSym">major-context</span><span class="stt"> </span><span class="RktSym">minor-context</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:extra-constructor-name</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._c%2Fprivate%2Fsyntactic-context..rkt%29._make-parser-state%29%29" class="RktValLink" data-pltdoc="x">make-parser-state</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">env</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._listof%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._listof%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cons%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktSym">symbol</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">var</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">type</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">declarators</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._listof%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fbox..rkt%2529._box%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">box/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=symbols.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._symbol%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">major-context</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._listof%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><a href="#%28tech._major._context%29" class="techoutside" data-pltdoc="x"><span class="techinside">major context</span></a><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">minor-context</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._listof%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><a href="#%28tech._minor._context%29" class="techoutside" data-pltdoc="x"><span class="techinside">minor context</span></a><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">State pertaining to the parser. The <span class="RktSym">env</span> field is the current environment.</div></p><p>The <span class="RktSym">declarators</span> stack contains the parser&rsquo;s view of the same cache as the
<span class="RktSym"><a href="#%28def._%28%28lib._c%2Fprivate%2Fsyntactic-context..rkt%29._lexer-state-declarators%29%29" class="RktValLink" data-pltdoc="x">lexer-state-declarators</a></span> stack.</p><p>The <span class="RktSym">major-context</span> stack tracks the <a href="#%28tech._major._context%29" class="techoutside" data-pltdoc="x"><span class="techinside">major context</span></a>. The <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._car%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">car</a></span> of
the stack is the <a name="(tech._current._major._context)"></a><span style="font-style: italic">current major context</span>. The current major context is a
<a name="(tech._declaration._context)"></a><span style="font-style: italic">declaration context</span> if it is one of <span class="RktVal">'</span><span class="RktVal">block</span>, <span class="RktVal">'</span><span class="RktVal">formals</span>, or
<span class="RktVal">'</span><span class="RktVal">preamble</span>.</p><p>The <span class="RktSym">minor-context</span> stack tracks the <a href="#%28tech._minor._context%29" class="techoutside" data-pltdoc="x"><span class="techinside">minor context</span></a>. The <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._car%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">car</a></span> of
the stack is the <a name="(tech._current._minor._context)"></a><span style="font-style: italic">current minor context</span>. A minor context is a
<a name="(tech._typedef._context)"></a><span style="font-style: italic">typedef context</span> if its value is <span class="RktVal">'</span><span class="RktVal">typedef</span>.</p><h5 x-source-module="(lib &quot;c/scribblings/c-utils.scrbl&quot;)" x-source-pkg="c-utils" x-part-tag="&quot;parser_invariants&quot;">7.1.4<tt>&nbsp;</tt><a name="(part._parser_invariants)"></a>Lexer and Parser Invariants</h5><p>Following are some invariants about the state of the lexer and parser.</p><ul><li><p>After an &#8249;<span style="font-style: italic">InitDeclaratorList</span>&#8250; there is one extra <a href="#%28tech._declarator._id%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator id</span></a> left in both the
<span class="RktSym"><a href="#%28def._%28%28lib._c%2Fprivate%2Fsyntactic-context..rkt%29._lexer-state-declarators%29%29" class="RktValLink" data-pltdoc="x">lexer-state-declarators</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._c%2Fprivate%2Fsyntactic-context..rkt%29._parser-state-declarators%29%29" class="RktValLink" data-pltdoc="x">parser-state-declarators</a></span> stack.</p></li><li><p>In a <a href="#%28tech._declaration._context%29" class="techoutside" data-pltdoc="x"><span class="techinside">declaration context</span></a>, when the lexer reaches a <a href="#%28tech._declarator._terminator%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator terminator</span></a> it pops the <span class="RktSym"><a href="#%28def._%28%28lib._c%2Fprivate%2Fsyntactic-context..rkt%29._lexer-state-declarators%29%29" class="RktValLink" data-pltdoc="x">lexer-state-declarators</a></span> stack.</p></li><li><p>In a <a href="#%28tech._declaration._context%29" class="techoutside" data-pltdoc="x"><span class="techinside">declaration context</span></a>, the <a href="#%28tech._declarator._id%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator id</span></a> of every &#8249;<span style="font-style: italic">Declarator</span>&#8250; is either cached by the parser before the lexer reaches the next <a href="#%28tech._declarator._terminator%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator terminator</span></a> or immediately precedes the <a href="#%28tech._declarator._terminator%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator terminator</span></a> token.</p></li><li><p>In a <a href="#%28tech._declaration._context%29" class="techoutside" data-pltdoc="x"><span class="techinside">declaration context</span></a>, when the parser reaches a <a href="#%28tech._declarator._terminator%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator terminator</span></a> it adds the saved <a href="#%28tech._declarator._id%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator id</span></a> to the environment.</p></li><li><p>In a <a href="#%28tech._declaration._context%29" class="techoutside" data-pltdoc="x"><span class="techinside">declaration context</span></a>, the <a href="#%28tech._declarator._id%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator id</span></a> is added to the current environment when the lexer reaches a <a href="#%28tech._declarator._terminator%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator terminator</span></a>.</p></li><li><p>In a non-<a href="#%28tech._declaration._context%29" class="techoutside" data-pltdoc="x"><span class="techinside">declaration context</span></a>, <a href="#%28tech._declarator._id%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator id</span></a>&rsquo;s are not cached, nor is the current environment frame ever extended.</p></li><li><p>In a <a href="#%28tech._declaration._context%29" class="techoutside" data-pltdoc="x"><span class="techinside">declaration context</span></a>, if the lexer reaches a <a href="#%28tech._declarator._terminator%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator terminator</span></a> and the <span class="RktSym"><a href="#%28def._%28%28lib._c%2Fprivate%2Fsyntactic-context..rkt%29._parser-state-declarators%29%29" class="RktValLink" data-pltdoc="x">parser-state-declarators</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._c%2Fprivate%2Fsyntactic-context..rkt%29._lexer-state-declarators%29%29" class="RktValLink" data-pltdoc="x">lexer-state-declarators</a></span> are the same, then the parser has not reduced the preceding &#8249;<span style="font-style: italic">Declarator</span>&#8250;, i.e., the lexer is looking ahead.</p></li><li><p>In a <a href="#%28tech._declaration._context%29" class="techoutside" data-pltdoc="x"><span class="techinside">declaration context</span></a>, if the parser reduces a &#8249;<span style="font-style: italic">Declarator</span>&#8250; and the <span class="RktSym"><a href="#%28def._%28%28lib._c%2Fprivate%2Fsyntactic-context..rkt%29._parser-state-declarators%29%29" class="RktValLink" data-pltdoc="x">parser-state-declarators</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._c%2Fprivate%2Fsyntactic-context..rkt%29._lexer-state-declarators%29%29" class="RktValLink" data-pltdoc="x">lexer-state-declarators</a></span> are the same, then the lexer has not reached the <a href="#%28tech._declarator._terminator%29" class="techoutside" data-pltdoc="x"><span class="techinside">declarator terminator</span></a>, i.e., the lexer has not looked ahead.</p></li><li><p>The lexer never reads more than one token ahead of the innermost production preceding the parser&rsquo;s current position in the grammar.</p></li></ul><h5 x-source-module="(lib &quot;c/scribblings/c-utils.scrbl&quot;)" x-source-pkg="c-utils" x-part-tag="&quot;typedef_names_as_ids&quot;">7.1.5<tt>&nbsp;</tt><a name="(part._typedef_names_as_ids)"></a>Type Names as Identifiers</h5><p>A popular but non-standard extension to C is to allow &#8249;<span style="font-style: italic">TypedefName</span>&#8250; tokens to be
used in many of the contexts that expect an &#8249;<span style="font-style: italic">Identifier</span>&#8250;. For example, a variable
declaration may shadow an existing name that was already bound by <span class="stt">typedef</span>:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">typedef int T;</span></p></td></tr><tr><td><p><span class="stt">void foo(char T) { }</span></p></td></tr></table></p><p>However, these extensions do result in one esoteric ambiguity: in a parameter declaration
such as</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">typedef void (*fn)(int (T));</span></p></td></tr></table></p><p>it is possible to interpret the parenthesized &#8249;<span style="font-style: italic">TypedefName</span>&#8250; <span class="stt">T</span> as either a
parenthesized declaration&#8212;<wbr></wbr>i.e., an <span class="stt">int</span> parameter, named <span class="stt">T</span>, to the <span class="stt">fn</span>
function type&#8212;<wbr></wbr>or a nested function parameter list&#8212;<wbr></wbr>i.e., an anonymous parameter of
type <span class="stt">T</span> to a function type of return type <span class="stt">int</span>.</p><p>To be a conservative extension of standard C, however, the ambiguity must be resolved
with the latter interpretation: the token <span class="stt">T</span> is treated as a type name, not an
identifier.</p><p>The implementation of this resolution actually requires forking the definition of
&#8249;<span style="font-style: italic">DirectDeclarator</span>&#8250; to provide an alternative version whose parenthesized
production does not allow occurrences of &#8249;<span style="font-style: italic">TypedefName</span>&#8250;.</p><h4 x-source-module="(lib &quot;c/scribblings/c-utils.scrbl&quot;)" x-source-pkg="c-utils" x-part-tag="&quot;internals_header&quot;">7.2<tt>&nbsp;</tt><a name="(part._internals_header)"></a>Header Compilation</h4><p>The compilation of headers uses a curious computational idiom of two separate
monads in two distinct stages. The first monadic pass (&ldquo;precompilation&rdquo;)
generates a computation in the second monadic pass (&ldquo;compilation&rdquo;).</p><p>More to follow.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="eval.html" title="backward to &quot;6 Evaluation&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;C Metaprogramming Utilities&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="doc-index.html" title="forward to &quot;Index&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/c-utils/internals.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:26:22 GMT -->
</html>