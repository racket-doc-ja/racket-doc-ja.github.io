<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/goblins/captp.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:27:03 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>5&nbsp;Distributed programming with CapTP</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Goblins:<span class="mywbr"> &nbsp;</span> a transactional, distributed actor model environment</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" data-pltdoc="x">What is Goblins?</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="tutorial.html" class="tocviewlink" data-pltdoc="x">A tutorial</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="api.html" class="tocviewlink" data-pltdoc="x">Goblins API</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="actor-lib.html" class="tocviewlink" data-pltdoc="x">Actor lib:<span class="mywbr"> &nbsp;</span> a collection of utilities</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Distributed programming with Cap<span class="mywbr"> &nbsp;</span>TP</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>5&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Distributed programming with Cap<span class="mywbr"> &nbsp;</span>TP</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">5.1&nbsp;</td><td><a href="#%28part._.What_.Cap.T.P_gives_you%29" class="tocviewlink" data-pltdoc="x">What Cap<span class="mywbr"> &nbsp;</span>TP gives you</a></td></tr><tr><td align="right">5.2&nbsp;</td><td><a href="#%28part._captp._limitations%29" class="tocviewlink" data-pltdoc="x">Cap<span class="mywbr"> &nbsp;</span>TP Limitations</a></td></tr><tr><td align="right">5.3&nbsp;</td><td><a href="#%28part._.Cap.T.P_usage_example%29" class="tocviewlink" data-pltdoc="x">Cap<span class="mywbr"> &nbsp;</span>TP usage example</a></td></tr><tr><td align="right">5.4&nbsp;</td><td><a href="#%28part._.Cap.T.P_.A.P.I%29" class="tocviewlink" data-pltdoc="x">Cap<span class="mywbr"> &nbsp;</span>TP API</a></td></tr><tr><td align="right">5.5&nbsp;</td><td><a href="#%28part._.Netlayers%29" class="tocviewlink" data-pltdoc="x">Netlayers</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">5.1<tt>&nbsp;</tt></span><a href="#%28part._.What_.Cap.T.P_gives_you%29" class="tocsubseclink" data-pltdoc="x">What Cap<span class="mywbr"> &nbsp;</span>TP gives you</a></td></tr><tr><td><span class="tocsublinknumber">5.2<tt>&nbsp;</tt></span><a href="#%28part._captp._limitations%29" class="tocsubseclink" data-pltdoc="x">Cap<span class="mywbr"> &nbsp;</span>TP Limitations</a></td></tr><tr><td><span class="tocsublinknumber">5.3<tt>&nbsp;</tt></span><a href="#%28part._.Cap.T.P_usage_example%29" class="tocsubseclink" data-pltdoc="x">Cap<span class="mywbr"> &nbsp;</span>TP usage example</a></td></tr><tr><td><span class="tocsublinknumber">5.3.1<tt>&nbsp;</tt></span><a href="#%28part._.Launch_a_.Tor_daemon_for_.Goblins%29" class="tocsubseclink" data-pltdoc="x">Launch a Tor daemon for Goblins</a></td></tr><tr><td><span class="tocsublinknumber">5.3.2<tt>&nbsp;</tt></span><a href="#%28part._.Two_.Goblins_programs_chatting_over_.Cap.T.P%29" class="tocsubseclink" data-pltdoc="x">Two Goblins programs chatting over Cap<span class="mywbr"> &nbsp;</span>TP</a></td></tr><tr><td><span class="tocsublinknumber">5.4<tt>&nbsp;</tt></span><a href="#%28part._.Cap.T.P_.A.P.I%29" class="tocsubseclink" data-pltdoc="x">Cap<span class="mywbr"> &nbsp;</span>TP API</a></td></tr><tr><td><a href="#%28def._%28%28lib._goblins%2Focapn%2Fcaptp..rkt%29._spawn-mycapn%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">spawn-<wbr></wbr>mycapn</span></span></a></td></tr><tr><td><span class="tocsublinknumber">5.5<tt>&nbsp;</tt></span><a href="#%28part._.Netlayers%29" class="tocsubseclink" data-pltdoc="x">Netlayers</a></td></tr><tr><td><span class="tocsublinknumber">5.5.1<tt>&nbsp;</tt></span><a href="#%28part._.Tor_.Onion_.Services%29" class="tocsubseclink" data-pltdoc="x">Tor Onion Services</a></td></tr><tr><td><a href="#%28def._%28%28lib._goblins%2Focapn%2Fnetlayer%2Fonion..rkt%29._new-onion-netlayer%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">new-<wbr></wbr>onion-<wbr></wbr>netlayer</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._goblins%2Focapn%2Fnetlayer%2Fonion..rkt%29._restore-onion-netlayer%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">restore-<wbr></wbr>onion-<wbr></wbr>netlayer</span></span></a></td></tr><tr><td><span class="tocsublinknumber">5.5.2<tt>&nbsp;</tt></span><a href="#%28part._.Fake_.Intarwebs%29" class="tocsubseclink" data-pltdoc="x">Fake Intarwebs</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.6</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="actor-lib.html" title="backward to &quot;4 Actor lib: a collection of utilities&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Goblins: a transactional, distributed actor model environment&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h3 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;captp&quot;">5<tt>&nbsp;</tt><a name="(part._captp)"></a><a name="(mod-path._goblins/ocapn/captp)"></a>Distributed programming with CapTP</h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#" class="RktModLink" data-pltdoc="x"><span class="RktSym">goblins/ocapn/captp</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/goblins" title="Install this package using `raco pkg install goblins`"><span class="stt">goblins</span></a></span></td></tr></table></p><p><span class="emph"><span style="font-weight: bold">CAUTION:</span> CapTP support is still in early days.
Please do not rely yet on this protocol being stable.</span></p><p><a href="http://erights.org/elib/distrib/captp/index.html">CapTP</a> is a
system for enabling distributed programming in a mutually suspicious
network.
It originated in the
<a href="http://www.erights.org/">E programming language</a>
but has since appeared in
<a href="https://capnproto.org/">Cap&rsquo;N Proto</a>,
<a href="http://waterken.sourceforge.net/">Waterken</a>,
<a href="https://agoric.com/">Agoric</a>&rsquo;s
<a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/SwingSet">SwingSet</a>,
and now Goblins.</p><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;What_CapTP_gives_you&quot;">5.1<tt>&nbsp;</tt><a name="(part._.What_.Cap.T.P_gives_you)"></a>What CapTP gives you</h4><ul><li><p>Invocation of remote objects resembles the same as with local
objects.  You can use <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span> and <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span> which means
that any most programs that were even originally designed mostly
for local-only computing naturally scale out to a networked
environment.</p></li><li><p>All this is done while mostly hiding the abstraction of the
networked protocol from the user.</p></li><li><p>Object capability security is upheld.  A remote machine cannot
make use of any capability that has not been handed to it.</p></li><li><p>Live object references between CapTP endpoints are incredibly
cheap, merely represented as integers on each side.
This keeps message sizes small and efficient.</p></li><li><p>CapTP provides (acyclic) distributed garbage collection.
Remote machines can indicate when they no longer need an object
and the machine locally containing that reference can reclaim it
if appropriate.</p></li><li><p><a href="tutorial.html#%28part._promise._pipelining._%28tutorial%29%29" data-pltdoc="x">Promise pipelining</a> means that
messages can be sent to the resolution of a promise before
that resolution actually occurs.
Over the network this is represented as a pipeline of messages.
This can reduce round trips significantly, which is a big win.
To re-quote Mark S. Miller:</p><blockquote class="SCentered"><p><span class="emph">"Machines grow faster and memories grow larger.
But the speed of light is constant and New York is not getting any
closer to Tokyo."</span></p></blockquote></li><li><p>CapTP is written independently of network transport abstractions.
It can be run over local unix domain sockets, an OpenSSL connection,
Tor Onion Services, or something custom.
CapTP operates under the assumption of secure pairwise channels;
the layer which provides the pairwise channels is called
"MachineTP" and can be written in a variety of ways.
A simple MachineTP abstraction is provided, but presently still
requires some manual wiring.
(In the future, even simpler abstractions will be provided which
cover most user needs.)</p></li></ul><p>All of these combine into an efficient and powerful protocol that,
most powerfully of all, the author of Goblins programs mostly need not
think too much about.
This circumvents the usual years and years of careful message
structure coordination and standardization for many kinds of
distributed programs, which can simply be written as normal Goblins
programs rather than bespoke protocols.</p><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;captp limitations&quot;">5.2<tt>&nbsp;</tt><a name="(part._captp._limitations)"></a>CapTP Limitations</h4><ul><li><p>Goblins&rsquo; CapTP provides <span class="emph">acyclic</span> distributed
garbage collection.
Cycles between servers are not automatically recognized.
Full
<a href="http://erights.org/history/original-e/dgc/">cycle-collecting distributed garbage collection</a>
has been written, but requires special cooperation from the garbage
collector that we don&rsquo;t have access to in Racket (or in most
languages).</p></li><li><p>Goblins&rsquo; CapTP does not do anything about memory usage or resource
management on its own.  (Features for this will come as Spritely
sub-projects in the future.)</p></li><li><p>While CapTP in theory routes capabilities to specific remote objects,
since the network is mutually suspicious we can&rsquo;t assume that the
remote end isn&rsquo;t conspiring some way to hand those capabilities to
other objects that we don&rsquo;t expect.
The right way to think about this from an object capability perspective
is that a remote misbehaving machine is equivalent to a misbehaving
object with the surface area of the entire machine.</p></li><li><p><span style="font-weight: bold">TEMPORARY:</span> The API is heavily in flux.</p></li></ul><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;CapTP_usage_example&quot;">5.3<tt>&nbsp;</tt><a name="(part._.Cap.T.P_usage_example)"></a>CapTP usage example</h4><p>There&rsquo;s still work to be done in terms of making Goblins&rsquo; CapTP
"easier" to use and set up.  In the meanwhile, let&rsquo;s give an example
showing off Goblins&rsquo; Tor Onion Services support.</p><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Launch_a_Tor_daemon_for_Goblins&quot;">5.3.1<tt>&nbsp;</tt><a name="(part._.Launch_a_.Tor_daemon_for_.Goblins)"></a>Launch a Tor daemon for Goblins</h5><p>In order for this to work, Goblins needs a Tor daemon to talk to...
Goblins can set up and manage the onion services itself once it has that.
So far it seems like running a single Goblins tor process "as your
user" is the easiest option, and let various Goblins processes connect
to that.</p><p>Here&rsquo;s an example config file template... replace <span class="RktSym">&lt;user&gt;</span>
with your actual username:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">DataDirectory /home/&lt;user&gt;/.cache/goblins/tor/data/</span></p></td></tr><tr><td><p><span class="stt">SocksPort unix:/home/&lt;user&gt;/.cache/goblins/tor/tor-socks-sock RelaxDirModeCheck</span></p></td></tr><tr><td><p><span class="stt">ControlSocket unix:/home/&lt;user&gt;/.cache/goblins/tor/tor-control-sock RelaxDirModeCheck</span></p></td></tr><tr><td><p><span class="stt">Log notice file /home/&lt;user&gt;/.cache/goblins/tor/tor-log.txt</span></p></td></tr></table></p><p>Put in <span class="RktSym">~/.config/goblins/tor-config.txt</span> or something.</p><p>You&rsquo;ll also want to make the relevant directories:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">mkdir -p ~/.cache/goblins/tor/data</span></p></td></tr></table></p><p>Okay, now you can launch the Tor daemon:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">tor -f ~/.config/goblins/tor-config.txt</span></p></td></tr></table></p><p>In the future we should probably make a raco launcher that does the
above for users so they don&rsquo;t need to read this section. :P</p><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Two_Goblins_programs_chatting_over_CapTP&quot;">5.3.2<tt>&nbsp;</tt><a name="(part._.Two_.Goblins_programs_chatting_over_.Cap.T.P)"></a>Two Goblins programs chatting over CapTP</h5><p>Here&rsquo;s our server, save as <span class="RktSym">captp-alice.rkt</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=index.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">goblins</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">goblins/actor-lib/bootstrap</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">goblins/ocapn</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">goblins/ocapn/netlayer/onion</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">net/url</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Machine</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">talk</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">network</span><span class="hspace">&nbsp;</span><span class="RktCmt">on</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define-vat-run</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">machine-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._make-vat%29%29" class="RktValLink" data-pltdoc="x">make-vat</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">mycapn</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">machine-run</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._define-values%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-values</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">onion-netlayer</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">_onion-private-key</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">_onion-service-id</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._goblins%2Focapn%2Fnetlayer%2Fonion..rkt%29._new-onion-netlayer%29%29" class="RktValLink" data-pltdoc="x">new-onion-netlayer</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._goblins%2Focapn%2Fcaptp..rkt%29._spawn-mycapn%29%29" class="RktValLink" data-pltdoc="x">spawn-mycapn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">onion-netlayer</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Get</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">command</span><span class="hspace">&nbsp;</span><span class="RktCmt">line</span><span class="hspace">&nbsp;</span><span class="RktCmt">argument</span><span class="hspace">&nbsp;</span><span class="RktCmt">for</span><span class="hspace">&nbsp;</span><span class="RktCmt">Alice's</span><span class="hspace">&nbsp;</span><span class="RktCmt">address</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alice-sref</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Command-Line_Parsing.html%23%2528form._%2528%2528lib._racket%252Fcmdline..rkt%2529._command-line%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">command-line</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">#:args</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">alice-sref-str</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">string-&gt;ocapn-sturdyref</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alice-sref-str</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Set</span><span class="hspace">&nbsp;</span><span class="RktCmt">up</span><span class="hspace">&nbsp;</span><span class="RktCmt">a</span><span class="hspace">&nbsp;</span><span class="RktCmt">vat</span><span class="hspace">&nbsp;</span><span class="RktCmt">for</span><span class="hspace">&nbsp;</span><span class="RktCmt">"alice"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define-vat-run</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._make-vat%29%29" class="RktValLink" data-pltdoc="x">make-vat</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alice-vow</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">mycapn</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">enliven</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alice-sref</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alice-vow</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Alice"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">heard-back</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Alice</span><span class="hspace">&nbsp;</span><span class="RktVal">heard</span><span class="hspace">&nbsp;</span><span class="RktVal">back:</span><span class="hspace">&nbsp;</span><span class="RktVal">~a"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">heard-back</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">we're</span><span class="hspace">&nbsp;</span><span class="RktCmt">done</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=semaphore.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._semaphore-post%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">semaphore-post</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">finished</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">A</span><span class="hspace">&nbsp;</span><span class="RktCmt">semaphore</span><span class="hspace">&nbsp;</span><span class="RktCmt">for</span><span class="hspace">&nbsp;</span><span class="RktCmt">us</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">signal</span><span class="hspace">&nbsp;</span><span class="RktCmt">once</span><span class="hspace">&nbsp;</span><span class="RktCmt">we've</span><span class="hspace">&nbsp;</span><span class="RktCmt">heard</span><span class="hspace">&nbsp;</span><span class="RktCmt">back</span><span class="hspace">&nbsp;</span><span class="RktCmt">from</span><span class="hspace">&nbsp;</span><span class="RktCmt">Alice</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">finished</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=semaphore.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-semaphore%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">make-semaphore</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sync%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sync</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">finished</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Traditionally Alice talks to Bob, you see.  So now we need Bob.</p><p>Now save the following client code as <span class="RktSym">captp-bob.rkt</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=index.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">goblins</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">goblins/actor-lib/bootstrap</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">goblins/ocapn</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">goblins/ocapn/netlayer/onion</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">net/url</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Bob</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="hspace">&nbsp;</span><span class="RktCmt">going</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">be</span><span class="hspace">&nbsp;</span><span class="RktCmt">a</span><span class="hspace">&nbsp;</span><span class="RktCmt">"greeter"</span><span class="hspace">&nbsp;</span><span class="RktCmt">of</span><span class="hspace">&nbsp;</span><span class="RktCmt">sorts,</span><span class="hspace">&nbsp;</span><span class="RktCmt">so</span><span class="hspace">&nbsp;</span><span class="RktCmt">let's</span><span class="hspace">&nbsp;</span><span class="RktCmt">define</span><span class="hspace">&nbsp;</span><span class="RktCmt">what</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">that</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^greeter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">_bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">constructor</span><span class="hspace">&nbsp;</span><span class="RktCmt">args</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">invocation</span><span class="hspace">&nbsp;</span><span class="RktCmt">args</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a!"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Now</span><span class="hspace">&nbsp;</span><span class="RktCmt">let's</span><span class="hspace">&nbsp;</span><span class="RktCmt">make</span><span class="hspace">&nbsp;</span><span class="RktCmt">a</span><span class="hspace">&nbsp;</span><span class="RktCmt">vat</span><span class="hspace">&nbsp;</span><span class="RktCmt">for</span><span class="hspace">&nbsp;</span><span class="RktCmt">bob,</span><span class="hspace">&nbsp;</span><span class="RktCmt">and</span><span class="hspace">&nbsp;</span><span class="RktCmt">run</span><span class="hspace">&nbsp;</span><span class="RktCmt">bob</span><span class="hspace">&nbsp;</span><span class="RktCmt">in</span><span class="hspace">&nbsp;</span><span class="RktCmt">it</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define-vat-run</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">b-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._make-vat%29%29" class="RktValLink" data-pltdoc="x">make-vat</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bob</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">b-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^greeter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Bob"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">First,</span><span class="hspace">&nbsp;</span><span class="RktCmt">let's</span><span class="hspace">&nbsp;</span><span class="RktCmt">set</span><span class="hspace">&nbsp;</span><span class="RktCmt">up</span><span class="hspace">&nbsp;</span><span class="RktCmt">our</span><span class="hspace">&nbsp;</span><span class="RktCmt">"machine"</span><span class="hspace">&nbsp;</span><span class="RktCmt">for</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">network</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define-vat-run</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">machine-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._make-vat%29%29" class="RktValLink" data-pltdoc="x">make-vat</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">machine-run</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._define-values%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-values</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">onion-netlayer</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">_onion-private-key</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">_onion-service-id</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._goblins%2Focapn%2Fnetlayer%2Fonion..rkt%29._new-onion-netlayer%29%29" class="RktValLink" data-pltdoc="x">new-onion-netlayer</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">mycapn</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._goblins%2Focapn%2Fcaptp..rkt%29._spawn-mycapn%29%29" class="RktValLink" data-pltdoc="x">spawn-mycapn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">onion-netlayer</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Now</span><span class="hspace">&nbsp;</span><span class="RktCmt">we</span><span class="hspace">&nbsp;</span><span class="RktCmt">need</span><span class="hspace">&nbsp;</span><span class="RktCmt">a</span><span class="hspace">&nbsp;</span><span class="RktCmt">sturdyref</span><span class="hspace">&nbsp;</span><span class="RktCmt">for</span><span class="hspace">&nbsp;</span><span class="RktCmt">Bob...</span><span class="hspace">&nbsp;</span><span class="RktCmt">let's</span><span class="hspace">&nbsp;</span><span class="RktCmt">print</span><span class="hspace">&nbsp;</span><span class="RktCmt">it</span><span class="hspace">&nbsp;</span><span class="RktCmt">out</span><span class="hspace">&nbsp;</span><span class="RktCmt">so</span><span class="hspace">&nbsp;</span><span class="RktCmt">that</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">we</span><span class="hspace">&nbsp;</span><span class="RktCmt">know</span><span class="hspace">&nbsp;</span><span class="RktCmt">how</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">connect</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bob-sturdyref</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">mycapn</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">register</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bob</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">onion</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">And</span><span class="hspace">&nbsp;</span><span class="RktCmt">let's</span><span class="hspace">&nbsp;</span><span class="RktCmt">print</span><span class="hspace">&nbsp;</span><span class="RktCmt">out</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">command</span><span class="hspace">&nbsp;</span><span class="RktCmt">line</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Bob's</span><span class="hspace">&nbsp;</span><span class="RktVal">sturdyref:</span><span class="hspace">&nbsp;</span><span class="RktVal">~a"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">url-&gt;string</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">ocapn-sturdyref-&gt;url</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bob-sturdyref</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">And</span><span class="hspace">&nbsp;</span><span class="RktCmt">we</span><span class="hspace">&nbsp;</span><span class="RktCmt">need</span><span class="hspace">&nbsp;</span><span class="RktCmt">some</span><span class="hspace">&nbsp;</span><span class="RktCmt">way</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">keep</span><span class="hspace">&nbsp;</span><span class="RktCmt">things</span><span class="hspace">&nbsp;</span><span class="RktCmt">open</span><span class="hspace">&nbsp;</span><span class="RktCmt">despite</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">other</span><span class="hspace">&nbsp;</span><span class="RktCmt">vats</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">humming</span><span class="hspace">&nbsp;</span><span class="RktCmt">along</span><span class="hspace">&nbsp;</span><span class="RktCmt">in</span><span class="hspace">&nbsp;</span><span class="RktCmt">their</span><span class="hspace">&nbsp;</span><span class="RktCmt">own</span><span class="hspace">&nbsp;</span><span class="RktCmt">threads...</span><span class="hspace">&nbsp;</span><span class="RktCmt">this</span><span class="hspace">&nbsp;</span><span class="RktCmt">kluge</span><span class="hspace">&nbsp;</span><span class="RktCmt">does</span><span class="hspace">&nbsp;</span><span class="RktCmt">it</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sync%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sync</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=semaphore.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-semaphore%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">make-semaphore</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Okay, let&rsquo;s try it out.
Open up two terminals, and in the first one run:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">racket captp-bob.rkt</span></p></td></tr></table></p><p>It&rsquo;ll spit out a captp "sturdyref" URI.
Copy it and in a new terminal paste it as the argument to
<span class="RktSym">captp-alice.rkt</span>:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">racket captp-alice.rkt STURDYREF-GOES-HERE</span></p></td></tr></table></p><p>You should see:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">Bob heard back: Hello Bob, my name is Alice!</span></p></td></tr></table></p><p>If that worked, your connection succeeded!
Horray!</p><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;CapTP_API&quot;">5.4<tt>&nbsp;</tt><a name="(part._.Cap.T.P_.A.P.I)"></a>CapTP API</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._goblins/ocapn/captp..rkt)._spawn-mycapn))"></a><span title="Provided from: goblins/ocapn/captp | Package: goblins"><span class="RktSym"><a href="#%28def._%28%28lib._goblins%2Focapn%2Fcaptp..rkt%29._spawn-mycapn%29%29" class="RktValDef RktValLink" data-pltdoc="x">spawn-mycapn</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">netlayer</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">local-refr?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">netlayer</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">local-refr?</span></span></span></td></tr></table></blockquote></div><div class="SIntrapara">Spawns a captp "machine router".
Needs to be run in a vat context.
Needs to be supplied netlayers in order to operate;
see the Tor Onion Services example above for an example.</div></p><p>Returns an object representing the machine with various methods
that Chris really ought to document.</p><p>Sorry, these docs are pretty sparse; we hope to make them better.
Hopefully the above example helps get you started.</p><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Netlayers&quot;">5.5<tt>&nbsp;</tt><a name="(part._.Netlayers)"></a>Netlayers</h4><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Tor_Onion_Services&quot;">5.5.1<tt>&nbsp;</tt><a name="(part._.Tor_.Onion_.Services)"></a><a name="(mod-path._goblins/ocapn/netlayer/onion)"></a>Tor Onion Services</h5><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._goblins%2Focapn%2Fnetlayer%2Fonion%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">goblins/ocapn/netlayer/onion</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/goblins" title="Install this package using `raco pkg install goblins`"><span class="stt">goblins</span></a></span></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._goblins/ocapn/netlayer/onion..rkt)._new-onion-netlayer))"></a><span title="Provided from: goblins/ocapn/netlayer/onion | Package: goblins"><span class="RktSym"><a href="#%28def._%28%28lib._goblins%2Focapn%2Fnetlayer%2Fonion..rkt%29._new-onion-netlayer%29%29" class="RktValDef RktValLink" data-pltdoc="x">new-onion-netlayer</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span><span class="RktOpt">[</span></td><td valign="top"><span class="RktPn">#:tor-control-path</span><span class="hspace">&nbsp;</span><span class="RktVar">tor-control-path</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:tor-socks-path</span><span class="hspace">&nbsp;</span><span class="RktVar">tor-socks-path</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:tor-ocapn-socks-dir</span><span class="hspace">&nbsp;</span><span class="RktVar">tor-ocapn-socks-dir</span><span class="RktOpt">]</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr></table></blockquote></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="prototype"><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><table cellspacing="0" cellpadding="0"><tr><td><span class="RktSym"><span class="badlink"><span class="RktValLink">local-refr?</span></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">string?</a></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">string?</a></span></td></tr></table></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td valign="top"><span class="hspace">&nbsp;&nbsp;</span></td><td valign="top"><span class="RktVar">tor-control-path</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">:</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Manipulating_Paths.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._path%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">path?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">string?</a></span><span class="RktPn">)</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">=</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym">default-tor-control-path</span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">tor-socks-path</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Manipulating_Paths.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._path%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">path?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">string?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym">default-tor-socks-path</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td valign="top"><span class="hspace">&nbsp;&nbsp;</span></td><td valign="top"><span class="RktVar">tor-ocapn-socks-dir</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">:</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Manipulating_Paths.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._path%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">path?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">string?</a></span><span class="RktPn">)</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">=</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym">default-tor-ocapn-socks-dir</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Sets up a new onion netlayer, generating a new keypair for
this onion service.
<span class="RktVar">tor-control-path</span> specifies the control socket to talk to
the tor daemon, <span class="RktVar">tor-socks-path</span> is the path which allows
speaking outward to other tor onion services, and <span class="RktVar">tor-ocapn-socks-dir</span>
is a directory where fresh tor sockets will be created.</div></p><p>Returns three values to its continuation: the set up netlayer,
the private key (formatted in a way that Tor recognizes) for this
onion service should you wish to restore it with
<span class="RktSym"><a href="#%28def._%28%28lib._goblins%2Focapn%2Fnetlayer%2Fonion..rkt%29._restore-onion-netlayer%29%29" class="RktValLink" data-pltdoc="x">restore-onion-netlayer</a></span>, and the "service id"
of this instance (ie the public key, or rather the left side of the
".onion" in an onion address).</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top" colspan="3"><span class="RktPn">(</span><a name="(def._((lib._goblins/ocapn/netlayer/onion..rkt)._restore-onion-netlayer))"></a><span title="Provided from: goblins/ocapn/netlayer/onion | Package: goblins"><span class="RktSym"><a href="#%28def._%28%28lib._goblins%2Focapn%2Fnetlayer%2Fonion..rkt%29._restore-onion-netlayer%29%29" class="RktValDef RktValLink" data-pltdoc="x">restore-onion-netlayer</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span><span class="RktOpt">[</span></td><td valign="top"><span class="RktPn">#:tor-control-path</span><span class="hspace">&nbsp;</span><span class="RktVar">tor-control-path</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:tor-socks-path</span><span class="hspace">&nbsp;</span><span class="RktVar">tor-socks-path</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:tor-ocapn-socks-dir</span><span class="hspace">&nbsp;</span><span class="RktVar">tor-ocapn-socks-dir</span><span class="RktOpt">]</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr></table></blockquote></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="prototype"><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><table cellspacing="0" cellpadding="0"><tr><td><span class="RktSym"><span class="badlink"><span class="RktValLink">local-refr?</span></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">string?</a></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">string?</a></span></td></tr></table></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td valign="top"><span class="hspace">&nbsp;&nbsp;</span></td><td valign="top"><span class="RktVar">tor-control-path</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">:</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Manipulating_Paths.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._path%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">path?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">string?</a></span><span class="RktPn">)</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">=</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym">default-tor-control-path</span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">tor-socks-path</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Manipulating_Paths.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._path%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">path?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">string?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym">default-tor-socks-path</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td valign="top"><span class="hspace">&nbsp;&nbsp;</span></td><td valign="top"><span class="RktVar">tor-ocapn-socks-dir</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">:</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Manipulating_Paths.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._path%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">path?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">string?</a></span><span class="RktPn">)</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">=</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym">default-tor-ocapn-socks-dir</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Same api as in <span class="RktSym"><a href="#%28def._%28%28lib._goblins%2Focapn%2Fnetlayer%2Fonion..rkt%29._new-onion-netlayer%29%29" class="RktValLink" data-pltdoc="x">new-onion-netlayer</a></span>, but restores a
tor service.</div></p><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Fake_Intarwebs&quot;">5.5.2<tt>&nbsp;</tt><a name="(part._.Fake_.Intarwebs)"></a><a name="(mod-path._goblins/ocapn/netlayer/fake-intarwebs)"></a>Fake Intarwebs</h5><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left" colspan="2"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._goblins%2Focapn%2Fnetlayer%2Ffake-intarwebs%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">goblins/ocapn/netlayer/fake-intarwebs</span></a><span class="RktPn">)</span></td></tr><tr><td align="left">&nbsp;</td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/goblins" title="Install this package using `raco pkg install goblins`"><span class="stt">goblins</span></a></span></td></tr></table></p><p>Sometimes you want to just test whether or not your code works over
captp without actually starting up a captp connection.</p><p>The "fake intarwebs" module is pretty... basic.  But the idea is that
there&rsquo;s a "network" (like a fake version of the internet) which has a
set of names mapped to locations which route to incoming connections.
Each abstract machine sets up its own captp process with corresponding
netlayer.</p><p>No attempt is made to actually process-separate the systems.  (Though
this too could be done, it could be nice to compose this module with
Racket&rsquo;s places... if you try this, let us know!)  However, the
objects do communicate over the captp system, just entirely locally
and in-process.</p><p>Look at the unit tests at the bottom of
<span class="RktSym">goblins/ocapn/netlayer/fake-intarwebs.rkt</span>
for an example of usage.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="actor-lib.html" title="backward to &quot;4 Actor lib: a collection of utilities&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Goblins: a transactional, distributed actor model environment&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/goblins/captp.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:27:03 GMT -->
</html>