<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/goblins/tutorial.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:27:01 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>2&nbsp;A tutorial</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Goblins:<span class="mywbr"> &nbsp;</span> a transactional, distributed actor model environment</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" data-pltdoc="x">What is Goblins?</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">A tutorial</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="api.html" class="tocviewlink" data-pltdoc="x">Goblins API</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="actor-lib.html" class="tocviewlink" data-pltdoc="x">Actor lib:<span class="mywbr"> &nbsp;</span> a collection of utilities</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="captp.html" class="tocviewlink" data-pltdoc="x">Distributed programming with Cap<span class="mywbr"> &nbsp;</span>TP</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>2&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">A tutorial</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="#%28part._.Getting_going%29" class="tocviewlink" data-pltdoc="x">Getting going</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="#%28part._.Vats__actors__spawning__and_immediate_calls%29" class="tocviewlink" data-pltdoc="x">Vats, actors, spawning, and immediate calls</a></td></tr><tr><td align="right">2.3&nbsp;</td><td><a href="#%28part._.Message_passing__promises__and_multiple_vats%29" class="tocviewlink" data-pltdoc="x">Message passing, promises, and multiple vats</a></td></tr><tr><td align="right">2.4&nbsp;</td><td><a href="#%28part._.Going_low-level__actormaps%29" class="tocviewlink" data-pltdoc="x">Going low-<wbr></wbr>level:<span class="mywbr"> &nbsp;</span> actormaps</a></td></tr><tr><td align="right">2.5&nbsp;</td><td><a href="#%28part._.Advanced_object_patterns%29" class="tocviewlink" data-pltdoc="x">Advanced object patterns</a></td></tr><tr><td align="right">2.6&nbsp;</td><td><a href="#%28part._.How_this_relates_to__object_capability_security_%29" class="tocviewlink" data-pltdoc="x">How this relates to "object capability security"</a></td></tr><tr><td align="right">2.7&nbsp;</td><td><a href="#%28part._.Sealers_unsealers_and_rights_amplification%29" class="tocviewlink" data-pltdoc="x">Sealers/<span class="mywbr"> &nbsp;</span>unsealers and rights amplification</a></td></tr><tr><td align="right">2.8&nbsp;</td><td><a href="#%28part._.Networked_object_interactions%29" class="tocviewlink" data-pltdoc="x">Networked object interactions</a></td></tr><tr><td align="right">2.9&nbsp;</td><td><a href="#%28part._.A_peek_into_.Goblins__machinery%29" class="tocviewlink" data-pltdoc="x">A peek into Goblins&rsquo; machinery</a></td></tr><tr><td align="right">2.10&nbsp;</td><td><a href="#%28part._.Working_with_.Racket_events_in_.Goblins%29" class="tocviewlink" data-pltdoc="x">Working with Racket events in Goblins</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._.Getting_going%29" class="tocsubseclink" data-pltdoc="x">Getting going</a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#%28part._.Vats__actors__spawning__and_immediate_calls%29" class="tocsubseclink" data-pltdoc="x">Vats, actors, spawning, and immediate calls</a></td></tr><tr><td><span class="tocsublinknumber">2.3<tt>&nbsp;</tt></span><a href="#%28part._.Message_passing__promises__and_multiple_vats%29" class="tocsubseclink" data-pltdoc="x">Message passing, promises, and multiple vats</a></td></tr><tr><td><span class="tocsublinknumber">2.3.1<tt>&nbsp;</tt></span><a href="#%28part._.The_basics%29" class="tocsubseclink" data-pltdoc="x">The basics</a></td></tr><tr><td><span class="tocsublinknumber">2.3.2<tt>&nbsp;</tt></span><a href="#%28part._.Making_and_resolving_our_own_promises%29" class="tocsubseclink" data-pltdoc="x">Making and resolving our own promises</a></td></tr><tr><td><span class="tocsublinknumber">2.3.3<tt>&nbsp;</tt></span><a href="#%28part._.Finally_we_have___finally%29" class="tocsubseclink" data-pltdoc="x">Finally we have #:<span class="mywbr"> &nbsp;</span>finally</a></td></tr><tr><td><span class="tocsublinknumber">2.3.4<tt>&nbsp;</tt></span><a href="#%28part._.The_on-fulfilled_handler_of__on__is_optional%29" class="tocsubseclink" data-pltdoc="x">The on-<wbr></wbr>fulfilled handler of "on" is optional</a></td></tr><tr><td><span class="tocsublinknumber">2.3.5<tt>&nbsp;</tt></span><a href="#%28part.__on__with_non-promise_values%29" class="tocsubseclink" data-pltdoc="x">"on" with non-<wbr></wbr>promise values</a></td></tr><tr><td><span class="tocsublinknumber">2.3.6<tt>&nbsp;</tt></span><a href="#%28part.__on__can_return_promises_too%29" class="tocsubseclink" data-pltdoc="x">"on" can return promises too</a></td></tr><tr><td><span class="tocsublinknumber">2.3.7<tt>&nbsp;</tt></span><a href="#%28part._promise._pipelining._%28tutorial%29%29" class="tocsubseclink" data-pltdoc="x">Promise pipelining</a></td></tr><tr><td><span class="tocsublinknumber">2.3.8<tt>&nbsp;</tt></span><a href="#%28part._.Broken_promise_contagion%29" class="tocsubseclink" data-pltdoc="x">Broken promise contagion</a></td></tr><tr><td><span class="tocsublinknumber">2.4<tt>&nbsp;</tt></span><a href="#%28part._.Going_low-level__actormaps%29" class="tocsubseclink" data-pltdoc="x">Going low-<wbr></wbr>level:<span class="mywbr"> &nbsp;</span> actormaps</a></td></tr><tr><td><span class="tocsublinknumber">2.4.1<tt>&nbsp;</tt></span><a href="#%28part._.Spawning__peeking__poking__turning%29" class="tocsubseclink" data-pltdoc="x">Spawning, peeking, poking, turning</a></td></tr><tr><td><span class="tocsublinknumber">2.4.2<tt>&nbsp;</tt></span><a href="#%28part._.Time_travel__snapshotting_and_restoring%29" class="tocsubseclink" data-pltdoc="x">Time travel:<span class="mywbr"> &nbsp;</span> snapshotting and restoring</a></td></tr><tr><td><span class="tocsublinknumber">2.5<tt>&nbsp;</tt></span><a href="#%28part._.Advanced_object_patterns%29" class="tocsubseclink" data-pltdoc="x">Advanced object patterns</a></td></tr><tr><td><span class="tocsublinknumber">2.5.1<tt>&nbsp;</tt></span><a href="#%28part._.Extending_our_methods%29" class="tocsubseclink" data-pltdoc="x">Extending our methods</a></td></tr><tr><td><span class="tocsublinknumber">2.5.2<tt>&nbsp;</tt></span><a href="#%28part._.Mixins%29" class="tocsubseclink" data-pltdoc="x">Mixins</a></td></tr><tr><td><span class="tocsublinknumber">2.5.3<tt>&nbsp;</tt></span><a href="#%28part._.Behavior_pivoting_as_a_kind_of_state_machine%29" class="tocsubseclink" data-pltdoc="x">Behavior pivoting as a kind of state machine</a></td></tr><tr><td><span class="tocsublinknumber">2.6<tt>&nbsp;</tt></span><a href="#%28part._.How_this_relates_to__object_capability_security_%29" class="tocsubseclink" data-pltdoc="x">How this relates to "object capability security"</a></td></tr><tr><td><span class="tocsublinknumber">2.7<tt>&nbsp;</tt></span><a href="#%28part._.Sealers_unsealers_and_rights_amplification%29" class="tocsubseclink" data-pltdoc="x">Sealers/<span class="mywbr"> &nbsp;</span>unsealers and rights amplification</a></td></tr><tr><td><span class="tocsublinknumber">2.8<tt>&nbsp;</tt></span><a href="#%28part._.Networked_object_interactions%29" class="tocsubseclink" data-pltdoc="x">Networked object interactions</a></td></tr><tr><td><span class="tocsublinknumber">2.9<tt>&nbsp;</tt></span><a href="#%28part._.A_peek_into_.Goblins__machinery%29" class="tocsubseclink" data-pltdoc="x">A peek into Goblins&rsquo; machinery</a></td></tr><tr><td><span class="tocsublinknumber">2.9.1<tt>&nbsp;</tt></span><a href="#%28part._.Actors_really_are_what_they_say_they_are%29" class="tocsubseclink" data-pltdoc="x">Actors really are what they say they are</a></td></tr><tr><td><span class="tocsublinknumber">2.9.2<tt>&nbsp;</tt></span><a href="#%28part._.So_how_does_message_passing_work%29" class="tocsubseclink" data-pltdoc="x">So how does message passing work</a></td></tr><tr><td><span class="tocsublinknumber">2.9.3<tt>&nbsp;</tt></span><a href="#%28part._.How_can_two_actormaps_communicate____.How_do_vats_do_it__%29" class="tocsubseclink" data-pltdoc="x">How can two actormaps communicate?  (How do vats do it?)</a></td></tr><tr><td><span class="tocsublinknumber">2.10<tt>&nbsp;</tt></span><a href="#%28part._.Working_with_.Racket_events_in_.Goblins%29" class="tocsubseclink" data-pltdoc="x">Working with Racket events in Goblins</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.6</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="intro.html" title="backward to &quot;1 What is Goblins?&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Goblins: a transactional, distributed actor model environment&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="api.html" title="forward to &quot;3 Goblins API&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;tutorial&quot;">2<tt>&nbsp;</tt><a name="(part._tutorial)"></a>A tutorial</h3><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Getting_going&quot;">2.1<tt>&nbsp;</tt><a name="(part._.Getting_going)"></a>Getting going</h4><p>First you will need to download and install
<a href="https://racket-lang.org/">Racket</a>, if you haven&rsquo;t already.
You will want an editor that you can comfortably program Racket in.
If you are already a user of
<a href="https://www.gnu.org/software/emacs/">GNU Emacs</a>,
<a href="https://github.com/greghendershott/racket-mode">racket-mode</a>
is most excellent.
If you aren&rsquo;t already an Emacs user, Racket ships with an excellent
built-in IDE called DrRacket.
Use that.</p><p>Next you will need to install Goblins.
At the command line you can type:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">raco pkg install goblins</span></p></td></tr></table></p><p>Alternately, from DrRacket you can go to <span class="RktSym">File =&gt; Install Package</span>.</p><p>If you are totally new to Racket, see the
<a href="../getting-started/index.html">Getting Started</a>
documentation page.
Otherwise, let&rsquo;s go!</p><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Vats__actors__spawning__and_immediate_calls&quot;">2.2<tt>&nbsp;</tt><a name="(part._.Vats__actors__spawning__and_immediate_calls)"></a>Vats, actors, spawning, and immediate calls</h4><p>Open a Racket REPL and import Goblins:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=index.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">goblins</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>First we&rsquo;re going to need something to store our objects in.
We&rsquo;ll boot up an event loop, called a <a href="api.html#%28tech._vat%29" class="techoutside" data-pltdoc="x"><span class="techinside">vat</span></a> (TODO: explain why it&rsquo;s
called that), which can manage our objects.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-vat</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._make-vat%29%29" class="RktValLink" data-pltdoc="x">make-vat</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Our vat is currently lonely... nobody lives in it!
Let&rsquo;s make a friend.
First we&rsquo;ll need a friend constructor:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">The</span><span class="hspace">&nbsp;</span><span class="RktCmt">^</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="hspace">&nbsp;</span><span class="RktCmt">conventionally</span><span class="hspace">&nbsp;</span><span class="RktCmt">called</span><span class="hspace">&nbsp;</span><span class="RktCmt">a</span><span class="hspace">&nbsp;</span><span class="RktCmt">"hard</span><span class="hspace">&nbsp;</span><span class="RktCmt">hat"</span><span class="hspace">&nbsp;</span><span class="RktCmt">in</span><span class="hspace">&nbsp;</span><span class="RktCmt">Goblins;</span><span class="hspace">&nbsp;</span><span class="RktCmt">it</span><span class="hspace">&nbsp;</span><span class="RktCmt">means</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">this</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="hspace">&nbsp;</span><span class="RktCmt">an</span><span class="hspace">&nbsp;</span><span class="RktCmt">object</span><span class="hspace">&nbsp;</span><span class="RktCmt">constructor.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Every</span><span class="hspace">&nbsp;</span><span class="RktCmt">constructor</span><span class="hspace">&nbsp;</span><span class="RktCmt">takes</span><span class="hspace">&nbsp;</span><span class="RktCmt">a</span><span class="hspace">&nbsp;</span><span class="RktCmt">bcom</span><span class="hspace">&nbsp;</span><span class="RktCmt">argument,</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">rest</span><span class="hspace">&nbsp;</span><span class="RktCmt">of</span><span class="hspace">&nbsp;</span><span class="RktCmt">them</span><span class="hspace">&nbsp;</span><span class="RktCmt">are</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">passed</span><span class="hspace">&nbsp;</span><span class="RktCmt">in</span><span class="hspace">&nbsp;</span><span class="RktCmt">from</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">spawn</span><span class="hspace">&nbsp;</span><span class="RktCmt">invocation.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">This</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">initial</span><span class="hspace">&nbsp;</span><span class="RktCmt">handler</span><span class="hspace">&nbsp;</span><span class="RktCmt">procedure.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a!"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>The outer procedure is the constructor; all it really does is return
another procedure which is the handler.</p><p>Let&rsquo;s make a friend and call her Alice.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alice</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-vat</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Alice"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Here the arguments to the spawn method are <span class="RktSym">^friend</span>, which is the
constructor procedure we are using, and the argument "Alice", which
becomes bound to <span class="RktSym">my-name</span>.
(The <span class="RktSym">bcom</span> argument is implicitly provided by Goblins; we&rsquo;ll
ignore it for right now.)</p><p>If we look at Alice in the REPL, we&rsquo;ll see that what we&rsquo;re really
holding onto is a "live reference" to Alice.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktSym">alice</span></td></tr><tr><td><p><span class="RktRes">#&lt;local-object ^friend&gt;</span></p></td></tr></table></blockquote><p>Now we&rsquo;d like to talk to Alice.
For now let&rsquo;s use the "call" method on our vat:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-vat</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">call</span><span class="hspace">&nbsp;</span><span class="RktSym">alice</span><span class="hspace">&nbsp;</span><span class="RktVal">"Chris"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Hello Chris, my name is Alice!"</span></p></td></tr></table></blockquote><p>If we look at our <span class="RktSym">^friend</span> procedure again, this should make a lot
of sense; the inner lambda is being evaluated with "Chris" being
passed in for <span class="RktSym">your-name</span>.
The returned value is just the result.</p><p>Normally in a Goblins program, we can just spawn and talk to a Goblins
object directly using the <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span> and <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span> operators directly.
However we&rsquo;re kind of "bootstrapping the world" here, so we need the
vat&rsquo;s help to do that.
However, we can see what it would look like to use them if we were in
a "Goblins context" by using the vat&rsquo;s <span class="RktSym">&rsquo;run</span> method
which allows us to pass in an arbitrary thunk (aka "procedure with no
arguments"):</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-vat</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alyssa</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">^friend</span><span class="hspace">&nbsp;</span><span class="RktVal">"Alyssa"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alyssa</span><span class="hspace">&nbsp;</span><span class="RktVal">"Ben"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">"Hello Ben, my name is Alyssa!"</span></p></td></tr></table></blockquote><p>Hm, this is a lot of work to read that!
Luckily, here is a friend that makes running bootstrapping commands
like this much easier to read:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">goblins/actor-lib/bootstrap</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define-vat-run</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">a-vat</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Now we can run the same code as above, but with significantly less
syntactic overhead:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alyssa</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">^friend</span><span class="hspace">&nbsp;</span><span class="RktVal">"Alyssa"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alyssa</span><span class="hspace">&nbsp;</span><span class="RktVal">"Ben"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">"Hello Ben, my name is Alyssa!"</span></p></td></tr></table></blockquote><p>Much easier to follow!</p><p>Anyway, maybe we&rsquo;d like to be greeted the same way we have been by our
friend sometimes, but other times we&rsquo;d like to just find out what our
friend&rsquo;s name is.
It would be nice to have different "methods" we could call, and in
fact, Goblins comes with a convenient <span class="RktSym">methods</span> macro:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">goblins/actor-lib/methods</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^methods-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">methods</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Greet</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">user</span><span class="hspace">&nbsp;</span><span class="RktCmt">using</span><span class="hspace">&nbsp;</span><span class="RktCmt">their</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">greet</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a!"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">return</span><span class="hspace">&nbsp;</span><span class="RktCmt">what</span><span class="hspace">&nbsp;</span><span class="RktCmt">our</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Now let&rsquo;s spawn an alice2 that uses <span class="RktSym">^methods-friend</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alice2</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^methods-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Alice"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Now we can call each method separately:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice2</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">name</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">"Alice"</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice2</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Chris"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">"Hello Chris, my name is Alice!"</span></p></td></tr></table></blockquote><p>(As a side note, if you&rsquo;re thinking that it would look nicer if this
looked like:)</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alice2.name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alice2.greet</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Chris"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>(... you&rsquo;re right and a <span class="RktSym">#lang</span> will provided in the future for
such aesthetic improvement which expands to the former syntax.)</p><p>What kind of magic is this methods thing?
Well actually it&rsquo;s barely any magic at all.
Methods just returns a procedure that dispatches on the first argument,
a symbol, to one of several procedures.
We can even use it outside of an object/actor constructor:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">what-am-i</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">methods</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">i-am</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">i</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">am</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">just</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">procedure</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">that</span><span class="hspace">&nbsp;</span><span class="RktSym">what</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">that</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">calls</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">other</span><span class="hspace">&nbsp;</span><span class="RktSym">what</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">what-am-i</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">i-am</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(i am just a procedure)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">what-am-i</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">that</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">procedures</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(that calls other procedures)</span></p></td></tr></table></blockquote><p>We could have just as well written methods-friend like so:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^match-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match-lambda%252A%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match-lambda*</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Greet</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">user</span><span class="hspace">&nbsp;</span><span class="RktCmt">using</span><span class="hspace">&nbsp;</span><span class="RktCmt">their</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">greet</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a!"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">return</span><span class="hspace">&nbsp;</span><span class="RktCmt">what</span><span class="hspace">&nbsp;</span><span class="RktCmt">our</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>But it&rsquo;s a lot nicer to use <span class="RktSym">methods</span>.
But the key thing to realize is that <span class="RktSym">methods</span> just itself returns
another procedure.</p><p>Maybe we&rsquo;d like to keep track of how many times our friend has been
called.
It might be helpful to have some kind of helper object which can do
that.
What if we made a counter?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^counter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">0</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">methods</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">return</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">current</span><span class="hspace">&nbsp;</span><span class="RktCmt">count</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Add</span><span class="hspace">&nbsp;</span><span class="RktCmt">one</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">current</span><span class="hspace">&nbsp;</span><span class="RktCmt">counter</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^counter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Now let&rsquo;s spawn and poke at an instance of that counter a bit:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-counter</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">^counter</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-counter</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">count</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">0</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-counter</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-counter</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">count</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">1</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-counter</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-counter</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-counter</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">count</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">3</span></p></td></tr></table></blockquote><p>Now note that our counter actually appears to change... how does this
happen?
Let&rsquo;s look at the body of that add1 method in detail:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^counter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span class="RktSym">bcom</span> (pronounced "be-come" or "be-comm") is the capability to
<span class="RktSym">become</span> a new version of ourselves; more explicitly, to give a
procedure which will be called the <span class="emph">next time</span> this object is
invoked.
<span class="RktSym">next</span> returns some methods wrapped up in a closure which knows
what the count is; we&rsquo;re incrementing that by one from whatever we
currently have.
(Depending on how experienced you are with functional programming is
how confusing this is likely to be.)</p><p>There are multiple equivalent ways we could build the "next" procedure
we are becoming for ourselves, and one is to build an actual <span class="RktSym">next</span>
builder and instantiate it once.
This technique is exactly equivalent to the above, and we will use this
kind of structure later, so it&rsquo;s worth seeing and realizing it&rsquo;s more
or less the same (except that we didn&rsquo;t expose the choice of an initial
count value):</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^counter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">next</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">methods</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">return</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">current</span><span class="hspace">&nbsp;</span><span class="RktCmt">count</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Add</span><span class="hspace">&nbsp;</span><span class="RktCmt">one</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">current</span><span class="hspace">&nbsp;</span><span class="RktCmt">counter</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Become</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">next</span><span class="hspace">&nbsp;</span><span class="RktCmt">version</span><span class="hspace">&nbsp;</span><span class="RktCmt">of</span><span class="hspace">&nbsp;</span><span class="RktCmt">ourselves,</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">with</span><span class="hspace">&nbsp;</span><span class="RktCmt">count</span><span class="hspace">&nbsp;</span><span class="RktCmt">incremented</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">next</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">We'll</span><span class="hspace">&nbsp;</span><span class="RktCmt">start</span><span class="hspace">&nbsp;</span><span class="RktCmt">at</span><span class="hspace">&nbsp;</span><span class="RktCmt">0.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">next</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Now that we have this counter, we can rewrite our friend to spawn it
and use it:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^counter-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-counter</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^counter</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">methods</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Greet</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">user</span><span class="hspace">&nbsp;</span><span class="RktCmt">using</span><span class="hspace">&nbsp;</span><span class="RktCmt">their</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">greet</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Increment</span><span class="hspace">&nbsp;</span><span class="RktCmt">count</span><span class="hspace">&nbsp;</span><span class="RktCmt">by</span><span class="hspace">&nbsp;</span><span class="RktCmt">one,</span><span class="hspace">&nbsp;</span><span class="RktCmt">since</span><span class="hspace">&nbsp;</span><span class="RktCmt">we</span><span class="hspace">&nbsp;</span><span class="RktCmt">were</span><span class="hspace">&nbsp;</span><span class="RktCmt">just</span><span class="hspace">&nbsp;</span><span class="RktCmt">called.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">The</span><span class="hspace">&nbsp;</span><span class="RktCmt">counter</span><span class="hspace">&nbsp;</span><span class="RktCmt">starts</span><span class="hspace">&nbsp;</span><span class="RktCmt">at</span><span class="hspace">&nbsp;</span><span class="RktCmt">0</span><span class="hspace">&nbsp;</span><span class="RktCmt">so</span><span class="hspace">&nbsp;</span><span class="RktCmt">this</span><span class="hspace">&nbsp;</span><span class="RktCmt">will</span><span class="hspace">&nbsp;</span><span class="RktCmt">be</span><span class="hspace">&nbsp;</span><span class="RktCmt">correct.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-counter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-counter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">I've</span><span class="hspace">&nbsp;</span><span class="RktVal">greeted</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">times!"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">return</span><span class="hspace">&nbsp;</span><span class="RktCmt">what</span><span class="hspace">&nbsp;</span><span class="RktCmt">our</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">check</span><span class="hspace">&nbsp;</span><span class="RktCmt">how</span><span class="hspace">&nbsp;</span><span class="RktCmt">many</span><span class="hspace">&nbsp;</span><span class="RktCmt">times</span><span class="hspace">&nbsp;</span><span class="RktCmt">we've</span><span class="hspace">&nbsp;</span><span class="RktCmt">greeted,</span><span class="hspace">&nbsp;</span><span class="RktCmt">without</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">incrementing</span><span class="hspace">&nbsp;</span><span class="RktCmt">it</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-counter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>You&rsquo;ll observe that there was no need to go through the vat here, our
object was able to use <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span> and <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span> (which is
pronounced "call", "immediate call", or "money call") directly.
That&rsquo;s because our actor is operating within a goblins context, so
there&rsquo;s no reason to do so by bootstrapping through the vat (indeed,
trying to do so would cause an exception to be raised).</p><p>Now let&rsquo;s give it a try:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice3</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">^counter-friend</span><span class="hspace">&nbsp;</span><span class="RktVal">"Alice"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice3</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Chris"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Hello Chris, my name is Alice and I've greeted 1 times!"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice3</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Chris"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Hello Chris, my name is Alice and I've greeted 2 times!"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice3</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet-count</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">2</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice3</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Chris"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Hello Chris, my name is Alice and I've greeted 3 times!"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice3</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet-count</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">3</span></p></td></tr></table></blockquote><p>Perhaps we&rsquo;d like to have our friend remember the last person she
was called by.
It would be nice if there were something along the lines of a mutable
variable we could change.
In fact there is, and it&rsquo;s called a cell.
When called with no arguments, a cell returns its current value.
When called with one argument, a cell replaces its current value with
the one we have provided:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">goblins/actor-lib/cell</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">treasure-chest</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">^cell</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">gold</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">treasure-chest</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'gold</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">treasure-chest</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">flaming-sword</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">treasure-chest</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'flaming-sword</span></p></td></tr></table></blockquote><p>A fun exercise is to try to write your own cell.
Here is one way:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Constructor</span><span class="hspace">&nbsp;</span><span class="RktCmt">for</span><span class="hspace">&nbsp;</span><span class="RktCmt">a</span><span class="hspace">&nbsp;</span><span class="RktCmt">cell.</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">Takes</span><span class="hspace">&nbsp;</span><span class="RktCmt">an</span><span class="hspace">&nbsp;</span><span class="RktCmt">optional</span><span class="hspace">&nbsp;</span><span class="RktCmt">initial</span><span class="hspace">&nbsp;</span><span class="RktCmt">value,</span><span class="hspace">&nbsp;</span><span class="RktCmt">defaults</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">false.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^our-cell</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktSym">val</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._case-lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">case-lambda</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Called</span><span class="hspace">&nbsp;</span><span class="RktCmt">with</span><span class="hspace">&nbsp;</span><span class="RktCmt">no</span><span class="hspace">&nbsp;</span><span class="RktCmt">arguments;</span><span class="hspace">&nbsp;</span><span class="RktCmt">return</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">current</span><span class="hspace">&nbsp;</span><span class="RktCmt">value</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">val</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Called</span><span class="hspace">&nbsp;</span><span class="RktCmt">with</span><span class="hspace">&nbsp;</span><span class="RktCmt">one</span><span class="hspace">&nbsp;</span><span class="RktCmt">argument,</span><span class="hspace">&nbsp;</span><span class="RktCmt">we</span><span class="hspace">&nbsp;</span><span class="RktCmt">become</span><span class="hspace">&nbsp;</span><span class="RktCmt">a</span><span class="hspace">&nbsp;</span><span class="RktCmt">version</span><span class="hspace">&nbsp;</span><span class="RktCmt">of</span><span class="hspace">&nbsp;</span><span class="RktCmt">ourselves</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">with</span><span class="hspace">&nbsp;</span><span class="RktCmt">this</span><span class="hspace">&nbsp;</span><span class="RktCmt">new</span><span class="hspace">&nbsp;</span><span class="RktCmt">value</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">new-val</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^our-cell</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">new-val</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Of course, you could also have a cell that instead has <span class="RktSym">&rsquo;get</span> and
<span class="RktSym">&rsquo;set</span> methods.
This is left as an exercise for the reader.</p><p>Now that we have cells, we can use them:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^memory-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-counter</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^counter</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">recent-friend</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">^cell</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">methods</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Greet</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">user</span><span class="hspace">&nbsp;</span><span class="RktCmt">using</span><span class="hspace">&nbsp;</span><span class="RktCmt">their</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">greet</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Increment</span><span class="hspace">&nbsp;</span><span class="RktCmt">count</span><span class="hspace">&nbsp;</span><span class="RktCmt">by</span><span class="hspace">&nbsp;</span><span class="RktCmt">one,</span><span class="hspace">&nbsp;</span><span class="RktCmt">since</span><span class="hspace">&nbsp;</span><span class="RktCmt">we</span><span class="hspace">&nbsp;</span><span class="RktCmt">were</span><span class="hspace">&nbsp;</span><span class="RktCmt">just</span><span class="hspace">&nbsp;</span><span class="RktCmt">called.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">The</span><span class="hspace">&nbsp;</span><span class="RktCmt">counter</span><span class="hspace">&nbsp;</span><span class="RktCmt">starts</span><span class="hspace">&nbsp;</span><span class="RktCmt">at</span><span class="hspace">&nbsp;</span><span class="RktCmt">0</span><span class="hspace">&nbsp;</span><span class="RktCmt">so</span><span class="hspace">&nbsp;</span><span class="RktCmt">this</span><span class="hspace">&nbsp;</span><span class="RktCmt">will</span><span class="hspace">&nbsp;</span><span class="RktCmt">be</span><span class="hspace">&nbsp;</span><span class="RktCmt">correct.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-counter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-counter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Who</span><span class="hspace">&nbsp;</span><span class="RktCmt">our</span><span class="hspace">&nbsp;</span><span class="RktCmt">friend</span><span class="hspace">&nbsp;</span><span class="RktCmt">was</span><span class="hspace">&nbsp;</span><span class="RktCmt">last</span><span class="hspace">&nbsp;</span><span class="RktCmt">time</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">recent-friend</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">But</span><span class="hspace">&nbsp;</span><span class="RktCmt">now</span><span class="hspace">&nbsp;</span><span class="RktCmt">let's</span><span class="hspace">&nbsp;</span><span class="RktCmt">set</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">recent</span><span class="hspace">&nbsp;</span><span class="RktCmt">friend</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">be</span><span class="hspace">&nbsp;</span><span class="RktCmt">this</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">recent-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">I've</span><span class="hspace">&nbsp;</span><span class="RktVal">greeted</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">times</span><span class="hspace">&nbsp;</span><span class="RktVal">(last</span><span class="hspace">&nbsp;</span><span class="RktVal">by</span><span class="hspace">&nbsp;</span><span class="RktVal">~a)!"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">I've</span><span class="hspace">&nbsp;</span><span class="RktVal">greeted</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">times!"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">return</span><span class="hspace">&nbsp;</span><span class="RktCmt">what</span><span class="hspace">&nbsp;</span><span class="RktCmt">our</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">check</span><span class="hspace">&nbsp;</span><span class="RktCmt">how</span><span class="hspace">&nbsp;</span><span class="RktCmt">many</span><span class="hspace">&nbsp;</span><span class="RktCmt">times</span><span class="hspace">&nbsp;</span><span class="RktCmt">we've</span><span class="hspace">&nbsp;</span><span class="RktCmt">greeted,</span><span class="hspace">&nbsp;</span><span class="RktCmt">without</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">incrementing</span><span class="hspace">&nbsp;</span><span class="RktCmt">it</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-counter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Let&rsquo;s try interacting with this friend:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice4</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">^memory-friend</span><span class="hspace">&nbsp;</span><span class="RktVal">"Alice"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice4</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Chris"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Hello Chris, my name is Alice and I've greeted 1 times!"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice4</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Carl"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Hello Carl, my name is Alice and I've greeted 2 times (last by Chris)!"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice4</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Carol"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Hello Carol, my name is Alice and I've greeted 3 times (last by Carl)!"</span></p></td></tr></table></blockquote><p>Whew... if we look at that code for the <span class="RktSym">greet</span> code, it sure looks
fairly imperative, though.
We pulled out the value from <span class="RktSym">recent-friend</span> before we changed it.</p><p>If we had accidentlaly put the definition for <span class="RktSym">last-friend-name</span>
after setting <span class="RktSym">recent-friend</span> to <span class="RktSym">your-name</span>, we might have
resulted in a classic imperative error and <span class="RktSym">last-friend-name</span> would
be set to the new one instead of the old one!</p><p>Well, it turns out that <span class="RktSym">bcom</span> can take a second argument which
provides a value it would like to return in addition to specifying the
new version of itself it would like to become.
This means that we could rewrite <span class="RktSym">^memory-friend</span> like so with no
behavioral differences:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^memory-friend2</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">next</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">methods</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Greet</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">user</span><span class="hspace">&nbsp;</span><span class="RktCmt">using</span><span class="hspace">&nbsp;</span><span class="RktCmt">their</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">greet</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greeting</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">I've</span><span class="hspace">&nbsp;</span><span class="RktVal">greeted</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">times</span><span class="hspace">&nbsp;</span><span class="RktVal">(last</span><span class="hspace">&nbsp;</span><span class="RktVal">by</span><span class="hspace">&nbsp;</span><span class="RktVal">~a)!"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">I've</span><span class="hspace">&nbsp;</span><span class="RktVal">greeted</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">times!"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">next</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greeting</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">return</span><span class="hspace">&nbsp;</span><span class="RktCmt">what</span><span class="hspace">&nbsp;</span><span class="RktCmt">our</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">check</span><span class="hspace">&nbsp;</span><span class="RktCmt">how</span><span class="hspace">&nbsp;</span><span class="RktCmt">many</span><span class="hspace">&nbsp;</span><span class="RktCmt">times</span><span class="hspace">&nbsp;</span><span class="RktCmt">we've</span><span class="hspace">&nbsp;</span><span class="RktCmt">greeted,</span><span class="hspace">&nbsp;</span><span class="RktCmt">without</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">incrementing</span><span class="hspace">&nbsp;</span><span class="RktCmt">it</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">next</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice5</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">^memory-friend2</span><span class="hspace">&nbsp;</span><span class="RktVal">"Alice"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice5</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Chris"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Hello Chris, my name is Alice and I've greeted 1 times!"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice5</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Carl"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Hello Carl, my name is Alice and I've greeted 2 times (last by Chris)!"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice5</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Carol"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Hello Carol, my name is Alice and I've greeted 3 times (last by Carl)!"</span></p></td></tr></table></blockquote><p>This certainly looks more functional, and we have some freedom of how
we&rsquo;d like to implement it.
It also leads to the observation that the behavior of objects in
respect to updating themselves appears to be very functional (returning
a new version of ourselves and maybe a value), whereas calling other
objects appears to be very imperative.
So what is the point of cells and counters?  After all, if we&rsquo;re using
<span class="RktSym">#lang racket</span> we have access to the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=set_.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._set%2521%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">set!</a></span>  procedure, and
could have easily rewritten the <span class="RktSym">^counter</span> and <span class="RktSym">^cell</span> versions
like so:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^imperative-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">recent-friend</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">methods</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Greet</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">user</span><span class="hspace">&nbsp;</span><span class="RktCmt">using</span><span class="hspace">&nbsp;</span><span class="RktCmt">their</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">greet</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Increment</span><span class="hspace">&nbsp;</span><span class="RktCmt">count</span><span class="hspace">&nbsp;</span><span class="RktCmt">by</span><span class="hspace">&nbsp;</span><span class="RktCmt">one,</span><span class="hspace">&nbsp;</span><span class="RktCmt">since</span><span class="hspace">&nbsp;</span><span class="RktCmt">we</span><span class="hspace">&nbsp;</span><span class="RktCmt">were</span><span class="hspace">&nbsp;</span><span class="RktCmt">just</span><span class="hspace">&nbsp;</span><span class="RktCmt">called.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">The</span><span class="hspace">&nbsp;</span><span class="RktCmt">counter</span><span class="hspace">&nbsp;</span><span class="RktCmt">starts</span><span class="hspace">&nbsp;</span><span class="RktCmt">at</span><span class="hspace">&nbsp;</span><span class="RktCmt">0</span><span class="hspace">&nbsp;</span><span class="RktCmt">so</span><span class="hspace">&nbsp;</span><span class="RktCmt">this</span><span class="hspace">&nbsp;</span><span class="RktCmt">will</span><span class="hspace">&nbsp;</span><span class="RktCmt">be</span><span class="hspace">&nbsp;</span><span class="RktCmt">correct.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=set_.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._set%2521%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">set!</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Who</span><span class="hspace">&nbsp;</span><span class="RktCmt">our</span><span class="hspace">&nbsp;</span><span class="RktCmt">friend</span><span class="hspace">&nbsp;</span><span class="RktCmt">was</span><span class="hspace">&nbsp;</span><span class="RktCmt">last</span><span class="hspace">&nbsp;</span><span class="RktCmt">time</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">recent-friend</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">But</span><span class="hspace">&nbsp;</span><span class="RktCmt">now</span><span class="hspace">&nbsp;</span><span class="RktCmt">let's</span><span class="hspace">&nbsp;</span><span class="RktCmt">set</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">recent</span><span class="hspace">&nbsp;</span><span class="RktCmt">friend</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">be</span><span class="hspace">&nbsp;</span><span class="RktCmt">this</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=set_.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._set%2521%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">set!</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">recent-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">I've</span><span class="hspace">&nbsp;</span><span class="RktVal">greeted</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">times</span><span class="hspace">&nbsp;</span><span class="RktVal">(last</span><span class="hspace">&nbsp;</span><span class="RktVal">by</span><span class="hspace">&nbsp;</span><span class="RktVal">~a)!"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">I've</span><span class="hspace">&nbsp;</span><span class="RktVal">greeted</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">times!"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">return</span><span class="hspace">&nbsp;</span><span class="RktCmt">what</span><span class="hspace">&nbsp;</span><span class="RktCmt">our</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">check</span><span class="hspace">&nbsp;</span><span class="RktCmt">how</span><span class="hspace">&nbsp;</span><span class="RktCmt">many</span><span class="hspace">&nbsp;</span><span class="RktCmt">times</span><span class="hspace">&nbsp;</span><span class="RktCmt">we've</span><span class="hspace">&nbsp;</span><span class="RktCmt">greeted,</span><span class="hspace">&nbsp;</span><span class="RktCmt">without</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">incrementing</span><span class="hspace">&nbsp;</span><span class="RktCmt">it</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">recent-friend</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">recent-friend</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Usage is exactly the ssame:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice6</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">^imperative-friend</span><span class="hspace">&nbsp;</span><span class="RktVal">"Alice"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice6</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Chris"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Hello Chris, my name is Alice and I've greeted 1 times!"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice6</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Carl"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Hello Carl, my name is Alice and I've greeted 2 times (last by Chris)!"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice6</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Carol"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Hello Carol, my name is Alice and I've greeted 3 times (last by Carl)!"</span></p></td></tr></table></blockquote><p>This code looks mostly the same too, and indeed maybe even a little
simpler with <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=set_.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._set%2521%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">set!</a></span> (no mucking around with that <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span>
malarky).</p><p>Let&rsquo;s introduce a couple of bugs into both the cell-using and the
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=set_.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._set%2521%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">set!</a></span> using imperative versions of these friends (we&rsquo;ll cheat
and introduce them by simply raising them as exceptions with
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._error%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">error</a></span>):</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^buggy-memory-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-counter</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^counter</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">recent-friend</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">^cell</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">methods</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Greet</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">user</span><span class="hspace">&nbsp;</span><span class="RktCmt">using</span><span class="hspace">&nbsp;</span><span class="RktCmt">their</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">greet</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Increment</span><span class="hspace">&nbsp;</span><span class="RktCmt">count</span><span class="hspace">&nbsp;</span><span class="RktCmt">by</span><span class="hspace">&nbsp;</span><span class="RktCmt">one,</span><span class="hspace">&nbsp;</span><span class="RktCmt">since</span><span class="hspace">&nbsp;</span><span class="RktCmt">we</span><span class="hspace">&nbsp;</span><span class="RktCmt">were</span><span class="hspace">&nbsp;</span><span class="RktCmt">just</span><span class="hspace">&nbsp;</span><span class="RktCmt">called.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">The</span><span class="hspace">&nbsp;</span><span class="RktCmt">counter</span><span class="hspace">&nbsp;</span><span class="RktCmt">starts</span><span class="hspace">&nbsp;</span><span class="RktCmt">at</span><span class="hspace">&nbsp;</span><span class="RktCmt">0</span><span class="hspace">&nbsp;</span><span class="RktCmt">so</span><span class="hspace">&nbsp;</span><span class="RktCmt">this</span><span class="hspace">&nbsp;</span><span class="RktCmt">will</span><span class="hspace">&nbsp;</span><span class="RktCmt">be</span><span class="hspace">&nbsp;</span><span class="RktCmt">correct.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-counter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-counter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Who</span><span class="hspace">&nbsp;</span><span class="RktCmt">our</span><span class="hspace">&nbsp;</span><span class="RktCmt">friend</span><span class="hspace">&nbsp;</span><span class="RktCmt">was</span><span class="hspace">&nbsp;</span><span class="RktCmt">last</span><span class="hspace">&nbsp;</span><span class="RktCmt">time</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">recent-friend</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">But</span><span class="hspace">&nbsp;</span><span class="RktCmt">now</span><span class="hspace">&nbsp;</span><span class="RktCmt">let's</span><span class="hspace">&nbsp;</span><span class="RktCmt">set</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">recent</span><span class="hspace">&nbsp;</span><span class="RktCmt">friend</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">be</span><span class="hspace">&nbsp;</span><span class="RktCmt">this</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">recent-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._error%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">error</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"AHH!</span><span class="hspace">&nbsp;</span><span class="RktVal">Throwing</span><span class="hspace">&nbsp;</span><span class="RktVal">an</span><span class="hspace">&nbsp;</span><span class="RktVal">error</span><span class="hspace">&nbsp;</span><span class="RktVal">after</span><span class="hspace">&nbsp;</span><span class="RktVal">I</span><span class="hspace">&nbsp;</span><span class="RktVal">changed</span><span class="hspace">&nbsp;</span><span class="RktVal">things!"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">I've</span><span class="hspace">&nbsp;</span><span class="RktVal">greeted</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">times</span><span class="hspace">&nbsp;</span><span class="RktVal">(last</span><span class="hspace">&nbsp;</span><span class="RktVal">by</span><span class="hspace">&nbsp;</span><span class="RktVal">~a)!"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">I've</span><span class="hspace">&nbsp;</span><span class="RktVal">greeted</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">times!"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">return</span><span class="hspace">&nbsp;</span><span class="RktCmt">what</span><span class="hspace">&nbsp;</span><span class="RktCmt">our</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">check</span><span class="hspace">&nbsp;</span><span class="RktCmt">how</span><span class="hspace">&nbsp;</span><span class="RktCmt">many</span><span class="hspace">&nbsp;</span><span class="RktCmt">times</span><span class="hspace">&nbsp;</span><span class="RktCmt">we've</span><span class="hspace">&nbsp;</span><span class="RktCmt">greeted,</span><span class="hspace">&nbsp;</span><span class="RktCmt">without</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">incrementing</span><span class="hspace">&nbsp;</span><span class="RktCmt">it</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-counter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._count%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">count</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^buggy-imperative-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">recent-friend</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">methods</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Greet</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">user</span><span class="hspace">&nbsp;</span><span class="RktCmt">using</span><span class="hspace">&nbsp;</span><span class="RktCmt">their</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">greet</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Increment</span><span class="hspace">&nbsp;</span><span class="RktCmt">count</span><span class="hspace">&nbsp;</span><span class="RktCmt">by</span><span class="hspace">&nbsp;</span><span class="RktCmt">one,</span><span class="hspace">&nbsp;</span><span class="RktCmt">since</span><span class="hspace">&nbsp;</span><span class="RktCmt">we</span><span class="hspace">&nbsp;</span><span class="RktCmt">were</span><span class="hspace">&nbsp;</span><span class="RktCmt">just</span><span class="hspace">&nbsp;</span><span class="RktCmt">called.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">The</span><span class="hspace">&nbsp;</span><span class="RktCmt">counter</span><span class="hspace">&nbsp;</span><span class="RktCmt">starts</span><span class="hspace">&nbsp;</span><span class="RktCmt">at</span><span class="hspace">&nbsp;</span><span class="RktCmt">0</span><span class="hspace">&nbsp;</span><span class="RktCmt">so</span><span class="hspace">&nbsp;</span><span class="RktCmt">this</span><span class="hspace">&nbsp;</span><span class="RktCmt">will</span><span class="hspace">&nbsp;</span><span class="RktCmt">be</span><span class="hspace">&nbsp;</span><span class="RktCmt">correct.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=set_.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._set%2521%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">set!</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Who</span><span class="hspace">&nbsp;</span><span class="RktCmt">our</span><span class="hspace">&nbsp;</span><span class="RktCmt">friend</span><span class="hspace">&nbsp;</span><span class="RktCmt">was</span><span class="hspace">&nbsp;</span><span class="RktCmt">last</span><span class="hspace">&nbsp;</span><span class="RktCmt">time</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">recent-friend</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">But</span><span class="hspace">&nbsp;</span><span class="RktCmt">now</span><span class="hspace">&nbsp;</span><span class="RktCmt">let's</span><span class="hspace">&nbsp;</span><span class="RktCmt">set</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">recent</span><span class="hspace">&nbsp;</span><span class="RktCmt">friend</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">be</span><span class="hspace">&nbsp;</span><span class="RktCmt">this</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=set_.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._set%2521%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">set!</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">recent-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._error%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">error</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"AHH!</span><span class="hspace">&nbsp;</span><span class="RktVal">Throwing</span><span class="hspace">&nbsp;</span><span class="RktVal">an</span><span class="hspace">&nbsp;</span><span class="RktVal">error</span><span class="hspace">&nbsp;</span><span class="RktVal">after</span><span class="hspace">&nbsp;</span><span class="RktVal">I</span><span class="hspace">&nbsp;</span><span class="RktVal">changed</span><span class="hspace">&nbsp;</span><span class="RktVal">things!"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">I've</span><span class="hspace">&nbsp;</span><span class="RktVal">greeted</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">times</span><span class="hspace">&nbsp;</span><span class="RktVal">(last</span><span class="hspace">&nbsp;</span><span class="RktVal">by</span><span class="hspace">&nbsp;</span><span class="RktVal">~a)!"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">last-friend-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">I've</span><span class="hspace">&nbsp;</span><span class="RktVal">greeted</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">times!"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">return</span><span class="hspace">&nbsp;</span><span class="RktCmt">what</span><span class="hspace">&nbsp;</span><span class="RktCmt">our</span><span class="hspace">&nbsp;</span><span class="RktCmt">name</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">check</span><span class="hspace">&nbsp;</span><span class="RktCmt">how</span><span class="hspace">&nbsp;</span><span class="RktCmt">many</span><span class="hspace">&nbsp;</span><span class="RktCmt">times</span><span class="hspace">&nbsp;</span><span class="RktCmt">we've</span><span class="hspace">&nbsp;</span><span class="RktCmt">greeted,</span><span class="hspace">&nbsp;</span><span class="RktCmt">without</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">incrementing</span><span class="hspace">&nbsp;</span><span class="RktCmt">it</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">greet-count</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">greet-count</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">buggy-gobliny-alice</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^buggy-memory-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Alice"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">buggy-imperative-alice</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^buggy-imperative-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Alice"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>(Observe the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._error%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">error</a></span> put after both of them changed
<span class="RktSym">greet-count</span> and <span class="RktSym">recent-friend</span>.)</p><p>Okay, first let&rsquo;s check the initial <span class="RktSym">greet-count</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buggy-gobliny-alice</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet-count</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">0</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buggy-imperative-alice</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet-count</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">0</span></p></td></tr></table></blockquote><p>So far, so good.
Now let&rsquo;s greet both of them:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buggy-gobliny-alice</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Chris"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">AHH! Throwing an error after I changed things!</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buggy-imperative-alice</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Chris"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">AHH! Throwing an error after I changed things!</span></p></td></tr></table></blockquote><p>Okay, so both of them threw the error.
But what do you think the result of =greet-count= will be now?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buggy-gobliny-alice</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet-count</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">0</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buggy-imperative-alice</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet-count</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">1</span></p></td></tr></table></blockquote><p>Now this is definitely different!
In the goblin&rsquo;y example, by using goblin objects/actors, unhandled
errors means that breakage is as if nothing ever occurred.
We can log the error, but we won&rsquo;t mess up the rest of the system.
With the imperative code which uses =set!=, the state of our system
could become unintentionally corrupted and inconsistent.</p><p>This is what we mean by Goblins being transactional: something that
goes wrong need not be "committed" to the current state.
This is important for systems like financial infrastructure.
It turns out it also opens us up, in general, to becoming
<a href="https://dustycloud.org/blog/goblins-time-travel-micropreview/"></a>
     {time wizards}.
But more on that later.</p><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Message_passing__promises__and_multiple_vats&quot;">2.3<tt>&nbsp;</tt><a name="(part._.Message_passing__promises__and_multiple_vats)"></a>Message passing, promises, and multiple vats</h4><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;The_basics&quot;">2.3.1<tt>&nbsp;</tt><a name="(part._.The_basics)"></a>The basics</h5><p>Remember simpler times, when friends mostly just greeted us hello?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a!"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alice</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Alice"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>We could of course make another friend that talks to Alice.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^calls-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">our-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">friend</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">what-my-friend-said</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">our-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"&lt;~a&gt;:</span><span class="hspace">&nbsp;</span><span class="RktVal">I</span><span class="hspace">&nbsp;</span><span class="RktVal">called</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">friend,</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">they</span><span class="hspace">&nbsp;</span><span class="RktVal">said:"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">our-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">\"~a\""</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">what-my-friend-said</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">archie</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^calls-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Archie"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Now Archie can talk to Alice:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">archie</span><span class="hspace">&nbsp;</span><span class="RktSym">alice</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">&lt;Archie&gt;: I called my friend, and they said:</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">"Hello Archie, my name is Alice!"</span></p></td></tr></table></td></tr></table></blockquote><p>Both Alice and Archie live in <span class="RktSym">a-vat</span>.
But <span class="RktSym">a-vat</span> isn&rsquo;t the only vat in town.  One other such vat
is <span class="RktSym">b-vat</span>, where Bob lives:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">b-vat</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._make-vat%29%29" class="RktValLink" data-pltdoc="x">make-vat</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">For</span><span class="hspace">&nbsp;</span><span class="RktCmt">convenience</span><span class="hspace">&nbsp;</span><span class="RktCmt">we'll</span><span class="hspace">&nbsp;</span><span class="RktCmt">make</span><span class="hspace">&nbsp;</span><span class="RktCmt">a</span><span class="hspace">&nbsp;</span><span class="RktCmt">bootstrapping</span><span class="hspace">&nbsp;</span><span class="RktCmt">b-run</span><span class="hspace">&nbsp;</span><span class="RktCmt">too</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define-vat-run</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">b-run</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">b-vat</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bob</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">b-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^calls-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Bob"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Obviously, since Bob is in <span class="RktSym">b-vat</span>, we bootstrap a message call to
Bob from <span class="RktSym">b-vat</span>.
But what do you think happens when Bob tries to call Alice?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">b-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">bob</span><span class="hspace">&nbsp;</span><span class="RktSym">alice</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">not-callable: Not in the same vat: #&lt;local-object ^friend&gt;</span></p></td></tr></table></blockquote><p>Oh no!
It looks like Bob can&rsquo;t call Alice since they live in different
places!
From Archie&rsquo;s perspective, Alice was "near", aka "in the same vat".
However from Bob&rsquo;s perspective Alice was "far", aka "in some other
vat that isn&rsquo;t the one I&rsquo;m in".
This is a problem because using the <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span> operator performs a
<span class="emph">synchronous</span> call, but it&rsquo;s only safe to do synchronous calls for
objects that are near each other (in the same vat).</p><p>Fortunately there&rsquo;s something we can do: we can send a message from
Bob to Alice.
But we&rsquo;ve never seen message sending in Goblins before, so what is that?</p><p>To prototype this, let&rsquo;s use the <span class="RktSym">&rsquo;run</span> method on <span class="RktSym">b-vat</span>.
Remember, we saw the <span class="RktSym">&rsquo;run</span> method used before, where it looked like:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alyssa</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">^friend</span><span class="hspace">&nbsp;</span><span class="RktVal">"Alyssa"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alyssa</span><span class="hspace">&nbsp;</span><span class="RktVal">"Ben"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">"Hello Ben, my name is Alyssa!"</span></p></td></tr></table></blockquote><p>So <span class="RktSym">&rsquo;run</span> is just a way to run some arbitrary code in an actor context.
That sounds good enough for playing around with sending messages.
We can send messages with <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span> so let&rsquo;s try that:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">b-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice</span><span class="hspace">&nbsp;</span><span class="RktVal">"Brenda"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#&lt;local-promise&gt;</span></p></td></tr></table></blockquote><p>Ah ok... so what <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span> returns is something called a "Promise" which
might eventually be resolved to something interesting.
We want some way to be able to pull out that interesting thing.
That&rsquo;s what <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span> is for: it resolves promises and pulls out their
resolved value:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">b-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice</span><span class="hspace">&nbsp;</span><span class="RktVal">"Brenda"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alice-says</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Got from Alice: ~a"</span><span class="hspace">&nbsp;</span><span class="RktSym">alice-says</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">Got from Alice: Hello Brenda, my name is Alice!</span></p></td></tr></table></blockquote><p><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span> works just fine with far references, but it also works
just fine with near references too!
So we can run the same code in a-vat (where Alice is "near") and it
works there too:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alice</span><span class="hspace">&nbsp;</span><span class="RktVal">"Arthur"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alice-says</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Got from Alice: ~a"</span><span class="hspace">&nbsp;</span><span class="RktSym">alice-says</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">Got from Alice: Hello Arthur, my name is Alice!</span></p></td></tr></table></blockquote><p>So using <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span> and <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span> seems to fit our needs.
But what would have happened if Alice had thrown an error?
Indeed, if we remember earlier we made <span class="RktSym">buggy-gobliny-alice</span>
so we can test for that.
It turns out that on can take a <span class="RktSym">#:catch</span> argument:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">b-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buggy-gobliny-alice</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">greet</span><span class="hspace">&nbsp;</span><span class="RktVal">"Brenda"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alice-says</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Got from Alice: ~a"</span><span class="hspace">&nbsp;</span><span class="RktSym">alice-says</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:catch</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">err</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Tried to talk to Alice, got an error :("</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">;;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">#(struct:message #&lt;local-object ^buggy-memory-friend&gt; #&lt;local-object ^resolver&gt; () () (greet "Brenda"))</span></p></td></tr><tr><td><p><span class="RktOut">Tried to talk to Alice, got an error :(</span></p></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktErr">;; === While attempting to handle message: ===</span></p></td></tr><tr><td><p><span class="RktErr">AHH! Throwing an error after I changed things!</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">context...:</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:995:5</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1240:6</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1749:3</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:925:0: call-with-fresh-syscaller</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/vat.rkt:140:9</span></p></td></tr></table></td></tr></table></blockquote><p>Now this is a little bit confusing to read because we saw two separate
messages here... it&rsquo;s important to realize that due to the way our vat
is configured, the exception backtrace being printed out is coming
from <span class="RktSym">a-vat</span>, not from our code being evaluated in <span class="RktSym">b-vat</span>.
We could configure the <span class="RktSym">a-vat</span> loop to do something different when it
hits errors, but currently it prints exceptions so we can debug them.
Anyway, so that&rsquo;s helpful information, but actually the place we caught
the error in <span class="emph">our</span> code above was in the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span> right
after <span class="RktSym">#:catch</span>.
As we can see, it did catch the error and we used that as an opportunity
to print out a complaint.</p><p>So <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span> makes a promise for us.
We don&rsquo;t always need a promise; sometimes we&rsquo;re just calling something
for its effects.
For instance we might have a parrot that we like to encourage to say
silly things, maybe on the screen or even out loud, but we don&rsquo;t care
much about the result.
In that case we can use <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-np%29%29" class="RktValLink" data-pltdoc="x">&lt;-np</a></span> which sends a message but with
"no promise":</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">parrot</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bcom</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">phrase</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Since we're using displayln, we're printing this phrase</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">rather than returning it as a string</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"&lt;parrot&gt;: ~a... *SQWAK!*"</span><span class="hspace">&nbsp;</span><span class="RktSym">phrase</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">b-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-np%29%29" class="RktValLink" data-pltdoc="x">&lt;-np</a></span><span class="hspace">&nbsp;</span><span class="RktSym">parrot</span><span class="hspace">&nbsp;</span><span class="RktVal">"Polly wants a chiptune"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">&lt;parrot&gt;: Polly wants a chiptune... *SQWAK!*</span></p></td></tr></table></blockquote><p>When we don&rsquo;t need a promise, <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-np%29%29" class="RktValLink" data-pltdoc="x">&lt;-np</a></span> is an optimization that saves us
from some promise overhead.
But in most of our code, <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span> performs the more common case
of returning a promise.</p><p>Anyway, we should have enough information to make a better constructor
for friends who are far away.
Recall our definition of <span class="RktSym">^calls-friend</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^calls-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">our-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">friend</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">what-my-friend-said</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">our-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"&lt;~a&gt;:</span><span class="hspace">&nbsp;</span><span class="RktVal">I</span><span class="hspace">&nbsp;</span><span class="RktVal">called</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">friend,</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">they</span><span class="hspace">&nbsp;</span><span class="RktVal">said:"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">our-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">\"~a\""</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">what-my-friend-said</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>.. we&rsquo;ll make a few changes and name our constructor =^messages-friend=:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^messages-friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">our-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">friend</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">our-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">what-my-friend-said</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"&lt;~a&gt;:</span><span class="hspace">&nbsp;</span><span class="RktVal">I</span><span class="hspace">&nbsp;</span><span class="RktVal">messaged</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">friend,</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">they</span><span class="hspace">&nbsp;</span><span class="RktVal">said:"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">our-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">\"~a\""</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">what-my-friend-said</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">#:catch</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">err</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"I</span><span class="hspace">&nbsp;</span><span class="RktVal">messaged</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">friend</span><span class="hspace">&nbsp;</span><span class="RktVal">but</span><span class="hspace">&nbsp;</span><span class="RktVal">they</span><span class="hspace">&nbsp;</span><span class="RktVal">broke</span><span class="hspace">&nbsp;</span><span class="RktVal">their</span><span class="hspace">&nbsp;</span><span class="RktVal">response</span><span class="hspace">&nbsp;</span><span class="RktVal">promise..."</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>(We even made it a bit more robust than our previous implementation
by handling errors!)</p><p>Now we can make a version of Bob that can do a better job of holding a
conversation with his far-away friend Alice:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">bob2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">b-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">^messages-friend</span><span class="hspace">&nbsp;</span><span class="RktVal">"Bob"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">b-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">bob2</span><span class="hspace">&nbsp;</span><span class="RktSym">alice</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">&lt;Bob&gt;: I messaged my friend, and they said:</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">"Hello Bob, my name is Alice!"</span></p></td></tr></table></td></tr></table></blockquote><p>Much better!</p><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Making_and_resolving_our_own_promises&quot;">2.3.2<tt>&nbsp;</tt><a name="(part._.Making_and_resolving_our_own_promises)"></a>Making and resolving our own promises</h5><p>So we know that <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span> can make promises, but it turns out we can
make promises ourselves:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn-promise-cons%29%29" class="RktValLink" data-pltdoc="x">spawn-promise-cons</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(#&lt;local-promise&gt; . #&lt;local-object ^resolver&gt;)</span></p></td></tr></table></blockquote><p>As we can see, promises come in pairs: the promise object, which we
can listen to with <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span>, and the resolver object, which lets us
fulfill or break a promise.</p><p>We can also use <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn-promise-values%29%29" class="RktValLink" data-pltdoc="x">spawn-promise-values</a></span> to spawn a promise
(TODO: add footnote about why we didn&rsquo;t earlier, multiple value return
not being allowed from actors currently), which returns multiple
values (which we can bind with <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._define-values%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-values</a></span>).
We can then try resolving a promise with <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span>... but of course
we&rsquo;ll need to fulfill or break it to see anything.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._define-values%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-values</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">foo-vow</span><span class="hspace">&nbsp;</span><span class="RktSym">foo-resolver</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn-promise-values%29%29" class="RktValLink" data-pltdoc="x">spawn-promise-values</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._define-values%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-values</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bar-vow</span><span class="hspace">&nbsp;</span><span class="RktSym">bar-resolver</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn-promise-values%29%29" class="RktValLink" data-pltdoc="x">spawn-promise-values</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">declare-resolved</span><span class="hspace">&nbsp;</span><span class="RktSym">result</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._printf%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Resolved: ~a\n"</span><span class="hspace">&nbsp;</span><span class="RktSym">result</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">declare-broken</span><span class="hspace">&nbsp;</span><span class="RktSym">err</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._printf%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Broken: ~a\n"</span><span class="hspace">&nbsp;</span><span class="RktSym">err</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktSym">foo-vow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">declare-resolved</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:catch</span><span class="hspace">&nbsp;</span><span class="RktSym">declare-broken</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktSym">bar-vow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">declare-resolved</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:catch</span><span class="hspace">&nbsp;</span><span class="RktSym">declare-broken</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">foo-resolver</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">fulfill</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">yeah-foo</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~24%29%29" class="RktValLink" data-pltdoc="x">$</a></span><span class="hspace">&nbsp;</span><span class="RktSym">bar-resolver</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">break</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">oh-no-bar</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">Resolved: yeah-foo</span></p></td></tr><tr><td><p><span class="RktOut">Broken: oh-no-bar</span></p></td></tr></table></td></tr></table></blockquote><p>By the way, you may notice that there&rsquo;s a naming convention in Goblins
(borrowed from E) to append a <span class="RktSym">-vow</span> suffix if something is a promise
(or should be treated as one).
That&rsquo;s a good practice for you to adopt, too.</p><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Finally_we_have___finally&quot;">2.3.3<tt>&nbsp;</tt><a name="(part._.Finally_we_have___finally)"></a>Finally we have #:finally</h5><p>Maybe we&rsquo;d like to run something once a promise resolves, finally
of whether or not it succeds or fails.
In such a case we can use the <span class="RktSym">#:finally</span> keyword:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">resolves-ok</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bcom</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"This is fine!"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">errors-out</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bcom</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._error%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"I am error!"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">handle-it</span><span class="hspace">&nbsp;</span><span class="RktSym">from-name</span><span class="hspace">&nbsp;</span><span class="RktSym">vow</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Got from ~a: ~a"</span><span class="hspace">&nbsp;</span><span class="RktSym">from-name</span><span class="hspace">&nbsp;</span><span class="RktSym">val</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:catch</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">err</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Error from ~a: ~a"</span><span class="hspace">&nbsp;</span><span class="RktSym">from-name</span><span class="hspace">&nbsp;</span><span class="RktSym">err</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:finally</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Done handling ~a."</span><span class="hspace">&nbsp;</span><span class="RktSym">from-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">handle-it</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">resolves-ok</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">resolves-ok</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">handle-it</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">errors-out</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">errors-out</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">;;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">#(struct:message #&lt;local-object&gt; #&lt;local-object ^resolver&gt; () () ())</span></p></td></tr><tr><td><p><span class="RktOut">Got from resolves-ok: This is fine!</span></p></td></tr><tr><td><p><span class="RktOut">Done handling resolves-ok.</span></p></td></tr><tr><td><p><span class="RktOut">Error from errors-out: #(struct:exn:fail I am error! #&lt;continuation-mark-set&gt;)</span></p></td></tr><tr><td><p><span class="RktOut">Done handling errors-out.</span></p></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktErr">;; === While attempting to handle message: ===</span></p></td></tr><tr><td><p><span class="RktErr">I am error!</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">context...:</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:995:5</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1240:6</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1749:3</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:925:0: call-with-fresh-syscaller</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/vat.rkt:140:9</span></p></td></tr></table></td></tr></table></blockquote><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;The_on-fulfilled_handler_of__on__is_optional&quot;">2.3.4<tt>&nbsp;</tt><a name="(part._.The_on-fulfilled_handler_of__on__is_optional)"></a>The on-fulfilled handler of "on" is optional</h5><p>Maybe all you care about is the <span class="RktSym">#:catch</span> or <span class="RktSym">#:finally</span> clause.
The <span class="RktSym">on-fulfilled</span> argument (ie, the first positional argument) to
<span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span> is actually optional:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">^throws-error</span><span class="hspace">&nbsp;</span><span class="RktSym">bcom</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._error%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"oh no"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">throws-error</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">^throws-error</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">throws-error</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:catch</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">err</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"The error is: ~a"</span><span class="hspace">&nbsp;</span><span class="RktSym">err</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">;;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">#(struct:message #&lt;local-object ^throws-error&gt; #&lt;local-object ^resolver&gt; () () ())</span></p></td></tr><tr><td><p><span class="RktOut">The error is: #(struct:exn:fail oh no #&lt;continuation-mark-set&gt;)</span></p></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktErr">;; === While attempting to handle message: ===</span></p></td></tr><tr><td><p><span class="RktErr">oh no</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">context...:</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:995:5</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1240:6</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1749:3</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:925:0: call-with-fresh-syscaller</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/vat.rkt:140:9</span></p></td></tr></table></td></tr></table></blockquote><p>(Side note, this is the first time we&rsquo;ve seen the procedure definition
style used in <span class="RktSym">^throws-error</span>... it&rsquo;s a way in Racket of making a
procedure that defines a procedure.  Handy in Goblins!  If you&rsquo;re new
to that, these two definitions are equivalent:)</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a!"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">^friend</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hello</span><span class="hspace">&nbsp;</span><span class="RktVal">~a,</span><span class="hspace">&nbsp;</span><span class="RktVal">my</span><span class="hspace">&nbsp;</span><span class="RktVal">name</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">~a!"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">your-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;_on__with_non-promise_values&quot;">2.3.5<tt>&nbsp;</tt><a name="(part.__on__with_non-promise_values)"></a>"on" with non-promise values</h5><p><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span> works just fine if you pass in a non-promise value.
It&rsquo;ll just treat that value as if it were a promise that had
resolved immediately.
For example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">v</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Got: ~a"</span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">Got: 5</span></p></td></tr></table></blockquote><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;_on__can_return_promises_too&quot;">2.3.6<tt>&nbsp;</tt><a name="(part.__on__can_return_promises_too)"></a>"on" can return promises too</h5><p>It turns out that <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span> can also return a promise!
However, this isn&rsquo;t a very common use case, so you have to ask for it
via the <span class="RktSym">#:promise?</span> keyword.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">^bakery</span><span class="hspace">&nbsp;</span><span class="RktSym">bcom</span><span class="hspace">&nbsp;</span><span class="RktSym">name</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">carb</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"~a's signature ~a baking"</span><span class="hspace">&nbsp;</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">carb</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">petite-oven-bakery</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-vat</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">spawn</span><span class="hspace">&nbsp;</span><span class="RktSym">^bakery</span><span class="hspace">&nbsp;</span><span class="RktVal">"The Petite Oven"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">smell-vow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">petite-oven-bakery</span><span class="hspace">&nbsp;</span><span class="RktVal">"croissants"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">what-you-smell</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"You smell ~a.</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">Heavenly!!"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">what-you-smell</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:promise?</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktSym">smell-vow</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">You smell The Petite Oven's signature croissants baking.</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">Heavenly!!</span></p></td></tr></table></blockquote><p>The choice of whether or not to include <span class="RktSym">#:catch</span> in an <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span>
with <span class="RktSym">#:promise?</span> affects whether or how an error will propagate
(or be cleaned up).</p><p>Without catching an error:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">^throws-error</span><span class="hspace">&nbsp;</span><span class="RktSym">bcom</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._error%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"oh no"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">throws-error</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-vat</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">spawn</span><span class="hspace">&nbsp;</span><span class="RktSym">^throws-error</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">throws-error</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"I won't run..."</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:promise?</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:catch</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">e</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Caught: ~a"</span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">;;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">#(struct:message #&lt;local-object ^throws-error&gt; #&lt;local-object ^resolver&gt; () () ())</span></p></td></tr><tr><td><p><span class="RktOut">Caught: #(struct:exn:fail oh no #&lt;continuation-mark-set&gt;)</span></p></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktErr">;; === While attempting to handle message: ===</span></p></td></tr><tr><td><p><span class="RktErr">oh no</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">context...:</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:995:5</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1240:6</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1749:3</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:925:0: call-with-fresh-syscaller</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/vat.rkt:140:9</span></p></td></tr></table></td></tr></table></blockquote><p>However if we catch the error, we can return a value that will succeed
if we like:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">throws-error</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:catch</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">e</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"An error?</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">Psh... this is fine."</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:promise?</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Got: ~a"</span><span class="hspace">&nbsp;</span><span class="RktSym">val</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">;;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">#(struct:message #&lt;local-object ^throws-error&gt; #&lt;local-object ^resolver&gt; () () ())</span></p></td></tr><tr><td><p><span class="RktOut">Got: An error?</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">Psh... this is fine.</span></p></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktErr">;; === While attempting to handle message: ===</span></p></td></tr><tr><td><p><span class="RktErr">oh no</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">context...:</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:995:5</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1240:6</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1749:3</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:925:0: call-with-fresh-syscaller</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/vat.rkt:140:9</span></p></td></tr></table></td></tr></table></blockquote><p>But if our <span class="RktSym">#:catch</span> handler raises an error, that error will
simply propagate (instead of the original one):</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">a-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">throws-error</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:catch</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">e</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._error%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"AAAAH!</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">This is NOT fine!"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:promise?</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:catch</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">e</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Caught: ~a"</span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">;;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">#(struct:message #&lt;local-object ^throws-error&gt; #&lt;local-object ^resolver&gt; () () ())</span></p></td></tr><tr><td><p><span class="RktOut">;;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">#(struct:message #&lt;local-object broken-handler&gt; #&lt;local-object ^resolver&gt; () () (#(struct:exn:fail "oh no" #&lt;continuation-mark-set&gt;)))</span></p></td></tr><tr><td><p><span class="RktOut">Caught: #(struct:exn:fail AAAAH!</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">This is NOT fine! #&lt;continuation-mark-set&gt;)</span></p></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktErr">;; === While attempting to handle message: ===</span></p></td></tr><tr><td><p><span class="RktErr">oh no</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">context...:</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:995:5</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1240:6</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1749:3</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:925:0: call-with-fresh-syscaller</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/vat.rkt:140:9</span></p></td></tr><tr><td><p><span class="RktErr">;; === While attempting to handle message: ===</span></p></td></tr><tr><td><p><span class="RktErr">AAAAH!</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">This is NOT fine!</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">context...:</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1605:11</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:995:5</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1240:6</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1749:3</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:925:0: call-with-fresh-syscaller</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/vat.rkt:140:9</span></p></td></tr></table></td></tr></table></blockquote><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;promise pipelining (tutorial)&quot;">2.3.7<tt>&nbsp;</tt><a name="(part._promise._pipelining._(tutorial))"></a>Promise pipelining</h5><blockquote class="SCentered"><p>"Machines grow faster and memories grow larger.
But the speed of light is constant and New York is not getting any
closer to Tokyo."</p><p><span class="emph">from
<a href="http://www.erights.org/talks/thesis/">Robust Composition: Towards a Unified Approach
to Access Control and Concurrency Control</a>
by Mark S. Miller</span></p></blockquote><p>Let&rsquo;s say we have a car factory that makes cars:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^car-factory</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">company-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">^car</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">model</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">color</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"*Vroom</span><span class="hspace">&nbsp;</span><span class="RktVal">vroom!*</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">You</span><span class="hspace">&nbsp;</span><span class="RktVal">drive</span><span class="hspace">&nbsp;</span><span class="RktVal">your</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">~a!"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">color</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">company-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">model</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">make-car</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">model</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">color</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^car</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">model</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">color</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">make-car</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">fork-motors</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^car-factory</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Fork"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Now observe... in this scenario, Fork Motors exists on <span class="RktSym">a-vat</span>.
It will also generate a car that technically lives on <span class="RktSym">a-vat</span>.
Let&rsquo;s say we live on <span class="RktSym">b-vat</span>... we&rsquo;d still like to drive our car.
Doing so seems extremely ugly:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">b-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fork-motors</span><span class="hspace">&nbsp;</span><span class="RktVal">"Explorist"</span><span class="hspace">&nbsp;</span><span class="RktVal">"blue"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">our-car</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">our-car</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">*Vroom vroom!*</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">You drive your blue Fork Explorist!</span></p></td></tr></table></blockquote><p>This is hard to follow.
Maybe if we actually name some of those promises it&rsquo;ll be a bit easier
to read:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">b-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">car-vow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fork-motors</span><span class="hspace">&nbsp;</span><span class="RktVal">"Explorist"</span><span class="hspace">&nbsp;</span><span class="RktVal">"blue"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktSym">car-vow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">our-car</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">drive-noise-vow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">our-car</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktSym">drive-noise-vow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">*Vroom vroom!*</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">You drive your blue Fork Explorist!</span></p></td></tr></table></blockquote><p>Hm, not so much better.
Naming things helped us remember what each promise was for, but it
seems to be the nesting of <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span> handlers that&rsquo;s confusing.</p><p>Fortunately, Goblins supports something called "promise pipelining".
We can send an instruction to drive our car... before it even rolls
off the factory lot!
That&rsquo;s right... you can send messages to promises, before they have
even resolved!</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">b-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">car-vow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fork-motors</span><span class="hspace">&nbsp;</span><span class="RktVal">"Explorist"</span><span class="hspace">&nbsp;</span><span class="RktVal">"blue"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">drive-noise-vow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">car-vow</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktSym">drive-noise-vow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">*Vroom vroom!*</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">You drive your blue Fork Explorist!</span></p></td></tr></table></blockquote><p>Wow... that&rsquo;s *much* easier to read!</p><p>But readability is not the only goal of promise pipelining.
Like many things in Goblins,
<a href="http://erights.org/elib/distrib/pipeline.html">promise pipelining comes from the E programming language</a>.
We&rsquo;re still working on distributed networked Goblins code, but the
foundations are there to do the same thing that E does: send messages
with less round trips!</p><p>Think about it this way: if <span class="RktSym">a-vat</span> actually lived on a different
server from <span class="RktSym">b-vat</span>, and both servers lived halfway across the globe
with the first way we implemented things:</p><ul><li><p><span class="RktSym">b-vat</span> would have to first send a message to the factory
on <span class="RktSym">a-vat</span> first asking to make a car</p></li><li><p>then <span class="RktSym">a-vat</span> would have to respond, resolving the promise
with the location of the new car</p></li><li><p>then <span class="RktSym">b-vat</span> would have to send <span class="emph">another</span> message
asking to drive the car</p></li><li><p>then <span class="RktSym">a-vat</span> would have to respond, resolving yet another
promise with the noise the car makes</p></li><li><p>and finally <span class="RktSym">b-vat</span> can now display the car noise to the user.</p></li></ul><p>With promise pipelining, this merely becomes:</p><ul><li><p><span class="RktSym">b-vat</span> would send a message to the factory on <span class="RktSym">a-vat</span>
first asking to make a car and /at the same time/ can say,
"and once this car is made, I&rsquo;d like to send another message
to it so I can drive it."</p></li><li><p>then =a-vat= can make the car, drive the car, and then respond
with the noise the car makes</p></li><li><p>and now =b-vat= can display the car noise to the user.</p></li></ul><p>Instead of going <span class="RktSym">B =&gt; A =&gt; B =&gt; A =&gt; B</span>, we have reduced our work to
<span class="RktSym">B =&gt; A =&gt; B</span> ... a significant savings in round-trips.
This can really add up in distributed applications, where (as Miller&rsquo;s
quote at the top of this subsection indicates) we may be limited in
how much we can prevent network delays by physics itself.</p><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Broken_promise_contagion&quot;">2.3.8<tt>&nbsp;</tt><a name="(part._.Broken_promise_contagion)"></a>Broken promise contagion</h5><p>Of course, now that we know that we can pipe promises together, what
happens if an error happens in the middle of the pipeline?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^lessgood-car-factory</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">company-name</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">^car</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">model</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">color</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"*Vroom</span><span class="hspace">&nbsp;</span><span class="RktVal">vroom!*</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">You</span><span class="hspace">&nbsp;</span><span class="RktVal">drive</span><span class="hspace">&nbsp;</span><span class="RktVal">your</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">~a</span><span class="hspace">&nbsp;</span><span class="RktVal">~a!"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">color</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">company-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">model</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">make-car</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">model</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">color</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._error%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">error</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Your</span><span class="hspace">&nbsp;</span><span class="RktVal">car</span><span class="hspace">&nbsp;</span><span class="RktVal">exploded</span><span class="hspace">&nbsp;</span><span class="RktVal">on</span><span class="hspace">&nbsp;</span><span class="RktVal">the</span><span class="hspace">&nbsp;</span><span class="RktVal">factory</span><span class="hspace">&nbsp;</span><span class="RktVal">floor!</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">Ooops!"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^car</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">model</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">color</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">make-car</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">forked-motors</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^lessgood-car-factory</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Forked"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>The answer is that the error is simply propagated to all pending promises:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">b-run</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">car-vow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">forked-motors</span><span class="hspace">&nbsp;</span><span class="RktVal">"Exploder"</span><span class="hspace">&nbsp;</span><span class="RktVal">"red"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">drive-noise-vow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="hspace">&nbsp;</span><span class="RktSym">car-vow</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktSym">drive-noise-vow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:catch</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">err</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Caught: ~a"</span><span class="hspace">&nbsp;</span><span class="RktSym">err</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">;;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">#(struct:message #&lt;local-object ^lessgood-car-factory&gt; #&lt;local-object ^resolver&gt; () () ("Exploder" "red"))</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktErr">;; === While attempting to handle message: ===</span></p></td></tr><tr><td><p><span class="RktErr">Your car exploded on the factory floor!</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">Ooops!</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">context...:</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:995:5</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1240:6</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:1749:3</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/core.rkt:925:0: call-with-fresh-syscaller</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">/home/root/user/.local/share/racket/8.6/pkgs/goblins/vat.rkt:140:9</span></p></td></tr></table></td></tr></table></blockquote><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Going_low-level__actormaps&quot;">2.4<tt>&nbsp;</tt><a name="(part._.Going_low-level__actormaps)"></a>Going low-level: actormaps</h4><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Spawning__peeking__poking__turning&quot;">2.4.1<tt>&nbsp;</tt><a name="(part._.Spawning__peeking__poking__turning)"></a>Spawning, peeking, poking, turning</h5><p>So far we have dealt with vats, but there is a lower level of
abstraction in Goblins which is called an <a href="api.html#%28tech._actormap%29" class="techoutside" data-pltdoc="x"><span class="techinside">actormap</span></a>.</p><p>The key differences are:</p><ul><li><p><span style="font-weight: bold">vat</span>: An event loop implementation that runs continuously
in its own thread.
Comes pre-built with tooling to handle message passing between
vats.
Actually wraps an actormap.</p></li><li><p><span style="font-weight: bold">actormap</span>: The transactional datastructure that vats use.
But, useful on its own to either build your own event loop
or as a synchronous one-turn-at-a-time mapping of actor references
to their current implementations.</p></li></ul><p>The best way to learn is by doing, so let&rsquo;s make an actormap now:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">am</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._make-actormap%29%29" class="RktValLink" data-pltdoc="x">make-actormap</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Let&rsquo;s add an actor to it.
Since cells are simple, let&rsquo;s add one of those.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">lunchbox</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-spawn%21%29%29" class="RktValLink" data-pltdoc="x">actormap-spawn!</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">am</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">^cell</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>What&rsquo;s in the lunchbox?
We could take a look with <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr></table></blockquote><p>An empty lunchbox... we&rsquo;d like to eat something later, so how about we
pack ourselves a nice sandwich by using <span class="RktSym">actormap-poke</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-poke%21%29%29" class="RktValLink" data-pltdoc="x">actormap-poke!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">peanut-butter-and-jelly</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'peanut-butter-and-jelly</span></p></td></tr></table></blockquote><p>What if we tried to look inside the lunchbox with <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-poke%21%29%29" class="RktValLink" data-pltdoc="x">actormap-poke!</a></span>
instead of <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span>?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-poke%21%29%29" class="RktValLink" data-pltdoc="x">actormap-poke!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">bbq-tofu</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-poke%21%29%29" class="RktValLink" data-pltdoc="x">actormap-poke!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'bbq-tofu</span></p></td></tr></table></blockquote><p>Well that worked just fine.
What happens if we do both operations with <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span>?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">chickpea-salad</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'bbq-tofu</span></p></td></tr></table></blockquote><p>What the...???
Our lunchbox didn&rsquo;t change!</p><p>We said that actormaps were transactional.
We have gotten a hint of this with the above:
<span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-poke%21%29%29" class="RktValLink" data-pltdoc="x">actormap-poke!</a></span> returns a value and commits any changes.
<span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span> returns a value and throws any changes away.</p><p>Actually, these two functions are just simple conveniences that wrap a
more powerful (but cumbersome to use) tool, <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-turn%29%29" class="RktValLink" data-pltdoc="x">actormap-turn</a></span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-turn%29%29" class="RktValLink" data-pltdoc="x">actormap-turn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">'bbq-tofu</span></p></td></tr><tr><td><p><span class="RktRes">#&lt;transactormap&gt;</span></p></td></tr><tr><td><p><span class="RktRes">'()</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-turn%29%29" class="RktValLink" data-pltdoc="x">actormap-turn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">chickpea-salad</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">#&lt;transactormap&gt;</span></p></td></tr><tr><td><p><span class="RktRes">'()</span></p></td></tr></table></td></tr></table></blockquote><p><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-turn%29%29" class="RktValLink" data-pltdoc="x">actormap-turn</a></span> returns four values to its continuation: a
return value (if any... Racket&rsquo;s REPL doesn&rsquo;t print out a
<span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void</a></span><span class="RktPn">)</span>, which is what actually got returned in the second
invocation), a "transactormap", and two lists representing messages
queued for delivery.
(*TODO:* Currently two, one for local and one for remote vats... we are
likely to collapse down to just one list, so update this text when
that changes!)</p><p>This <span class="RktSym">#&lt;transactormap&gt;</span> is interesting... we haven&rsquo;t mentioned this
before, but there are really two kinds of actormaps, "whactormaps"
(weak-hash actormaps) and "transactormaps" (which hold a transaction
which we can choose whether or not to commit).
Actually our <span class="RktSym">am</span> is a whactormap:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktSym">am</span></td></tr><tr><td><p><span class="RktRes">#&lt;whactormap&gt;</span></p></td></tr></table></blockquote><p>It&rsquo;s a weak hashtable which stores the current mutable state of all
actors.</p><p>But we&rsquo;d like to see about that transactormap... just running
<span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-turn%29%29" class="RktValLink" data-pltdoc="x">actormap-turn</a></span> on its own won&rsquo;t update the lunchbox either:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-turn%29%29" class="RktValLink" data-pltdoc="x">actormap-turn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">chickpea-salad</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">#&lt;transactormap&gt;</span></p></td></tr><tr><td><p><span class="RktRes">'()</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-turn%29%29" class="RktValLink" data-pltdoc="x">actormap-turn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">'bbq-tofu</span></p></td></tr><tr><td><p><span class="RktRes">#&lt;transactormap&gt;</span></p></td></tr><tr><td><p><span class="RktRes">'()</span></p></td></tr></table></td></tr></table></blockquote><p>We need to capture the transactormap and commit it.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._define-values%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-values</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">val</span><span class="hspace">&nbsp;</span><span class="RktSym">tr-am</span><span class="hspace">&nbsp;</span><span class="RktVar">nm</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-turn%29%29" class="RktValLink" data-pltdoc="x">actormap-turn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">chickpea-salad</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">tr-am</span></td></tr><tr><td><p><span class="RktRes">#&lt;transactormap&gt;</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._transactormap-merge%21%29%29" class="RktValLink" data-pltdoc="x">transactormap-merge!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">tr-am</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Now at least our <span class="RktSym">am</span> actormap should reflect that we&rsquo;ve switched out
our <span class="RktSym">&rsquo;bbq-tofu</span> sandwich for a <span class="RktSym">&rsquo;chickpea-salad</span> one:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'chickpea-salad</span></p></td></tr></table></blockquote><p>Horray!</p><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Time_travel__snapshotting_and_restoring&quot;">2.4.2<tt>&nbsp;</tt><a name="(part._.Time_travel__snapshotting_and_restoring)"></a>Time travel: snapshotting and restoring</h5><p>But what does our actormap really look like?
Right now it only has one thing in it, the lunchbox cell.
We can see this by "snapshotting" the actormap.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._snapshot-whactormap%29%29" class="RktValLink" data-pltdoc="x">snapshot-whactormap</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'#hasheq((#&lt;local-object ^cell&gt; . #&lt;ephemeron&gt;))</span></p></td></tr></table></blockquote><p>This returns an immutable actormap, frozen in time.
We can see that it only has one pairing in it, and yep... it looks
like the key is our <span class="RktSym">lunchbox</span> reference:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktSym">lunchbox</span></td></tr><tr><td><p><span class="RktRes">#&lt;local-object ^cell&gt;</span></p></td></tr></table></blockquote><p>So it seems our "refr" is just a "reference"... it isn&rsquo;t the state of
the object itself, it&rsquo;s something that points to that state, through
an indirection of the actormap.</p><p>We now know that we can snapshot an actormap, we can freeze time and
come back to it.
First we&rsquo;ll freeze a snapshot of this period of time, change what&rsquo;s
in the lunchbox, and then snapshot it again:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-snapshot1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._snapshot-whactormap%29%29" class="RktValLink" data-pltdoc="x">snapshot-whactormap</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-poke%21%29%29" class="RktValLink" data-pltdoc="x">actormap-poke!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">sloppy joe w/ lentils</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sloppy-jane</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-snapshot2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._snapshot-whactormap%29%29" class="RktValLink" data-pltdoc="x">snapshot-whactormap</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Now let&rsquo;s restore them as separate whactormaps:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-restored1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._hasheq-~3ewhactormap%29%29" class="RktValLink" data-pltdoc="x">hasheq-&gt;whactormap</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-snapshot1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-restored2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._hasheq-~3ewhactormap%29%29" class="RktValLink" data-pltdoc="x">hasheq-&gt;whactormap</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-snapshot2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Now it doesn&rsquo;t matter what we put in our lunchbox; we can always
come back to life (and lunch) as it used to be.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-poke%21%29%29" class="RktValLink" data-pltdoc="x">actormap-poke!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">peanut-butter-and-pickles</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'peanut-butter-and-pickles</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-restored2</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'sloppy-jane</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-restored1</span><span class="hspace">&nbsp;</span><span class="RktSym">lunchbox</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'chickpea-salad</span></p></td></tr></table></blockquote><p>Why eat leftovers when you can simply travel back in time and eat
yesterday&rsquo;s lunch?</p><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Advanced_object_patterns&quot;">2.5<tt>&nbsp;</tt><a name="(part._.Advanced_object_patterns)"></a>Advanced object patterns</h4><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Extending_our_methods&quot;">2.5.1<tt>&nbsp;</tt><a name="(part._.Extending_our_methods)"></a>Extending our methods</h5><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Mixins&quot;">2.5.2<tt>&nbsp;</tt><a name="(part._.Mixins)"></a>Mixins</h5><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Behavior_pivoting_as_a_kind_of_state_machine&quot;">2.5.3<tt>&nbsp;</tt><a name="(part._.Behavior_pivoting_as_a_kind_of_state_machine)"></a>Behavior pivoting as a kind of state machine</h5><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;How_this_relates_to__object_capability_security_&quot;">2.6<tt>&nbsp;</tt><a name="(part._.How_this_relates_to__object_capability_security_)"></a>How this relates to "object capability security"</h4><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Sealers_unsealers_and_rights_amplification&quot;">2.7<tt>&nbsp;</tt><a name="(part._.Sealers_unsealers_and_rights_amplification)"></a>Sealers/unsealers and rights amplification</h4><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Networked_object_interactions&quot;">2.8<tt>&nbsp;</tt><a name="(part._.Networked_object_interactions)"></a>Networked object interactions</h4><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;A_peek_into_Goblins__machinery&quot;">2.9<tt>&nbsp;</tt><a name="(part._.A_peek_into_.Goblins__machinery)"></a>A peek into Goblins&rsquo; machinery</h4><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Actors_really_are_what_they_say_they_are&quot;">2.9.1<tt>&nbsp;</tt><a name="(part._.Actors_really_are_what_they_say_they_are)"></a>Actors really are what they say they are</h5><p>Now at last we will pull the curtain aside and see that the (hu?)man
standing behind the curtain is who we thought it was all along.
(This particular section is totally "optional", but hopefully
illuminates some of the guts of Goblins itself.)</p><p>Here is a suitable test subject:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^the-wizard</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">High</span><span class="hspace">&nbsp;</span><span class="RktCmt">and</span><span class="hspace">&nbsp;</span><span class="RktCmt">mighty</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">the-wizard-behind-the-curtain</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">methods</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">request-gift</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">what</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"HOW</span><span class="hspace">&nbsp;</span><span class="RktVal">DARE</span><span class="hspace">&nbsp;</span><span class="RktVal">YOU</span><span class="hspace">&nbsp;</span><span class="RktVal">APPROACH</span><span class="hspace">&nbsp;</span><span class="RktVal">THE</span><span class="hspace">&nbsp;</span><span class="RktVal">ALL</span><span class="hspace">&nbsp;</span><span class="RktVal">POWERFUL</span><span class="hspace">&nbsp;</span><span class="RktVal">WIZARD?"</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">pull-back-curtain</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">bcom</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">the-man</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Er...</span><span class="hspace">&nbsp;</span><span class="RktVal">I</span><span class="hspace">&nbsp;</span><span class="RktVal">can</span><span class="hspace">&nbsp;</span><span class="RktVal">explain..."</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Just</span><span class="hspace">&nbsp;</span><span class="RktCmt">a</span><span class="hspace">&nbsp;</span><span class="RktCmt">person</span><span class="hspace">&nbsp;</span><span class="RktCmt">after</span><span class="hspace">&nbsp;</span><span class="RktCmt">all</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">the-man</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">methods</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">request-gift</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">what</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">what</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">heart</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Here's</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">clock</span><span class="hspace">&nbsp;</span><span class="RktVal">shaped</span><span class="hspace">&nbsp;</span><span class="RktVal">like</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">heart!"</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">brain</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Here's</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">diploma!"</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">courage</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"The</span><span class="hspace">&nbsp;</span><span class="RktVal">courage</span><span class="hspace">&nbsp;</span><span class="RktVal">was</span><span class="hspace">&nbsp;</span><span class="RktVal">inside</span><span class="hspace">&nbsp;</span><span class="RktVal">you</span><span class="hspace">&nbsp;</span><span class="RktVal">all</span><span class="hspace">&nbsp;</span><span class="RktVal">along!"</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktSym">anything-else</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"I</span><span class="hspace">&nbsp;</span><span class="RktVal">don't</span><span class="hspace">&nbsp;</span><span class="RktVal">know</span><span class="hspace">&nbsp;</span><span class="RktVal">what</span><span class="hspace">&nbsp;</span><span class="RktVal">that</span><span class="hspace">&nbsp;</span><span class="RktVal">is..."</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">pull-back-curtain</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"...</span><span class="hspace">&nbsp;</span><span class="RktVal">you</span><span class="hspace">&nbsp;</span><span class="RktVal">already</span><span class="hspace">&nbsp;</span><span class="RktVal">pulled</span><span class="hspace">&nbsp;</span><span class="RktVal">it</span><span class="hspace">&nbsp;</span><span class="RktVal">back."</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">we</span><span class="hspace">&nbsp;</span><span class="RktCmt">start</span><span class="hspace">&nbsp;</span><span class="RktCmt">out</span><span class="hspace">&nbsp;</span><span class="RktCmt">obscured</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">the-wizard-behind-the-curtain</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">wizard</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-spawn%21%29%29" class="RktValLink" data-pltdoc="x">actormap-spawn!</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">am</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^the-wizard</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>We humbly approach the wizard asking for the gift of a heart:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">wizard</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">request-gift</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">heart</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"HOW DARE YOU APPROACH THE ALL POWERFUL WIZARD?"</span></p></td></tr></table></blockquote><p>Is that so?
Let&rsquo;s snapshot time both before and after we pull back the curtain
so we can remember how he changes his tone:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-wizard-snapshot1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._snapshot-whactormap%29%29" class="RktValLink" data-pltdoc="x">snapshot-whactormap</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-poke%21%29%29" class="RktValLink" data-pltdoc="x">actormap-poke!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">wizard</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">pull-back-curtain</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Er... I can explain..."</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-wizard-snapshot2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._snapshot-whactormap%29%29" class="RktValLink" data-pltdoc="x">snapshot-whactormap</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Of course now, if we request a gift of the wizard, the conversation is
a bit different:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">wizard</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">request-gift</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">heart</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Here's a clock shaped like a heart!"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">wizard</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">request-gift</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">brain</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Here's a diploma!"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._actormap-peek%29%29" class="RktValLink" data-pltdoc="x">actormap-peek</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am</span><span class="hspace">&nbsp;</span><span class="RktSym">wizard</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">request-gift</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">courage</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"The courage was inside you all along!"</span></p></td></tr></table></blockquote><p>Of course, this isn&rsquo;t too much of a surprise, since, well, we wrote
the code for the wizard.</p><p>Both actormaps show our new wizard resident (and the old lunchbox
cell):</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktSym">am-wizard-snapshot1</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">'#hasheq((#&lt;local-object ^the-wizard&gt; . #&lt;ephemeron&gt;)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(#&lt;local-object ^cell&gt; . #&lt;ephemeron&gt;))</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">am-wizard-snapshot2</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">'#hasheq((#&lt;local-object ^the-wizard&gt; . #&lt;ephemeron&gt;)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(#&lt;local-object ^cell&gt; . #&lt;ephemeron&gt;))</span></p></td></tr></table></td></tr></table></blockquote><p>Referencing the wizard from either hashtable gives us this
weird-looking "ephemeron" thing:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-ref%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">hash-ref</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-wizard-snapshot1</span><span class="hspace">&nbsp;</span><span class="RktSym">wizard</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#&lt;ephemeron&gt;</span></p></td></tr></table></blockquote><p>Well, an
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=ephemerons.html%23%2528tech._ephemeron%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">ephemeron</span></a>
is just
<a href="https://en.wikipedia.org/wiki/Ephemeron">a datastructure</a>
to help the garbage collection in the weak hashtable of whactormaps
work right.  So we can peel that off:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=ephemerons.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._ephemeron-value%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">ephemeron-value</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-ref%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">hash-ref</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-wizard-snapshot1</span><span class="hspace">&nbsp;</span><span class="RktSym">wizard</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">#&lt;mactor:object&gt;</span></p></td></tr></table></blockquote><p>What&rsquo;s a... "mactor"?
Well, it stands for "meta-actor"... there are a few of these
kinds of things.
A <span class="RktSym">mactor:object</span> is one kind of mactor (actually the most common
kind), one that works in the usual way of wrapping a procedure.</p><p>It would be wonderful to be able to look at that procedure.
Unfortunately, we haven&rsquo;t pulled in all the tools to do it yet, but
there is a way to do so:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._submod%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">submod</a></span><span class="hspace">&nbsp;</span><span class="RktSym">goblins/core</span><span class="hspace">&nbsp;</span><span class="RktSym">mactor-extra</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>This gives us access to <span class="RktSym">mactor:object-handler</span>, which is what
we want.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">mactor:object-handler</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=ephemerons.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._ephemeron-value%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">ephemeron-value</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-ref%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">hash-ref</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-wizard-snapshot1</span><span class="hspace">&nbsp;</span><span class="RktSym">wizard</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">#&lt;procedure:methods&gt;</span></p></td></tr></table></blockquote><p>Let&rsquo;s give names to both snapshotted wizard handlers:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">wizard-handler1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mactor:object-handler</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=ephemerons.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._ephemeron-value%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">ephemeron-value</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-ref%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">hash-ref</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-wizard-snapshot1</span><span class="hspace">&nbsp;</span><span class="RktSym">wizard</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">wizard-handler2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mactor:object-handler</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=ephemerons.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._ephemeron-value%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">ephemeron-value</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-ref%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">hash-ref</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-wizard-snapshot2</span><span class="hspace">&nbsp;</span><span class="RktSym">wizard</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Since these are just procedures, we can try calling them directly.
As we can see, the first wizard is petulant in response to our request
for a gift, whereas the second wizard, having had the curtain pulled
away, is happy to assist.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">wizard-handler1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">request-gift</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">heart</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"HOW DARE YOU APPROACH THE ALL POWERFUL WIZARD?"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">wizard-handler2</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">request-gift</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">heart</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Here's a clock shaped like a heart!"</span></p></td></tr></table></blockquote><p>So this really was the procedure we thought it was!</p><p>But wait... if we remember correctly, our first wizard version,
<span class="RktSym">the-wizard-behind-the-curtain</span>, returned its request to "become"
something (as well as its return value) wrapped by its =bcom=
capability when we called the <span class="RktSym">&rsquo;pull-back-curtain</span> method.
So what happens if we try calling that again on the unwrapped
procedure?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">wizard-handler1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">pull-back-curtain</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#&lt;become&gt;</span></p></td></tr></table></blockquote><p>That&rsquo;s interesting... it returned a "become" object!
How can we unwrap it?</p><p>Well, here&rsquo;s the secret about <span class="RktSym">bcom</span>: as we said, it is a capability,
but it&rsquo;s actually using a "sealer" (we&rsquo;ll get to what those are later,
which as it sounds like is a kind of capability to "seal" an object in
a certain way).
To unseal it, we need the corresponding "unsealer".
<span class="RktSym">mactor:object</span> has a way of detecting that the value is wrapped
in this sealer, as well as a way of unsealing it:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">wizard-become?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mactor:object-become?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=ephemerons.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._ephemeron-value%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">ephemeron-value</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-ref%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">hash-ref</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-wizard-snapshot1</span><span class="hspace">&nbsp;</span><span class="RktSym">wizard</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">wizard-become-unsealer</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mactor:object-become-unsealer</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=ephemerons.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._ephemeron-value%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">ephemeron-value</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-ref%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">hash-ref</a></span><span class="hspace">&nbsp;</span><span class="RktSym">am-wizard-snapshot1</span><span class="hspace">&nbsp;</span><span class="RktSym">wizard</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Now we can see that the value returned from the =&rsquo;pull-back-curtain=
method is from the wizard&rsquo;s <span class="RktSym">bcom</span> sealer:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">wizard-become?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wizard-handler1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">pull-back-curtain</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr></table></blockquote><p>And now, at last!
We can peer into its contents:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">wizard-become-unsealer</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wizard-handler1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">pull-back-curtain</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">#&lt;procedure:methods&gt;</span></p></td></tr><tr><td><p><span class="RktRes">"Er... I can explain..."</span></p></td></tr></table></td></tr></table></blockquote><p>Aha!
It looks like it returns two values to its continuation...
the procedure that the actor would like to become, as well as
an extra (and optional, defaulting to <span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void</a></span><span class="RktPn">)</span>) return value.
Let&rsquo;s bind the first of those to a useful name:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._define-values%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-values</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">new-wizard-handler</span><span class="hspace">&nbsp;</span><span class="RktVar">wizval</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wizard-become-unsealer</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wizard-handler1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">pull-back-curtain</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Now as you&rsquo;ve probably guessed, this ought to be the same procedure as
<span class="RktSym">wizard-handler2</span>.
Is it?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Works just like wizard-handler2...</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">new-wizard-handler</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">request-gift</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">courage</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"The courage was inside you all along!"</span></p></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">... because it *is* wizard-handler2!</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eq%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eq?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">new-wizard-handler</span><span class="hspace">&nbsp;</span><span class="RktSym">wizard-handler2</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr></table></blockquote><p>Woohoo!</p><p>Of course, the tools we&rsquo;ve seen in this subsection are not really
tools that we expect users of Goblins to use very regularly.
(Indeed, when we implement better module-level security, rarely will
they have access to them.)
But now we&rsquo;ve gotten a peek inside of Goblins&rsquo; machinery, and seen
that it was mostly what we expected all along.</p><p>I feel like all that learning is was worth a reward, don&rsquo;t you?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">new-wizard-handler</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">request-gift</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">brain</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Here's a diploma!"</span></p></td></tr></table></blockquote><p>Yes, we deserve it!</p><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;So_how_does_message_passing_work&quot;">2.9.2<tt>&nbsp;</tt><a name="(part._.So_how_does_message_passing_work)"></a>So how does message passing work</h5><h5 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;How_can_two_actormaps_communicate____How_do_vats_do_it__&quot;">2.9.3<tt>&nbsp;</tt><a name="(part._.How_can_two_actormaps_communicate____.How_do_vats_do_it__)"></a>How can two actormaps communicate?  (How do vats do it?)</h5><h4 x-source-module="(lib &quot;goblins/scribblings/goblins.scrbl&quot;)" x-source-pkg="goblins" x-part-tag="&quot;Working_with_Racket_events_in_Goblins&quot;">2.10<tt>&nbsp;</tt><a name="(part._.Working_with_.Racket_events_in_.Goblins)"></a>Working with Racket events in Goblins</h4><p>Goblins provides some utilities in actor-lib that make it
straightforward to integrate a Goblins program with Racket&rsquo;s
synchronizable events - for example, when working with I/O. Here&rsquo;s how
you might use that.</p><p>Let&rsquo;s use terminal I/O as a simple example here; we&rsquo;ll be watching for
a line of text on stdin, and outputting to stdout. You might first be
tempted to do something like this:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">goblins</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">goblins/actor-lib/methods</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">WARNING</span><span class="hspace">&nbsp;</span><span class="RktCmt">-</span><span class="hspace">&nbsp;</span><span class="RktCmt">Don't</span><span class="hspace">&nbsp;</span><span class="RktCmt">do</span><span class="hspace">&nbsp;</span><span class="RktCmt">this!</span><span class="hspace">&nbsp;</span><span class="RktCmt">Doesn't</span><span class="hspace">&nbsp;</span><span class="RktCmt">do</span><span class="hspace">&nbsp;</span><span class="RktCmt">what</span><span class="hspace">&nbsp;</span><span class="RktCmt">you</span><span class="hspace">&nbsp;</span><span class="RktCmt">expect!</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^buggy-reader</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">methods</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">echo</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sync%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sync</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=port-lib.html%23%2528def._%2528%2528lib._racket%252Fport..rkt%2529._read-line-evt%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">read-line-evt</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-input-port%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">current-input-port</a></span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">any</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>We can then, as usual, create a vat and instantiate our friendly
reader, Alice:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">goblins/actor-lib/bootstrap</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">a-vat</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._make-vat%29%29" class="RktValLink" data-pltdoc="x">make-vat</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alice</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-vat</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._spawn%29%29" class="RktValLink" data-pltdoc="x">spawn</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">^buggy-reader</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define-vat-run</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">a-vat</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>...then ask Alice to echo back what you sent her:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-np%29%29" class="RktValLink" data-pltdoc="x">&lt;-np</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alice</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">echo</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sleep%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sleep</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">20</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>(Note: Using <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sleep%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sleep</a></span> here is a bit of a hack so the program doesn&rsquo;t
immediately end; we&rsquo;ll show you a better way a bit later.)</p><p>If you run this program at the command line, you&rsquo;ll be able to type a
line, press enter, and see the same thing you typed echoed back to
you:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ racket buggyio.rkt</span></p></td></tr><tr><td><p><span class="stt">test</span></p></td></tr><tr><td><p><span class="stt">test</span></p></td></tr><tr><td><p><span class="stt">$</span></p></td></tr></table></p><p>This looks fine, right? But wait, what happens if you want to send a
message to another actor in the same vat while that&rsquo;s happening? Let&rsquo;s
try it. You&rsquo;ll need another actor to add to the vat, so a simple one
would be one that just prints whatever you send it to the terminal:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^writer</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">methods</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">disp</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">in</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">in</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Let&rsquo;s call him Bob.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktVal">"(define bob (a-vat 'spawn ^writer))"</span></td></tr><tr><td><p><span class="RktRes">"(define bob (a-vat 'spawn ^writer))"</span></p></td></tr></table></blockquote><p>Like before, we&rsquo;ll be asking Alice to echo back input from the
terminal, but two seconds later, Bob should print "Hi!" to the
terminal.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define-vat-run</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">a-vat</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-np%29%29" class="RktValLink" data-pltdoc="x">&lt;-np</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alice</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">echo</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sleep%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sleep</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-np%29%29" class="RktValLink" data-pltdoc="x">&lt;-np</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bob</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">disp</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hi!"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sleep%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sleep</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">20</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>What do you think this will do? Well, the <span class="emph">intent</span> was to have Alice
wait for input, while Bob says "Hi!" two seconds later. But remember:
vats are synchronous, and Alice is running <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sync%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sync</a></span> here,
which blocks! So if you run this, you&rsquo;ll see:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ racket buggyio.rkt</span></p></td></tr></table></p><p>Only <span class="emph">after</span> you type a line will you see Alice respond back,
and Bob&rsquo;s hello:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ racket buggyio.rkt</span></p></td></tr><tr><td><p><span class="stt">test</span></p></td></tr><tr><td><p><span class="stt">test</span></p></td></tr><tr><td><p><span class="stt">Hi!</span></p></td></tr></table></p><p>So this might be a problem. Alice just waiting for input is gumming up
<span class="RktSym">a-vat</span> entirely; nothing else can run there while she&rsquo;s
waiting! How can we solve this?</p><p>Fortunately, actor-lib has some tools that can help us with this. To
get started, import this:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">goblins/actor-lib/sync-pr</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>This gives you a new function called <span class="RktSym">sync/pr</span>. Unlike Racket&rsquo;s
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sync%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sync</a></span>, <span class="RktSym">sync/pr</span> doesn&rsquo;t block. Instead, it produces a
promise, and sets up a separate thread to watch for the event. You can
use it in much the same way, just using <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span> to resolve the
promise:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">^better-reader</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bcom</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">methods</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">echo</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">sync/pr</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=port-lib.html%23%2528def._%2528%2528lib._racket%252Fport..rkt%2529._read-line-evt%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">read-line-evt</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-input-port%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">current-input-port</a></span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">any</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">evt</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._car%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">car</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">evt</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Note:</span><span class="hspace">&nbsp;</span><span class="RktCmt">#:promise?</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="hspace">&nbsp;</span><span class="RktCmt">important</span><span class="hspace">&nbsp;</span><span class="RktCmt">here,</span><span class="hspace">&nbsp;</span><span class="RktCmt">because</span><span class="hspace">&nbsp;</span><span class="RktCmt">we'll</span><span class="hspace">&nbsp;</span><span class="RktCmt">later</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">need</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">know</span><span class="hspace">&nbsp;</span><span class="RktCmt">when</span><span class="hspace">&nbsp;</span><span class="RktCmt">this</span><span class="hspace">&nbsp;</span><span class="RktCmt">completes</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">#:promise?</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">#t</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Not too different! And unlike the first one, this one will let other
actors in the same vat run while waiting for input. For example, let&rsquo;s
say Carol is this new, better actor:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">carol</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-vat</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">spawn</span><span class="hspace">&nbsp;</span><span class="RktSym">^better-reader</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Let&rsquo;s do the same thing we did before with Alice: ask Carol to watch
for terminal input, then have Bob speak up a few seconds later:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-np%29%29" class="RktValLink" data-pltdoc="x">&lt;-np</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">carol</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">echo</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sleep%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sleep</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-np%29%29" class="RktValLink" data-pltdoc="x">&lt;-np</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bob</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">disp</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hi!"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sleep%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sleep</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">20</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>This time, you can wait a few seconds and still be able to hear Bob!</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ racket buggyio.rkt</span></p></td></tr><tr><td><p><span class="stt">Hi!</span></p></td></tr><tr><td><p><span class="stt">test</span></p></td></tr><tr><td><p><span class="stt">test</span></p></td></tr></table></p><p>Now, remember how I said using <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sleep%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sleep</a></span> was a hack? We needed
that before because otherwise the program would end right after the
last <span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-np%29%29" class="RktValLink" data-pltdoc="x">&lt;-np</a></span> message; they don&rsquo;t block, so without it we would
have almost immediately reached the end of the main thread. But
there&rsquo;s a better option that lets us just wait until we&rsquo;re done: a
semaphore!</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">finished</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=semaphore.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-semaphore%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">make-semaphore</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._on%29%29" class="RktValLink" data-pltdoc="x">on</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-%29%29" class="RktValLink" data-pltdoc="x">&lt;-</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alice</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">echo</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=semaphore.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._semaphore-post%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">semaphore-post</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">finished</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sleep%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sleep</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">a-run</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="api.html#%28def._%28%28lib._goblins%2Fmain..rkt%29._~3c-np%29%29" class="RktValLink" data-pltdoc="x">&lt;-np</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bob</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">'</a></span><span class="RktSym">disp</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Hi!"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=semaphore.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._semaphore-wait%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">semaphore-wait</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">finished</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>You can see the Racket docs on
<a href="../reference/semaphore.html">semaphores</a>
for more details, but essentially we&rsquo;re using one here to block until
Alice has finished her job. Once Alice responds, we call
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=semaphore.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._semaphore-post%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">semaphore-post</a></span>, which fulfills the condition that
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=semaphore.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._semaphore-wait%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">semaphore-wait</a></span> is looking for. At that point, we&rsquo;ve reached
the end of the program, so the program terminates.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="intro.html" title="backward to &quot;1 What is Goblins?&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Goblins: a transactional, distributed actor model environment&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="api.html" title="forward to &quot;3 Goblins API&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/goblins/tutorial.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:27:03 GMT -->
</html>