<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/punctaffy/motivation.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:29:59 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>2&nbsp;Motivation for Punctaffy</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Punctaffy</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" data-pltdoc="x">Introduction to Punctaffy</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Motivation for Punctaffy</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="hypersnippet-data.html" class="tocviewlink" data-pltdoc="x">Representation of Hypersnippet Data</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="token-of-syntax.html" class="tocviewlink" data-pltdoc="x">Tokens of Syntax Object Tree Content</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="taffy-notation.html" class="tocviewlink" data-pltdoc="x">Defining Hyperbracket Notations for Racket</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="baseline-notations.html" class="tocviewlink" data-pltdoc="x">Baseline Punctaffy Hyperbracket Notations</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="hyperbracketed-util.html" class="tocviewlink" data-pltdoc="x">Hyperbracketed Operations</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>2&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Motivation for Punctaffy</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="#%28part._existing-use-cases%29" class="tocviewlink" data-pltdoc="x">Hyperbracketed Notations Predating Punctaffy</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="#%28part._potential-use-cases%29" class="tocviewlink" data-pltdoc="x">Potential Application Areas</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._existing-use-cases%29" class="tocsubseclink" data-pltdoc="x">Hyperbracketed Notations Predating Punctaffy</a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#%28part._potential-use-cases%29" class="tocsubseclink" data-pltdoc="x">Potential Application Areas</a></td></tr><tr><td><span class="tocsublinknumber">2.2.1<tt>&nbsp;</tt></span><a href="#%28part._potential-use-case-hygiene%29" class="tocsubseclink" data-pltdoc="x">Potential Application:<span class="mywbr"> &nbsp;</span> Hygiene</a></td></tr><tr><td><span class="tocsublinknumber">2.2.2<tt>&nbsp;</tt></span><a href="#%28part._potential-use-case-incremental-compilation%29" class="tocsubseclink" data-pltdoc="x">Potential Application:<span class="mywbr"> &nbsp;</span> Incremental Compilation</a></td></tr><tr><td><span class="tocsublinknumber">2.2.3<tt>&nbsp;</tt></span><a href="#%28part._potential-use-case-call-stacks%29" class="tocsubseclink" data-pltdoc="x">Potential Application:<span class="mywbr"> &nbsp;</span> Abstraction-<wbr></wbr>Respecting Call Stacks</a></td></tr><tr><td><span class="tocsublinknumber">2.2.4<tt>&nbsp;</tt></span><a href="#%28part._potential-use-case-ellipsis-unsyntax%29" class="tocsubseclink" data-pltdoc="x">Potential Application:<span class="mywbr"> &nbsp;</span> Interactions Between <span class="RktSym"><span class="RktStxLink">unsyntax</span></span> and Ellipses</a></td></tr><tr><td><span class="tocsublinknumber">2.2.5<tt>&nbsp;</tt></span><a href="#%28part._potential-use-case-opetopes%29" class="tocsubseclink" data-pltdoc="x">Potential Application:<span class="mywbr"> &nbsp;</span> Opetopes and Higher Categories</a></td></tr><tr><td><span class="tocsublinknumber">2.2.6<tt>&nbsp;</tt></span><a href="#%28part._potential-use-case-transpension%29" class="tocsubseclink" data-pltdoc="x">Potential Application:<span class="mywbr"> &nbsp;</span> Type Theories with Transpension</a></td></tr><tr><td><span class="tocsublinknumber">2.2.7<tt>&nbsp;</tt></span><a href="#%28part._potential-use-case-custom-escape%29" class="tocsubseclink" data-pltdoc="x">Potential Application:<span class="mywbr"> &nbsp;</span> User-<wbr></wbr>Defined Escapes from Nestable Quotation</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.6</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="intro.html" title="backward to &quot;1 Introduction to Punctaffy&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Punctaffy&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="hypersnippet-data.html" title="forward to &quot;3 Representation of Hypersnippet Data&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;punctaffy/scribblings/punctaffy.scrbl&quot;)" x-source-pkg="punctaffy-doc" x-part-tag="&quot;motivation&quot;">2<tt>&nbsp;</tt><a name="(part._motivation)"></a>Motivation for Punctaffy</h3><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._existing-use-cases%29" class="toclink" data-pltdoc="x">2.1<span class="hspace">&nbsp;</span>Hyperbracketed Notations Predating Punctaffy</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._potential-use-cases%29" class="toclink" data-pltdoc="x">2.2<span class="hspace">&nbsp;</span>Potential Application Areas</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._potential-use-case-hygiene%29" class="toclink" data-pltdoc="x">2.2.1<span class="hspace">&nbsp;</span>Potential Application: Hygiene</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._potential-use-case-incremental-compilation%29" class="toclink" data-pltdoc="x">2.2.2<span class="hspace">&nbsp;</span>Potential Application: Incremental Compilation</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._potential-use-case-call-stacks%29" class="toclink" data-pltdoc="x">2.2.3<span class="hspace">&nbsp;</span>Potential Application: Abstraction-Respecting Call Stacks</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._potential-use-case-ellipsis-unsyntax%29" class="toclink" data-pltdoc="x">2.2.4<span class="hspace">&nbsp;</span>Potential Application: Interactions Between <span class="RktSym"><span class="RktStxLink">unsyntax</span></span> and Ellipses</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._potential-use-case-opetopes%29" class="toclink" data-pltdoc="x">2.2.5<span class="hspace">&nbsp;</span>Potential Application: Opetopes and Higher Categories</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._potential-use-case-transpension%29" class="toclink" data-pltdoc="x">2.2.6<span class="hspace">&nbsp;</span>Potential Application: Type Theories with Transpension</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._potential-use-case-custom-escape%29" class="toclink" data-pltdoc="x">2.2.7<span class="hspace">&nbsp;</span>Potential Application: User-Defined Escapes from Nestable Quotation</a></p></td></tr></table><h4 x-source-module="(lib &quot;punctaffy/scribblings/punctaffy.scrbl&quot;)" x-source-pkg="punctaffy-doc" x-part-tag="&quot;existing-use-cases&quot;">2.1<tt>&nbsp;</tt><a name="(part._existing-use-cases)"></a>Hyperbracketed Notations Predating Punctaffy</h4><ul><li><p>Trivially, <a href="taffy-notation.html#%28tech._hyperbracket%29" class="techoutside" data-pltdoc="x"><span class="techinside">hyperbrackets</span></a> of low <a href="hypersnippet-data.html#%28tech._degree%29" class="techoutside" data-pltdoc="x"><span class="techinside">degree</span></a> are hyperbrackets too: If we find ourselves in a context where a program is usually just a "sequence of instructions," then a structured <span class="stt">while</span> loop is a degree-1-<a href="baseline-notations.html#%28tech._hyperbracketed%29" class="techoutside" data-pltdoc="x"><span class="techinside">hyperbracketed</span></a> operation. (An instruction by itself is a degree-0-hyperbracketed operation.) If we learn lessons about hygienic macro system design at higher degrees, there&rsquo;s a good chance they can be extrapolated downward to tell us something about s-expression macros (degree 1) and reader macros (degree 0).</p></li><li><p>The <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._quasiquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasiquote</a></span> or <span class="stt">backquote</span> operation is probably the most widespread example. Moreover, string interpolation is even more widespread, and it&rsquo;s basically quasiquotation for text-based code.</p></li><li><p>The "apply-to-all" notation <span class="stt">&#945;(f &#8226;xs)</span> from Connection Machine Lisp (CM-Lisp) applies the same operation <span class="stt">(f _)</span> to every element of a xapping <span class="stt">xs</span> (where a xapping is a certain type of multiple-element collection). Pages 280-281 of <a href="https://web.archive.org/web/20060219230046/http://fresh.homeunix.net/~luke/misc/ConnectionMachineLisp.pdf">"Connection Machine Lisp" by Guy Steele</a> go into detail on the functionality and motivation of this operation.</p></li><li><p>Shadow DOM is an HTML feature which allows templates to be defined and instantiated. A template can have slots in it, which can have default content specified inside (in case the slot isn&rsquo;t filled at the instantiation site). The template looks like <span class="stt">&lt;template&gt;...&lt;slot name="x"&gt;...&lt;/slot&gt;...&lt;/template&gt;</span>, where the <span class="stt">...</span> inside the <span class="stt">&lt;slot&gt;</span> element is the <a href="hypersnippet-data.html#%28tech._degree%29" class="techoutside" data-pltdoc="x"><span class="techinside">degree</span></a>-1 <a href="hypersnippet-data.html#%28tech._hypersnippet%29" class="techoutside" data-pltdoc="x"><span class="techinside">hypersnippet</span></a> of default content for the slot, the slot&rsquo;s <span class="stt">name</span> attribute identifies the slot when overriding it at the instantiation site, and the rest of the template is the degree-2 hypersnippet of content that doesn&rsquo;t vary.</p></li><li><p>In a <a href="https://www.youtube.com/watch?v=dCuZkaaou0Q">2017 invited talk at Clojure/Conj</a>, Guy Steele talks about the inconsistency of computer science notation. At 53m03s, he goes into detail about a combination underline/overline notation he proposes as a way to bring more rigor to schematic formulas which iterate over vectors. He compares it to quasiquotation and the CM-Lisp <span class="stt">&#945;</span> notation.</p></li></ul><p>None of these existing examples involves a <a href="hypersnippet-data.html#%28tech._hypersnippet%29" class="techoutside" data-pltdoc="x"><span class="techinside">hypersnippet</span></a> of <a href="hypersnippet-data.html#%28tech._degree%29" class="techoutside" data-pltdoc="x"><span class="techinside">degree</span></a> 3 or greater. So, aside from the trivial degree-0 and degree-1 examples, all the examples above have degree 2.</p><h4 x-source-module="(lib &quot;punctaffy/scribblings/punctaffy.scrbl&quot;)" x-source-pkg="punctaffy-doc" x-part-tag="&quot;potential-use-cases&quot;">2.2<tt>&nbsp;</tt><a name="(part._potential-use-cases)"></a>Potential Application Areas</h4><h5 x-source-module="(lib &quot;punctaffy/scribblings/punctaffy.scrbl&quot;)" x-source-pkg="punctaffy-doc" x-part-tag="&quot;potential-use-case-hygiene&quot;">2.2.1<tt>&nbsp;</tt><a name="(part._potential-use-case-hygiene)"></a>Potential Application: Hygiene</h5><p>Hygienic macroexpansion usually generates code where certain variables are only in scope across some <a href="hypersnippet-data.html#%28tech._degree%29" class="techoutside" data-pltdoc="x"><span class="techinside">degree</span></a>-2 <a href="hypersnippet-data.html#%28tech._hypersnippet%29" class="techoutside" data-pltdoc="x"><span class="techinside">hypersnippet</span></a> of the code.</p><p>For instance, Racket first colors all the input subforms of a macro call using a new scope tag, and then it inverts that color in the result so that the color winds up only occurring on the code the macro generates itself, not the code it merely passes through.</p><p>Racket&rsquo;s strategy works, but it relies on the generation of unique tags and the creation of invisible annotations throughout the generated code.</p><p>If we were to approach hygiene by using explicit hypersnippets instead, it might lead to more straightforward or less error-prone implementations of macro hygiene. If enough people find it convenient enough to do structural recursion over nested hypersnippets, then they may find this skill lets them easily keep a lid on the local details of each hypersnippet, just as traditional forms of structural recursion make it easy to keep the details of one branch of a tree data structure from interfering with unrelated branches.</p><h5 x-source-module="(lib &quot;punctaffy/scribblings/punctaffy.scrbl&quot;)" x-source-pkg="punctaffy-doc" x-part-tag="&quot;potential-use-case-incremental-compilation&quot;">2.2.2<tt>&nbsp;</tt><a name="(part._potential-use-case-incremental-compilation)"></a>Potential Application: Incremental Compilation</h5><p>In a language like Racket where programmers can write arbitrarily complex custom syntaxes, compilation can be expensive. This can drag down the experience of editing code the DrRacket IDE, where features like jump-to-definition can depend on performing background expansion to process the user&rsquo;s custom syntaxes.</p><p>If macros weren&rsquo;t tree-to-tree transformations, but instead consumed only some small part of the tree and generated a <a href="hypersnippet-data.html#%28tech._degree%29" class="techoutside" data-pltdoc="x"><span class="techinside">degree</span></a>-2 <a href="hypersnippet-data.html#%28tech._hypersnippet%29" class="techoutside" data-pltdoc="x"><span class="techinside">hypersnippet</span></a>, then a modification of one local part of a file could lead to a pinpoint re-expansion of the specific macro call that processed that part of the file, rather than a costly re-expansion of every macro call in the whole file.</p><p>Incidentally, this would bring s-expression macro calls into a closer analogy with reader macro calls, which themselves consume some bounded part of the source text stream and generate an s-expression.</p><h5 x-source-module="(lib &quot;punctaffy/scribblings/punctaffy.scrbl&quot;)" x-source-pkg="punctaffy-doc" x-part-tag="&quot;potential-use-case-call-stacks&quot;">2.2.3<tt>&nbsp;</tt><a name="(part._potential-use-case-call-stacks)"></a>Potential Application: Abstraction-Respecting Call Stacks</h5><p>When using higher-order functional programming techniques, the call stack can sometimes be cluttered with the implementation details of higher-order functions.</p><p>For instance, if <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Flist..rkt%2529._filter%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">filter</a></span> were implemented in terms of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._append-map%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">append-map</a></span>, then call stacks observed during the execution of the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Flist..rkt%2529._filter%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">filter</a></span> predicate might look like:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">...</span></p></td></tr><tr><td><p><span class="stt">&lt;filter-callback&gt;</span></p></td></tr><tr><td><p><span class="stt">&lt;append-map-callback&gt;</span></p></td></tr><tr><td><p><span class="stt">append-map</span></p></td></tr><tr><td><p><span class="stt">filter</span></p></td></tr><tr><td><p><span class="stt">...</span></p></td></tr></table></blockquote><p>But this may be too much information if someone&rsquo;s not trying to debug the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Flist..rkt%2529._filter%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">filter</a></span> function itself. If <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Flist..rkt%2529._filter%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">filter</a></span> were implemented in a more direct way, the call stack would only show:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">...</span></p></td></tr><tr><td><p><span class="stt">&lt;filter-callback&gt;</span></p></td></tr><tr><td><p><span class="stt">filter</span></p></td></tr><tr><td><p><span class="stt">...</span></p></td></tr></table></blockquote><p>If call stacks were <a href="hyperstack.html#%28tech._hyperstack%29" class="techoutside" data-pltdoc="x"><span class="techinside">hyperstacks</span></a>, then the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Flist..rkt%2529._filter%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">filter</a></span> and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._append-map%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">append-map</a></span> calls could be <a href="hypersnippet-data.html#%28tech._degree%29" class="techoutside" data-pltdoc="x"><span class="techinside">degree</span></a>-2 hyperstack frames, essentially giving the call stack a nested structure:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">...</span></p></td></tr><tr><td><p><span class="stt">{</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">{</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">} append-map</span></p></td></tr><tr><td><p><span class="stt">} filter</span></p></td></tr><tr><td><p><span class="stt">...</span></p></td></tr></table></blockquote><p>With tools built on this infrastructure, the user could view the stack in as much or as little detail as they&rsquo;d like, using UI toggles or a verbosity-controlling stylesheet to collapse and expand sections of interest.</p><h5 x-source-module="(lib &quot;punctaffy/scribblings/punctaffy.scrbl&quot;)" x-source-pkg="punctaffy-doc" x-part-tag="&quot;potential-use-case-ellipsis-unsyntax&quot;">2.2.4<tt>&nbsp;</tt><a name="(part._potential-use-case-ellipsis-unsyntax)"></a>Potential Application: Interactions Between <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fqqstx..rkt%2529._unsyntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unsyntax</a></span> and Ellipses</h5><p>In <a href="intro.html" data-pltdoc="x">Introduction to Punctaffy</a>, we talk about the relationship between <a href="hypersnippet-data.html#%28tech._hypersnippet%29" class="techoutside" data-pltdoc="x"><span class="techinside">hypersnippets</span></a> and Racket&rsquo;s <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax</a></span> DSL for syntax templates (or, more specifically, its <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Datum_Pattern_Matching.html%23%2528form._%2528%2528lib._syntax%252Fdatum..rkt%2529._datum%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">datum</a></span> DSL for s-expression templates).</p><p>The <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fqqstx..rkt%2529._quasisyntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasisyntax</a></span> form (abbreviated <span class="stt">#</span>`) introduces the quasiquotation-like ability to use <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fqqstx..rkt%2529._unsyntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unsyntax</a></span> and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fqqstx..rkt%2529._unsyntax-splicing%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unsyntax-splicing</a></span> (abbreviated <span class="stt">#,</span> and <span class="stt">#,@</span>) to interpolate arbitrary expression results into a template.</p><p>There&rsquo;s a noticeable missed opportunity in the current design of the DSL, and it has to do with how these interpolated expressions interact with ellipses (<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span>). Usually, ellipses iterate the template they apply to, and template variables have an associated ellipsis depth that specifies how many dimensions of nested iteration they should undergo (usually because they were created by matching a <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span> or <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax-case%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-case</a></span> template with the same number of nested ellipses).</p><p>However, expressions interpolated with <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fqqstx..rkt%2529._unsyntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unsyntax</a></span> don&rsquo;t have any ellipsis depth information. Even if they contain another <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax</a></span> or <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fqqstx..rkt%2529._quasisyntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasisyntax</a></span> call inside, the variables in that second call can&rsquo;t interact with the ellipses in the first call. For insatnce, the following doesn&rsquo;t work, because <span class="RktVar">pat</span> and <span class="RktVar">val</span> only occur in the template <span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktVar">pat</span><span class="stt"> </span><span class="RktVar">val</span><span class="RktPn">)</span>, not in the template that has the ellipsis:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">match-let/derived</span><span class="hspace">&nbsp;</span><span class="RktVar">stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span><span class="hspace">&nbsp;</span><span class="RktVar">stx</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktVar">orig-stx</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVar">pat</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxcerts.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax-protect%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax-protect</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#`</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#,</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._datum-%7E3esyntax%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">datum-&gt;syntax</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktRdr">,</span><span class="RktRdr">#'</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match-define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match-define</a></span><span class="hspace">&nbsp;</span><span class="RktRdr">,@</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktVar">pat</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktVar">orig-stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVar">body</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>(TODO: See if we can make this a better example. The idea here is that the macro defines something like a cross between <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match%252Fderived%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match/derived</a></span> and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match-let%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match-let</a></span>, and it manipulates the call to <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match-define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match-define</a></span> to insert the source location of the given term to help with accurate error-reporting. However, we haven&rsquo;t tested that this manipulation would actually improve the error-reporting this way, and using the actual <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match%252Fderived%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match/derived</a></span> would likely be a better idea than trying to make <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match-define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match-define</a></span> work just right.)</p><p>Incidentally, the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax</a></span> DSL already has an experimental feature that caters to this situation: template metafunctions. A template metafunction can run arbitrary code during the iteration of a template:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">match-let/derived</span><span class="hspace">&nbsp;</span><span class="RktVar">stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span><span class="hspace">&nbsp;</span><span class="RktVar">stx</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktVar">orig-stx</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVar">pat</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Experimental.html%23%2528form._%2528%2528lib._syntax%252Fparse%252Fexperimental%252Ftemplate..rkt%2529._define-template-metafunction%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-template-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">reattributed-match-define</span><span class="hspace">&nbsp;</span><span class="RktVar">stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span><span class="hspace">&nbsp;</span><span class="RktVar">stx</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktVar">pat</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._datum-%7E3esyntax%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">datum-&gt;syntax</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktRdr">,</span><span class="RktRdr">#'</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match-define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match-define</a></span><span class="hspace">&nbsp;</span><span class="RktRdr">,@</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktVar">pat</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktVar">orig-stx</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxcerts.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax-protect%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax-protect</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktVar">reattributed-match-define</span><span class="hspace">&nbsp;</span><span class="RktVar">pat</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVar">body</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>However, using <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Experimental.html%23%2528form._%2528%2528lib._syntax%252Fparse%252Fexperimental%252Ftemplate..rkt%2529._define-template-metafunction%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-template-metafunction</a></span> substantially rearranges the code. That can be good in cases like this one, where the concept can be associated with a simple name and interface. On the other hand, <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fqqstx..rkt%2529._unsyntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unsyntax</a></span> comes in handy in situations where the code&rsquo;s navigability benefits from having some structural resemblance to the results it produces, or in situations where multiple DSLs have synergy together but haven&rsquo;t yet been fused into a single monolithic DSL.</p><p>If for some reason we have a strong preference to arrange this code in the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fqqstx..rkt%2529._unsyntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unsyntax</a></span> style, then what we really need here is for <span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktVar">pat</span><span class="stt"> </span><span class="RktVar">val</span><span class="RktPn">)</span> not to be a <span class="emph">new</span> template but a <span class="emph">resumption</span> of the original syntax. We need some kind of <span class="stt">un-unsyntax</span>, perhaps abbreviated <span class="stt">#,!</span>. Then we could replace <span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktVar">pat</span><span class="stt"> </span><span class="RktVar">val</span><span class="RktPn">)</span> with <span class="stt">#,!</span><span class="RktPn">(</span><span class="RktVar">pat</span><span class="stt"> </span><span class="RktVar">val</span><span class="RktPn">)</span> and be on our way.</p><p>The concept of <span class="stt">un-unsyntax</span> fits neatly into the hypersnippet concept we explore in Punctaffy. We can consider <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fqqstx..rkt%2529._quasisyntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasisyntax</a></span> to be opening a <a href="hypersnippet-data.html#%28tech._degree%29" class="techoutside" data-pltdoc="x"><span class="techinside">degree</span></a>-3 hypersnippet, <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fqqstx..rkt%2529._unsyntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unsyntax</a></span> to be opening a degree-2 <a href="hypersnippet-data.html#%28tech._hole%29" class="techoutside" data-pltdoc="x"><span class="techinside">hole</span></a> in that hypersnippet, and <span class="stt">un-unsyntax</span> to be opening a degree-1 hole in that degree-2 hole.</p><p>Punctaffy currently defines a <span class="RktSym"><a href="hyperbracketed-util.html#%28form._%28%28lib._punctaffy%2Fquote..rkt%29._taffy-quote-syntax%29%29" class="RktStxLink" data-pltdoc="x">taffy-quote-syntax</a></span> operation, but it corresponds to <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Syntax_Quoting__quote-syntax.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote-syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quote-syntax</a></span> rather than the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax</a></span> template DSL. Suppose Punctaffy were to define a <span class="stt">taffy-syntax</span> operation in that combined spirit, which used <a href="baseline-notations.html" data-pltdoc="x">Punctaffy&rsquo;s baseline hyperbrackets</a> and had support for <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax</a></span> DSL features like ellipses. Using that operation, the above code could look like this:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">match-let/derived</span><span class="hspace">&nbsp;</span><span class="RktVar">stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span><span class="hspace">&nbsp;</span><span class="RktVar">stx</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktVar">orig-stx</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVar">pat</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxcerts.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax-protect%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax-protect</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">taffy-syntax</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3cd%29%29" class="RktStxLink" data-pltdoc="x">^&lt;d</a></span><span class="hspace">&nbsp;</span><span class="RktVal">3</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3ed%29%29" class="RktStxLink" data-pltdoc="x">^&gt;d</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._datum-%7E3esyntax%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">datum-&gt;syntax</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktRdr">,</span><span class="RktRdr">#'</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match-define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match-define</a></span><span class="hspace">&nbsp;</span><span class="RktRdr">,@</span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3e%29%29" class="RktStxLink" data-pltdoc="x">^&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">pat</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktVar">orig-stx</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVar">body</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>This seems to be a rare example of where a degree-3 hypersnippet specifically would come in handy. Most of the things we say about hypersnippets of degree 3 aren&rsquo;t so specific; they would make just as much sense at degree 4, 5, etc.</p><p>This example seems like an instance of a pattern, though: The basic principle of this example is that we want two different invocations of an embedded DSL to be part of the same "whole program" to allow some nonlocal interaction between them. The nonlocal interactions here aren&rsquo;t too exotic; they&rsquo;re basically lexically scoped variables, with ellipses acting as the binding sites.</p><p>Other embedded DSLs with lexically scoped interactions, such as type inference and type-directed elaboration, may similarly benefit from degree-3 lexical structure.</p><h5 x-source-module="(lib &quot;punctaffy/scribblings/punctaffy.scrbl&quot;)" x-source-pkg="punctaffy-doc" x-part-tag="&quot;potential-use-case-opetopes&quot;">2.2.5<tt>&nbsp;</tt><a name="(part._potential-use-case-opetopes)"></a>Potential Application: Opetopes and Higher Categories</h5><p>An opetope is a kind of geometric shape that arises in certain formulations of higher category theory.</p><p>A category is like the collection of paths in a directed graph: Two paths (called morphisms) can match up end-to-end, and if they do, together they make a single path. Path-joining like this is associative; if we join some number of paths together this way, it doesn&rsquo;t matter which ones we join first.</p><p>Higher category theory extends this to higher-dimensional shapes. If two paths share both their endpoints, we can think of a soap bubble where current flows across from one of them to the other, a path between paths (called a 2-cell). And given two of these, we can imagine a geometric solid where current flows from one of these faces to the other (called a 3-cell).</p><p>We can study more subtle category-like systems this way: Instead of simply knowing whether two paths are equal or not, we can point to a 2-cell and say they&rsquo;re equivalent according to this specific equivalence that translates between them. This is appealing to many category theorists, because a lot of interesting category-theoretic results don&rsquo;t depend at all on whether paths have <span class="emph">particular endpoints</span> (called objects), only that when joining paths, there&rsquo;s some equivalence-like way to join up one endpoint to another. Once we&rsquo;re looking at 2-cells, a lot of interesting results have nothing to do with what specific 1-cells/paths/morphisms they begin and end at.</p><p>However, this kind of generalization also makes it quite a bit more difficult to formalize the meaning of a higher category. A number of different formalizations exist.</p><p>What we&rsquo;ve described just now is a <span class="emph">globular</span> approach, where each cell of dimension (N + 1) begins at a cell of dimension N and ends at another cell of dimension N with the same endpoints.</p><p>Perhaps we should instead take a <span class="emph">cubical</span> approach, where the source and target don&rsquo;t necessarily have "the same" endpoints, just edges that are related by other cells. Then a 2-cell is shaped like a square, a 3-cell is a cube, and higher cells are hypercubes.</p><p>Or perhaps we could take a <span class="emph">simplicial</span> approach, where the higher cells that mediate compositions of two paths are triangles, the ones that mediate compositions of three paths are tetrahedra, and the ones that mediate compositions of more paths are higher-dimensional simplex polytopes.</p><p>But one of the approaches is what we&rsquo;re here for, because it resembles Punctaffy&rsquo;s <a href="hypersnippet-data.html#%28tech._hypersnippet%29" class="techoutside" data-pltdoc="x"><span class="techinside">hypersnippets</span></a>: The <span class="emph">opetopic</span> approach.</p><p><a name="(tech._opetope)"></a><span style="font-style: italic">Opetopes</span> are another set of higher-dimensional shapes like hypercubes or simplexes. An <a name="(tech._opetopic)"></a><span style="font-style: italic">opetopic</span> cell of dimension (N + 1) has a target cell of dimension N and any number of source cells of dimension N that are in a composable arrangement. For instance, an opetopic 2-cell ends at a path, and it begins with any number of paths aligned end-to-end. This makes opetopic 2-cells just the right shape for saying "this arrangement of paths composes to make something that&rsquo;s related to this other path in this particular way." Opetopic 3-cells are good for the same thing, but they relate a composable arrangement of 2-cells (i.e. a tree) to a single 2-cell. Since these are many-input, single-output relations, a composition of 2-cells tends to look like a tree, and higher cells are composed along "higher-dimensional trees."</p><p>The peculiar shape of opetopes lets us talk about composition at the same time as we talk about cells being related to each other. Instead of postulating ideas of composition and equivalence as separate ideas, we can define them both in terms of the existence of certain opetopic cells. If we&rsquo;re looking for a cell that acts as the composition of some composable arrangement of cells, all we need is for the arrangement to be the source of some equivalence-like cell; that way the target of that cell is the composition we&rsquo;re looking for (or equivalent to it, which is just as good). Once we have composition, we can also use cells like these to relate one arrangement to another, by first taking the composition of the target arrangement and making that the target cell of another opetope. In this fashion, we can build up a theory of weak higher categories by merely requiring that enough equivalence-like cells exist (and are actually equivalence-like in their relationships with each other).</p><p>Now we can finally relate opetopes to hypersnippets, specifically <a href="hypersnippet-data.html#%28tech._hypertee%29" class="techoutside" data-pltdoc="x"><span class="techinside">hypertees</span></a>. At low dimensions, there&rsquo;s a striking resemblance: <a href="hypersnippet-data.html#%28tech._degree%29" class="techoutside" data-pltdoc="x"><span class="techinside">Degree</span></a>-2 hypertees are shaped like <span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3c%29%29" class="RktStxLink" data-pltdoc="x">^&lt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3e%29%29" class="RktStxLink" data-pltdoc="x">^&gt;</a></span><span class="stt"> </span><span class="RktVar">_</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3e%29%29" class="RktStxLink" data-pltdoc="x">^&gt;</a></span><span class="stt"> </span><span class="RktVar">_</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3e%29%29" class="RktStxLink" data-pltdoc="x">^&gt;</a></span><span class="stt"> </span><span class="RktVar">_</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span> with some number of degree-1 <a href="hypersnippet-data.html#%28tech._hole%29" class="techoutside" data-pltdoc="x"><span class="techinside">holes</span></a> in sequence, which looks just like the way an opetopic 2-cell represents a composition of any number of paths. There&rsquo;s only one degree-0 hypertee, and only one degree-1 hypertee, and the same is true for dimension-0 and dimension-1 opetopes. At degree 3, the degree-2 holes of a hypertee can be arranged like a tree, and the source cells of a dimension-3 opetope are also arranged like a tree.</p><p>However, there does seem to be a discrepancy. This is apparent when we look at algebraic data types that represent opetopes and hypersnippets.</p><p>The slide deck <a href="https://ncatlab.org/nlab/files/FinsterTypesAndOpetopes2012.pdf">"Type Theory and the Opetopes"</a> by Eric Finster gives a richly illustrated overview of opetopes as they&rsquo;re used in opetopic higher category theory and opetopic type theory. One slide mentions a type <span class="stt">MTree</span> representing "possible ill-typed A-labeled pasting diagrams":</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">data MTree (A : Set) : N &#8594; Set where</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">obj : MTree A 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">drop : {n : N} &#8594; MTree &#8868; n &#8594; MTree A (n + 2)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">node : {n : N} &#8594; A &#8594; MTree (MTree A (n + 1)) n &#8594; MTree A (n + 1)</span></p></td></tr></table></blockquote><p>This corresponds to three mutually exclusive kinds of opetopes:</p><ul><li><p>An opetope can be the trivial dimension-0 opetope, which has no targets or sources.</p></li><li><p>An dimension-(<span class="emph">n</span> + 2) opetope&rsquo;s composable arrangement of dimension-(<span class="emph">n</span> + 1) source cells can be a trivial arrangement of zero source cells. In that case, its dimension-(<span class="emph">n</span> + 1) target cell is shaped like an identity element of dimension-(<span class="emph">n</span> + 1) cell composition. That dimension-(<span class="emph">n</span> + 1) target cell must have a single dimension-<span class="emph">n</span> source cell of the same shape as its dimension-<span class="emph">n</span> target cell. This kind of opetope is called a "drop" due to the teardrop-like way it can be illustrated: The zero source cells effectively pinch the two sides of the target cell together into a teardrop. There&rsquo;s one of these dimension-(<span class="emph">n</span> + 2) opetopes for each of the dimension-<span class="emph">n</span> opetopes (the endpoints that are pinched together).</p></li><li><p>Finally, a dimension-(<span class="emph">n</span> + 1) opetope&rsquo;s composable arrangement of source cells can consist of a nonzero number of cells. In this case, one of these dimension-<span class="emph">n</span> source cells in the arrangement can be identified by its incidence with the the target cell&rsquo;s target cell (if dimension (<span class="emph">n</span> + 1) is at least 2). The rest can be grouped into sub-arrangements of dimension (<span class="emph">n</span> + 1), each of which targets one of the identified source cell&rsquo;s source cells. (If the dimension (<span class="emph">n</span> + 1) is only 1, then there&rsquo;s precisely one dimension-<span class="emph">n</span> source cell, which we can serendipitously talk about the same way since that source cell no source cells of its own for the sub-arrangements to target.)</p></li></ul><p>In short, an opetope falls into one of three cases: Either it&rsquo;s the trivial dimension-0 opetope where sources aren&rsquo;t allowed at all, it has no sources, or it has at least one source.</p><p>As for hypersnippets, an analogous data type definition for possible ill-typed A-labeled hypertees would look like this:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">data Hypertee (A : Set) : N &#8594; Set where</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">zero : Hypertee A 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">hole :</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">{m, n : N} &#8594; {m &lt; n} &#8594; A &#8594; Hypertee (Hypertee A n) m &#8594;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">Hypertee A n</span></p></td></tr></table></blockquote><p>These cases correspond to <span class="RktSym"><a href="hypertee.html#%28form._%28%28lib._punctaffy%2Fhypersnippet%2Fhypertee..rkt%29._hypertee-coil-zero%29%29" class="RktStxLink" data-pltdoc="x">hypertee-coil-zero</a></span> and <span class="RktSym"><a href="hypertee.html#%28form._%28%28lib._punctaffy%2Fhypersnippet%2Fhypertee..rkt%29._hypertee-coil-hole%29%29" class="RktStxLink" data-pltdoc="x">hypertee-coil-hole</a></span>, and we can describe them like this:</p><ul><li><p>A hypertee can be the trivial degree-0 hypertee, which has no holes.</p></li><li><p>A degree-<span class="emph">n</span> hypertee can have at least one hole. In that case, the first hole has some dimension <span class="emph">m</span> such that (<span class="emph">m</span> &lt; <span class="emph">n</span>). The rest of the hypertee&rsquo;s arrangement of holes can be grouped into sub-arrangements which correspond to other degree-<span class="emph">n</span> hypertees.</p></li></ul><p>Going from opetopes to hypertees, we notably lose the existence of "drop" opetopes, but the "at least one" case has become more lenient and admits more hypertees to take the place of what we lost. Specifically, the "at least one" case no longer limites us to incrementing the dimension by precisely 1.</p><p>This gives us all the shapes we had before. The degree-2 hypertee <span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3c%29%29" class="RktStxLink" data-pltdoc="x">^&lt;</a></span><span class="RktPn">)</span> has zero degree-1 holes <span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3e%29%29" class="RktStxLink" data-pltdoc="x">^&gt;</a></span><span class="stt"> </span><span class="RktVar">_</span><span class="RktPn">)</span>, and in this way it is exactly the same shape as the "drop" dimension-2 opetope which has zero degree-1 source cells. However, we don&rsquo;t represent it by a zero-hole "drop" case; we represent it as having at least one hole: Its <span class="emph">degree-0</span> hole. The degree-0 hole corresponds not to one of the dimension-2 opetope&rsquo;s dimension-1 source cells, but to its dimension-1 target cell&rsquo;s dimension-0 source cell. We can similarly encode any other "drop" opetope as a hypertee by encoding its target cell (which is not itself a "drop" opetope since it has one source cell) and then adjusting that encoding to have a degree 1 greater.</p><p>In fact, we have some hypertees that don&rsquo;t correspond to any opetopes. For instance, the degree-2 hypertee <span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3c%29%29" class="RktStxLink" data-pltdoc="x">^&lt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3e%29%29" class="RktStxLink" data-pltdoc="x">^&gt;</a></span><span class="stt"> </span><span class="RktVar">_</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3e%29%29" class="RktStxLink" data-pltdoc="x">^&gt;</a></span><span class="stt"> </span><span class="RktVar">_</span><span class="RktPn">)</span><span class="RktPn">)</span> corresponds to an opetope, but setting its degree to 3 gives us a degree-3 hypertee <span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3cd%29%29" class="RktStxLink" data-pltdoc="x">^&lt;d</a></span><span class="stt"> </span><span class="RktVal">3</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3e%29%29" class="RktStxLink" data-pltdoc="x">^&gt;</a></span><span class="stt"> </span><span class="RktVar">_</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3e%29%29" class="RktStxLink" data-pltdoc="x">^&gt;</a></span><span class="stt"> </span><span class="RktVar">_</span><span class="RktPn">)</span><span class="RktPn">)</span> that has no such correspondence. This hypertee isn&rsquo;t a drop, because a drop&rsquo;s target must have exactly one source (of the same shape as its target, so that it can represent an identity element that unimposingly slots into compositions along that shape).</p><p>On the other hand, if we turn our attention to the role of these shapes as conceptual notations for higher category theory, then in some sense it makes sense for <span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3cd%29%29" class="RktStxLink" data-pltdoc="x">^&lt;d</a></span><span class="stt"> </span><span class="RktVal">3</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3e%29%29" class="RktStxLink" data-pltdoc="x">^&gt;</a></span><span class="stt"> </span><span class="RktVar">_</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3e%29%29" class="RktStxLink" data-pltdoc="x">^&gt;</a></span><span class="stt"> </span><span class="RktVar">_</span><span class="RktPn">)</span><span class="RktPn">)</span> to be a "drop." That&rsquo;s because, while the degree-2 target <span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3c%29%29" class="RktStxLink" data-pltdoc="x">^&lt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3e%29%29" class="RktStxLink" data-pltdoc="x">^&gt;</a></span><span class="stt"> </span><span class="RktVar">_</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3e%29%29" class="RktStxLink" data-pltdoc="x">^&gt;</a></span><span class="stt"> </span><span class="RktVar">_</span><span class="RktPn">)</span><span class="RktPn">)</span> isn&rsquo;t syntactically identity-shaped the way <span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3c%29%29" class="RktStxLink" data-pltdoc="x">^&lt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="baseline-notations.html#%28form._%28%28lib._punctaffy%2Fmain..rkt%29._~5e~3e%29%29" class="RktStxLink" data-pltdoc="x">^&gt;</a></span><span class="stt"> </span><span class="RktVar">_</span><span class="RktPn">)</span><span class="RktPn">)</span> is, it&rsquo;s still <span class="emph">semantically</span> identity-shaped: A higher category has an equivalence-like cell of this shape&#8212;<wbr></wbr>namely, one of the 2-cells that relates two composable paths to the combined path they become.</p><p>The story isn&rsquo;t as simple as saying that there are more hypertees than opetopes. The two approaches seem to have an affinity for different kinds of generalization:</p><ul><li><p>Opetopes are typically defined by iterating a <span class="emph">slice construction</span> taking one symmetric operad or symmetric multicategory to another. The "symmetric" part means there sources of an opetopic cell are an orderless collection.</p><p>The Punctaffy authors don&rsquo;t yet (TODO) understand the reason for this. It seems the cells can be assigned an ordering by, for instance, iterating over each tree of a zoom complex in depth-first order according to the branch ordering we established in the previous tree, and numbering the circles as we first arrive at them to establish the branch ordering of the next tree. But we suppose the slice construction could potentially be applied to an operad or multicategory that isn&rsquo;t trivial enough for this to work. As long as most of the work on opetopic theories works with this kind of slice construction, its results will likely be transportable to those less trivial base operads/multicategories. (The paper <a href="https://mat.uab.cat/~kock/cat/0706.1033v2.pdf">"Polynomial functors and opetopes"</a> by Joachim Kock, Andr&#233; Joyal, Michael Batanin, and Jean-Fran&#231;ois Mascari goes into detail on zoom complexes and might even contain information as to why the symmetric approach is necessary.)</p><p>This kind of generality doesn&rsquo;t seem like a focus of hypersnippets. Hypersnippets are primarily motivated by giving structure to a text file, a context where the syntax does have an innate order that we can work with. In particular, the design of <a href="taffy-notation.html#%28tech._hyperbracket%29" class="techoutside" data-pltdoc="x"><span class="techinside">hyperbracket</span></a> notation and the <a href="hyperstack.html#%28tech._hyperstack%29" class="techoutside" data-pltdoc="x"><span class="techinside">hyperstacks</span></a> to parse it likely relies intrinsically on syntax having an ordering so that the brackets can be associated with their closest matches.</p></li><li><p>Since the definition of hypertees doesn&rsquo;t rely on adding 1 or 2 to a dimension number, hypertees can be generalized across any <a href="hypersnippet-data.html#%28tech._dimension._system%29" class="techoutside" data-pltdoc="x"><span class="techinside">dimension system</span></a>. (Dimension systems seem to be semilattices.) We sometimes make use of this as an implementation technique, by constructing a modified dimension system that gives us the hypertees we need for our intermediate representations. Typically when we do this, we simply add a new greatest element to the dimension system, giving us "degree-infinity" hypersnippets to work with.</p><p>With opetopes, by defining them via the iteration of a slice construction on a base operad/multicategory, it&rsquo;s generally possible to prove things about them by doing induction on the dimension of an opetope. (TODO: Is that right?)</p><p>In Punctaffy, since hypersnippets are motivated by syntax, and since programs have syntax of finite size, we can count on each hypersnippet to have a finite number of holes. This already seems to be a way to keep our recursive constructions well-founded, so induction over the degree of a hypersnippet doesn&rsquo;t seem to be as necessary.</p></li></ul><p>Still, hypertees and opetopes are two systems that seem to have a lot in common. This finally brings us to the potential applications:</p><p>It&rsquo;s quite likely Punctaffy will be easier to explain if we borrow some of the graphical visualization techniques from the existing body of work on opetopes. Conversely, we suspect opetopic type theory in particular would benefit from hyperbrackets as a more intuitive notation for specifying opetopic shapes in textual code.</p><p>If hypertees aren&rsquo;t quite the same as opetopes, then perhaps hypertees constitute yet another geometry for higher category theory, alongside shapes like hypercubes and simplexes. Perhaps this approach to higher category theory would be more appealing than the others in some ways, at least thanks to the ease of representing its higher-dimensional shapes in textual code if nothing else.</p><p>If we pursue hypersnippet-shaped higher category theory, then Punctaffy&rsquo;s progress so far can give us some clues as to how that theory might be formulated. In particular, the <a href="hypersnippet-data.html#%28tech._snippet._system%29" class="techoutside" data-pltdoc="x"><span class="techinside">snippet system</span></a> interface likely bears a strong resemblance to the interface of an internalized hypersnippet-based higher category, similar to the way the Haskell <span class="stt">Category</span> type class can be seen as the interface of an internalized 1-category.</p><h5 x-source-module="(lib &quot;punctaffy/scribblings/punctaffy.scrbl&quot;)" x-source-pkg="punctaffy-doc" x-part-tag="&quot;potential-use-case-transpension&quot;">2.2.6<tt>&nbsp;</tt><a name="(part._potential-use-case-transpension)"></a>Potential Application: Type Theories with Transpension</h5><p>The paper <a href="https://arxiv.org/pdf/2008.08533.pdf">"Transpension: The Right Adjoint to the Pi-type"</a> by Andreas Nuyts and Dominique Devriese discusses several type theories that have operations that we might hope to connect with what Punctaffy is doing. Transpension appears to be making use of <a href="hypersnippet-data.html#%28tech._degree%29" class="techoutside" data-pltdoc="x"><span class="techinside">degree</span></a>-2 <a href="hypersnippet-data.html#%28tech._hypersnippet%29" class="techoutside" data-pltdoc="x"><span class="techinside">hypersnippets</span></a> in its syntax.</p><p>Essentially (and if we understand correctly), a transpension operation declares a variable that represents some unknown coordinate along a new dimension. At some point in the scope of that dimension variable, another operation takes ownership of it, taking the original dimension variable and all the variables that depended on it since then out of scope, but replacing the latter with reusable functions that can be applied repeatedly to different coordinate values of the user&rsquo;s choice.</p><p>From a Punctaffy perspective, the dimension variable&rsquo;s original scope is a degree-2 hypersnippet, and the operation that takes it out of scope (and converts other variables to functions) is located at one of the degree-1 closing <a href="taffy-notation.html#%28tech._hyperbracket%29" class="techoutside" data-pltdoc="x"><span class="techinside">hyperbrackets</span></a> of that hypersnippet.</p><p>Curiously, the degree-2 hypersnippet also gets closed by degree-1 closing hyperbrackets at the <span class="emph">type</span> level; we might say these type theories assign types to terms that have unmatched closing hyperbrackets. They also have lambdas that <span class="emph">abstract over</span> terms that have unmatched closing hyperbrackets, so the journey of a closing hyperbracket through the codebase to find its match can potentially be rather circuitous.</p><p>At any rate, these dimension variables have affine (use-at-most-once) types, which can sometimes seem odd in the context of a type theory where the rest of the variables are Cartesian (use-any-number-of-times). By relating transpension operators to hyperbrackets, we may give the affine typing situation some more clarity: A "closing bracket" can&rsquo;t match up with an "opening bracket" that&rsquo;s already been closed.</p><p>And conversely, by relating the two, we may find techniques for understanding Punctaffy&rsquo;s hyperbrackets in terms of affine variables in a type theory rather than the other way around. This kind of insight may come in handy for studying the categorical semantics of a calculus that has <a href="baseline-notations.html#%28tech._hyperbracketed%29" class="techoutside" data-pltdoc="x"><span class="techinside">hyperbracketed</span></a> operations, or even for implementing hyperbracket libraries like Punctaffy for typed languages.</p><h5 x-source-module="(lib &quot;punctaffy/scribblings/punctaffy.scrbl&quot;)" x-source-pkg="punctaffy-doc" x-part-tag="&quot;potential-use-case-custom-escape&quot;">2.2.7<tt>&nbsp;</tt><a name="(part._potential-use-case-custom-escape)"></a>Potential Application: User-Defined Escapes from Nestable Quotation</h5><p>Pairs of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._quasiquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasiquote</a></span> and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._unquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unquote</a></span> can be seamlessly nested within each other as long as they match up. The situation is less convenient for string literal syntaxes, which typically require nested occurrences to be escaped:</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"(displayln \"(displayln \\\"Hello, world!\\\")\")"</span><span class="RktPn">)</span></p></blockquote><p>A rethought design for string syntaxes, using more distinctive string delimiters like <span class="stt">"{</span> and <span class="stt">}"</span>, can give strings the ability to recognize nested occurrences of <span class="stt">"{</span> the way <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._quasiquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasiquote</a></span> does:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">(displayln "{(displayln "{(displayln "{Hello, world!}")}")}")</span></p></td></tr></table></blockquote><p>However, string syntaxes also complicate matters in a way that doesn&rsquo;t come up as often with <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._quasiquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasiquote</a></span>: String syntaxes have a wide variety of escape sequences.</p><p>In fact, if we take a look at s-expression quotation DSLs other than <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._quasiquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasiquote</a></span>, this <span class="emph">does</span> come up: For instance, <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax</a></span> templates have the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span>, <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._%7E7e%7E40%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~@</a></span>, and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._%7E7e%7E3f%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~?</a></span> directives, and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span> patterns have a wide variety of directives like <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eseq%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~seq</a></span> and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eoptional%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~optional</a></span>. Users can even define their own operations like <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eseq%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~seq</a></span> and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eoptional%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~optional</a></span> by using <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528def._%2528%2528lib._syntax%252Fparse..rkt%2529._prop%7E3apattern-expander%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">prop:pattern-expander</a></span>. (And from a certain point of view, most languages are trivial "quotation DSLs" where nothing at all is quoted and every single term is an escape sequence.)</p><p>When an escape sequence appears inside multiple layers of quotation, there&rsquo;s an ambiguity issue: Which layer of quotation does it escape from? Should a string escape sequence be processed right away as part of the first string literal, or should it become part of the generated code to be processed as part of the next one (or the one after that)?</p><p>While this suggests some ambiguity in the user&rsquo;s intent, there&rsquo;s no corresponding wiggle room in the design. When we consider the point of recognizing nested occurrences in the first place, one design stands out: If we associate escape sequences specifically with the innermost quotation, we can successfully write a string literal the same way whether we&rsquo;re inside or outside another string literal.</p><p>That ambiguity in the user&rsquo;s intent does exist, though. Sometimes the user may <span class="emph">intend</span> to escape from an outer quotation. In that case, they can use a more elaborate notation to specify what layer they have in mind, such as writing <span class="stt">\[LABEL]x20</span> instead of <span class="stt">\x20</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">(displayln "[OUTER]{(displayln "{Hello,\[OUTER]x20world!}")}")</span></p></td></tr></table></blockquote><p>One implication of this design is that when we process an escape sequence like <span class="stt">\x20</span>, we might treat it in two different ways depending on context: If it&rsquo;s associated with the outermost stage of quotation, we fully process it, turning <span class="stt">\x20</span> into a space character. If it&rsquo;s associated with some inner stage of quotation, we suppress it, treating <span class="stt">\x20</span> as the four characters <span class="stt">\ x 2 0</span>.</p><p>Note that even when we suppress an escape sequence, we still need to <span class="emph">recognize</span> it to know where it ends. That means in the implementation of even our simplest escape sequences, we&rsquo;ll need a couple of behaviors:</p><ul><li><p>Process an unbounded input to determine what prefix of it is the escape sequence&rsquo;s bounded input.</p></li><li><p>Once we know the bounded input to determine what the interpretation of this escape sequence is (often just some escaped content, but sometimes a more sophisticated behavior like <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eoptional%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~optional</a></span>).</p></li></ul><p>For string escape sequences, expressing the boundary is simple, and the bounded input is some substring of the string literal&rsquo;s code. For instance, in <span class="RktVal">"Hello, world..."</span>, the <span class="stt">x</span> escape sequence might process the unbounded input <span class="stt">20world...</span> and determine that its bounded input is <span class="stt">20</span>. If the escape sequence is being suppressed, then we stop there and treat that bounded input as literal text. Otherwise, we invoke the <span class="stt">x</span> escape sequence&rsquo;s second step to detemine what it represents (a space character). Either way, we then turn our attention to the rest of the input (<span class="stt">world...</span>) and process the escape sequences we find there.</p><p>Punctaffy&rsquo;s infrastructure starts to come in handy when we apply this design to s-expression escape sequences. There, the bounded input is a <a href="hypersnippet-data.html#%28tech._degree%29" class="techoutside" data-pltdoc="x"><span class="techinside">degree</span></a>-2 <a href="hypersnippet-data.html#%28tech._hypersnippet%29" class="techoutside" data-pltdoc="x"><span class="techinside">hypersnippet</span></a> of code.</p><p>This quotation DSL design&#8212;<wbr></wbr>specifically this particular way it leads to degree-2 hypersnippets&#8212;<wbr></wbr>is actually the original motivating force behind Punctaffy.</p><p>For a couple of other reasons, the infrastructure we need to complete a DSL like this is still not straightorward to build, even with Punctaffy&rsquo;s hypersnippets in our toolkit:</p><ul><li><p>If we just have <a href="baseline-notations.html#%28tech._hyperbracketed._code%29" class="techoutside" data-pltdoc="x"><span class="techinside">hyperbracketed code</span></a>, how do we know which <a href="taffy-notation.html#%28tech._hyperbracket%29" class="techoutside" data-pltdoc="x"><span class="techinside">hyperbrackets</span></a> delimit <span class="emph">quoted</span> sections of code that should suppress our escape sequences? After all, in the examples above, we wouldn&rsquo;t expect the parentheses around the <span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="stt"> </span><span class="RktVar">...</span><span class="RktPn">)</span> call to be delimiting a quoted section of code, and the same is true of degree-2 hyperbrackets when they&rsquo;re used in the <span class="RktSym"><a href="hyperbracketed-util.html#%28form._%28%28lib._punctaffy%2Flet..rkt%29._list-taffy-map%29%29" class="RktStxLink" data-pltdoc="x">list-taffy-map</a></span> or <span class="RktSym"><a href="hyperbracketed-util.html#%28form._%28%28lib._punctaffy%2Flet..rkt%29._taffy-let%29%29" class="RktStxLink" data-pltdoc="x">taffy-let</a></span> operations. We might want to create a slightly more complex analogue of hyperbracketed code where instead of just having an interoperable notation for hyperbracketed lexical structure, we also have interoperable notations for quotation boundaries and escape sequences.</p></li><li><p>One of the techniques we mention above is to use <span class="stt">\[LABEL]x20</span> as a way to specify which quotation stage the escape sequence <span class="stt">\x20</span> should be processed in. What happens if we want to apply that kind of label to an <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._unquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unquote</a></span>?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVar">place</span><span class="hspace">&nbsp;</span><span class="RktVal">"world"</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._writeln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">writeln</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._quasiquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasiquote</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:label</span><span class="hspace">&nbsp;</span><span class="RktVar">OUTER</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._writeln%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">writeln</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._quasiquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasiquote</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktVal">"hello"</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._unquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unquote</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:to-label</span><span class="hspace">&nbsp;</span><span class="RktVar">OUTER</span><span class="hspace">&nbsp;</span><span class="RktVar">place</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>If we do that, we might expect our labeled <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._unquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unquote</a></span> to skip over one <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._quasiquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasiquote</a></span> to match a labeled <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._quasiquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasiquote</a></span> beyond it, but isn&rsquo;t obvious how to denote that interaction in terms of hyperbrackets or how to manipulate that kind of structure in terms of hypersnippet-shaped data.</p><p>One approach we might take to this is to use hypersnippets of almost impredicatively infinite degree, where we don&rsquo;t quite get to say we have a degree that&rsquo;s "less than itself," but every time we use an unnamed degree, it&rsquo;s something that&rsquo;s less than the unnamed degree we used before. We can likely simulate this if we use a custom <a href="hypersnippet-data.html#%28tech._dimension._system%29" class="techoutside" data-pltdoc="x"><span class="techinside">dimension system</span></a> where instead of counting degrees up from zero using natural numbers, we count down from infinity using chains of symbolic names.</p><p>We might say the outer <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._quasiquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasiquote</a></span> is a quote-depth-increasing opening hyperbracket of degree <span class="stt">/OUTER</span>, the inner <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._quasiquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasiquote</a></span> is a quote-depth-increasing opening hyperbracket of degree <span class="stt">/OUTER/GENSYM_ONE</span>, and the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=quasiquote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._unquote%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">unquote</a></span> is a closing hyperbracket of degree <span class="stt">/OUTER/GENSYM_TWO</span> &#8212;<wbr></wbr> not <span class="stt">/OUTER/GENSYM_ONE/GENSYM_TWO</span>, because its explicit label specifies another parent to use. To see if one degree is less than another, we check that it&rsquo;s <span class="emph">under the other&rsquo;s directory</span>. Since <span class="stt">/OUTER/GENSYM_TWO</span> is under the <span class="stt">/OUTER</span> directory, but not under the <span class="stt">/OUTER/GENSYM_ONE</span> directory, the hyperbrackets match up just the way we want.</p><p>Of course, we haven&rsquo;t put this plan into motion yet, so there may be lurking obstacles that we haven&rsquo;t uncovered.</p></li></ul><p>Nestable quasiquotation with depth-labeled escape sequences seems to be a complex problem. While Punctaffy&rsquo;s notion of hyperbracketed code doesn&rsquo;t straightforwardly apply in all the ways we might hope for it to, the slightly more complex variations we&rsquo;ve described seem viable, and Punctaffy&rsquo;s hyperbrackets are a milestone in those directions. Hypersnippet-shaped data does seem come in handy at least for representing the bounded input of an escape sequence.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="intro.html" title="backward to &quot;1 Introduction to Punctaffy&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Punctaffy&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="hypersnippet-data.html" title="forward to &quot;3 Representation of Hypersnippet Data&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/punctaffy/motivation.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:29:59 GMT -->
</html>