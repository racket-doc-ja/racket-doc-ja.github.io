<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/fexpress/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:00:37 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Fexpress</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Fexpress</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._proof-of-concept%29" class="tocviewlink" data-pltdoc="x">The Fexpress Proof of Concept</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._top%29" class="tocsubseclink" data-pltdoc="x">Fexpress</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._proof-of-concept%29" class="tocsubseclink" data-pltdoc="x">The Fexpress Proof of Concept</a></td></tr><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._entrypoint%29" class="tocsubseclink" data-pltdoc="x">Entrypoint</a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-eval%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">fexpress-<wbr></wbr>eval</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env-of-specific-values%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">env-<wbr></wbr>of-<wbr></wbr>specific-<wbr></wbr>values</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._current-fexpress-logger%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">current-<wbr></wbr>fexpress-<wbr></wbr>logger</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._fexpr%29" class="tocsubseclink" data-pltdoc="x">Fexprs</a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpr~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">fexpr?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3afexpr%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gen:<span class="mywbr"> &nbsp;</span>fexpr</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpr-apply%2Ft%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">fexpr-<wbr></wbr>apply/<span class="mywbr"> &nbsp;</span>t+</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._makeshift-fexpr%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">makeshift-<wbr></wbr>fexpr</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.2.1<tt>&nbsp;</tt></span><a href="#%28part._fexprs-for-lambda%29" class="tocsubseclink" data-pltdoc="x">Fexprs for Lambda Operations</a></td></tr><tr><td><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-ilambda%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">fexpress-<wbr></wbr>ilambda</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-clambda%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">fexpress-<wbr></wbr>clambda</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._parse-lambda-args%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">parse-<wbr></wbr>lambda-<wbr></wbr>args</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._parsed-lambda-args%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">parsed-<wbr></wbr>lambda-<wbr></wbr>args</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.2.2<tt>&nbsp;</tt></span><a href="#%28part._an-fexpr-for-type-ascription%29" class="tocsubseclink" data-pltdoc="x">An Fexpr for Type Ascription</a></td></tr><tr><td><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-the%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">fexpress-<wbr></wbr>the</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.3<tt>&nbsp;</tt></span><a href="#%28part._continuation-expr%29" class="tocsubseclink" data-pltdoc="x">Continuation Expressions</a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">continuation-<wbr></wbr>expr?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3acontinuation-expr%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gen:<span class="mywbr"> &nbsp;</span>continuation-<wbr></wbr>expr</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr-continue-eval%2Ft%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">continuation-<wbr></wbr>expr-<wbr></wbr>continue-<wbr></wbr>eval/<span class="mywbr"> &nbsp;</span>t+</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.3.1<tt>&nbsp;</tt></span><a href="#%28part._essential-continuation-exprs%29" class="tocsubseclink" data-pltdoc="x">Essential Continuation Expressions</a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._done%2Fce%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">done/<span class="mywbr"> &nbsp;</span>ce</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._apply%2Fce%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">apply/<span class="mywbr"> &nbsp;</span>ce</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.4<tt>&nbsp;</tt></span><a href="#%28part._type%2B%29" class="tocsubseclink" data-pltdoc="x">Positive Types</a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">type+<span class="mywbr"> &nbsp;</span>?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3atype%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gen:<span class="mywbr"> &nbsp;</span>type+</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-eval%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">type+<span class="mywbr"> &nbsp;</span>-<wbr></wbr>eval</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-compile%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">type+<span class="mywbr"> &nbsp;</span>-<wbr></wbr>compile</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._at-variable%2Ft%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">at-<wbr></wbr>variable/<span class="mywbr"> &nbsp;</span>t+</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-continue-eval%2Ft%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">type+<span class="mywbr"> &nbsp;</span>-<wbr></wbr>continue-<wbr></wbr>eval/<span class="mywbr"> &nbsp;</span>t+</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._lazy-value%2Ft%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">lazy-<wbr></wbr>value/<span class="mywbr"> &nbsp;</span>t+</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.4.1<tt>&nbsp;</tt></span><a href="#%28part._essential-positive-types%29" class="tocsubseclink" data-pltdoc="x">Essential Positive Types</a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._any-value%2Ft%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">any-<wbr></wbr>value/<span class="mywbr"> &nbsp;</span>t+</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._non-fexpr-value%2Ft%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">non-<wbr></wbr>fexpr-<wbr></wbr>value/<span class="mywbr"> &nbsp;</span>t+</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._specific-value%2Ft%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">specific-<wbr></wbr>value/<span class="mywbr"> &nbsp;</span>t+</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.5<tt>&nbsp;</tt></span><a href="#%28part._type_%29" class="tocsubseclink" data-pltdoc="x">Negative Types</a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type_~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">type_<span class="mywbr"> &nbsp;</span>?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3atype_%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gen:<span class="mywbr"> &nbsp;</span>type_</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.5.1<tt>&nbsp;</tt></span><a href="#%28part._essential-negative-types%29" class="tocsubseclink" data-pltdoc="x">Essential Negative Types</a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._any-value%2Ft_%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">any-<wbr></wbr>value/<span class="mywbr"> &nbsp;</span>t_</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._-~3e%2Ft_%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink"><span class="nobreak">-<wbr></wbr>&gt;</span>/<span class="mywbr"> &nbsp;</span>t_</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.6<tt>&nbsp;</tt></span><a href="#%28part._phases%29" class="tocsubseclink" data-pltdoc="x">Phases of the Language</a></td></tr><tr><td><span class="tocsublinknumber">1.6.1<tt>&nbsp;</tt></span><a href="#%28part._representing-source%29" class="tocsubseclink" data-pltdoc="x">Representing Concepts in the Source</a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">var?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">env?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._free-vars~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">free-<wbr></wbr>vars?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env-get%2Ft%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">env-<wbr></wbr>get/<span class="mywbr"> &nbsp;</span>t+</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.6.2<tt>&nbsp;</tt></span><a href="#%28part._evaluator-compiler%29" class="tocsubseclink" data-pltdoc="x">The Combination Evaluator-<wbr></wbr>Compiler</a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-eval%2Ft%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">fexpress-<wbr></wbr>eval/<span class="mywbr"> &nbsp;</span>t+</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._literal~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">literal?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._unknown-non-fexpr-apply%2Ft%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">unknown-<wbr></wbr>non-<wbr></wbr>fexpr-<wbr></wbr>apply/<span class="mywbr"> &nbsp;</span>t+</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._specific-value-continue-eval%2Ft%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">specific-<wbr></wbr>value-<wbr></wbr>continue-<wbr></wbr>eval/<span class="mywbr"> &nbsp;</span>t+</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._non-fexpr-continue-eval%2Ft%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">non-<wbr></wbr>fexpr-<wbr></wbr>continue-<wbr></wbr>eval/<span class="mywbr"> &nbsp;</span>t+</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.6.3<tt>&nbsp;</tt></span><a href="#%28part._compiling-to-racket%29" class="tocsubseclink" data-pltdoc="x">Compiling to Racket</a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var-representation-in-racket%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">var-<wbr></wbr>representation-<wbr></wbr>in-<wbr></wbr>racket</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._compilation-result%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">compilation-<wbr></wbr>result</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var-compile%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">var-<wbr></wbr>compile</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._compilation-result-eval%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">compilation-<wbr></wbr>result-<wbr></wbr>eval</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.6</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h2 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;top&quot;"><a name="(part._top)"></a><a name="(part._.Fexpress)"></a>Fexpress</h2><p>Fexpress is a compilation-friendly <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a> language. As far as feasible, it macroexpands expressions ahead of time instead of just interpreting everything.</p><p>At some point, there may be two variants of Fexpress.</p><p>The current variant&#8212;<wbr></wbr><a href="#%28mod-path._fexpress%2Fproof-of-concept%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">fexpress/proof-of-concept</span></a>&#8212;<wbr></wbr>is intended to help demonstrate the principles at work. For this reason, it has only a minimalistic set of features, it doesn&rsquo;t have deep library dependencies, and we haven&rsquo;t gone to any special effort to harden its API for future stability. If the concepts that need to be demonstrated change, we might add newly needed methods to some of the generic interfaces, might allow an <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span> to be something more expressive or restrictive than a hash table, and so on.</p><p>The other variant of Fexpress&#8212;<wbr></wbr>potentially the <span class="stt">fexpress</span> module proper, once it exists&#8212;<wbr></wbr>could be a more full-fledged system for using fexprs in Racket programs. This variant could better preserve Racket syntax object metadata for error reporting and Racket-style hygiene, and it could introduce features like editor highlighting to show what subexpressions of a program are making unoptimized fexpr calls. We can test the limits of how seamless an addition they can be to the Racket language.</p><p>However, there&rsquo;s a certain kind of seamlessness Fexpress won&rsquo;t attempt: Racket&rsquo;s <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._and%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">and</a></span> can&rsquo;t be passed into Racket&rsquo;s <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmap..rkt%2529._map%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">map</a></span>, and sometimes this surprises people who expect macros to act like functions. In languages with fexprs as the default abstraction, it tends to be easy to implement <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._and%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">and</a></span> and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmap..rkt%2529._map%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">map</a></span> in such a way that this interaction succeeds. However, that amounts to a much different design for these operations, and not a better one. If Racket&rsquo;s <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmap..rkt%2529._map%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">map</a></span> refuses to pass its internal code to an fexpr, that&rsquo;s good encapsulation of its implementation details. And Racket&rsquo;s <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._and%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">and</a></span> is designed to operate on input that&rsquo;s an unevaluated syntax object (along with various macroexpansion-time parameters), so if the input it receives is actually a run-time collection of positional and keyword arguments, it&rsquo;s quite reasonable for it to reject that input as a likely mistake by the user. These would be good design choices even in a language that had fexprs in it, and we don&rsquo;t intend to circumvent them with Fexpress.</p><p>Anyhow, the Fexpress that exists now is the simplified proof of concept. Our hope is to demonstrate that a viable strategy exists for mixing fexprs with compilation. Thanks to extension points like <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3afexpr%29%29" class="RktValLink" data-pltdoc="x">gen:fexpr</a></span>, it could be put to some fun use, but keep in mind the instability of the API.</p><p>(TODO: Currently, there isn&rsquo;t a dedicated operation for writing simple fexprs. Fexpress users can build one out of <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3afexpr%29%29" class="RktValLink" data-pltdoc="x">gen:fexpr</a></span>, or just use <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._makeshift-fexpr%29%29" class="RktValLink" data-pltdoc="x">makeshift-fexpr</a></span> in Fexpress code directly, but let&rsquo;s provide one at some point to ease the analogy between Fexpress and other fexpr-equipped languages.)</p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._proof-of-concept%29" class="toptoclink" data-pltdoc="x">1<span class="hspace">&nbsp;</span>The Fexpress Proof of Concept</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._entrypoint%29" class="toclink" data-pltdoc="x">1.1<span class="hspace">&nbsp;</span>Entrypoint</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._fexpr%29" class="toclink" data-pltdoc="x">1.2<span class="hspace">&nbsp;</span>Fexprs</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._fexprs-for-lambda%29" class="toclink" data-pltdoc="x">1.2.1<span class="hspace">&nbsp;</span>Fexprs for Lambda Operations</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._an-fexpr-for-type-ascription%29" class="toclink" data-pltdoc="x">1.2.2<span class="hspace">&nbsp;</span>An Fexpr for Type Ascription</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._continuation-expr%29" class="toclink" data-pltdoc="x">1.3<span class="hspace">&nbsp;</span>Continuation Expressions</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._essential-continuation-exprs%29" class="toclink" data-pltdoc="x">1.3.1<span class="hspace">&nbsp;</span>Essential Continuation Expressions</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._type%2B%29" class="toclink" data-pltdoc="x">1.4<span class="hspace">&nbsp;</span>Positive Types</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._essential-positive-types%29" class="toclink" data-pltdoc="x">1.4.1<span class="hspace">&nbsp;</span>Essential Positive Types</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._type_%29" class="toclink" data-pltdoc="x">1.5<span class="hspace">&nbsp;</span>Negative Types</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._essential-negative-types%29" class="toclink" data-pltdoc="x">1.5.1<span class="hspace">&nbsp;</span>Essential Negative Types</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._phases%29" class="toclink" data-pltdoc="x">1.6<span class="hspace">&nbsp;</span>Phases of the Language</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._representing-source%29" class="toclink" data-pltdoc="x">1.6.1<span class="hspace">&nbsp;</span>Representing Concepts in the Source</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._evaluator-compiler%29" class="toclink" data-pltdoc="x">1.6.2<span class="hspace">&nbsp;</span>The Combination Evaluator-Compiler</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._compiling-to-racket%29" class="toclink" data-pltdoc="x">1.6.3<span class="hspace">&nbsp;</span>Compiling to Racket</a></p></td></tr></table><h3 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;proof-of-concept&quot;">1<tt>&nbsp;</tt><a name="(part._proof-of-concept)"></a><a name="(mod-path._fexpress/proof-of-concept)"></a>The Fexpress Proof of Concept</h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left" colspan="2"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._fexpress%2Fproof-of-concept%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">fexpress/proof-of-concept</span></a><span class="RktPn">)</span></td></tr><tr><td align="left">&nbsp;</td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/fexpress-lib" title="Install this package using `raco pkg install fexpress-lib`"><span class="stt">fexpress-lib</span></a></span></td></tr></table></p><p>This module provides an open-faced implementation of a minimalistic, experimental Fexpress language. Not all the contracts documented here are completely enforced, nor are they stable.</p><p>The building blocks provided here make the language capable of doing simple lambda calculus, with more or less efficiency depending on the use of <span class="RktSym"><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-ilambda%29%29" class="RktStxLink" data-pltdoc="x">fexpress-ilambda</a></span> or <span class="RktSym"><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-clambda%29%29" class="RktStxLink" data-pltdoc="x">fexpress-clambda</a></span>. This language can be extended by implementing more <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3afexpr%29%29" class="RktValLink" data-pltdoc="x">gen:fexpr</a></span> values in Racket, and possibly more <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3acontinuation-expr%29%29" class="RktValLink" data-pltdoc="x">gen:continuation-expr</a></span>, <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3atype%2B%29%29" class="RktValLink" data-pltdoc="x">gen:type+</a></span>, and <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3atype_%29%29" class="RktValLink" data-pltdoc="x">gen:type_</a></span> values for them to interact with.</p><h4 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;entrypoint&quot;">1.1<tt>&nbsp;</tt><a name="(part._entrypoint)"></a>Entrypoint</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._fexpress-eval))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-eval%29%29" class="RktValDef RktValLink" data-pltdoc="x">fexpress-eval</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Given an s-expression representing Fexpress code, return the result of evaluating it in the given <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span>.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktVar">test-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env-of-specific-values%29%29" class="RktValLink" data-pltdoc="x">env-of-specific-values</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">hash</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">the</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-the%29%29" class="RktStxLink" data-pltdoc="x">fexpress-the</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">ilambda</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-ilambda%29%29" class="RktStxLink" data-pltdoc="x">fexpress-ilambda</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-clambda%29%29" class="RktStxLink" data-pltdoc="x">fexpress-clambda</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">funcall</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">f</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">args</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._apply%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">apply</a></span><span class="hspace">&nbsp;</span><span class="RktVar">f</span><span class="hspace">&nbsp;</span><span class="RktVar">args</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">+</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252A%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">*</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">logging</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=parameters.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._parameterize%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">parameterize</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._current-fexpress-logger%29%29" class="RktValLink" data-pltdoc="x">current-fexpress-logger</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pretty-print.html%23%2528def._%2528%2528lib._racket%252Fpretty..rkt%2529._pretty-print%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">pretty-print</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktVar">body</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">fexpress-eval-and-log</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktVar">logging</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-eval%29%29" class="RktValLink" data-pltdoc="x">fexpress-eval</a></span><span class="hspace">&nbsp;</span><span class="RktVar">test-env</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktVar">fexpress-eval-and-log</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">3</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktVar">fexpress-eval-and-log</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">ilambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">x</span><span class="hspace">&nbsp;</span><span class="RktVal">y</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">x</span><span class="hspace">&nbsp;</span><span class="RktVal">y</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">6</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktVar">fexpress-eval-and-log</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">x</span><span class="hspace">&nbsp;</span><span class="RktVal">y</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">x</span><span class="hspace">&nbsp;</span><span class="RktVal">y</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">'("Evaluating Racket code:"</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (env -+) (lambda (-x -y) (#%app -+ -x -y (#%datum . 3)))))</span></p></td></tr></table></td></tr><tr><td><p><span class="RktRes">6</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktVar">fexpress-eval-and-log</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">funcall</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">square</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">funcall</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">double</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">funcall</span><span class="hspace">&nbsp;</span><span class="RktVal">double</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">funcall</span><span class="hspace">&nbsp;</span><span class="RktVal">double</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">funcall</span><span class="hspace">&nbsp;</span><span class="RktVal">square</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">funcall</span><span class="hspace">&nbsp;</span><span class="RktVal">square</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">x</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">x</span><span class="hspace">&nbsp;</span><span class="RktVal">x</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">x</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">x</span><span class="hspace">&nbsp;</span><span class="RktVal">x</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">'("Evaluating Racket code:"</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (env -+ -funcall)</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (-square)</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(#%app</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">-funcall</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (-double)</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(#%app</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">-funcall</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">-double</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(#%app</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">-funcall</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">-double</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(#%app</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">-+</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(#%app -funcall -square (#%datum . 3))</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(#%app -funcall -square (#%datum . 4))))))</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (-x) (#%app -+ -x -x))))))</span></p></td></tr><tr><td><p><span class="RktOut">'("Evaluating Racket code:" (lambda (env -*) (lambda (-x) (#%app -* -x -x))))</span></p></td></tr></table></td></tr><tr><td><p><span class="RktRes">100</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._env-of-specific-values))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env-of-specific-values%29%29" class="RktValDef RktValLink" data-pltdoc="x">env-of-specific-values</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">specific-values</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">specific-values</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fhash..rkt%2529._hash%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">hash/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var~3f%29%29" class="RktValLink" data-pltdoc="x">var?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Creates an <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span> from a hash that maps Fexpress variables to values.</div></p><p>An <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span> maps Fexpress variables to <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive types</span></a> that compile to references to the same variables, so this wraps up the values in <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._specific-value%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">specific-value/t+</a></span> and sets up their compilation behavior with <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._at-variable%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">at-variable/t+</a></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._fexpress/proof-of-concept..rkt)._current-fexpress-logger))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._current-fexpress-logger%29%29" class="RktValDef RktValLink" data-pltdoc="x">current-fexpress-logger</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._parameter%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">parameter/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">any</a></span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A parameter holding a procedure that the Fexpress proof of concept uses to log diagnostic messages in s-expression form. Currently, we log two things:</div></p><ul><li><p>Evaluation of Racket code, so that we can inspect what kind of Racket code Fexpress produces.</p></li><li><p>Moments where the compiled Racket code reenters the interpreter in order to call an fexpr. These moments are worth knowing about so we can optimize them away.</p></li></ul><h4 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;fexpr&quot;">1.2<tt>&nbsp;</tt><a name="(part._fexpr)"></a>Fexprs</h4><p>An <a name="(tech._fexpr)"></a><span style="font-style: italic">fexpr</span> (sometimes known as a <a name="(tech._first._class._macro)"></a><span style="font-style: italic">first-class macro</span>) is a kind of abstraction that&rsquo;s existed since the earliest implementations of Lisp.</p><p>An fexpr is something in between a function and a macro. Like a function, it&rsquo;s a first-class value that can do its work at run time. Like a macro, it receives its arguments unevaluated, and&#8212;<wbr></wbr>at least in the better incarnations&#8212;<wbr></wbr>it also receives some kind of access to its caller&rsquo;s local scope with which to understand these arguments&rsquo; intended semantics.</p><p>This combination lets programmers express a few things that they can&rsquo;t express with functions and macros, since fexprs can compute their results based on a synthesis of run-time information and source code information.</p><p>However, this combination generally means programs can&rsquo;t be compiled effectively, because certain expressions need to be preserved as-is until run time. If a programmer wants to <span class="emph">express</span> a compilable program, fexprs usually get in the way of that, and the combination of macros and functions is arguably more expressive than fexprs for that task.</p><p>The Fexpress proof of concept shows how to get around this limitation by giving fexprs even more information to work with. These fexprs receive a <a href="#%28tech._continuation._expression%29" class="techoutside" data-pltdoc="x"><span class="techinside">continuation expression</span></a> which contains a <a href="#%28tech._negative._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">negative type</span></a> where they can find optimization hints to apply in their behavior.</p><p>There are also <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a> values, which are types that can perform some fexpr-calling behavior on behalf of their potential values. Positive types are the tool the fexpr evaluator needs to proceed into binding forms like <span class="RktSym"><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-clambda%29%29" class="RktStxLink" data-pltdoc="x">fexpress-clambda</a></span> and implement some of their behavior early, before the actual values of the variables are known. With careful programming, the remaining part of the behavior is compiled code, allowing Fexpress to express compilable programs.</p><p>(TODO: How new are the things we&rsquo;re demonstrating here? Fexprs have been in active use in the newLISP, PicoLisp, and (arguably) R communities. There&rsquo;s been a lot of research on compiling reflective languages, as seen in "Collapsing Towers of Interpreters." There&rsquo;s also a potential connection to JIT in general, and possibly to the compilation of algebraic effect systems.)</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._fexpr~3f))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpr~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">fexpr?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns whether the given value is an Fexpress <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._fexpress/proof-of-concept..rkt)._gen~3afexpr))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3afexpr%29%29" class="RktValDef RktValLink" data-pltdoc="x">gen:fexpr</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A generic interface for Fexpress <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexprs</span></a>, which must implement the method <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpr-apply%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">fexpr-apply/t+</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._fexpr-apply/t+))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpr-apply%2Ft%2B%29%29" class="RktValDef RktValLink" data-pltdoc="x">fexpr-apply/t+</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span><span class="RktVar">cont</span><span class="hspace">&nbsp;</span><span class="RktVar">val/t+</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="hspace">&nbsp;</span><span class="RktVar">args</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cont</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr~3f%29%29" class="RktValLink" data-pltdoc="x">continuation-expr?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">val/t+</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">val</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpr~3f%29%29" class="RktValLink" data-pltdoc="x">fexpr?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">args</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">(Makes <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a> calls, namely to the given one.) Returns a <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a> for the potential values which result from transforming the given positive type and the given value (an <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpr~3f%29%29" class="RktValLink" data-pltdoc="x">fexpr?</a></span>) of that type according to an fexpr call with the given arguments followed by the series of steps and the target <a href="#%28tech._negative._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">negative type</span></a> listed in the given <a href="#%28tech._continuation._expression%29" class="techoutside" data-pltdoc="x"><span class="techinside">continuation expression</span></a>.</div></p><p>There are many <span class="stt">...-continue-eval/t+</span> and <span class="stt">...-apply/t+</span> operations in Fexpress, and this is the one to call when the actual <span class="emph">value</span> of the original type is known and is definitely an fexpr that is definitely being invoked.</p><p>The given <span class="RktVar">val/t+</span> type should be a type which evaluates to the value <span class="RktVar">val</span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._makeshift-fexpr))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._makeshift-fexpr%29%29" class="RktValDef RktValLink" data-pltdoc="x">makeshift-fexpr</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">apply/t+</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpr~3f%29%29" class="RktValLink" data-pltdoc="x">fexpr?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">apply/t+</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr~3f%29%29" class="RktValLink" data-pltdoc="x">continuation-expr?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns an <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a> that has the given behavior for <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpr-apply%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">fexpr-apply/t+</a></span>.</div></p><p>This may be more convenient than defining an instance of <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3afexpr%29%29" class="RktValLink" data-pltdoc="x">gen:fexpr</a></span>.</p><h5 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;fexprs-for-lambda&quot;">1.2.1<tt>&nbsp;</tt><a name="(part._fexprs-for-lambda)"></a>Fexprs for Lambda Operations</h5><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>fexpr</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._fexpress/proof-of-concept..rkt)._fexpress-ilambda))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-ilambda%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">fexpress-ilambda</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">arg-id</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">body-expr</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">An <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a> implementing an interpreted <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span> operation. This doesn&rsquo;t attempt to compile the body. The resulting function evaluates the body dynamically every time it&rsquo;s called.</div></p><p>When calling this fexpr, the subforms should be parseable according to <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._parse-lambda-args%29%29" class="RktValLink" data-pltdoc="x">parse-lambda-args</a></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>fexpr</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._fexpress/proof-of-concept..rkt)._fexpress-clambda))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-clambda%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">fexpress-clambda</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">arg-id</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">body-expr</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">An <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a> implementing a compiled <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span> operation. This attempts to compile the body. The resulting function is likely to be as fast as the equivalent Racket code unless it uses Fexpress features that inhibit compilation, in which case it falls back to interpreting the relevant Fexpress code.</div></p><p>When calling this fexpr, the subforms should be parseable according to <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._parse-lambda-args%29%29" class="RktValLink" data-pltdoc="x">parse-lambda-args</a></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._parse-lambda-args))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._parse-lambda-args%29%29" class="RktValDef RktValLink" data-pltdoc="x">parse-lambda-args</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">err-name</span><span class="hspace">&nbsp;</span><span class="RktVar">args</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._parsed-lambda-args~3f%29%29" class="RktValLink" data-pltdoc="x">parsed-lambda-args?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">err-name</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=symbols.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._symbol%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">symbol?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">args</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Asserts that the given subforms are in the format expected for an <span class="RktSym"><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-ilambda%29%29" class="RktStxLink" data-pltdoc="x">fexpress-ilambda</a></span> or <span class="RktSym"><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-clambda%29%29" class="RktStxLink" data-pltdoc="x">fexpress-clambda</a></span> form&#8212;<wbr></wbr>namely, a list of two elements, the first of which is a list of mutually unique variables and the second of which, the body, is any value. (The body is usually an s-expression representing an Fexpress expression.) If the subforms do fit this format, returns a <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._parsed-lambda-args%29%29" class="RktValLink" data-pltdoc="x">parsed-lambda-args</a></span> struct carrying the number of arguments, the argument variable names, and the body. If they don&rsquo;t, an error attributed to the operation name given by <span class="RktVar">err-name</span> will be raised.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>struct</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="stt"> </span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._parsed-lambda-args-body))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._parsed-lambda-args-arg-vars))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._parsed-lambda-args-n))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._parsed-lambda-args~3f))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._struct~3aparsed-lambda-args))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._parsed-lambda-args))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._parsed-lambda-args%29%29" class="RktValDef RktValLink" data-pltdoc="x">parsed-lambda-args</a></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">n</span><span class="stt"> </span><span class="RktSym">arg-vars</span><span class="stt"> </span><span class="RktSym">body</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528lib._racket%252Fmath..rkt%2529._natural%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">natural?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">arg-vars</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._listof%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var~3f%29%29" class="RktValLink" data-pltdoc="x">var?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A return value of <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._parse-lambda-args%29%29" class="RktValLink" data-pltdoc="x">parse-lambda-args</a></span>.</div></p><p>The number <span class="RktVar">n</span> should be the length of <span class="RktVar">arg-vars</span>.</p><p>The <span class="RktVar">arg-vars</span> should be mutually unique.</p><p>The <span class="RktVar">body</span> should be an s-expression representing an Fexpress expression.</p><h5 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;an-fexpr-for-type-ascription&quot;">1.2.2<tt>&nbsp;</tt><a name="(part._an-fexpr-for-type-ascription)"></a>An Fexpr for Type Ascription</h5><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>fexpr</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._fexpress/proof-of-concept..rkt)._fexpress-the))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-the%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">fexpress-the</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">val/t_</span><span class="hspace">&nbsp;</span><span class="RktVar">val-expr</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">An <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a> implementing a type ascription operation. The subform <span class="RktVar">val/t_</span> must be a <a href="#%28tech._negative._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">negative type</span></a> syntactically, not just an expression that evaluates to one. The subform <span class="RktVar">val-expr</span> is an expression the type applies to. The purpose of <span class="stt">fexpress-the</span> is mainly to allow function bodies to use Lisp-1-style function application on local variables without inhibiting compilation.</div></p><p>As the following example shows, it&rsquo;s possible to use <span class="stt">fexpress-the</span> to declare that the local variables <span class="RktVar">f</span> and <span class="RktVar">g</span> are non-<a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexprs</span></a>. This allows their use sites to be compiled into procedure calls rather than less efficient fexpr calls:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktVar">my-compose</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktVar">fexpress-eval-and-log</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">the</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._-~3e%2Ft_%29%29" class="RktValLink" data-pltdoc="x"><span class="nobreak">-&gt;</span>/t_</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._non-fexpr-value%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">non-fexpr-value/t+</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._-~3e%2Ft_%29%29" class="RktValLink" data-pltdoc="x"><span class="nobreak">-&gt;</span>/t_</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._non-fexpr-value%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">non-fexpr-value/t+</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._any-value%2Ft_%29%29" class="RktValLink" data-pltdoc="x">any-value/t_</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">f</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">g</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">x</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">f</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">g</span><span class="hspace">&nbsp;</span><span class="RktVal">x</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">'("Evaluating Racket code:"</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (env)</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (-f) (lambda (-g) (lambda (-x) (#%app -f (#%app -g -x)))))))</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktVar">logging</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktVar">my-compose</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sqrt%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sqrt</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">3</span></p></td></tr></table></blockquote><p>If we don&rsquo;t declare that <span class="RktVar">g</span> is a non-fexpr, what happens is that the call to <span class="RktVar">g</span> is compiled into an invocation of the Fexpress interpreter. In order to pass a lexical environment into that interpreter, each surrounding <span class="RktSym"><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-clambda%29%29" class="RktStxLink" data-pltdoc="x">fexpress-clambda</a></span> (or similar binding syntax) updates the local binding of <span class="stt">env</span> so that the bindings held in <span class="stt">env</span> always correspond to the lexical scope:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktVar">my-less-typed-compose</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktVar">fexpress-eval-and-log</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">the</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._-~3e%2Ft_%29%29" class="RktValLink" data-pltdoc="x"><span class="nobreak">-&gt;</span>/t_</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._non-fexpr-value%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">non-fexpr-value/t+</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._-~3e%2Ft_%29%29" class="RktValLink" data-pltdoc="x"><span class="nobreak">-&gt;</span>/t_</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._any-value%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">any-value/t+</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._any-value%2Ft_%29%29" class="RktValLink" data-pltdoc="x">any-value/t_</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">f</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">g</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">x</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">f</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">g</span><span class="hspace">&nbsp;</span><span class="RktVal">x</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">'("Evaluating Racket code:"</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (env)</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (-f)</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(let ((env</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(hash-set* env 'f (at-variable/t+ 'f (specific-value/t+ -f)))))</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (-g)</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(let ((env</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(hash-set*</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">env</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">'g</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(at-variable/t+ 'g (specific-value/t+ -g)))))</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (-x)</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(let ((env</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(hash-set*</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">env</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">'x</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(at-variable/t+ 'x (specific-value/t+ -x)))))</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(#%app</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">-f</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(begin</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">((current-fexpress-logger) "Reentering the interpreter")</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(type+-eval</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(type+-continue-eval/t+</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">env</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(apply/ce '(x) (done/ce (any-value/t_)))</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(specific-value/t+ -g)))))))))))))</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktVar">logging</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktVar">my-less-typed-compose</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sqrt%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sqrt</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">"Reentering the interpreter"</span></p></td></tr><tr><td><p><span class="RktRes">3</span></p></td></tr></table></blockquote><p>If we don&rsquo;t use <span class="stt">fexpress-the</span> at all, then we get the least optimized version of the code. This time, the call to <span class="RktVar">f</span> reenters the interpreter, and the call to <span class="RktVar">g</span> is just taken care of during that interpretation:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktVar">my-untyped-compose</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktVar">fexpress-eval-and-log</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">f</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">g</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">clambda</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">x</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">f</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">g</span><span class="hspace">&nbsp;</span><span class="RktVal">x</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">'("Evaluating Racket code:"</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (env)</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (-f)</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(let ((env</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(hash-set* env 'f (at-variable/t+ 'f (specific-value/t+ -f)))))</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (-g)</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(let ((env</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(hash-set*</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">env</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">'g</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(at-variable/t+ 'g (specific-value/t+ -g)))))</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(lambda (-x)</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(let ((env</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(hash-set*</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">env</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">'x</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(at-variable/t+ 'x (specific-value/t+ -x)))))</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(begin</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">((current-fexpress-logger) "Reentering the interpreter")</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(type+-eval</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(type+-continue-eval/t+</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">env</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(apply/ce '((g x)) (done/ce (any-value/t_)))</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">(specific-value/t+ -f))))))))))))</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktVar">logging</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktVar">my-untyped-compose</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sqrt%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sqrt</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">"Reentering the interpreter"</span></p></td></tr><tr><td><p><span class="RktRes">3</span></p></td></tr></table></blockquote><h4 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;continuation-expr&quot;">1.3<tt>&nbsp;</tt><a name="(part._continuation-expr)"></a>Continuation Expressions</h4><p>An Fexpress <a name="(tech._continuation._expression)"></a><span style="font-style: italic">continuation expression</span> is a representation of the syntax around the evaluating part of an Fexpress expression.</p><p>Usually, this is a series of pending <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a> applications (<span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._apply%2Fce%29%29" class="RktValLink" data-pltdoc="x">apply/ce</a></span>) to perform in the current <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span>, followed by an ascribed <a href="#%28tech._negative._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">negative type</span></a> to optimize the overall result by (<span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._done%2Fce%29%29" class="RktValLink" data-pltdoc="x">done/ce</a></span>). Other kinds of copatterns or spine elements, like field or method accessor syntaxes, could fit in here as well.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._continuation-expr~3f))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">continuation-expr?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns whether the given value is a <a href="#%28tech._continuation._expression%29" class="techoutside" data-pltdoc="x"><span class="techinside">continuation expression</span></a>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._fexpress/proof-of-concept..rkt)._gen~3acontinuation-expr))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3acontinuation-expr%29%29" class="RktValDef RktValLink" data-pltdoc="x">gen:continuation-expr</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A generic interface for <a href="#%28tech._continuation._expression%29" class="techoutside" data-pltdoc="x"><span class="techinside">continuation expressions</span></a>, which must implement the method <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr-continue-eval%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">continuation-expr-continue-eval/t+</a></span>.</div></p><p>In order to perform compilation, Fexpress <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexprs</span></a> usually need to know the structural details of the continuation expression that holds their arguments. Thus, when defining new continuation expressions, it&rsquo;s typical to define a structure type that does more than just implement the <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3acontinuation-expr%29%29" class="RktValLink" data-pltdoc="x">gen:continuation-expr</a></span> interface. For instance, it can also provide its predicate and field accessors as part of its intended API, or it can implement other interfaces on the side.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._continuation-expr-continue-eval/t+))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr-continue-eval%2Ft%2B%29%29" class="RktValDef RktValLink" data-pltdoc="x">continuation-expr-continue-eval/t+</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">env</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">cont</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">val/t+</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cont</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr~3f%29%29" class="RktValLink" data-pltdoc="x">continuation-expr?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">val/t+</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">(Makes <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a> calls.) Assuming the given <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a> will have no known fexpr-calling behavior until we witness its potential values, returns another positive type for the potential values which result from transforming those according to the series of steps and the target <a href="#%28tech._negative._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">negative type</span></a> listed in the given <a href="#%28tech._continuation._expression%29" class="techoutside" data-pltdoc="x"><span class="techinside">continuation expression</span></a>.</div></p><p>There are many <span class="stt">...-continue-eval/t+</span> and <span class="stt">...-apply/t+</span> operations in Fexpress, and this is the one to call when the positive type&rsquo;s fexpr-calling behavior should be ignored but its values&rsquo; fexpr-calling behavior, if any, should not be ignored. This will usually result in code that consults the value at run time and makes fexpr calls to it dynamically. A positive type usually delegates to this itself when its <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-continue-eval%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">type+-continue-eval/t+</a></span> behavior has no better idea for what to do.</p><h5 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;essential-continuation-exprs&quot;">1.3.1<tt>&nbsp;</tt><a name="(part._essential-continuation-exprs)"></a>Essential Continuation Expressions</h5><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>struct</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="stt"> </span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._done/ce-type_))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._done/ce~3f))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._struct~3adone/ce))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._done/ce))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._done%2Fce%29%29" class="RktValDef RktValLink" data-pltdoc="x">done/ce</a></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">type_</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">type_</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type_~3f%29%29" class="RktValLink" data-pltdoc="x">type_?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A <a href="#%28tech._continuation._expression%29" class="techoutside" data-pltdoc="x"><span class="techinside">continuation expression</span></a> that represents that there&rsquo;s nothing left to do except return a value. The specified <a href="#%28tech._negative._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">negative type</span></a> can serve as a hint for optimizing the value.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>struct</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="stt"> </span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._apply/ce-next))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._apply/ce-args))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._apply/ce~3f))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._struct~3aapply/ce))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._apply/ce))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._apply%2Fce%29%29" class="RktValDef RktValLink" data-pltdoc="x">apply/ce</a></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">args</span><span class="stt"> </span><span class="RktSym">next</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">args</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">next</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr~3f%29%29" class="RktValLink" data-pltdoc="x">continuation-expr?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A <a href="#%28tech._continuation._expression%29" class="techoutside" data-pltdoc="x"><span class="techinside">continuation expression</span></a> that represents that the next thing to do to the value is to invoke it as an <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a> with certain arguments.</div></p><p>In typical code, the <span class="RktVar">args</span> to an fexpr call are usually a proper list.</p><h4 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;type+&quot;">1.4<tt>&nbsp;</tt><a name="(part._type+)"></a>Positive Types</h4><p>A <a name="(tech._positive._type)"></a><span style="font-style: italic">positive type</span> in Fexpress essentially acts like a symbolic value. Like other type systems, this kind of type designates a set of potential values. Depending on what assumptions it carries, it can produce a value (<span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-eval%29%29" class="RktValLink" data-pltdoc="x">type+-eval</a></span>) and/or a <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._compilation-result~3f%29%29" class="RktValLink" data-pltdoc="x">compilation-result?</a></span> that evaluates to a value (<span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-compile%29%29" class="RktValLink" data-pltdoc="x">type+-compile</a></span>).</p><p>The type system in the Fexpress proof of concept exists only for the purpose of optimization, and it has only the bells and whistles that serve that purpose. In particular, this type system makes no attempt to be sound. A variable associated with a positive type can turn out to have a value that defies that type&rsquo;s assumptions or has been computed in a different way than the type would have computed it.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._type+~3f))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">type+?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns whether the given value is a <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._fexpress/proof-of-concept..rkt)._gen~3atype+))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3atype%2B%29%29" class="RktValDef RktValLink" data-pltdoc="x">gen:type+</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A generic interface for <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive types</span></a>, which must implement the following methods:</div></p><ul><li><p><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-eval%29%29" class="RktValLink" data-pltdoc="x">type+-eval</a></span></p></li><li><p><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-compile%29%29" class="RktValLink" data-pltdoc="x">type+-compile</a></span></p></li><li><p><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._at-variable%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">at-variable/t+</a></span></p></li><li><p><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-continue-eval%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">type+-continue-eval/t+</a></span></p></li></ul><p>The implementations of these methods should satisfy certain algebraic laws:</p><p>If both <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-eval%29%29" class="RktValLink" data-pltdoc="x">type+-eval</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-compile%29%29" class="RktValLink" data-pltdoc="x">type+-compile</a></span> both successfully produce results and don&rsquo;t perform any side effects along the way, the evaluation result should be the same as running the compilation result with <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._compilation-result-eval%29%29" class="RktValLink" data-pltdoc="x">compilation-result-eval</a></span> in any <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span> where the bindings for its free variables have their own successful and pure <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-eval%29%29" class="RktValLink" data-pltdoc="x">type+-eval</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-compile%29%29" class="RktValLink" data-pltdoc="x">type+-compile</a></span> behaviors.</p><p>The <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._at-variable%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">at-variable/t+</a></span> method should observe the lens laws with respect to <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-compile%29%29" class="RktValLink" data-pltdoc="x">type+-compile</a></span>: The result of getting a compilation result with <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-compile%29%29" class="RktValLink" data-pltdoc="x">type+-compile</a></span> after it&rsquo;s been replaced with <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._at-variable%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">at-variable/t+</a></span> should be the same as just calling <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var-compile%29%29" class="RktValLink" data-pltdoc="x">var-compile</a></span> on the variable that was passed to the replacer. The result of replacing a compilation result with itself should be the same as not using <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._at-variable%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">at-variable/t+</a></span> at all. The result of replacing a compilation result and replacing it a second time should be the same as just skipping to the second replacement.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._type+-eval))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-eval%29%29" class="RktValDef RktValLink" data-pltdoc="x">type+-eval</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">type+</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type+</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Attempt to compute a value of the given <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._type+-compile))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-compile%29%29" class="RktValDef RktValLink" data-pltdoc="x">type+-compile</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">type+</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._compilation-result~3f%29%29" class="RktValLink" data-pltdoc="x">compilation-result?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type+</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Attempt to produce a <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._compilation-result~3f%29%29" class="RktValLink" data-pltdoc="x">compilation-result?</a></span> that evaluates to values of the given <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a> in the <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span> the type belongs to.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._at-variable/t+))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._at-variable%2Ft%2B%29%29" class="RktValDef RktValLink" data-pltdoc="x">at-variable/t+</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">var</span><span class="hspace">&nbsp;</span><span class="RktVar">type+</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">var</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var~3f%29%29" class="RktValLink" data-pltdoc="x">var?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type+</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Replaces the given <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a>&rsquo;s compilation result so that it refers to the given Fexpress variable. The variable&rsquo;s potential bindings must be among the type&rsquo;s potential values, but nothing is done to verify this.</div></p><p>Any type that&rsquo;s added to an <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span> should be transformed this way, since it&rsquo;s now in scope under a dedicated name.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._type+-continue-eval/t+))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-continue-eval%2Ft%2B%29%29" class="RktValDef RktValLink" data-pltdoc="x">type+-continue-eval/t+</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span><span class="RktVar">cont</span><span class="hspace">&nbsp;</span><span class="RktVar">type+</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cont</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr~3f%29%29" class="RktValLink" data-pltdoc="x">continuation-expr?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type+</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">(Makes <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a> calls.) Returns a <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a> for the potential values which result from transforming the given <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a> according to a series of steps and a target <a href="#%28tech._negative._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">negative type</span></a> listed in the given continuation expression.</div></p><p>There are many <span class="stt">...-continue-eval/t+</span> and <span class="stt">...-apply/t+</span> operations in Fexpress, and this is the most general one; it delegates to the others.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._lazy-value/t+))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._lazy-value%2Ft%2B%29%29" class="RktValDef RktValLink" data-pltdoc="x">lazy-value/t+</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">eval</span><span class="hspace">&nbsp;</span><span class="RktVar">compile</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">eval</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">compile</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._compilation-result~3f%29%29" class="RktValLink" data-pltdoc="x">compilation-result?</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a> with the given implementations of <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-eval%29%29" class="RktValLink" data-pltdoc="x">type+-eval</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-compile%29%29" class="RktValLink" data-pltdoc="x">type+-compile</a></span>. These should satisfy the algebraic laws described at <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3atype%2B%29%29" class="RktValLink" data-pltdoc="x">gen:type+</a></span>.</div></p><p>The resulting type doesn&rsquo;t carry any assumptions about the potential values&rsquo; <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a>-calling behavior. That is to say, its <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-continue-eval%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">type+-continue-eval/t+</a></span> behavior only gives up and delegates to <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr-continue-eval%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">continuation-expr-continue-eval/t+</a></span>.</p><h5 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;essential-positive-types&quot;">1.4.1<tt>&nbsp;</tt><a name="(part._essential-positive-types)"></a>Essential Positive Types</h5><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._any-value/t+))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._any-value%2Ft%2B%29%29" class="RktValDef RktValLink" data-pltdoc="x">any-value/t+</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a> which carries no assumptions about its potential values.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._non-fexpr-value/t+))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._non-fexpr-value%2Ft%2B%29%29" class="RktValDef RktValLink" data-pltdoc="x">non-fexpr-value/t+</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a> which carries an assumption that its potential values will not be <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpr~3f%29%29" class="RktValLink" data-pltdoc="x">fexpr?</a></span> values. This isn&rsquo;t necessarily a sound assumption, but certain operations will use this information to allow compilation to proceed even if a value of this type is invoked like an <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._specific-value/t+))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._specific-value%2Ft%2B%29%29" class="RktValDef RktValLink" data-pltdoc="x">specific-value/t+</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">value</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">value</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a> which carries an assumption that its potential values will all be the given value. It can also <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-eval%29%29" class="RktValLink" data-pltdoc="x">type+-eval</a></span> to that value.</div></p><h4 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;type_&quot;">1.5<tt>&nbsp;</tt><a name="(part._type_)"></a>Negative Types</h4><p>A <a name="(tech._negative._type)"></a><span style="font-style: italic">negative type</span> in Fexpress essentially acts like an optimization hint for compiling an expression of that type.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._type_~3f))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type_~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">type_?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns whether the given value is a <a href="#%28tech._negative._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">negative type</span></a>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._fexpress/proof-of-concept..rkt)._gen~3atype_))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3atype_%29%29" class="RktValDef RktValLink" data-pltdoc="x">gen:type_</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A generic interface for <a href="#%28tech._negative._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">negative types</span></a>. This interface doesn&rsquo;t have any methods. (It&rsquo;s not that it couldn&rsquo;t have methods, but we don&rsquo;t seem to need any for this proof of concept.)</div></p><p>In order to perform compilation, Fexpress <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexprs</span></a> sometimes need to know the structural details of the negative type they&rsquo;re expected to create a value in. Thus, when defining new negative types, it&rsquo;s typical to define a structure type that does more than just implement the <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._gen~3atype_%29%29" class="RktValLink" data-pltdoc="x">gen:type_</a></span> interface. For instance, it can also provide its predicate and field accessors as part of its intended API, or it can implement other interfaces on the side.</p><h5 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;essential-negative-types&quot;">1.5.1<tt>&nbsp;</tt><a name="(part._essential-negative-types)"></a>Essential Negative Types</h5><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>struct</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="stt"> </span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._any-value/t_~3f))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._struct~3aany-value/t_))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._any-value/t_))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._any-value%2Ft_%29%29" class="RktValDef RktValLink" data-pltdoc="x">any-value/t_</a></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A <a href="#%28tech._negative._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">negative type</span></a> which provides no hints as to what its potential values should be like.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>struct</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="stt"> </span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._-~3e/t_-return/t_))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._-~3e/t_-arg-type+-list))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._-~3e/t_~3f))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._struct~3a-~3e/t_))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._-~3e/t_))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._-~3e%2Ft_%29%29" class="RktValDef RktValLink" data-pltdoc="x"><span class="nobreak">-&gt;</span>/t_</a></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">arg-type+-list</span><span class="stt"> </span><span class="RktSym">return/t_</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">arg-type+-list</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._listof%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">return/t_</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type_~3f%29%29" class="RktValLink" data-pltdoc="x">type_?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A <a href="#%28tech._negative._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">negative type</span></a> for functions that have the specified list of <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive types</span></a> for their arguments and the single specified negative type for their results.</div></p><p>If we unpack the meaning of positive and negative types in Fexpress, this is a compilation hint for expressions that return functions. It offers the given symbolic values as approximations for the function arguments, and it offers further hints for compiling the function body.</p><h4 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;phases&quot;">1.6<tt>&nbsp;</tt><a name="(part._phases)"></a>Phases of the Language</h4><h5 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;representing-source&quot;">1.6.1<tt>&nbsp;</tt><a name="(part._representing-source)"></a>Representing Concepts in the Source</h5><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._var~3f))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">var?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns whether the given value is an Fexpress variable name, which is represented by an interned symbol.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._env~3f))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">env?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns whether the given value is an Fexpress lexical environment, which is represented by an immutable hash from variable names to <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive types</span></a>. Besides being positive types, the values of the hash should also have successful <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-compile%29%29" class="RktValLink" data-pltdoc="x">type+-compile</a></span> behavior, and they should be equivalent to <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var-compile%29%29" class="RktValLink" data-pltdoc="x">var-compile</a></span> for the same Fexpress variable.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._free-vars~3f))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._free-vars~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">free-vars?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns whether the given value is an Fexpress free variable set, which is represented by an immutable hash from variable names to <span class="RktVal">#t</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._env-get/t+))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env-get%2Ft%2B%29%29" class="RktValDef RktValLink" data-pltdoc="x">env-get/t+</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span><span class="RktVar">var</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">var</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var~3f%29%29" class="RktValLink" data-pltdoc="x">var?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Gets the <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a> associated with the given variable name in the given environment. Unlike simply calling <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-ref%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">hash-ref</a></span>, this raises an informative error if the variable doesn&rsquo;t have a binding in the environment.</div></p><h5 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;evaluator-compiler&quot;">1.6.2<tt>&nbsp;</tt><a name="(part._evaluator-compiler)"></a>The Combination Evaluator-Compiler</h5><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._fexpress-eval/t+))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-eval%2Ft%2B%29%29" class="RktValDef RktValLink" data-pltdoc="x">fexpress-eval/t+</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span><span class="RktVar">cont</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cont</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr~3f%29%29" class="RktValLink" data-pltdoc="x">continuation-expr?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Reduces the given Fexpress expression and <a href="#%28tech._continuation._expression%29" class="techoutside" data-pltdoc="x"><span class="techinside">continuation expression</span></a> in the given <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span> to a <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a>. The resulting positive type can be transformed into an evaluated result using <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-eval%29%29" class="RktValLink" data-pltdoc="x">type+-eval</a></span> or a compiled result using <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-compile%29%29" class="RktValLink" data-pltdoc="x">type+-compile</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._literal~3f))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._literal~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">literal?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns whether the given value can be used as a datum literal in the Fexpress proof of concept. For this simple demonstration, we just support <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-integer%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">exact-integer?</a></span> values.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._unknown-non-fexpr-apply/t+))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._unknown-non-fexpr-apply%2Ft%2B%29%29" class="RktValDef RktValLink" data-pltdoc="x">unknown-non-fexpr-apply/t+</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">env</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">cont</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">op/t+</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">get-op</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">args</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cont</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr~3f%29%29" class="RktValLink" data-pltdoc="x">continuation-expr?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">op/t+</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">get-op</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">args</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">(Makes <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a> calls, namely to an assumed non-fexpr value.) Returns a <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a> for the potential values which result from transforming the given positive type and the given function (for getting the value of that type) according to a <span class="emph">procedure</span> call with the evaluated forms of the given arguments, followed by the series of additional steps and the target negative type listed in the given continuation expression.</div></p><p>There are many <span class="stt">...-continue-eval/t+</span> and <span class="stt">...-apply/t+</span> operations in Fexpress, and this is the one to call when a type&rsquo;s potential values are assumed not to be fexprs and yet they&rsquo;re definitely being invoked with an fexpr call. This is called either when a value turns out to be a non-fexpr at run time or when it&rsquo;s assumed to be a non-fexpr using <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._non-fexpr-value%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">non-fexpr-value/t+</a></span>.</p><p>The given <span class="RktVar">op/t+</span> type should be a type which evaluates to the result of <span class="RktVar">get-op</span>.</p><p>In typical code, the <span class="RktVar">args</span> to an fexpr call are usually a proper list. This operation raises an error if they&rsquo;re not.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._specific-value-continue-eval/t+))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._specific-value-continue-eval%2Ft%2B%29%29" class="RktValDef RktValLink" data-pltdoc="x">specific-value-continue-eval/t+</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">env</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">cont</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">val/t+</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">val</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cont</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr~3f%29%29" class="RktValLink" data-pltdoc="x">continuation-expr?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">val/t+</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">val</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">(Makes <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a> calls.) Returns a <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a> for the potential values which result from transforming the given positive type and the given value of that type according to the series of steps and the target <a href="#%28tech._negative._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">negative type</span></a> listed in the given <a href="#%28tech._continuation._expression%29" class="techoutside" data-pltdoc="x"><span class="techinside">continuation expression</span></a>.</div></p><p>There are many <span class="stt">...-continue-eval/t+</span> and <span class="stt">...-apply/t+</span> operations in Fexpress, and this is the one to call when the actual <span class="emph">value</span> being called is known and can potentially be an fexpr with its own idea of how to proceed. A positive type processing a <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B-continue-eval%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">type+-continue-eval/t+</a></span> call usually delegates to this itself when the type&rsquo;s value is known at compile time, and a continuation expression processing a <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr-continue-eval%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">continuation-expr-continue-eval/t+</a></span> call usually delegates to this itself once the value is finally known at run time.</p><p>The given <span class="RktVar">val/t+</span> type should be a type which evaluates to the value <span class="RktVar">val</span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._non-fexpr-continue-eval/t+))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._non-fexpr-continue-eval%2Ft%2B%29%29" class="RktValDef RktValLink" data-pltdoc="x">non-fexpr-continue-eval/t+</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span><span class="RktVar">cont</span><span class="hspace">&nbsp;</span><span class="RktVar">val/t+</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cont</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._continuation-expr~3f%29%29" class="RktValLink" data-pltdoc="x">continuation-expr?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">val/t+</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._type%2B~3f%29%29" class="RktValLink" data-pltdoc="x">type+?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">(Makes <a href="#%28tech._fexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">fexpr</span></a> calls.) Assuming the given <a href="#%28tech._positive._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">positive type</span></a> and its values have no custom fexpr-calling behavior, returns a positive type for the potential values which result from transforming the given one according to the series of steps and the target <a href="#%28tech._negative._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">negative type</span></a> listed in the given <a href="#%28tech._continuation._expression%29" class="techoutside" data-pltdoc="x"><span class="techinside">continuation expression</span></a>.</div></p><p>There are many <span class="stt">...-continue-eval/t+</span> and <span class="stt">...-apply/t+</span> operations in Fexpress, and this is the one to call when the positive type <span class="emph">and</span> its values should have their custom fexpr-calling behavior ignored. Fexpress doesn&rsquo;t usually ignore values&rsquo; fexpr-calling behavior like this, but since this can lead to better performance, it can be explicitly requested by using <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._fexpress-the%29%29" class="RktStxLink" data-pltdoc="x">fexpress-the</a></span><span class="stt"> </span><span class="RktVar">...</span><span class="RktPn">)</span> to ascribe a type that uses <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._non-fexpr-value%2Ft%2B%29%29" class="RktValLink" data-pltdoc="x">non-fexpr-value/t+</a></span>.</p><h5 x-source-module="(lib &quot;fexpress/scribblings/fexpress.scrbl&quot;)" x-source-pkg="fexpress-doc" x-part-tag="&quot;compiling-to-racket&quot;">1.6.3<tt>&nbsp;</tt><a name="(part._compiling-to-racket)"></a>Compiling to Racket</h5><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._var-representation-in-racket))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var-representation-in-racket%29%29" class="RktValDef RktValLink" data-pltdoc="x">var-representation-in-racket</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">var</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=symbols.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._symbol%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">symbol?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">var</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var~3f%29%29" class="RktValLink" data-pltdoc="x">var?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Converts an Fexpress variable name into the symbol it should be represented as in compiled Racket code for <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._compilation-result~3f%29%29" class="RktValLink" data-pltdoc="x">compilation-result?</a></span> values. Currently, it&rsquo;s the same symbol but with <span class="RktVal">"-"</span> prepended to it.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>struct</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="stt"> </span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._compilation-result-expr))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._compilation-result-free-vars))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._compilation-result-depends-on-env~3f))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._compilation-result~3f))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._struct~3acompilation-result))"></a><a name="(def._((lib._fexpress/proof-of-concept..rkt)._compilation-result))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._compilation-result%29%29" class="RktValDef RktValLink" data-pltdoc="x">compilation-result</a></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">depends-on-env?</span><span class="stt"> </span><span class="RktSym">free-vars</span><span class="stt"> </span><span class="RktSym">expr</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">depends-on-env?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">free-vars</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._free-vars~3f%29%29" class="RktValLink" data-pltdoc="x">free-vars?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">expr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A bundle containing an s-expression ready to compile as Racket code and some information about its dependencies. If it depends on the variable <span class="stt">env</span> being bound to a first-class representation of the entire lexical environment, the <span class="RktVar">depends-on-env?</span> field should be <span class="RktVal">#t</span>. If it depends on Fexpress variables, those should be accounted for in the <span class="RktVar">free-vars</span> field.</div></p><p>The <span class="RktVar">expr</span> should be an s-expression of Racket code. It may have free variables corresponding to the <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var-representation-in-racket%29%29" class="RktValLink" data-pltdoc="x">var-representation-in-racket</a></span> versions of the Fexpress free variables listed in <span class="RktVar">free-vars</span>. It may also have the free variable <span class="stt">env</span> if <span class="RktVar">depends-on-env?</span> is <span class="RktVal">#t</span>. The <span class="stt">env</span> variable refers to the current lexical environment. It should not have other free variables, but if it needs to refer to Racket module bindings, it may do so with an embedded <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fstx..rkt%2529._identifier%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">identifier?</a></span> syntax object.</p><p>Depending on the lexical environment using <span class="RktVar">depends-on-env?</span> can lead to performance degradation in the surrounding parts of the Fexpress program, since an up-to-date first-class environment value must be constructed whenever variables come into scope.</p><p>While we could make more extensive use of Racket syntax objects, we keep their use to a minimum here to demonstrate this language in a way that can be easily ported to other Lisp dialects and other languages with <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eval%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eval</a></span> variants available.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._var-compile))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var-compile%29%29" class="RktValDef RktValLink" data-pltdoc="x">var-compile</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">var</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._compilation-result~3f%29%29" class="RktValLink" data-pltdoc="x">compilation-result?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">var</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._var~3f%29%29" class="RktValLink" data-pltdoc="x">var?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Compiles an expression that just refers to the given Fexpress variable.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._fexpress/proof-of-concept..rkt)._compilation-result-eval))"></a><span title="Provided from: fexpress/proof-of-concept | Package: fexpress-lib"><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._compilation-result-eval%29%29" class="RktValDef RktValLink" data-pltdoc="x">compilation-result-eval</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span><span class="RktVar">compiled</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">env</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">compiled</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._compilation-result~3f%29%29" class="RktValLink" data-pltdoc="x">compilation-result?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Evaluates the given Fexpress compilation result, using the given Fexpress <span class="RktSym"><a href="#%28def._%28%28lib._fexpress%2Fproof-of-concept..rkt%29._env~3f%29%29" class="RktValLink" data-pltdoc="x">env?</a></span> to resolve its references to free variables. This uses Racket&rsquo;s <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eval%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eval</a></span>, which fully compiles the Racket code before executing it.</div></p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/fexpress/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:00:37 GMT -->
</html>