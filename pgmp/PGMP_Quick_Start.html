<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/pgmp/PGMP_Quick_Start.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:29:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>1&nbsp;PGMP Quick Start</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">PGMP:<span class="mywbr"> &nbsp;</span> Profile-<wbr></wbr>Guided Meta-<wbr></wbr>Programming</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">PGMP Quick Start</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="API.html" class="tocviewlink" data-pltdoc="x">API</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Profile-Guided_Conditionals.html" class="tocviewlink" data-pltdoc="x">Profile-<wbr></wbr>Guided Conditionals</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>1&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">PGMP Quick Start</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">1.1&nbsp;</td><td><a href="#%28part._.Instrumenting_and_optimizing%29" class="tocviewlink" data-pltdoc="x">Instrumenting and optimizing</a></td></tr><tr><td align="right">1.2&nbsp;</td><td><a href="#%28part._.My_.First_.Profile-.Guided_.Meta-.Program%29" class="tocviewlink" data-pltdoc="x">My First Profile-<wbr></wbr>Guided Meta-<wbr></wbr>Program</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._.Instrumenting_and_optimizing%29" class="tocsubseclink" data-pltdoc="x">Instrumenting and optimizing</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._.My_.First_.Profile-.Guided_.Meta-.Program%29" class="tocsubseclink" data-pltdoc="x">My First Profile-<wbr></wbr>Guided Meta-<wbr></wbr>Program</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="index.html" title="backward to &quot;PGMP: Profile-Guided Meta-Programming&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;PGMP: Profile-Guided Meta-Programming&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="API.html" title="forward to &quot;2 API&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;pgmp/docs/pgmp.scrbl&quot;)" x-source-pkg="rackpgmp" x-part-tag="&quot;PGMP_Quick_Start&quot;">1<tt>&nbsp;</tt><a name="(part._.P.G.M.P_.Quick_.Start)"></a>PGMP Quick Start</h3><h4 x-source-module="(lib &quot;pgmp/docs/pgmp.scrbl&quot;)" x-source-pkg="rackpgmp" x-part-tag="&quot;Instrumenting_and_optimizing&quot;">1.1<tt>&nbsp;</tt><a name="(part._.Instrumenting_and_optimizing)"></a>Instrumenting and optimizing</h4><p>This section presents the standard workflow for profiling and optimizing
a profile-guided <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=macros.html%23%2528tech._macro%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">macro</span></a>. We present a small example program using
<span class="RktSym"><a href="Profile-Guided_Conditionals.html#%28form._%28%28lib._pgmp%2Fcase..rkt%29._case%29%29" class="RktStxLink" data-pltdoc="x">case</a></span>, a profile-guided <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=macros.html%23%2528tech._macro%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">macro</span></a> defined by
<a href="Profile-Guided_Conditionals.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">pgmp/case</span></a>.</p><blockquote class="SCodeFlow"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"example-parser.rkt"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=index.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">racket/base</span></a></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgmp</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktVar">...</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">parse</span><span class="hspace">&nbsp;</span><span class="RktVar">stream</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Profile-Guided_Conditionals.html#%28form._%28%28lib._pgmp%2Fcase..rkt%29._case%29%29" class="RktStxLink" data-pltdoc="x">case</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Byte_and_String_Input.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._peek-char%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">peek-char</a></span><span class="hspace">&nbsp;</span><span class="RktVar">stream</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">#\space</span><span class="hspace">&nbsp;</span><span class="RktVal">#\tab</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">white-space</span><span class="hspace">&nbsp;</span><span class="RktVar">stream</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">digit</span><span class="hspace">&nbsp;</span><span class="RktVar">stream</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">#\(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">start-paren</span><span class="hspace">&nbsp;</span><span class="RktVar">stream</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVal">#\)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">end-paren</span><span class="hspace">&nbsp;</span><span class="RktVar">stream</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=module.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._module%252B%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">module+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">main</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">parse</span><span class="hspace">&nbsp;</span><span class="RktVar">input-stream</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote><p>Here we define a <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=module.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._module%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">module</a></span> that uses <span class="RktSym"><a href="Profile-Guided_Conditionals.html#%28form._%28%28lib._pgmp%2Fcase..rkt%29._case%29%29" class="RktStxLink" data-pltdoc="x">case</a></span>. To
get the benefits of <span class="RktSym"><a href="Profile-Guided_Conditionals.html#%28form._%28%28lib._pgmp%2Fcase..rkt%29._case%29%29" class="RktStxLink" data-pltdoc="x">case</a></span>, we first need to instrument
and run the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=module.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._module%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">module</a></span>. There are two ways to do this.</p><p><a href="API.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">pgmp</span></a> provides a commandline utility through
<span class="stt">raco</span>. We could instrument and profile the module by running
the command
<span class="stt">raco pgmp --profile example-parser.rkt</span>. To optimize
and run the module, we can henceforth use <span class="stt">racket -t
example-parser.rkt</span>. <span class="RktSym"><a href="Profile-Guided_Conditionals.html#%28form._%28%28lib._pgmp%2Fcase..rkt%29._case%29%29" class="RktStxLink" data-pltdoc="x">case</a></span> will automatically
load and use the profile data from the instrumented run.</p><p>Alternatively, <a href="API.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">pgmp</span></a> also provides API functions to
instrument and profile one <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=module.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._module%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">module</a></span> from another. We can use the
API to instrument and profile the module,
then optimize and run the module via <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Module_Names_and_Loading.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._dynamic-require%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">dynamic-require</a></span>.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="API.html#%28def._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._run-with-profiling%29%29" class="RktValLink" data-pltdoc="x">run-with-profiling</a></span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">submod</span><span class="hspace">&nbsp;</span><span class="RktVal">"example-parser.rkt"</span><span class="hspace">&nbsp;</span><span class="RktVal">main</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="API.html#%28def._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._save-profile%29%29" class="RktValLink" data-pltdoc="x">save-profile</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"example-parser.rkt"</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Module_Names_and_Loading.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._dynamic-require%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">dynamic-require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">submod</span><span class="hspace">&nbsp;</span><span class="RktVal">"example-parser.rkt"</span><span class="hspace">&nbsp;</span><span class="RktVal">main</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span></td></tr></table></blockquote><h4 x-source-module="(lib &quot;pgmp/docs/pgmp.scrbl&quot;)" x-source-pkg="rackpgmp" x-part-tag="&quot;My_First_Profile-Guided_Meta-Program&quot;">1.2<tt>&nbsp;</tt><a name="(part._.My_.First_.Profile-.Guided_.Meta-.Program)"></a>My First Profile-Guided Meta-Program</h4><p>In this tutorial, we present the API defined in <a href="API.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">pgmp/api/exact</span></a>
via an example profiled-guided <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=macros.html%23%2528tech._macro%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">macro</span></a>. We define <span class="RktSym">if-r</span>, a
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=macros.html%23%2528tech._macro%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">macro</span></a> that reorders its branches based on which branch is
executed most frequently.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pgmp</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if-r</span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">profile-query</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="API.html#%28def._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._load-profile-query-weight%29%29" class="RktValLink" data-pltdoc="x">load-profile-query-weight</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._or%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax-case%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-case</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym">test</span><span class="hspace">&nbsp;</span><span class="RktSym">t</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">t-prof</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">profile-query</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">t</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">f-prof</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">profile-query</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3c%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">&lt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">t-prof</span><span class="hspace">&nbsp;</span><span class="RktSym">f-prof</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._not%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">not</a></span><span class="hspace">&nbsp;</span><span class="RktSym">test</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktSym">t</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktSym">test</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">t</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>First, the function <span class="RktSym"><a href="API.html#%28def._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._load-profile-query-weight%29%29" class="RktValLink" data-pltdoc="x">load-profile-query-weight</a></span>, which executes at
compile-time, loads any profile information associated with
<span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-source%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax-source</a></span><span class="stt"> </span><span class="RktSym">stx</span><span class="RktPn">)</span> that has been saved from previous
executions and returns a query function. The query function may return
<span class="RktVal">#f</span>, but in this example we ignore the distinction between
<span class="RktVal">#f</span> and <span class="RktVal">0</span>  by always returning <span class="RktVal">0</span> when the
query returns <span class="RktVal">#f</span>.</p><p>Next, we use <span class="RktSym">profile-query</span> to get the <a href="API.html#%28tech._profile._weight%29" class="techoutside" data-pltdoc="x"><span class="techinside">profile weight</span></a>
associated with each branch. <span class="RktSym">profile-query</span> can accept either a
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax?</a></span> or <span class="RktSym"><a href="API.html#%28def._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._profile-point~3f%29%29" class="RktValLink" data-pltdoc="x">profile-point?</a></span>. Here, we query the syntax
of each branch.</p><p>Finally, we generate code. If the false branch <span class="RktSym">f</span> is executed
most often, then we negate the <span class="RktSym">test</span> and flip the branches
when generating the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">if</a></span> form.
Otherwise, we generate a normal <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">if</a></span> form.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3edatum%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;datum</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Expanding_Top-Level_Forms.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._expand-once%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">expand-once</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">if-r</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subject-contains-ci</span><span class="hspace">&nbsp;</span><span class="RktSym">email</span><span class="hspace">&nbsp;</span><span class="RktVal">"PLDI"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">flag</span><span class="hspace">&nbsp;</span><span class="RktSym">email</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">important</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">flag</span><span class="hspace">&nbsp;</span><span class="RktSym">email</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">spam</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">'(if (subject-contains-ci email "PLDI")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(flag email 'important)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(flag email 'spam))</span></p></td></tr></table></td></tr></table></blockquote><p>We see that when we expand <span class="RktSym">if-r</span> before any profile information is generated
and saved, the test and branches stay in the original order. While
expanding is useful for debugging, it can expose implementation specific
details, so do not rely on the output of expand being in a specific
form.</p><p>Before <span class="RktSym">if-r</span> will reorder its branches, we need to generate some
profile information. While we could use <span class="RktSym"><a href="API.html#%28def._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._run-with-profiling%29%29" class="RktValLink" data-pltdoc="x">run-with-profiling</a></span> and
<span class="RktSym"><a href="API.html#%28def._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._save-profile%29%29" class="RktValLink" data-pltdoc="x">save-profile</a></span> to actually profile the profile and save the
profiling data, for this example we instead use the API to generate some
new profile points example profile data.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">make-profile-point</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="API.html#%28def._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._make-profile-point-factory%29%29" class="RktValLink" data-pltdoc="x">make-profile-point-factory</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"my-first-pgmp"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">profile-point-t</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-profile-point</span><span class="hspace">&nbsp;</span><span class="RktVar">syntax</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">profile-point-f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-profile-point</span><span class="hspace">&nbsp;</span><span class="RktVar">syntax</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>We use <span class="RktSym"><a href="API.html#%28def._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._make-profile-point-factory%29%29" class="RktValLink" data-pltdoc="x">make-profile-point-factory</a></span> to create a function
that generates fresh profile points using the prefix <span class="RktVal">"my-first-pgmp"</span>,
and define two new profile points <span class="RktSym">profile-point-t</span> and
<span class="RktSym">profile-point-f</span>. The profile point generator expects a
piece of syntax. For this example, we assume we have some appropriate
piece of syntax <span class="RktVar">syntax</span> which we use where needed
places. In practice, this piece of syntax will be something in scope
when defining a new profile-guided<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=macros.html%23%2528tech._macro%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">macro</span></a>.
If you are following along in the <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=intro.html%23%2528tech._repl%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">REPL</span></a>, use some arbitrary
piece of syntax such as <span class="RktRdr">#'</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void</a></span>.</p><p>Next, we generate some profile information and save it to
the file expected by <span class="RktSym"><a href="API.html#%28def._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._load-profile-query-weight%29%29" class="RktValLink" data-pltdoc="x">load-profile-query-weight</a></span>. We use
<span class="RktSym"><a href="API.html#%28def._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._profile-file%29%29" class="RktValLink" data-pltdoc="x">profile-file</a></span> to generate the filename based on
<span class="RktVar">syntax</span>. The generated profile information claims that the
expression associated with <span class="RktSym">profile-point-t</span> was executed
<span class="RktVal">10</span> times, while the expression associated with
<span class="RktSym">profile-point-f</span> was executed <span class="RktVal">20</span> times. Therefore,
<span class="RktSym">if-r</span> should reorder the branches.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/serialize</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=file-ports.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._with-output-to-file%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">with-output-to-file</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="API.html#%28def._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._profile-file%29%29" class="RktValLink" data-pltdoc="x">profile-file</a></span><span class="hspace">&nbsp;</span><span class="RktVar">syntax</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._write%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">write</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">serialize</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cons%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktSym">profile-point-t</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cons%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktSym">profile-point-f</span><span class="hspace">&nbsp;</span><span class="RktVal">20</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:exists</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">replace</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Finally, we annotate branches with the generated profile points, so
<span class="RktSym">profile-query</span> will find the profile information for the
generated profile points. We also annotate the whole <span class="RktPn">(</span><span class="RktSym">if-r</span><span class="stt"> </span><span class="RktVar">...</span><span class="RktPn">)</span>
with <span class="RktVar">syntax</span> so <span class="RktSym"><a href="API.html#%28def._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._load-profile-query-weight%29%29" class="RktValLink" data-pltdoc="x">load-profile-query-weight</a></span> will load
the right file.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3edatum%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;datum</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Expanding_Top-Level_Forms.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._expand-once%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">expand-once</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fqqstx..rkt%2529._quasisyntax%252Floc%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">quasisyntax/loc</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVar">syntax</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if-r</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subject-contains-ci</span><span class="hspace">&nbsp;</span><span class="RktSym">email</span><span class="hspace">&nbsp;</span><span class="RktVal">"PLDI"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#,</span><span class="RktPn">(</span><span class="RktSym"><a href="API.html#%28form._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._annotate-syn%29%29" class="RktStxLink" data-pltdoc="x">annotate-syn</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">profile-point-t</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">flag</span><span class="hspace">&nbsp;</span><span class="RktSym">email</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">important</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#,</span><span class="RktPn">(</span><span class="RktSym"><a href="API.html#%28form._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._annotate-syn%29%29" class="RktStxLink" data-pltdoc="x">annotate-syn</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">profile-point-f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">flag</span><span class="hspace">&nbsp;</span><span class="RktSym">email</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">spam</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">'(if (not (subject-contains-ci email "PLDI"))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">((lambda () (flag email 'spam)))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">((lambda () (flag email 'important))))</span></p></td></tr></table></td></tr></table></blockquote><p>Note that the branches have been eta-expanded by <span class="RktSym"><a href="API.html#%28form._%28%28lib._pgmp%2Fapi%2Fexact..rkt%29._annotate-syn%29%29" class="RktStxLink" data-pltdoc="x">annotate-syn</a></span>.
This is an implementation detail used to coerce <span class="RktSym">errortrace</span> into
accepting the new profile point.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="index.html" title="backward to &quot;PGMP: Profile-Guided Meta-Programming&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;PGMP: Profile-Guided Meta-Programming&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="API.html" title="forward to &quot;2 API&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/pgmp/PGMP_Quick_Start.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:29:40 GMT -->
</html>