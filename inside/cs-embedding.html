<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/inside/cs-embedding.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:22:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>2&nbsp;Embedding into a Program (CS)</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Inside:<span class="mywbr"> &nbsp;</span> Racket C API</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">I&nbsp;</td><td><a href="cs.html" class="tocviewselflink" data-pltdoc="x">Inside Racket CS</a></td></tr><tr><td align="right">II&nbsp;</td><td><a href="bc.html" class="tocviewlink" data-pltdoc="x">Inside Racket BC (3m and CGC)</a></td></tr><tr><td align="right">III&nbsp;</td><td><a href="appendix.html" class="tocviewlink" data-pltdoc="x">Appendices</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>I&nbsp;</td><td><a href="cs.html" class="tocviewlink" data-pltdoc="x">Inside Racket CS</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="cs-overview.html" class="tocviewlink" data-pltdoc="x">Overview (CS)</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Embedding into a Program (CS)</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="cs-values_types.html" class="tocviewlink" data-pltdoc="x">Values and Types (CS)</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="cs-procs.html" class="tocviewlink" data-pltdoc="x">Calling Procedures (CS)</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="cs-start.html" class="tocviewlink" data-pltdoc="x">Starting and Declaring Initial Modules (CS)</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="cs-eval.html" class="tocviewlink" data-pltdoc="x">Evaluation and Running Modules (CS)</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="cs-thread.html" class="tocviewlink" data-pltdoc="x">Managing OS-<wbr></wbr>Level Threads (CS)</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="cs-overview.html" title="backward to &quot;1 Overview (CS)&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="cs.html" title="up to &quot;I Inside Racket CS&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="cs-values_types.html" title="forward to &quot;3 Values and Types (CS)&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;scribblings/inside/inside.scrbl&quot;)" x-source-pkg="racket-doc" x-part-tag="&quot;cs-embedding&quot;">2<tt>&nbsp;</tt><a name="(part._cs-embedding)"></a><a name="(idx._(gentag._1._(lib._scribblings/inside/inside..scrbl)))"></a>Embedding into a Program (CS)</h3><p>To embed Racket CS in a program, follow these steps:</p><ul><li><p>Locate or <a href="src-build.html" data-pltdoc="x">build</a> the Racket CS library.</p><p>On Unix, the library is <a name="(idx._(gentag._2._(lib._scribblings/inside/inside..scrbl)))"></a><span class="stt">"libracketcs.a"</span>.
Building from source and installing places the libraries into the
installation&rsquo;s <span class="stt">"lib"</span> directory.</p><p>On Windows, link to <span class="stt">"libracketcs<span style="font-style: italic">x</span>.dll"</span> (where
<span style="font-style: italic">x</span> represents the version number). At run time, either
<span class="stt">"libracketcs<span style="font-style: italic">x</span>.dll"</span> must be moved to a location in
the standard DLL search path, or your embedding application must
&ldquo;delayload&rdquo; link the DLLs and explicitly load them before use.
(<span class="stt">"Racket.exe"</span> uses the latter strategy.) See also
<a href="link-dll.html" data-pltdoc="x">Linking to DLLs on Windows</a>.</p><p>On Mac OS, besides <a name="(idx._(gentag._3._(lib._scribblings/inside/inside..scrbl)))"></a><span class="stt">"libracketcs.a"</span> for static
linking, a dynamic library is provided by the <span class="stt">"Racket"</span>
framework, which is typically installed in <span class="stt">"lib"</span>
sub-directory of the installation. Supply <span class="stt">-framework Racket</span>
to <span class="stt">gcc</span> when linking, along with <span class="stt">-F</span> and a path to the
<span class="stt">"lib"</span> directory. At run time, either
<span class="stt">"Racket.framework"</span> must be moved to a location in the
standard framework search path, or your embedding executable must
provide a specific path to the framework (possibly an
executable-relative path using the Mach-O <span class="stt">@executable_path</span>
prefix). When targeting the Hardened Runtime, you must enable the
&ldquo;Allow Unsigned Executable Memory&rdquo; entitlement, otherwise you will
run into &ldquo;out of memory&rdquo; errors when calling <a href="cs-start.html#%28cpp._racket_boot%29" class="RktStxLink" data-pltdoc="x"><span class="stt">racket_boot</span></a>.</p></li><li><p>For each C file that uses Racket library functions,
<span class="stt">#include</span> the files <a name="(idx._(gentag._4._(lib._scribblings/inside/inside..scrbl)))"></a><span class="stt">"chezscheme.h"</span>
and <a name="(idx._(gentag._5._(lib._scribblings/inside/inside..scrbl)))"></a><span class="stt">"racketcs.h"</span>.</p><p>The <span class="stt">"chezscheme.h"</span> and <span class="stt">"racketcs.h"</span> files are
distributed with the Racket software in the installation&rsquo;s
<span class="stt">"include"</span> directory. Building and installing from source
also places this file in the installation&rsquo;s <span class="stt">"include"</span>
directory.</p></li><li><p>In your program, call <a href="cs-start.html#%28cpp._racket_boot%29" class="RktStxLink" data-pltdoc="x"><span class="stt">racket_boot</span></a>. The
<a href="cs-start.html#%28cpp._racket_boot%29" class="RktStxLink" data-pltdoc="x"><span class="stt">racket_boot</span></a> function takes a pointer to a
<a href="cs-start.html#%28cpp._racket_boot_arguments_t%29" class="RktStxLink" data-pltdoc="x"><span class="stt">racket_boot_arguments_t</span></a> for configuring the Racket instance.
After zeroing out the <a href="cs-start.html#%28cpp._racket_boot_arguments_t%29" class="RktStxLink" data-pltdoc="x"><span class="stt">racket_boot_arguments_t</span></a> value
(typicially with <span class="stt">memset</span>), only the following fields are
required to be set:</p><ul><li><p><a href="cs-start.html#%28cpp._exec_file%29" class="RktStxLink" data-pltdoc="x"><span class="stt">exec_file</span></a> &#8212;<wbr></wbr> a path to be reported by
<span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Filesystem.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._find-system-path%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">find-system-path</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">exec-file</span><span class="RktPn">)</span>, usually
<span class="stt">argv[0]</span> for the <span class="stt">argv</span> received by your program&rsquo;s
<span class="stt">main</span>.</p></li><li><p><a href="cs-start.html#%28cpp._boot1_path%29" class="RktStxLink" data-pltdoc="x"><span class="stt">boot1_path</span></a> &#8212;<wbr></wbr> a path to <span class="stt">"petite.boot"</span>. Use
a path that includes at least one directory separator.</p></li><li><p><a href="cs-start.html#%28cpp._boot2_path%29" class="RktStxLink" data-pltdoc="x"><span class="stt">boot2_path</span></a> &#8212;<wbr></wbr> a path to <span class="stt">"scheme.boot"</span> (with
a separator).</p></li><li><p><a href="cs-start.html#%28cpp._boot3_path%29" class="RktStxLink" data-pltdoc="x"><span class="stt">boot3_path</span></a> &#8212;<wbr></wbr> a path to <span class="stt">"racket.boot"</span>
(with a separator).</p></li></ul><p>The <span class="stt">"petite.boot"</span>, <span class="stt">"scheme.boot"</span>, and
<span class="stt">"racket.boot"</span> files are distributed with the Racket
software in the installation&rsquo;s <span class="stt">"lib"</span> directory for Windows,
and they are distributed within the <span class="stt">"Racket"</span> framework on
Mac OS X; they must be <a href="src-build.html" data-pltdoc="x">built</a> from source on Unix.
These files can be combined into a single file&#8212;<wbr></wbr>or even
embedded into the executable&#8212;<wbr></wbr>as long as the <a href="cs-start.html#%28cpp._boot1_offset%29" class="RktStxLink" data-pltdoc="x"><span class="stt">boot1_offset</span></a>,
<a href="cs-start.html#%28cpp._boot2_offset%29" class="RktStxLink" data-pltdoc="x"><span class="stt">boot2_offset</span></a>, and <a href="cs-start.html#%28cpp._boot3_offset%29" class="RktStxLink" data-pltdoc="x"><span class="stt">boot3_offset</span></a> fields of
<a href="cs-start.html#%28cpp._racket_boot_arguments_t%29" class="RktStxLink" data-pltdoc="x"><span class="stt">racket_boot_arguments_t</span></a> are set to identify the starting
offset of each boot image in the file.</p><p>See <a href="segment-ideas.html" data-pltdoc="x">Embedding Files in Executable Sections</a> for advice on embedding files like
<span class="stt">"petite.boot"</span> in an executable.</p></li><li><p>Configure the main thread&rsquo;s namespace by adding module
declarations. The initial namespace contains declarations only for a
few primitive modules, such as <span class="RktVal">'</span><span class="RktVal">#%kernel</span>, and no bindings
are imported into the top-level environment.</p><p>To embed a module like <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=index.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">racket/base</span></a> (along with all
its dependencies), use
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=raco&amp;rel=c-mods.html&amp;version=8.6" class="Sq" data-pltdoc="x"><span class="stt">raco ctool --c-mods </span><span class="sroman">&#8249;<span style="font-style: italic">dest</span>&#8250;</span></a>,
which generates a C file <span class="sroman">&#8249;<span style="font-style: italic">dest</span>&#8250;</span>
that contains modules in compiled form as encapsulated in a static
array. The generated C file defines a <span class="stt">declare_modules</span>
function that takes no arguments and installs the modules into
the environment, and it adjusts the module name resolver to access the
embedded declarations. If embedded modules refer to runtime files
that need to be carried along, supply <span class="nobreak"><span class="stt">--runtime</span></span> to
<span class="stt">raco ctool --c-mods</span> to collect the runtime files into a
directory; see <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=raco&amp;rel=c-mods.html&amp;version=8.6" class="Sq" data-pltdoc="x">Embedding Modules via C</a> for more information.</p><p>Alternatively, set fields like <a href="cs-start.html#%28cpp._collects_dir%29" class="RktStxLink" data-pltdoc="x"><span class="stt">collects_dir</span></a>, <a href="cs-start.html#%28cpp._config_dir%29" class="RktStxLink" data-pltdoc="x"><span class="stt">config_dir</span></a>,
and/or <span class="stt">argv</span> in the <a href="cs-start.html#%28cpp._racket_boot_arguments_t%29" class="RktStxLink" data-pltdoc="x"><span class="stt">racket_boot_arguments_t</span></a> passed to
<a href="cs-start.html#%28cpp._racket_boot%29" class="RktStxLink" data-pltdoc="x"><span class="stt">racket_boot</span></a> to locate collections/packages and initialize the
namespace the same way as when running the <span class="stt">racket</span> executable.</p><p>On Windows, <span class="stt">raco ctool --c-mods </span><span class="sroman">&#8249;<span style="font-style: italic">dest</span>&#8250;</span><span class="stt"> --runtime</span><span class="stt">
</span><span class="sroman">&#8249;<span style="font-style: italic">dest-dir</span>&#8250;</span> includes in <span class="sroman">&#8249;<span style="font-style: italic">dest-dir</span>&#8250;</span> optional DLLs
that are referenced by the Racket library to support
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes-open-converter%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">bytes-open-converter</a></span>. Set <a href="cs-start.html#%28cpp._dll_dir%29" class="RktStxLink" data-pltdoc="x"><span class="stt">dll_dir</span></a> in
<a href="cs-start.html#%28cpp._racket_boot_arguments_t%29" class="RktStxLink" data-pltdoc="x"><span class="stt">racket_boot_arguments_t</span></a> to register <span class="sroman">&#8249;<span style="font-style: italic">dest-dir</span>&#8250;</span> so that
those DLLs can be found at run time.</p><p>Instead of using <span class="nobreak"><span class="stt">--c-mods</span></span> with <span class="stt">raco ctool</span>, you can use
<span class="nobreak"><span class="stt">--mods</span></span>, embed the file content (see <a href="segment-ideas.html" data-pltdoc="x">Embedding Files in Executable Sections</a>)
and load the content with <a href="cs-start.html#%28cpp._racket_embedded_load_file_region%29" class="RktStxLink" data-pltdoc="x"><span class="stt">racket_embedded_load_file_region</span></a>.</p></li><li><p>Access Racket through <a href="cs-eval.html#%28cpp._racket_dynamic_require%29" class="RktStxLink" data-pltdoc="x"><span class="stt">racket_dynamic_require</span></a>,
<a href="cs-eval.html#%28cpp._racket_eval%29" class="RktStxLink" data-pltdoc="x"><span class="stt">racket_eval</span></a>, and/or other functions described in this manual.</p><p>If the embedding program configures built-in parameters in a way
that should be considered part of the default configuration, then
call the <span class="RktSym">seal</span> function provided by the primitive
<span class="RktSym">#%boot</span> module afterward. The snapshot of parameter
values taken by <span class="RktSym">seal</span> is used for certain
privileged operations, such as installing a <span class="planetName">PLaneT</span> package.</p></li><li><p>Compile the program and link it with the Racket libraries.</p></li></ul><p><a name="(idx._(gentag._6._(lib._scribblings/inside/inside..scrbl)))"></a>Racket values may be moved or garbage
collected any time that <span class="stt">racket_...</span> functions are used to run
Racket code. Do not retain a reference to any Racket value across such
a call.</p><p>For example, the following is a simple embedding program that runs a
module <span class="stt">"run.rkt"</span>, assuming that <span class="stt">"run.c"</span> is created
as</p><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">raco ctool --c-mods run.c "run.rkt"</span></p><p>to generate <span class="stt">"run.c"</span>, which encapsulates the compiled form of
<span class="stt">"run.rkt"</span> and all of its transitive imports (so that they
need not be found separately a run time). Copies of
<span class="stt">"petite.boot"</span>, <span class="stt">"scheme.boot"</span>, and
<span class="stt">"racket.boot"</span> must be in the current directory on startup.</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"main.c"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#include &lt;string.h&gt;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#include "chezscheme.h"</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#include "racketcs.h"</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#include "run.c"</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int main(int argc, char *argv[])</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">{</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">racket_boot_arguments_t ba;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">memset(&amp;ba, 0, sizeof(ba));</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">ba.boot1_path = "./petite.boot";</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">ba.boot2_path = "./scheme.boot";</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">ba.boot3_path = "./racket.boot";</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">ba.exec_file = argv[0];</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">racket_boot(&amp;ba);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">declare_modules();</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">ptr mod = Scons(Sstring_to_symbol("quote"),</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">Scons(Sstring_to_symbol("run"),</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">Snil));</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">racket_dynamic_require(mod, Sfalse);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">return 0;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></blockquote></blockquote><p>As another example, the following is a simple embedding program that
evaluates all expressions provided on the command line and displays
the results, then runs a <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Reading.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._read%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">read</a></span>-<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=eval.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eval%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eval</a></span>-<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._print%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">print</a></span>
loop, all using <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=index.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">racket/base</span></a>. Run</p><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">raco ctool --c-mods base.c ++lib racket/base</span></p><p>to generate <span class="stt">"base.c"</span>, which encapsulates <span class="RktSym">racket/base</span>
and all of its transitive imports.</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"main.c"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#include &lt;string.h&gt;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#include "chezscheme.h"</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#include "racketcs.h"</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">#include "base.c"</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">static ptr to_bytevector(char *s);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int main(int argc, char *argv[])</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">{</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">racket_boot_arguments_t ba;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">memset(&amp;ba, 0, sizeof(ba));</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">ba.boot1_path = "./petite.boot";</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">ba.boot2_path = "./scheme.boot";</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">ba.boot3_path = "./racket.boot";</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">ba.exec_file = argv[0];</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">racket_boot(&amp;ba);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">declare_modules();</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">racket_namespace_require(Sstring_to_symbol("racket/base"));</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">{</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">int i;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">for (i = 1; i &lt; argc; i++) {</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">ptr e = to_bytevector(argv[i]);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">e = Scons(Sstring_to_symbol("open-input-bytes"),</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">Scons(e, Snil));</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">e = Scons(Sstring_to_symbol("read"), Scons(e, Snil));</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">e = Scons(Sstring_to_symbol("eval"), Scons(e, Snil));</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">e = Scons(Sstring_to_symbol("println"), Scons(e, Snil));</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">racket_eval(e);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">{</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">ptr rbase_sym = Sstring_to_symbol("racket/base");</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">ptr repl_sym = Sstring_to_symbol("read-eval-print-loop");</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">racket_apply(Scar(racket_dynamic_require(rbase_sym,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">repl_sym)),</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">Snil);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">return 0;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">static ptr to_bytevector(char *s)</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">{</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">iptr len = strlen(s);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">ptr bv = Smake_bytevector(len, 0);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">memcpy(Sbytevector_data(bv), s, len);</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">return bv;</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></p></td></tr></table></blockquote></blockquote><p>If modules embedded in the executable need to access runtime files
(via <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Filesystem.html%23%2528mod-path._racket%252Fruntime-path%2529&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">racket/runtime-path</span></a> forms), supply the
<span class="nobreak"><span class="stt">--runtime</span></span> flag to <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=raco&amp;rel=ctool.html&amp;version=8.6" class="Sq" data-pltdoc="x"><span class="stt">raco ctool</span></a>, specifying a directory
where the runtime files are to be gathered. The modules in the
generated <span class="stt">".c"</span> file will then refer to the files in that
directory.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="cs-overview.html" title="backward to &quot;1 Overview (CS)&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="cs.html" title="up to &quot;I Inside Racket CS&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="cs-values_types.html" title="forward to &quot;3 Values and Types (CS)&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/inside/cs-embedding.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:22:49 GMT -->
</html>