<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/qi/Qi_Macros.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:13:28 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>6&nbsp;Qi Macros</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Qi:<span class="mywbr"> &nbsp;</span> A Functional, Flow-<wbr></wbr>Oriented DSL</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Using_These_Docs.html" class="tocviewlink" data-pltdoc="x">Using These Docs</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Introduction_and_Usage.html" class="tocviewlink" data-pltdoc="x">Introduction and Usage</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Tutorial.html" class="tocviewlink" data-pltdoc="x">Tutorial</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Language_Interface.html" class="tocviewlink" data-pltdoc="x">Language Interface</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Qi_Forms.html" class="tocviewlink" data-pltdoc="x">The Qi Language</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Qi Macros</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Field_Guide.html" class="tocviewlink" data-pltdoc="x">Field Guide</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="Principles_of_Qi.html" class="tocviewlink" data-pltdoc="x">Principles of Qi</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="When_Should_I_Use_Qi_.html" class="tocviewlink" data-pltdoc="x">When Should I Use Qi?</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>6&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Qi Macros</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">6.1&nbsp;</td><td><a href="#%28part._.Defining_.Macros%29" class="tocviewlink" data-pltdoc="x">Defining Macros</a></td></tr><tr><td align="right">6.2&nbsp;</td><td><a href="#%28part._.Using_.Macros%29" class="tocviewlink" data-pltdoc="x">Using Macros</a></td></tr><tr><td align="right">6.3&nbsp;</td><td><a href="#%28part._.Adding_.New_.Language_.Features%29" class="tocviewlink" data-pltdoc="x">Adding New Language Features</a></td></tr><tr><td align="right">6.4&nbsp;</td><td><a href="#%28part._.Writing_.Languages_in_.Qi%29" class="tocviewlink" data-pltdoc="x">Writing Languages in Qi</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">6.1<tt>&nbsp;</tt></span><a href="#%28part._.Defining_.Macros%29" class="tocsubseclink" data-pltdoc="x">Defining Macros</a></td></tr><tr><td><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-rule%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>qi-<wbr></wbr>syntax-<wbr></wbr>rule</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-parser%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>qi-<wbr></wbr>syntax-<wbr></wbr>parser</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._qi%2Fmain..rkt%29._qi-macro%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">qi-<wbr></wbr>macro</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>qi-<wbr></wbr>syntax</span></span></a></td></tr><tr><td><span class="tocsublinknumber">6.2<tt>&nbsp;</tt></span><a href="#%28part._.Using_.Macros%29" class="tocsubseclink" data-pltdoc="x">Using Macros</a></td></tr><tr><td><span class="tocsublinknumber">6.2.1<tt>&nbsp;</tt></span><a href="#%28part._.Racket_.Version_.Compatibility%29" class="tocsubseclink" data-pltdoc="x">Racket Version Compatibility</a></td></tr><tr><td><span class="tocsublinknumber">6.3<tt>&nbsp;</tt></span><a href="#%28part._.Adding_.New_.Language_.Features%29" class="tocsubseclink" data-pltdoc="x">Adding New Language Features</a></td></tr><tr><td><span class="tocsublinknumber">6.3.1<tt>&nbsp;</tt></span><a href="#%28part._.Write_.Yourself_a_.Maybe_.Monad_for_.Great_.Good%29" class="tocsubseclink" data-pltdoc="x">Write Yourself a Maybe Monad for Great Good</a></td></tr><tr><td><span class="tocsublinknumber">6.3.2<tt>&nbsp;</tt></span><a href="#%28part._.Translating_.Foreign_.Macros%29" class="tocsubseclink" data-pltdoc="x">Translating Foreign Macros</a></td></tr><tr><td><span class="tocsublinknumber">6.4<tt>&nbsp;</tt></span><a href="#%28part._.Writing_.Languages_in_.Qi%29" class="tocsubseclink" data-pltdoc="x">Writing Languages in Qi</a></td></tr><tr><td><span class="tocsublinknumber">6.4.1<tt>&nbsp;</tt></span><a href="#%28part._.Embedded_.Languages%29" class="tocsubseclink" data-pltdoc="x">Embedded Languages</a></td></tr><tr><td><span class="tocsublinknumber">6.4.2<tt>&nbsp;</tt></span><a href="#%28part._.Hosted_.Languages%29" class="tocsubseclink" data-pltdoc="x">Hosted Languages</a></td></tr><tr><td><span class="tocsublinknumber">6.4.3<tt>&nbsp;</tt></span><a href="#%28part._.Embedding_a_.Hosted_.Language%29" class="tocsubseclink" data-pltdoc="x">Embedding a Hosted Language</a></td></tr><tr><td><span class="tocsublinknumber">6.4.3.1<tt>&nbsp;</tt></span><a href="#%28part._.Exercise__.Pattern_.Matching%29" class="tocsubseclink" data-pltdoc="x">Exercise:<span class="mywbr"> &nbsp;</span> Pattern Matching</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Qi_Forms.html" title="backward to &quot;5 The Qi Language&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Qi: A Functional, Flow-Oriented DSL&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Field_Guide.html" title="forward to &quot;7 Field Guide&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;qi/scribblings/qi.scrbl&quot;)" x-source-pkg="qi-doc" x-part-tag="&quot;Qi_Macros&quot;">6<tt>&nbsp;</tt><a name="(part._.Qi_.Macros)"></a>Qi Macros</h3><p>Qi may be extended in much the same way as Racket &ndash; using <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=syntax-model.html%23%2528tech._macro%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">macros</span></a>. Qi macros are indistinguishable from built-in Qi forms during the macro expansion phase, just as user-defined Racket macros are indistinguishable from macros that are part of the Racket language. This allows us to have the same syntactic freedom with Qi as we are used to with Racket, from being able to <a href="#%28part._.Adding_.New_.Language_.Features%29" data-pltdoc="x">add new language features</a> to implementing <a href="#%28part._.Writing_.Languages_in_.Qi%29" data-pltdoc="x">entire new languages</a> in Qi.</p><p>This "first class" macro extensibility of Qi follows the general approach described in <a href="https://dl.acm.org/doi/abs/10.1145/3428297">Macros for Domain-Specific Languages (Ballantyne et. al.)</a>.</p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Defining_.Macros%29" class="toclink" data-pltdoc="x">6.1<span class="hspace">&nbsp;</span>Defining Macros</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Using_.Macros%29" class="toclink" data-pltdoc="x">6.2<span class="hspace">&nbsp;</span>Using Macros</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Racket_.Version_.Compatibility%29" class="toclink" data-pltdoc="x">6.2.1<span class="hspace">&nbsp;</span>Racket Version Compatibility</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Adding_.New_.Language_.Features%29" class="toclink" data-pltdoc="x">6.3<span class="hspace">&nbsp;</span>Adding New Language Features</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Write_.Yourself_a_.Maybe_.Monad_for_.Great_.Good%29" class="toclink" data-pltdoc="x">6.3.1<span class="hspace">&nbsp;</span>Write Yourself a Maybe Monad for Great Good</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Translating_.Foreign_.Macros%29" class="toclink" data-pltdoc="x">6.3.2<span class="hspace">&nbsp;</span>Translating Foreign Macros</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Writing_.Languages_in_.Qi%29" class="toclink" data-pltdoc="x">6.4<span class="hspace">&nbsp;</span>Writing Languages in Qi</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Embedded_.Languages%29" class="toclink" data-pltdoc="x">6.4.1<span class="hspace">&nbsp;</span>Embedded Languages</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Hosted_.Languages%29" class="toclink" data-pltdoc="x">6.4.2<span class="hspace">&nbsp;</span>Hosted Languages</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Embedding_a_.Hosted_.Language%29" class="toclink" data-pltdoc="x">6.4.3<span class="hspace">&nbsp;</span>Embedding a Hosted Language</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Exercise__.Pattern_.Matching%29" class="toclink" data-pltdoc="x">6.4.3.1<span class="hspace">&nbsp;</span>Exercise: Pattern Matching</a></p></td></tr></table><h4 x-source-module="(lib &quot;qi/scribblings/qi.scrbl&quot;)" x-source-pkg="qi-doc" x-part-tag="&quot;Defining_Macros&quot;">6.1<tt>&nbsp;</tt><a name="(part._.Defining_.Macros)"></a>Defining Macros</h4><p>These Qi macro definition forms mirror the corresponding forms for defining Racket macros. Note that if you use <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html&amp;version=8.6" class="Sq" data-pltdoc="x">syntax patterns</a> or <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-specifying.html&amp;version=8.6" class="Sq" data-pltdoc="x">syntax classes</a> in your macro definition, or if you are manipulating syntax objects directly, you may need to <span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for-syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">for-syntax</a></span><span class="stt"> </span><span class="RktSym">syntax/parse</span><span class="stt"> </span><span class="RktSym">racket/base</span><span class="RktPn">)</span><span class="RktPn">)</span>, just as you would in writing similar Racket macros.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><table cellspacing="0" cellpadding="0" class="RktBlk RForeground"><tr><td><span class="RktPn">(</span><a name="(form._((lib._qi/main..rkt)._define-qi-syntax-rule))"></a><span title="Provided from: qi | Package: qi-lib"><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-rule%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-qi-syntax-rule</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">macro-id</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">pattern</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">pattern-directive</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">template</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Similar to <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Defining_Simple_Macros.html%23%2528form._%2528%2528lib._syntax%252Fparse%252Fdefine..rkt%2529._define-syntax-parse-rule%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax-parse-rule</a></span>, this defines a Qi macro named <span class="RktVar">macro-id</span>, which may be used in any flow definition. The <span class="RktVar">template</span> is expected to be a Qi rather than Racket expression. You can <a href="Language_Interface.html#%28part._.Using_.Racket_to_.Define_.Flows%29" data-pltdoc="x">always use Racket</a> here via <span class="RktSym">esc</span>, of course.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pare</span><span class="hspace">&nbsp;</span><span class="RktSym">car-flo</span><span class="hspace">&nbsp;</span><span class="RktSym">cdr-flo</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">group</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktSym">car-flo</span><span class="hspace">&nbsp;</span><span class="RktSym">cdr-flo</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pare</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528lib._racket%252Fmath..rkt%2529._sqr%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#9661;</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(9<span class="stt"> </span>15)</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._qi/main..rkt)._define-qi-syntax-parser))"></a><span title="Provided from: qi | Package: qi-lib"><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-parser%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-qi-syntax-parser</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">macro-id</span><span class="hspace">&nbsp;</span><span class="RktVar">parse-option</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="hspace">&nbsp;</span><span class="RktVar">clause</span><span class="hspace">&nbsp;</span><span class="RktMeta">...+</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Similar to <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Defining_Simple_Macros.html%23%2528form._%2528%2528lib._syntax%252Fparse%252Fdefine..rkt%2529._define-syntax-parser%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax-parser</a></span>, this defines a Qi macro named <span class="RktVar">macro-id</span>, which may be used in any flow definition. The <span class="RktSym">template</span> in each clause is expected to be a Qi rather than Racket expression. You can <a href="Language_Interface.html#%28part._.Using_.Racket_to_.Define_.Flows%29" data-pltdoc="x">always use Racket</a> here via <span class="RktSym">esc</span>, of course.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-parser%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax-parser</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pare</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVar">:id</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktVal">'</span><span class="RktVal">hello</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym">car-flo</span><span class="hspace">&nbsp;</span><span class="RktSym">cdr-flo</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">group</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktSym">car-flo</span><span class="hspace">&nbsp;</span><span class="RktSym">cdr-flo</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pare</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528lib._racket%252Fmath..rkt%2529._sqr%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#9661;</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(9<span class="stt"> </span>15)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">pare</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'hello</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>struct</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="stt"> </span><a name="(def._((lib._qi/main..rkt)._qi-macro-transformer))"></a><a name="(def._((lib._qi/main..rkt)._qi-macro~3f))"></a><a name="(def._((lib._qi/main..rkt)._struct~3aqi-macro))"></a><a name="(def._((lib._qi/main..rkt)._qi-macro))"></a><span title="Provided from: qi | Package: qi-lib"><span class="RktSym"><a href="#%28def._%28%28lib._qi%2Fmain..rkt%29._qi-macro%29%29" class="RktValDef RktValLink" data-pltdoc="x">qi-macro</a></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">transformer</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">transformer</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._procedure%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">procedure?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">If you cannot use the forms above and instead need to define a macro using Racket&rsquo;s macro APIs directly, the only thing you&rsquo;d need to do is wrap the resulting syntax parser as a <span class="RktSym"><a href="#%28def._%28%28lib._qi%2Fmain..rkt%29._qi-macro%29%29" class="RktValLink" data-pltdoc="x">qi-macro</a></span> type.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">qi</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for-syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">for-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktSym">syntax/parse</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">racket/base</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktSym">square</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._qi%2Fmain..rkt%29._qi-macro%29%29" class="RktValLink" data-pltdoc="x">qi-macro</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parser%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-parser</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">square</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">7</span></p></td></tr></table></blockquote></div></p><p>However, if the binding you define in this way collides with an identifier in Racket (for instance, if you call it <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span>), it would override the Racket version (unlike using <span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax-rule</a></span> or <span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-parser%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax-parser</a></span> where they exist in a distinct <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=syntax-model.html%23%2528tech._binding._space%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">binding space</span></a>). To avoid this, use <span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax</a></span> instead of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span>.</p><p>Note that the type constructor <span class="RktSym"><a href="#%28def._%28%28lib._qi%2Fmain..rkt%29._qi-macro%29%29" class="RktValLink" data-pltdoc="x">qi-macro</a></span> is all that is publicly exported for this struct type (and only in the <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=syntax-model.html%23%2528tech._phase._level%2529&amp;version=8.6" class="Sq" data-pltdoc="x">syntax phase</a>), since the details of its implementation are considered internal to the Qi library.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._qi/main..rkt)._define-qi-syntax))"></a><span title="Provided from: qi | Package: qi-lib"><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-qi-syntax</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">macro-id</span><span class="hspace">&nbsp;</span><span class="RktVar">transformer</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Similar to <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span>, this creates a <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=proc-macros.html%23%2528tech._transformer._binding%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">transformer binding</span></a> but uses the Qi <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=syntax-model.html%23%2528tech._binding._space%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">binding space</span></a>, so that macros defined this way will not override any Racket (or other language) forms that may have the same name. <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax</a></span><span class="stt"> </span><span class="RktVar">macro-id</span><span class="stt"> </span><span class="RktVar">transformer</span><span class="RktPn">)</span> is approximately <span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxtrans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-interned-syntax-introducer%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">make-interned-syntax-introducer</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">qi</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVar">macro-id</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVar">transformer</span><span class="RktPn">)</span>.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._qi%2Fmain..rkt%29._qi-macro%29%29" class="RktValLink" data-pltdoc="x">qi-macro</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parser%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">syntax-parser</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">7</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">cond</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">hi</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">bye</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'bye</span></p></td></tr></table></blockquote></div></p><p>Note that macros defined using this form <span class="emph">must</span> wrap the resulting syntax parser as a <span class="RktSym"><a href="#%28def._%28%28lib._qi%2Fmain..rkt%29._qi-macro%29%29" class="RktValLink" data-pltdoc="x">qi-macro</a></span>.</p><h4 x-source-module="(lib &quot;qi/scribblings/qi.scrbl&quot;)" x-source-pkg="qi-doc" x-part-tag="&quot;Using_Macros&quot;">6.2<tt>&nbsp;</tt><a name="(part._.Using_.Macros)"></a>Using Macros</h4><p><span class="emph">Note: This section is about using Qi macros. If you are looking for information on using macros of another language (such as Racket or another DSL) together with Qi, see <a href="Language_Interface.html#%28part._.Using_.Racket_.Macros_as_.Flows%29" data-pltdoc="x">Using Racket Macros as Flows</a>.</span></p><p>Qi macros are bindings just like Racket macros. In order to use them, simply <a href="#%28part._.Defining_.Macros%29" data-pltdoc="x">define them</a>, and if necessary, <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._provide%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">provide</a></span>, and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span> them in the relevant modules, with the proviso below regarding "binding spaces." Once defined and in scope, Qi macros are indistinguishable from built-in <a href="Qi_Forms.html" data-pltdoc="x">Qi forms</a>, and may be used in any flow definition just like the built-in forms.</p><p>In order to ensure that Qi macros are only usable within a Qi context and do not interfere with Racket macros that may happen to share the same name, Qi macros are defined so that they exist in their own <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=syntax-model.html%23%2528tech._binding._space%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">binding space</span></a>. This means that you must use the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._provide%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">provide</a></span> subform <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for-space%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">for-space</a></span> in order to make Qi macros available for use in other modules. They may be <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="Sq" data-pltdoc="x">required</a> in the same way as any other bindings, however, i.e. indicating <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for-space%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">for-space</a></span> with <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span> is not necessary.</p><p>To illustrate, the providing module would resemble this:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._provide%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">provide</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for-space%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">for-space</a></span><span class="hspace">&nbsp;</span><span class="RktSym">qi</span><span class="hspace">&nbsp;</span><span class="RktSym">pare</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pare</span><span class="hspace">&nbsp;</span><span class="RktSym">car-flo</span><span class="hspace">&nbsp;</span><span class="RktSym">cdr-flo</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">group</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktSym">car-flo</span><span class="hspace">&nbsp;</span><span class="RktSym">cdr-flo</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>And assuming the module defining the Qi macro <span class="RktSym">pare</span> is called <span class="RktSym">mac-module</span>, then any of the following (among other variations) would import it into scope.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mac-module</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._only-in%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">only-in</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mac-module</span><span class="hspace">&nbsp;</span><span class="RktSym">pare</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><h5 x-source-module="(lib &quot;qi/scribblings/qi.scrbl&quot;)" x-source-pkg="qi-doc" x-part-tag="&quot;Racket_Version_Compatibility&quot;">6.2.1<tt>&nbsp;</tt><a name="(part._.Racket_.Version_.Compatibility)"></a>Racket Version Compatibility</h5><p>As binding spaces were added to Racket in version 8.3, older versions of Racket will not be able to use the macros described here, but can still use the legacy <a href="Qi_Forms.html#%28part._.Language_.Extension%29" data-pltdoc="x"><span class="RktSym">qi:</span>-prefixed macros</a>.</p><h4 x-source-module="(lib &quot;qi/scribblings/qi.scrbl&quot;)" x-source-pkg="qi-doc" x-part-tag="&quot;Adding_New_Language_Features&quot;">6.3<tt>&nbsp;</tt><a name="(part._.Adding_.New_.Language_.Features)"></a>Adding New Language Features</h4><p>When you consider that Racket&rsquo;s <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=guide&amp;rel=classes.html&amp;version=8.6" class="Sq" data-pltdoc="x">class-based object system</a> for object-oriented programming is implemented with Racket macros in terms of the underlying <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=structures.html&amp;version=8.6" class="Sq" data-pltdoc="x">struct type</a> system, it gives you some idea of the extent to which macros enable the addition of new language features, both great and small. In this section we&rsquo;ll look at a few examples of what Qi macros can do.</p><h5 x-source-module="(lib &quot;qi/scribblings/qi.scrbl&quot;)" x-source-pkg="qi-doc" x-part-tag="&quot;Write_Yourself_a_Maybe_Monad_for_Great_Good&quot;">6.3.1<tt>&nbsp;</tt><a name="(part._.Write_.Yourself_a_.Maybe_.Monad_for_.Great_.Good)"></a>Write Yourself a Maybe Monad for Great Good</h5><p>In functional languages such as Haskell, a popular way to do (or rather avoid) exception handling is to use the Maybe monad. Qi doesn&rsquo;t include monads out of the box yet, but you could implement a version of the Maybe monad yourself by using macros. But first, let&rsquo;s quickly review why you might want to in the first place.</p><p>Earlier, we <a href="Introduction_and_Usage.html#%28part._.Overview%29" data-pltdoc="x">drew a distinction</a> between two paradigms employed in programming languages: one organized around the flow of <span class="emph">control</span> and another organized around the flow of <span class="emph">data</span>. A way to manage possible errors in code along the lines of the former ("control") paradigm is to handle <span class="emph">exceptions</span> that may occur at each stage, and take appropriate action &ndash; for instance, abort the remainder of the computation. A second way to handle errors, more along the lines of the "flow of data" paradigm, is for the "failing" computation to simply produce a sentinel value that signifies an error, so that the sequence of operations does not actually fail but merely generates and propagates a value signifying failure. The trick is, how to do this in such a way that downstream computations are aware of the sentinel error value so that they don&rsquo;t attempt to perform computations on it that they might do on a "normal" value? This is where the Maybe monad comes in.</p><p>We want to thread values through a number of flows, and if any of those flows raises an exception, we&rsquo;d like the entire flow to generate <span class="emph">no values</span>. Typically, we compose flows in series by using the <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span> form. For flows that may fail, we need a similar form, but one that (1) handles failure of a particular flow by producing no values, and (2) composes flows so that the entire flow fails (i.e. produces no values) if any component fails.</p><p>Let&rsquo;s write each of these in turn and then put them together.</p><p>For the first, we write a macro that wraps any Qi flow with the exception handling logic to generate no values.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">get</span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">try</span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exn%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">exn?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">&#9178;</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>This uses Qi&rsquo;s <span class="RktSym">try</span> form to catch any exceptions raised during execution of the flow, handling them by simply generating no values as the result.</p><p>Now for the second part, in the binary case of two flows <span class="RktSym">f</span> and <span class="RktSym">g</span>, either of which may fail to produce values, the composition could be defined as:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mcomp</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktSym">g</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=when_unless.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._when%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">when</a></span><span class="hspace">&nbsp;</span><span class="RktSym">live?</span><span class="hspace">&nbsp;</span><span class="RktSym">g</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>... which only feeds the output of the first flow to the second if there is any. Now, let&rsquo;s put these together to write our failure-aware threading form, that is to say, our Maybe monad.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-parser%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax-parser</a></span><span class="hspace">&nbsp;</span><span class="RktSym">maybe~&gt;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">get</span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym">flo1</span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">mcomp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">get</span><span class="hspace">&nbsp;</span><span class="RktSym">flo1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">maybe~&gt;</span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote><p>This form is just like <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span>, except that it does two additional things: (1) It wraps each component flow with the <span class="RktSym">get</span> macro so that an exception would result in the flow generating no values, and (2) it checks whether there are values flowing at all before attempting to invoke the next flow on the outputs. Thus, if there is a failure at any point, the entire rest of the computation is short-circuited.</p><p>Note that short-circuiting isn&rsquo;t essential here as long as our composition ensures that the result is still well-defined if downstream flow components are invoked with no values upon failure of an upstream component (and they should produce no values in this case). But as we already know the result at the first point of failure, it is more performant to avoid invoking subsequent flows at all rather than rely on repeated composition in a computation destined to produce no values, and indeed, most Maybe implementations do short-circuit in this manner.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~e2~98~af%29%29" class="RktStxLink" data-pltdoc="x">&#9775;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">maybe~&gt;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252F%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">/</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528lib._racket%252Fmath..rkt%2529._sqr%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~e2~98~af%29%29" class="RktStxLink" data-pltdoc="x">&#9775;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">maybe~&gt;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252F%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">/</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528lib._racket%252Fmath..rkt%2529._sqr%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span></td></tr></table></blockquote><p>And there you have it, you&rsquo;ve implemented the Maybe monad in about nine lines of Qi macros.</p><h5 x-source-module="(lib &quot;qi/scribblings/qi.scrbl&quot;)" x-source-pkg="qi-doc" x-part-tag="&quot;Translating_Foreign_Macros&quot;">6.3.2<tt>&nbsp;</tt><a name="(part._.Translating_.Foreign_.Macros)"></a>Translating Foreign Macros</h5><p>Qi expects components of a flow to be flows, which at the lowest level are functions. This means that Qi cannot naively be used with forms from the host language (or another DSL) that are <span class="emph">macros</span>. If we didn&rsquo;t have <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-foreign-syntaxes%29%29" class="RktStxLink" data-pltdoc="x">define-qi-foreign-syntaxes</a></span> to register such "foreign-language macros" with Qi in a convenient way, we could still implement this feature ourselves, by writing corresponding Qi macros to wrap the foreign macros. The following example demonstrates how this might work.</p><p>In <a href="Field_Guide.html#%28part._.Converting_a_.Macro_to_a_.Flow%29" data-pltdoc="x">Converting a Macro to a Flow</a>, we learned that Racket macros could be used from Qi by employing <span class="RktSym">esc</span> and wrapping the foreign macro invocation in a <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span>. To avoid doing this manually each time, we could write a Qi macro to make this syntactic transformation invisible. For instance:</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._define-syntax-rule%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">double-me</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252A%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._define-syntax-rule%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-two</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._-%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-parser%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax-parser</a></span><span class="hspace">&nbsp;</span><span class="RktSym">subtract-two</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVar">:id</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">esc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._%7Ece%7Ebb%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-two</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">esc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._%7Ece%7Ebb%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-two</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7edatum%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~datum</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">subtract-two</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7edatum%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">~datum</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">esc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._%7Ece%7Ebb%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-two</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-parser%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax-parser</a></span><span class="hspace">&nbsp;</span><span class="RktSym">double-me</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVar">:id</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">esc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._%7Ece%7Ebb%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">double-me</span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-two</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">double-me</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">2</span></p></td></tr></table></blockquote></div></p><p>Note that the Qi macros can have the same name as the Racket macros since they exist in different <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=syntax-model.html%23%2528tech._binding._space%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">binding spaces</span></a> and therefore don&rsquo;t interfere with one another.</p><p>Of course, writing Qi macros for such cases in practice is unnecessary as there is <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-foreign-syntaxes%29%29" class="RktStxLink" data-pltdoc="x">define-qi-foreign-syntaxes</a></span> instead, which does this for you and in a robust and generally applicable way.</p><h4 x-source-module="(lib &quot;qi/scribblings/qi.scrbl&quot;)" x-source-pkg="qi-doc" x-part-tag="&quot;Writing_Languages_in_Qi&quot;">6.4<tt>&nbsp;</tt><a name="(part._.Writing_.Languages_in_.Qi)"></a>Writing Languages in Qi</h4><p>Just as Racket macros allow us to write new languages in Racket, Qi macros allow us to write new languages in Qi.</p><p>You may prefer to use Qi as your starting point if your language deals with the flow of data, or if the semantics of the language are more easily expressed in Qi than in Racket. By starting from Qi, you inherit access to all of Qi&rsquo;s forms, extensions, and tools that have been designed with the flow of data in mind &#8211; so you can focus on the specifics of your domain rather than the generalities of data flow.</p><p>In general, macros that define new languages are called <a name="(tech._interface._macro)"></a><span style="font-style: italic">interface macros</span>, since they form the interface between two languages. Languages fall into two classes depending on their use of interface macros. We&rsquo;ll learn about these two classes and then go over some examples to get a sense for when each type of language is called for.</p><h5 x-source-module="(lib &quot;qi/scribblings/qi.scrbl&quot;)" x-source-pkg="qi-doc" x-part-tag="&quot;Embedded_Languages&quot;">6.4.1<tt>&nbsp;</tt><a name="(part._.Embedded_.Languages)"></a>Embedded Languages</h5><p>One class of language has as many <a href="#%28tech._interface._macro%29" class="techoutside" data-pltdoc="x"><span class="techinside">interface macros</span></a> as there are forms in the language, so that the language seamlessly extends the host language. Such languages are called embedded languages or <a name="(tech._embedded._dsl)"></a><span style="font-style: italic">embedded DSLs</span>. Examples of embedded languages in the Racket ecosystem include <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?tag=%28part._%28.%27%28lib._deta%2Fdeta..scrbl%29.%27._.%27top.%27%29%29&amp;version=8.6" class="Sq" data-pltdoc="x">Deta</a>, <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?tag=%28part._%28.%27%28lib._sawzall-doc%2Fsawzall..scrbl%29.%27._.%27top.%27%29%29&amp;version=8.6" class="Sq" data-pltdoc="x">Sawzall</a>, Racket&rsquo;s built-in <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=contracts.html&amp;version=8.6" class="Sq" data-pltdoc="x">contract DSL</a>, <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?tag=%28part._%28.%27%28lib._contract%2Fsocial%2Fscribblings%2Fsocial-contract..scrbl%29.%27._.%27top.%27%29%29&amp;version=8.6" class="Sq" data-pltdoc="x">Social Contract</a>, and <a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?tag=%28part._%28.%27%28lib._scribblings%2Fmegaparsack..scrbl%29.%27._.%27top.%27%29%29&amp;version=8.6" class="Sq" data-pltdoc="x">Megaparsack</a>.</p><p>Embedded languages implicitly inherit the semantics of the host language (but may define and employ custom semantics, even predominantly). With Qi as the host language, this means that such languages are inherently flow-oriented, and could range from general-purpose "dialects" of Qi to specialized DSLs. They are perhaps the most common type of language one might write in Qi.</p><p>If your language would employ flows in a general way but with specialized data structures or idioms, then it may be a good candidate for implementation as an embedded Qi DSL.</p><p>If there is an existing such language already implemented in Racket that you&rsquo;d like to treat as a Qi DSL, you can embed it into Qi by using <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-foreign-syntaxes%29%29" class="RktStxLink" data-pltdoc="x">define-qi-foreign-syntaxes</a></span>, but note that this "extrinsic" embedding would not benefit from any flow optimizations that may eventually be part of the Qi compiler, and incurs some administrative overhead.</p><h5 x-source-module="(lib &quot;qi/scribblings/qi.scrbl&quot;)" x-source-pkg="qi-doc" x-part-tag="&quot;Hosted_Languages&quot;">6.4.2<tt>&nbsp;</tt><a name="(part._.Hosted_.Languages)"></a>Hosted Languages</h5><p>It is also possible to implement your language as a <span class="emph">single</span> macro or a small set of mutually reliant macros, with the bulk of the forms of the language specified as expansion rules within these macros. Such a language is called a <span class="emph">hosted</span> language or <a name="(tech._hosted._dsl)"></a><span style="font-style: italic">hosted DSL</span>, and each of the <a href="#%28tech._interface._macro%29" class="techoutside" data-pltdoc="x"><span class="techinside">interface macros</span></a> it is made up of could be considered to be hosted sublanguages. Examples of hosted languages include Racket&rsquo;s <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match</a></span>, and Qi itself, and typically (as in these examples) they are defined via a single interface macro containing all of the rules of the language.</p><p>The advantage of writing a hosted DSL, in general, is that by introducing a level of indirection between your code and the host-language (e.g. Racket or Qi) expander, you gain access to a distinct namespace that does not interfere with the names in the host language, allowing you greater syntactic freedom (for instance, to name your forms <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._and%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">and</a></span> and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">if</a></span>, which would otherwise collide with forms of the same name in the host language). In addition, you gain control over the expansion process, allowing you to, for instance, add a custom compiler to optimize the expanded forms of your language before host language expansion takes over.</p><p>If you are interested in writing a hosted language that you&rsquo;d like to use from within Qi, there are two options. You could either write the language as a Qi macro, or as a Racket macro and leverage it via Qi&rsquo;s <span class="RktSym">esc</span>. In the latter case, you could even write a Qi "bridge" macro that transparently employs <span class="RktSym">esc</span>. These two options are functionally equivalent, but if your language is data-oriented it may make more sense for it to compile to Qi so that it can leverage any flow optimizations that may eventually be part of the Qi compiler.</p><h5 x-source-module="(lib &quot;qi/scribblings/qi.scrbl&quot;)" x-source-pkg="qi-doc" x-part-tag="&quot;Embedding_a_Hosted_Language&quot;">6.4.3<tt>&nbsp;</tt><a name="(part._.Embedding_a_.Hosted_.Language)"></a>Embedding a Hosted Language</h5><p>You can always embed a hosted language into the host language by implementing a set of macros corresponding to each form of the language. For languages that are large enough, this may be the best option to gain the advantages of a hosted language while also retaining the convenience of an embedded one for special cases. For instance, for a small embedded version of Qi, you could do:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Defining_Simple_Macros.html%23%2528form._%2528%2528lib._syntax%252Fparse%252Fdefine..rkt%2529._define-syntax-parse-rule%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax-parse-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">arg</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._on%29%29" class="RktStxLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">arg</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Defining_Simple_Macros.html%23%2528form._%2528%2528lib._syntax%252Fparse%252Fdefine..rkt%2529._define-syntax-parse-rule%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax-parse-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&gt;&lt;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">arg</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._on%29%29" class="RktStxLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">arg</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&gt;&lt;</span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Defining_Simple_Macros.html%23%2528form._%2528%2528lib._syntax%252Fparse%252Fdefine..rkt%2529._define-syntax-parse-rule%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax-parse-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&lt;</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">arg</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._on%29%29" class="RktStxLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">arg</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&lt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=syntax&amp;rel=Defining_Simple_Macros.html%23%2528form._%2528%2528lib._syntax%252Fparse%252Fdefine..rkt%2529._define-syntax-parse-rule%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define-syntax-parse-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._%7E3d%7E3d%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">==</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">arg</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._on%29%29" class="RktStxLink" data-pltdoc="x">on</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">arg</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._%7E3d%7E3d%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">==</a></span><span class="hspace">&nbsp;</span><span class="RktSym">flo</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>And this would allow you to use Qi forms directly in Racket &ndash; indeed, the forms in the <a href="Language_Interface.html" data-pltdoc="x">Language Interface</a> are such embeddings of Qi into Racket. The same approach would also work to embed a hosted DSL into Qi, whether that DSL is hosted on Qi or Racket.</p><h5 x-source-module="(lib &quot;qi/scribblings/qi.scrbl&quot;)" x-source-pkg="qi-doc" x-part-tag="&quot;Exercise__Pattern_Matching&quot;">6.4.3.1<tt>&nbsp;</tt><a name="(part._.Exercise__.Pattern_.Matching)"></a>Exercise: Pattern Matching</h5><p>Let&rsquo;s add some pattern matching to Qi by embedding Racket&rsquo;s pattern matching language into Qi, using this approach.</p><p>First, the simplest possible embedding of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match</a></span> is to just write a Qi macro corresponding to the Racket macro.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">pats</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">esc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._%7Ece%7Ebb%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">args</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match%252Fvalues%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match/values</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._apply%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">apply</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=values.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._values%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">values</a></span><span class="hspace">&nbsp;</span><span class="RktSym">args</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">pats</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._apply%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">apply</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._flow%29%29" class="RktStxLink" data-pltdoc="x">flow</a></span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">args</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>This <a href="Field_Guide.html#%28part._.Converting_a_.Macro_to_a_.Flow%29" data-pltdoc="x">converts the foreign macro to a flow</a> in the usual way, i.e. by wrapping it in a lambda and using it via <span class="RktSym">esc</span>, as discussed earlier. Note that it expects the body of the match clauses to be <span class="emph">Qi</span> rather than Racket, and any identifiers bound by pattern matching would be in scope in these flows since that is what <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match</a></span> does. Let&rsquo;s use it:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">gen</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cons%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktSym">vs</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">something-else</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>This is great, but in practice we are often interested in using pattern matching just for <span class="emph">destructuring</span> the input, and already know the pattern it is going to match. It would be nice to have a more convenient form to use in such cases. We can do this by writing a second macro to embed this narrower functionality into Qi.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-qi-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pat</span><span class="hspace">&nbsp;</span><span class="RktSym">pat-clause</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">pat-clause</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>And now:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pat</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">gen</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pat</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._number%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">number?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Similarly, we could write more such embeddings to simplify other common cases, such as matching against a single input value. Thus, the features provided by one language may be embedded into another language.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Qi_Forms.html" title="backward to &quot;5 The Qi Language&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Qi: A Functional, Flow-Oriented DSL&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Field_Guide.html" title="forward to &quot;7 Field Guide&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/qi/Qi_Macros.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:13:28 GMT -->
</html>