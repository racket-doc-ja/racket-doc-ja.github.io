<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/heresy/monad-do.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:13:22 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>3.15&nbsp;Monads and Do Notation</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">The Heresy Programming Language</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="rules.html" class="tocviewlink" data-pltdoc="x">The Heresy Rules</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="syntax.html" class="tocviewlink" data-pltdoc="x">Heresy Syntax and Conventions</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="reference.html" class="tocviewselflink" data-pltdoc="x">Heresy Reference</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>3&nbsp;</td><td><a href="reference.html" class="tocviewlink" data-pltdoc="x">Heresy Reference</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">3.1&nbsp;</td><td><a href="declarations.html" class="tocviewlink" data-pltdoc="x">Declarations</a></td></tr><tr><td align="right">3.2&nbsp;</td><td><a href="conditionals.html" class="tocviewlink" data-pltdoc="x">Conditionals and Loops</a></td></tr><tr><td align="right">3.3&nbsp;</td><td><a href="logic.html" class="tocviewlink" data-pltdoc="x">Predicates and Logic</a></td></tr><tr><td align="right">3.4&nbsp;</td><td><a href="syntax-and-evaluation.html" class="tocviewlink" data-pltdoc="x">Syntax and Evaluation</a></td></tr><tr><td align="right">3.5&nbsp;</td><td><a href="io.html" class="tocviewlink" data-pltdoc="x">Input and Output</a></td></tr><tr><td align="right">3.6&nbsp;</td><td><a href="lists.html" class="tocviewlink" data-pltdoc="x">Lists</a></td></tr><tr><td align="right">3.7&nbsp;</td><td><a href="strings.html" class="tocviewlink" data-pltdoc="x">Strings</a></td></tr><tr><td align="right">3.8&nbsp;</td><td><a href="math.html" class="tocviewlink" data-pltdoc="x">Math</a></td></tr><tr><td align="right">3.9&nbsp;</td><td><a href="random.html" class="tocviewlink" data-pltdoc="x">Random Numbers</a></td></tr><tr><td align="right">3.10&nbsp;</td><td><a href="things.html" class="tocviewlink" data-pltdoc="x">Things</a></td></tr><tr><td align="right">3.11&nbsp;</td><td><a href="theory.html" class="tocviewlink" data-pltdoc="x">Theory</a></td></tr><tr><td align="right">3.12&nbsp;</td><td><a href="pipes.html" class="tocviewlink" data-pltdoc="x">Pipe/<span class="mywbr"> &nbsp;</span>Threading Operators</a></td></tr><tr><td align="right">3.13&nbsp;</td><td><a href="holes.html" class="tocviewlink" data-pltdoc="x">Holes</a></td></tr><tr><td align="right">3.14&nbsp;</td><td><a href="maybe.html" class="tocviewlink" data-pltdoc="x">Maybe</a></td></tr><tr><td align="right">3.15&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Monads and Do Notation</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9658;</a></td><td>3.15&nbsp;</td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Monads and Do Notation</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">3.15.1&nbsp;</td><td><a href="#%28part._implementing-monad%29" class="tocviewlink" data-pltdoc="x">Implementing a monad</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._monad-do%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">monad-<wbr></wbr>do</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._maybe-do%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">maybe-<wbr></wbr>do</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._list-do%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">list-<wbr></wbr>do</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._id-do%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">id-<wbr></wbr>do</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._hole-do%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">hole-<wbr></wbr>do</span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.15.1<tt>&nbsp;</tt></span><a href="#%28part._implementing-monad%29" class="tocsubseclink" data-pltdoc="x">Implementing a monad</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="maybe.html" title="backward to &quot;3.14 Maybe&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="reference.html" title="up to &quot;3 Heresy Reference&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h4 x-source-module="(lib &quot;heresy/docs/heresy.scrbl&quot;)" x-source-pkg="heresy" x-part-tag="&quot;monad-do&quot;">3.15<tt>&nbsp;</tt><a name="(part._monad-do)"></a>Monads and Do Notation</h4><p><span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._monad-do%29%29" class="RktStxLink" data-pltdoc="x">monad-do</a></span> provides a generic, specializable DSL for handling monadic values, inspired by
Haskell&rsquo;s do notation and Scala&rsquo;s for comprehensions. <span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._monad-do%29%29" class="RktStxLink" data-pltdoc="x">monad-do</a></span> itself is generic,
expecting the provision of functions for the bind (<span class="RktSym">&gt;&gt;=</span>), return, and guard operators, but
individual types can easily layer over this with a simple macro to provide a specialized version
of the DSL for a particular data type.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._heresy/main..rkt)._monad-do))"></a><span title="Provided from: heresy | Package: heresy"><span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._monad-do%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">monad-do</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">bind</span><span class="hspace">&nbsp;</span><span class="RktVar">return</span><span class="hspace">&nbsp;</span><span class="RktVar">guard</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">exprs</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="hspace">&nbsp;</span><span class="RktVar">final-expr</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">exprs</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;-</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym"><a href="conditionals.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktVar">test</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">final-expr</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym">yield</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">return-expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">The main implementation for do notation. The opening clause is a list of the three necessary
operators for a given type to implement monadic operations, which should be implemented
as follows:</div></p><ul><li><p><span class="RktVar">bind</span>: A function which takes two arguments: an instance of the type,
and a function. <span class="RktVar">bind</span> returns the result of applying the function
to the value of the instance.</p></li><li><p><span class="RktVar">return</span>: A function which takes a value, and wraps it in an instance of
the type.</p></li><li><p><span class="RktVar">guard</span>: A function which takes a boolean, and on true returns an
instance of the type, and on false returns the empty instance or Null.</p></li></ul><p>The rest of the body of the form is composed of various operations, which bind, guard, or return
values, described as follows. The last line of the do notation is special, in a sense, as it must
consist of either <span class="RktSym">yield</span> or a bare expression.</p><blockquote class="leftindent"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktVar">&lt;-</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Binds <span class="RktVar">val</span> to <span class="RktVar">name</span>. <span class="RktVar">val</span> must be an instance of the type over which
the do form operates.</p></blockquote><blockquote class="leftindent"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktVar">=</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Wraps <span class="RktVar">val</span> in the current type, and binds it to <span class="RktVar">name</span>.</p></blockquote><blockquote class="leftindent"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><span class="RktVar">if</span><span class="hspace">&nbsp;</span><span class="RktVar">test</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Filters the ongoing expression according to test.</p></blockquote><blockquote class="leftindent"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><span class="RktVar">yield</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr></table></blockquote><p>When used as the last line of a do form, returns the given <span class="RktVar">val</span>(s) wrapped in the type
of the ongoing do form.</p></blockquote><blockquote class="leftindent"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><span class="RktPn">(</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr></table></blockquote><p>When used in the body of a do form, the <span class="RktVar">expr</span> is evaluated but its return value ignored.
If the last line of the do form is a bare expression, then the form will return the result of the
expression.</p></blockquote><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._heresy/main..rkt)._maybe-do))"></a><span title="Provided from: heresy | Package: heresy"><span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._maybe-do%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">maybe-do</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A specialization of <span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._monad-do%29%29" class="RktStxLink" data-pltdoc="x">monad-do</a></span> for <span class="RktSym"><a href="maybe.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._.Maybe%29%29" class="RktValLink" data-pltdoc="x">Maybe</a></span>. This is useful for chaining operations
that return <span class="RktSym"><a href="maybe.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._.Maybe%29%29" class="RktValLink" data-pltdoc="x">Maybe</a></span>, as the monad for <span class="RktSym"><a href="maybe.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._.Maybe%29%29" class="RktValLink" data-pltdoc="x">Maybe</a></span> short-circuits. If one operation
in the chain is a <span class="RktSym"><a href="maybe.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._.None%29%29" class="RktValLink" data-pltdoc="x">None</a></span>, then the result of a <span class="RktSym">yield</span> will be none.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="maybe.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._is-none~3f%29%29" class="RktValLink" data-pltdoc="x">is-none?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._maybe-do%29%29" class="RktStxLink" data-pltdoc="x">maybe-do</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;-</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="maybe.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._some%29%29" class="RktValLink" data-pltdoc="x">some</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;-</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="maybe.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._.None%29%29" class="RktValLink" data-pltdoc="x">None</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">yield</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._heresy/main..rkt)._list-do))"></a><span title="Provided from: heresy | Package: heresy"><span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._list-do%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">list-do</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A specialization of <span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._monad-do%29%29" class="RktStxLink" data-pltdoc="x">monad-do</a></span> for lists. <span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._list-do%29%29" class="RktStxLink" data-pltdoc="x">list-do</a></span> flatmaps over its operations
forming a single-dimensional list from its calculations. This essentially enables list
comprehensions.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._list-do%29%29" class="RktStxLink" data-pltdoc="x">list-do</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rank</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;-</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="lists.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._append%29%29" class="RktValLink" data-pltdoc="x">append</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="lists.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._range%29%29" class="RktStxLink" data-pltdoc="x">range</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">to</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">J</span><span class="hspace">&nbsp;</span><span class="RktVal">Q</span><span class="hspace">&nbsp;</span><span class="RktVal">K</span><span class="hspace">&nbsp;</span><span class="RktVal">A</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">suit</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;-</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">&#9824;</span><span class="hspace">&nbsp;</span><span class="RktVal">&#9827;</span><span class="hspace">&nbsp;</span><span class="RktVal">&#9829;</span><span class="hspace">&nbsp;</span><span class="RktVal">&#9830;</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="conditionals.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="logic.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">suit</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">&#9830;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">card</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="strings.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._format~24%29%29" class="RktValLink" data-pltdoc="x">format$</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"#_#_"</span><span class="hspace">&nbsp;</span><span class="RktSym">rank</span><span class="hspace">&nbsp;</span><span class="RktSym">suit</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">yield</span><span class="hspace">&nbsp;</span><span class="RktSym">card</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'("2&#9830;"<span class="stt"> </span>"3&#9830;"<span class="stt"> </span>"4&#9830;"<span class="stt"> </span>"5&#9830;"<span class="stt"> </span>"6&#9830;"<span class="stt"> </span>"7&#9830;"<span class="stt"> </span>"8&#9830;"<span class="stt"> </span>"9&#9830;"<span class="stt"> </span>"10&#9830;"<span class="stt"> </span>"J&#9830;"<span class="stt"> </span>"Q&#9830;"<span class="stt"> </span>"K&#9830;"<span class="stt"> </span>"A&#9830;")</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._heresy/main..rkt)._id-do))"></a><span title="Provided from: heresy | Package: heresy"><span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._id-do%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">id-do</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">The Identity monad as a specialization of <span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._monad-do%29%29" class="RktStxLink" data-pltdoc="x">monad-do</a></span>. This essentially replaces the
functionality of the old "monadish" DSL from Heresy 0.1.0 and earlier. Mostly this is useful
as an example, but can be used for chaining together operations and mock-mutable behavior.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._id-do%29%29" class="RktStxLink" data-pltdoc="x">id-do</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">z</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="io.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._print%29%29" class="RktStxLink" data-pltdoc="x">print</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="strings.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._format~24%29%29" class="RktValLink" data-pltdoc="x">format$</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"#_ + #_ = #_"</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">z</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">5 + 4 = 9</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._heresy/main..rkt)._hole-do))"></a><span title="Provided from: heresy | Package: heresy"><span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._hole-do%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">hole-do</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A specialization of <span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._monad-do%29%29" class="RktStxLink" data-pltdoc="x">monad-do</a></span> for holes. Allows you to operate over and combine values
from multiple holes easily, while returning a new hole for future use.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="holes.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._deref%29%29" class="RktValLink" data-pltdoc="x">deref</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._hole-do%29%29" class="RktStxLink" data-pltdoc="x">hole-do</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;-</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="holes.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._hole%29%29" class="RktValLink" data-pltdoc="x">hole</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;-</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="holes.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._hole%29%29" class="RktValLink" data-pltdoc="x">hole</a></span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">z</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">yield</span><span class="hspace">&nbsp;</span><span class="RktSym">z</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">11</span></p></td></tr></table></blockquote></div></p><h5 x-source-module="(lib &quot;heresy/docs/heresy.scrbl&quot;)" x-source-pkg="heresy" x-part-tag="&quot;implementing-monad&quot;">3.15.1<tt>&nbsp;</tt><a name="(part._implementing-monad)"></a>Implementing a monad</h5><p>A "monad" is a data type which can contain a value, and a set of operator functions which
operate on that type while obeying certain rules. You can think of them as a kind of container,
and the components of an assembly line that processes the container and its contents.</p><p><div class="SIntrapara">Let&rsquo;s say that we have a Thing called <span class="RktSym">Box</span>, defined thusly:
</div><div class="SIntrapara"><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="things.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._describe%29%29" class="RktStxLink" data-pltdoc="x">describe</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Box</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="logic.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._.Null%29%29" class="RktValLink" data-pltdoc="x">Null</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p></div><div class="SIntrapara">We then define a set of three functions, that work with <span class="RktSym">Box</span>. The first, is
<span style="font-style: italic">return</span>, which is a constructor function that wraps a value in our type:
</div><div class="SIntrapara"><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._def%29%29" class="RktStxLink" data-pltdoc="x">def</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._fn%29%29" class="RktStxLink" data-pltdoc="x">fn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">box-return</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Box</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="lists.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">val</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p></div><div class="SIntrapara">The next function is <span style="font-style: italic">bind</span>, known in some languages as the operator <span class="RktSym">&gt;&gt;=</span>. This
takes an instance of our type, and a function, and applies the function to the value inside
our type. The definition of <span style="font-style: italic">bind</span> for <span class="RktSym">Box</span> looks like this:
</div><div class="SIntrapara"><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._def%29%29" class="RktStxLink" data-pltdoc="x">def</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._fn%29%29" class="RktStxLink" data-pltdoc="x">fn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">box-bind</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">box</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._fn%29%29" class="RktStxLink" data-pltdoc="x">fn</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._fn%29%29" class="RktStxLink" data-pltdoc="x">fn</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">box</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">val</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p></div><div class="SIntrapara">The final function is <span style="font-style: italic">guard</span>, which is not especially useful on its own, but enables us
to implement a filter effect inside <span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._monad-do%29%29" class="RktStxLink" data-pltdoc="x">monad-do</a></span>. This function takes a boolean value,
the result of some test, and returns either an instance of our type with empty contents, or
nothing. For <span class="RktSym">Box</span>, it looks like this.
</div><div class="SIntrapara"><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._def%29%29" class="RktStxLink" data-pltdoc="x">def</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._fn%29%29" class="RktStxLink" data-pltdoc="x">fn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">box-guard</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">test</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="conditionals.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktSym">test</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">then</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">box-return</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="logic.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._.Null%29%29" class="RktValLink" data-pltdoc="x">Null</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="logic.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="logic.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._.Null%29%29" class="RktValLink" data-pltdoc="x">Null</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p></div><div class="SIntrapara">Now, we can provide those functions to <span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._monad-do%29%29" class="RktStxLink" data-pltdoc="x">monad-do</a></span> ourselves, or for convenience, we can
define a macro that wraps <span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._monad-do%29%29" class="RktStxLink" data-pltdoc="x">monad-do</a></span> without new operators pre-defined. It is necessary
to use <span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._def%29%29" class="RktStxLink" data-pltdoc="x">def</a></span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">macroset</span></span></span> here, due to the peculiarities of the underlying Racket macro
system.
</div><div class="SIntrapara"><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._def%29%29" class="RktStxLink" data-pltdoc="x">def</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">macroset</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">box-do</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._e%29%29" class="RktValLink" data-pltdoc="x">e</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._monad-do%29%29" class="RktStxLink" data-pltdoc="x">monad-do</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">box-bind</span><span class="hspace">&nbsp;</span><span class="RktSym">box-return</span><span class="hspace">&nbsp;</span><span class="RktSym">box-guard</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._e%29%29" class="RktValLink" data-pltdoc="x">e</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p></div></p><p><div class="SIntrapara">Together, these three functions actually form an implementation of the Identity monad, and
by combining these and providing them to <span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._monad-do%29%29" class="RktStxLink" data-pltdoc="x">monad-do</a></span>, we can
already perform imperative-like operations in our otherwise functional language of Heresy,
and all without any mutability involved! Behold:
</div><div class="SIntrapara"><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="conditionals.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._do%29%29" class="RktStxLink" data-pltdoc="x">do</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="things.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._describe%29%29" class="RktStxLink" data-pltdoc="x">describe</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Box</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="logic.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._.Null%29%29" class="RktValLink" data-pltdoc="x">Null</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._def%29%29" class="RktStxLink" data-pltdoc="x">def</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._fn%29%29" class="RktStxLink" data-pltdoc="x">fn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">box-return</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Box</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="lists.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">val</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._def%29%29" class="RktStxLink" data-pltdoc="x">def</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._fn%29%29" class="RktStxLink" data-pltdoc="x">fn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">box-bind</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">box</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._fn%29%29" class="RktStxLink" data-pltdoc="x">fn</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._fn%29%29" class="RktStxLink" data-pltdoc="x">fn</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">box</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">val</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._def%29%29" class="RktStxLink" data-pltdoc="x">def</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._fn%29%29" class="RktStxLink" data-pltdoc="x">fn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">box-guard</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">test</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="conditionals.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktSym">test</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">then</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">box-return</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="logic.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._.Null%29%29" class="RktValLink" data-pltdoc="x">Null</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="logic.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="logic.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._.Null%29%29" class="RktValLink" data-pltdoc="x">Null</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="declarations.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._def%29%29" class="RktStxLink" data-pltdoc="x">def</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">macroset</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">box-do</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._e%29%29" class="RktValLink" data-pltdoc="x">e</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._heresy%2Fmain..rkt%29._monad-do%29%29" class="RktStxLink" data-pltdoc="x">monad-do</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">box-bind</span><span class="hspace">&nbsp;</span><span class="RktSym">box-return</span><span class="hspace">&nbsp;</span><span class="RktSym">box-guard</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._e%29%29" class="RktValLink" data-pltdoc="x">e</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">box-do</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;-</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">box-return</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="io.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._print%29%29" class="RktStxLink" data-pltdoc="x">print</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;-</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">box-return</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="math.html#%28def._%28%28lib._heresy%2Fmain..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="io.html#%28form._%28%28lib._heresy%2Fmain..rkt%29._print%29%29" class="RktStxLink" data-pltdoc="x">print</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">5</span></p></td></tr><tr><td><p><span class="RktOut">50</span></p></td></tr></table></td></tr></table></blockquote></div></p></div></p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="maybe.html" title="backward to &quot;3.14 Maybe&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="reference.html" title="up to &quot;3 Heresy Reference&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/heresy/monad-do.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 03:13:22 GMT -->
</html>