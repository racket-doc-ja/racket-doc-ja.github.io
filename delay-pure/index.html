<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Mirrored from docs.racket-lang.org/delay-pure/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 02:57:01 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Pure functions and promises</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;">&bull;</td><td></td><td><a href="#" class="tocviewselflink" data-pltdoc="x">Pure functions and promises</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._top%29" class="tocsubseclink" data-pltdoc="x">Pure functions and promises</a></td></tr><tr><td><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._delay%2Fpure%2Fstateless%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">delay/<span class="mywbr"> &nbsp;</span>pure/<span class="mywbr"> &nbsp;</span>stateless</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._delay%2Fpure%2Fstateful%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">delay/<span class="mywbr"> &nbsp;</span>pure/<span class="mywbr"> &nbsp;</span>stateful</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._promise%2Fpure%2Fmaybe-stateful~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">promise/<span class="mywbr"> &nbsp;</span>pure/<span class="mywbr"> &nbsp;</span>maybe-<wbr></wbr>stateful?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._promise%2Fpure%2Fstateless~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">promise/<span class="mywbr"> &nbsp;</span>pure/<span class="mywbr"> &nbsp;</span>stateless?</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateless%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">pure/<span class="mywbr"> &nbsp;</span>stateless</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateful%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">pure/<span class="mywbr"> &nbsp;</span>stateful</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure-thunk%2Fstateless%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">pure-<wbr></wbr>thunk/<span class="mywbr"> &nbsp;</span>stateless</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure-thunk%2Fstateful%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">pure-<wbr></wbr>thunk/<span class="mywbr"> &nbsp;</span>stateful</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._define-pure%2Fstateless%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>pure/<span class="mywbr"> &nbsp;</span>stateless</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._define-pure%2Fstateful%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>pure/<span class="mywbr"> &nbsp;</span>stateful</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._built-in-pure-functions-set%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">built-<wbr></wbr>in-<wbr></wbr>pure-<wbr></wbr>functions-<wbr></wbr>set</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._built-in-pure-functions-free-id-set%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">built-<wbr></wbr>in-<wbr></wbr>pure-<wbr></wbr>functions-<wbr></wbr>free-<wbr></wbr>id-<wbr></wbr>set</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._immutable%2Fstateless%2Fc%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">immutable/<span class="mywbr"> &nbsp;</span>stateless/<span class="mywbr"> &nbsp;</span>c</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._immutable%2Fstateful%2Fc%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">immutable/<span class="mywbr"> &nbsp;</span>stateful/<span class="mywbr"> &nbsp;</span>c</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._unsafe-pure%2Fstateless%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">unsafe-<wbr></wbr>pure/<span class="mywbr"> &nbsp;</span>stateless</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._unsafe-operation%2Fmutating%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">unsafe-<wbr></wbr>operation/<span class="mywbr"> &nbsp;</span>mutating</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._unsafe-declare-pure%2Fstateless%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">unsafe-<wbr></wbr>declare-<wbr></wbr>pure/<span class="mywbr"> &nbsp;</span>stateless</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._unsafe-declare-allowed-in-pure%2Fstateful%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">unsafe-<wbr></wbr>declare-<wbr></wbr>allowed-<wbr></wbr>in-<wbr></wbr>pure/<span class="mywbr"> &nbsp;</span>stateful</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.6</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h2 x-source-module="(lib &quot;delay-pure/scribblings/delay-pure.scrbl&quot;)" x-source-pkg="delay-pure" x-part-tag="&quot;top&quot;"><a name="(part._top)"></a><a name="(part._.Pure_functions_and_promises)"></a><a name="(mod-path._delay-pure)"></a>Pure functions and promises</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Suzanne Soy &lt;<a href="mailto:racket@suzanne.soy">racket@suzanne.soy</a>&gt;</p></span></div><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#" class="RktModLink" data-pltdoc="x"><span class="RktSym">delay-pure</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/delay-pure" title="Install this package using `raco pkg install delay-pure`"><span class="stt">delay-pure</span></a></span></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._delay-pure/main..rkt)._delay/pure/stateless))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._delay%2Fpure%2Fstateless%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">delay/pure/stateless</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expression</span><span class="RktPn">)</span></p></blockquote></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._delay-pure/main..rkt)._delay/pure/stateful))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._delay%2Fpure%2Fstateful%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">delay/pure/stateful</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expression</span><span class="RktPn">)</span></p></blockquote></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Produces a promise for <span class="RktVar">expression</span> which does not cache its result,
like <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Delayed_Evaluation.html%23%2528form._%2528%2528lib._racket%252Fpromise..rkt%2529._delay%252Fname%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">delay/name</a></span>. The <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._delay%2Fpure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">delay/pure/stateless</a></span> form checks that
the <span class="RktVar">expression</span> is pure by wrapping it with
<span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">pure/stateless</a></span><span class="stt"> </span><span class="RktVar">expression</span><span class="RktPn">)</span>. The <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._delay%2Fpure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">delay/pure/stateful</a></span> form
instead relies on <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">pure/stateful</a></span><span class="stt"> </span><span class="RktVar">expression</span><span class="RktPn">)</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._delay-pure/main..rkt)._promise/pure/maybe-stateful~3f))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._promise%2Fpure%2Fmaybe-stateful~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">promise/pure/maybe-stateful?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A predicate which recognizes promises created with both
<span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._delay%2Fpure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">delay/pure/stateless</a></span> and <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._delay%2Fpure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">delay/pure/stateful</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._delay-pure/main..rkt)._promise/pure/stateless~3f))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._promise%2Fpure%2Fstateless~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">promise/pure/stateless?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A predicate which recognizes promises created with
<span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._delay%2Fpure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">delay/pure/stateless</a></span>, and rejects those created with
<span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._delay%2Fpure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">delay/pure/stateful</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._delay-pure/main..rkt)._pure/stateless))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateless%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">pure/stateless</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expression</span><span class="RktPn">)</span></p></blockquote></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._delay-pure/main..rkt)._pure/stateful))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateful%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">pure/stateful</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expression</span><span class="RktPn">)</span></p></blockquote></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Checks that the <span class="RktVar">expression</span> is pure. This is done by fully expanding
the expression, and checking at run-time that the free variables (including
functions) contain only immutable values and pure functions. There is a
hard-coded list of built-in functions which are known to be pure. The
functions created with <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._define-pure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">define-pure/stateless</a></span> are also accepted (but
not those created with <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._define-pure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">define-pure/stateful</a></span>), as well as
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span> accessors and predicates, and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span> constructors for
immutable structures.</div></p><p>Note that the expressions can refer to variables mutated with <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=set_.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._set%2521%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">set!</a></span>
by other code. Placing the expression in a lambda function and calling that
function twice may therefore yield different results, if other code mutates
some free variables between the two invocations. In order to produce a pure
thunk which caches its inputs (thereby shielding them from any mutation of the
external environment), use <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure-thunk%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">pure-thunk/stateless</a></span> and
<span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure-thunk%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">pure-thunk/stateful</a></span> instead.</p><p>The first form, <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">pure/stateless</a></span>, checks that once fully-expanded, the
<span class="RktVar">expression</span> does not contain uses of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=set_.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._set%2521%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">set!</a></span>. Since the free
variables can never refer to stateful functions, this means that any function
present in the result is guaranteed be a <a name="(tech._stateles)"></a><span style="font-style: italic">stateless</span> function. The
results of two calls to a <a href="#%28tech._stateles%29" class="techoutside" data-pltdoc="x"><span class="techinside">stateless</span></a> function with the same arguments
should be indistinguishable, aside from the fact that they might not be
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eq%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eq?</a></span>. In other words, a <a href="#%28tech._stateles%29" class="techoutside" data-pltdoc="x"><span class="techinside">stateless</span></a> function will always return
the &ldquo;same&rdquo; (not necessarily <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eq%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eq?</a></span>) value given the same
(<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eq%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eq?</a></span>) arguments. If the result contains functions, these functions are
guaranteed to be <a href="#%28tech._stateles%29" class="techoutside" data-pltdoc="x"><span class="techinside">stateless</span></a> too.</p><p>With the second form <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">pure/stateful</a></span>, uses of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=set_.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._set%2521%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">set!</a></span> are
allowed within the expression (but may not alter free variables). The
resulting value will be an immutable value which may contain both
<a href="#%28tech._stateles%29" class="techoutside" data-pltdoc="x"><span class="techinside">stateless</span></a> and <a name="(tech._stateful)"></a><span style="font-style: italic">stateful</span> functions. Stateful functions may be
closures over a value which is mutated using <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=set_.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._set%2521%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">set!</a></span>, and therefore
calling a <a href="#%28tech._stateful%29" class="techoutside" data-pltdoc="x"><span class="techinside">stateful</span></a> function twice with the same (<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eq%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eq?</a></span>)
arguments may produce different results. Since Typed/Racket does not use
occurrence typing on function calls, the guarantee that the result is
immutable until a function value is reached is enough to safely build
non-caching promises that return the &ldquo;same&rdquo; value, as far as occurrence
typing is concerned.</p><p>Promises created with <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._delay%2Fpure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">delay/pure/stateless</a></span> and
<span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._delay%2Fpure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">delay/pure/stateful</a></span> re-compute their result each time, which yields
results that are not necessarily <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eq%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eq?</a></span>. This means that calling
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eq%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eq?</a></span> twice on the same pair of expressions may not produce the same
result. Fortunately, occurrence typing in Typed/Racket does not rely on this
assumption, and does not "cache" the result of calls to <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eq%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eq?</a></span>. If this
behaviour were to change, this library would become unsound.</p><p>TODO: add a test in the test suite which checks that Typed/Racket does not
"cache" the result of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eq%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eq?</a></span> calls, neither at the type level, nor at
the value level.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._delay-pure/main..rkt)._pure-thunk/stateless))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure-thunk%2Fstateless%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">pure-thunk/stateless</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">thunk</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure-thunk%2Fstateless%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">pure-thunk/stateless</a></span><span class="hspace">&nbsp;</span><span class="RktVar">thunk</span><span class="hspace">&nbsp;</span><span class="RktPn">#:check-result</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._delay-pure/main..rkt)._pure-thunk/stateful))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure-thunk%2Fstateful%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">pure-thunk/stateful</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">thunk</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure-thunk%2Fstateful%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">pure-thunk/stateful</a></span><span class="hspace">&nbsp;</span><span class="RktVar">thunk</span><span class="hspace">&nbsp;</span><span class="RktPn">#:check-result</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">pure/stateless</a></span> and <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">pure/stateful</a></span>, but the
<span class="RktVar">thunk</span> expression should produce a thunk. When
<span class="RktPn">#:check-result</span> is specified, a run-time guard on the function&rsquo;s
result is added. The guard checks that the result is an immutable value. With
<span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure-thunk%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">pure-thunk/stateless</a></span>, the result guard only accepts immutable values,
possibly containing <a href="#%28tech._stateles%29" class="techoutside" data-pltdoc="x"><span class="techinside">stateless</span></a> functions. With
<span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure-thunk%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">pure-thunk/stateful</a></span>, the result guard also accepts immutable values,
possibly containing <a href="#%28tech._stateful%29" class="techoutside" data-pltdoc="x"><span class="techinside">stateful</span></a> functions.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._delay-pure/main..rkt)._define-pure/stateless))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._define-pure%2Fstateless%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-pure/stateless</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">args</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-result</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._define-pure%2Fstateless%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-pure/stateless</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=type-expander&amp;rel=index.html%23%2528form._%2528%2528lib._type-expander%252Ftype-expander..hl..rkt%2529._%7E3a%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">type</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">args</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-result</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._delay-pure/main..rkt)._define-pure/stateful))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._define-pure%2Fstateful%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-pure/stateful</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">args</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-result</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._define-pure%2Fstateful%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-pure/stateful</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=type-expander&amp;rel=index.html%23%2528form._%2528%2528lib._type-expander%252Ftype-expander..hl..rkt%2529._%7E3a%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">type</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">args</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-result</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">maybe-result</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=type-expander&amp;rel=index.html%23%2528form._%2528%2528lib._type-expander%252Ftype-expander..hl..rkt%2529._%7E3a%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktVar">result-type</span></td></tr></table></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Defines <span class="RktVar">name</span> as a pure function. The <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._define-pure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">define-pure/stateful</a></span>
form relies on <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">pure/stateful</a></span>, and therefore allows the function to
return a value containing <a href="#%28tech._stateful%29" class="techoutside" data-pltdoc="x"><span class="techinside">stateful</span></a> functions. On the other hand,
<span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._define-pure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">define-pure/stateless</a></span> relies on <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">pure/stateless</a></span>, and
therefore only allows the return value to contain <a href="#%28tech._stateles%29" class="techoutside" data-pltdoc="x"><span class="techinside">stateless</span></a> functions.</div></p><p>Due to the way the function is defined, a regular separate type annotation of
the form <span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=type-expander&amp;rel=index.html%23%2528form._%2528%2528lib._type-expander%252Ftype-expander..hl..rkt%2529._%7E3a%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">:</a></span><span class="stt"> </span><span class="RktVar">name</span><span class="stt"> </span><span class="RktVar">type</span><span class="RktPn">)</span> would not work (the function is first defined
using a temporary variable, and <span class="RktVar">name</span> is merely a
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=syntax-model.html%23%2528tech._rename._transformer%2529&amp;version=8.6" class="techoutside Sq" data-pltdoc="x"><span class="techinside">rename transformer</span></a> for that temporary
variable).</p><p>It is therefore possible to express such a type annotation by placing both
the type annotation and the definition within a <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._define-pure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">define-pure/stateless</a></span>
or <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._define-pure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">define-pure/stateful</a></span> form:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._define-pure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">define-pure/stateless</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=type-expander&amp;rel=index.html%23%2528form._%2528%2528lib._type-expander%252Ftype-expander..hl..rkt%2529._%7E3a%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktSym">square</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=type-expander&amp;rel=index.html%23%2528form._%2528%2528lib._type-expander%252Ftype-expander..hl..rkt%2529._%7E3a%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._%7Ee2%7E86%7E92%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">&#8594;</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Number%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">Number</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Number%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">Number</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">square</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252A%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>The <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span> identifier can either be <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span> from
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=ts-reference&amp;rel=index.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">typed/racket</span></a> or <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=type-expander&amp;rel=index.html%23%2528form._%2528%2528lib._type-expander%252Ftype-expander..hl..rkt%2529._define%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">define</a></span> from
<a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=type-expander&amp;rel=index.html&amp;version=8.6" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">type-expander</span></a>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._delay-pure/main..rkt)._built-in-pure-functions-set))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._built-in-pure-functions-set%29%29" class="RktValDef RktValLink" data-pltdoc="x">built-in-pure-functions-set</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._and%252Fc%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">and/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sets.html%23%2528def._%2528%2528lib._racket%252Fset..rkt%2529._generic-set%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">generic-set?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sets.html%23%2528def._%2528%2528lib._racket%252Fset..rkt%2529._set-eq%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">set-eq?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sets.html%23%2528def._%2528%2528lib._racket%252Fset..rkt%2529._set%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">set?</a></span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">This set contains the built-in functions recognized as pure by this library.</div></p><p>For now only a few built-in functions are recognized as pure:</p><ul><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252A%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">*</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">+</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._-%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x"><span class="nobreak">-</span></a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252F%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">/</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3d%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">=</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">add1</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._car%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">car</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cdr%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">cdr</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cons%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">cons</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eq%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eq?</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._equal%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">equal?</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Equality.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eqv%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">eqv?</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._error%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">error</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Delayed_Evaluation.html%23%2528def._%2528%2528lib._racket%252Fpromise..rkt%2529._force%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">force</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">format</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._hash-%7E3elist%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">hash-&gt;list</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-ref%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">hash-ref</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">hash?</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._length%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">length</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">list?</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._modulo%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">modulo</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._null%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">null</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._null%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">null?</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._pair%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">pair?</a></span></p></li><li><p><span class="RktSym"><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._promise%2Fpure%2Fmaybe-stateful~3f%29%29" class="RktValLink" data-pltdoc="x">promise/pure/maybe-stateful?</a></span></p></li><li><p><span class="RktSym"><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._promise%2Fpure%2Fstateless~3f%29%29" class="RktValLink" data-pltdoc="x">promise/pure/stateless?</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Flist..rkt%2529._reverse%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">reverse</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sets.html%23%2528def._%2528%2528lib._racket%252Fset..rkt%2529._set-%7E3elist%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">set-&gt;list</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sets.html%23%2528def._%2528%2528lib._racket%252Fset..rkt%2529._set-member%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">set-member?</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=sets.html%23%2528def._%2528%2528lib._racket%252Fset..rkt%2529._set%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">set?</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sub1%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">sub1</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=values.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._values%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">values</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._vector-%7E3elist%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">vector-&gt;list</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._vector-immutable%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">vector-immutable</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._vector-length%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">vector-length</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._vector-ref%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">vector-ref</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._vector%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">vector?</a></span></p></li><li><p><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">void</a></span></p></li></ul><p>Patches adding new functions to the set are welcome.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>for-syntax value</p></div></div><p class="RForeground"><a name="(def._((lib._delay-pure/main..rkt)._built-in-pure-functions-free-id-set))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._built-in-pure-functions-free-id-set%29%29" class="RktValDef RktValLink" data-pltdoc="x">built-in-pure-functions-free-id-set</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">immutable-free-id-set?</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">This value is provided at level 1, and contains the identifiers of the
functions present in <span class="RktSym"><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._built-in-pure-functions-set%29%29" class="RktValLink" data-pltdoc="x">built-in-pure-functions-set</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">((</span><a name="(def._((lib._delay-pure/main..rkt)._immutable/stateless/c))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._immutable%2Fstateless%2Fc%29%29" class="RktValDef RktValLink" data-pltdoc="x">immutable/stateless/c</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">varref</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Boolean%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">Boolean</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">varref</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Variable-.Reference%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">Variable-Reference</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Any%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">Any</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a predicate which accepts only values which are immutable, possibly
containing <a href="#%28tech._stateles%29" class="techoutside" data-pltdoc="x"><span class="techinside">stateless</span></a> functions, but not <a href="#%28tech._stateful%29" class="techoutside" data-pltdoc="x"><span class="techinside">stateful</span></a> functions.</div></p><p>This predicate detects whether the functions contained within the value
<span class="RktVar">v</span> are pure or not, based on the <span class="RktSym"><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._built-in-pure-functions-set%29%29" class="RktValLink" data-pltdoc="x">built-in-pure-functions-set</a></span>
set and a few special cases:</p><ul><li><p>The low-level functions used to build pure promises are always
accepted. Their valid use is guaranteed by the macros wrapping them.</p></li><li><p>Predicates for <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span> types are always accepted</p></li><li><p>Field accessors for <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span> types are always accepted</p></li><li><p>Constructors for <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">struct</a></span> types are accepted only if
<span class="RktSym"><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._immutable%2Fstateless%2Fc%29%29" class="RktValLink" data-pltdoc="x">immutable/stateless/c</a></span> can determine that the struct type is
immutable.</p></li></ul><p>There seems to be no combination of built-in functions in Racket which would
reliably associate a struct constructor (as a value) with its corresponding
struct type. Instead, <span class="RktSym"><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._immutable%2Fstateless%2Fc%29%29" class="RktValLink" data-pltdoc="x">immutable/stateless/c</a></span> uses a heuristic based on
<span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=inspectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._object-name%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">object-name</a></span>: if <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=structutils.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._struct-constructor-procedure%7E3f%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">struct-constructor-procedure?</a></span> returns
<span class="RktVal">#true</span> for a function, and that function&rsquo;s <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=inspectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._object-name%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">object-name</a></span> is
<span class="RktSym">st</span> or <span class="RktSym">make-st</span>, then <span class="RktSym">st</span> is expected to be an
identifier with static struct type information.</p><p>To achieve this, it is necessary to access the call-site&rsquo;s namespace, which is
done via the <span class="RktVar">varref</span> parameter. Simply supplying the result of
<span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Locations____variable-reference.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._%7E23%7E25variable-reference%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">#%variable-reference</a></span><span class="RktPn">)</span> should be enough.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">((</span><a name="(def._((lib._delay-pure/main..rkt)._immutable/stateful/c))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._immutable%2Fstateful%2Fc%29%29" class="RktValDef RktValLink" data-pltdoc="x">immutable/stateful/c</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">varref</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Boolean%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">Boolean</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">varref</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Variable-.Reference%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">Variable-Reference</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Any%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">Any</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a predicate which accepts only values which are immutable, possibly
containing both <a href="#%28tech._stateful%29" class="techoutside" data-pltdoc="x"><span class="techinside">stateful</span></a> and <a href="#%28tech._stateles%29" class="techoutside" data-pltdoc="x"><span class="techinside">stateless</span></a> functions.</div></p><p>This predicate needs to access the call-site&rsquo;s namespace, which is
done via the <span class="RktVar">varref</span> parameter. Simply supplying the result of
<span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=Locations____variable-reference.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._%7E23%7E25variable-reference%2529%2529&amp;version=8.6" class="RktStxLink Sq" data-pltdoc="x">#%variable-reference</a></span><span class="RktPn">)</span> should be enough.</p><p>See the documentation for <span class="RktSym"><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._immutable%2Fstateless%2Fc%29%29" class="RktValLink" data-pltdoc="x">immutable/stateless/c</a></span> for an explanation
of the reason for this need.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._delay-pure/main..rkt)._unsafe-pure/stateless))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._unsafe-pure%2Fstateless%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">unsafe-pure/stateless</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expression</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Indicates that the expression should be trusted as allowable within a
<span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">pure/stateless</a></span> or <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">pure/stateful</a></span> block or one of their
derivatives. No check is performed on the expression.</div></p><p>The <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._unsafe-pure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">unsafe-pure/stateless</a></span> form can be used within
<span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">pure/stateless</a></span>, <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">pure/stateful</a></span> and their derivatives, to
prevent any check on a portion of code.</p><p>The expression should be a pure, stateless expression.</p><p>Note that in the current implementation, the <span class="RktVar">expression</span> is lifted
(in the sense of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxtrans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-local-lift-expression%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax-local-lift-expression</a></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._delay-pure/main..rkt)._unsafe-operation/mutating))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._unsafe-operation%2Fmutating%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">unsafe-operation/mutating</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expression</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Indicates that the expression should be trusted as allowable within a
<span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">pure/stateful</a></span> block, or one of its derivatives. No check is performed
on the expression.</div></p><p>The <span class="RktVar">expression</span> should not vary its outputs and effects based on
external state (i.e. its outputs and effects should depend only on the
arguments passed to it).</p><p>The <span class="RktVar">expression</span> function may internally use mutation. It may return
freshly-created stateful objects (closures over freshly-created mutable
variables, closures over mutable arguments, and mutable data structure which
are freshly created or extracted from the arguments). It may mutate any
mutable data structure passed as an argument.</p><p>Note that in the current implementation, the <span class="RktVar">expression</span> is lifted
(in the sense of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.6/doc/local-redirect/index.html?doc=reference&amp;rel=stxtrans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-local-lift-expression%2529%2529&amp;version=8.6" class="RktValLink Sq" data-pltdoc="x">syntax-local-lift-expression</a></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._delay-pure/main..rkt)._unsafe-declare-pure/stateless))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._unsafe-declare-pure%2Fstateless%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">unsafe-declare-pure/stateless</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">identifier</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Declares that the given identifier should be trusted as a stateless pure
function. The given function is subsequently treated like the functions
present in <span class="RktSym"><a href="#%28def._%28%28lib._delay-pure%2Fmain..rkt%29._built-in-pure-functions-set%29%29" class="RktValLink" data-pltdoc="x">built-in-pure-functions-set</a></span>.</div></p><p>Note that this has a global effect. For one-off exceptions, especially when
it&rsquo;s not 100% clear whether the function is always pure and stateless, prefer
<span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._unsafe-pure%2Fstateless%29%29" class="RktStxLink" data-pltdoc="x">unsafe-pure/stateless</a></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._delay-pure/main..rkt)._unsafe-declare-allowed-in-pure/stateful))"></a><span title="Provided from: delay-pure | Package: delay-pure"><span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._unsafe-declare-allowed-in-pure%2Fstateful%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">unsafe-declare-allowed-in-pure/stateful</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">identifier</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Declares that the given identifier should be trusted as a function that can
be used within <span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._pure%2Fstateful%29%29" class="RktStxLink" data-pltdoc="x">pure/stateful</a></span> and its derivatives.</div></p><p>The <span class="RktVar">identifier</span> function should not vary its outputs and effects
based on external state (i.e. its outputs and effects should depend only on
the arguments passed to it).</p><p>The <span class="RktVar">identifier</span> function may internally use mutation. It may return
freshly-created stateful objects (closures over freshly-created mutable
variables, closures over mutable arguments, and mutable data structure which
are freshly created or extracted from the arguments). It may mutate any
mutable data structure passed as an argument.</p><p>Note that this has a global effect. For one-off exceptions, prefer
<span class="RktSym"><a href="#%28form._%28%28lib._delay-pure%2Fmain..rkt%29._unsafe-operation%2Fmutating%29%29" class="RktStxLink" data-pltdoc="x">unsafe-operation/mutating</a></span>.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.6&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index-2.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.6&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body>
<!-- Mirrored from docs.racket-lang.org/delay-pure/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Sep 2022 02:57:01 GMT -->
</html>